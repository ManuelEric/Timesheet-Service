import{r as c,o as pe,e as m,p as P,w as o,b as l,h as e,a as V,f as i,t as y,F as G,a0 as le,q as z,j as ye,H as B,i as k,l as q,W as ke,k as ae,V as Q,z as he,s as X,A as j,a1 as Te,a3 as $e,y as Se,n as me}from"./main-_fLkZ-AY.js";import{r as T}from"./rules-CkvmYWH-.js";import{A as ge}from"./ApiServiceCRM-BaVCGjaS.js";import{c as ne,V as ie,d as Ve,b as qe}from"./VCard-MpYbC6I-.js";import{V as xe}from"./VForm-D8PYVbGi.js";import{V as de,a as g}from"./VRow-DaoFyr2r.js";import{V as I}from"./VAutocomplete-RJlU06BS.js";import{V as _e}from"./VDialog-BYCUg4TV.js";import{V as Y}from"./VTooltip-D3L6ocr1.js";import{a as fe,V as Ue}from"./VTable-DE4_dZjb.js";import{V as we}from"./VTextarea-CCuJStB0.js";import{d as je}from"./debounce-rmTKhzIf.js";import{V as Pe}from"./VPagination-ACYpsFqH.js";import{V as ve}from"./VBadge-BIdfi22S.js";import"./VAvatar-BGE7fl55.js";import"./VImg-C3iIJCNc.js";import"./VList-DcK3maGA.js";import"./ssrBoot-DlMdpIlo.js";import"./VDivider-BXRMEgMA.js";import"./VCheckboxBtn-CFP6aR67.js";import"./VSelectionControl-CMDnsBTx.js";import"./VSlideGroup-DaFI5VRt.js";const Ie={key:0,class:"mb-4 d-flex gap-1"},Fe={class:"text-sm"},Ne={class:"d-flex justify-between align-center mb-3"},De=i("h4",{class:"w-100"},"Detail of Active Agreement",-1),Me=i("thead",null,[i("tr",null,[i("th",{class:"text-left",nowrap:""}," Engagement Type "),i("th",{nowrap:""},"Stream"),i("th",{nowrap:""},"Package"),i("th",{nowrap:""},"Fee Individual - Gross")])],-1),Ae={nowrap:""},Re=["href"],Ee={nowrap:""},He={nowrap:""},Ge={nowrap:""},be="mentor",ze={__name:"program_add_specialist_timesheet",emits:["close","reload"],setup(ce,{emit:D}){const L=D,d=c(!1),p=c(null),Z=c([]),W=c([]),O=c([]),$=c(null),M=c([]),R=c([]),ee=c([]),F=c(!1),C=c(null),re=c([]),N=c(),n=c({ref_details:[],mentortutor_email:null,subject_id:null,inhouse_id:null,package_id:null,duration:"",tax:2.5,individual_fee:null,notes:"",pic_id:[]}),oe=async()=>{const _="get/active/mentees/global";try{const u=await ge.get(_);u&&(W.value=u)}catch(u){console.error(u)}},s=async()=>{var u,S;const _="external-mentor/streams";try{d.value=!0;const r=await ge.get(_);r&&(O.value=r),d.value=!1}catch(r){X("error",(S=(u=r.response)==null?void 0:u.data)==null?void 0:S.message,"bottom-end"),console.error(r),d.value=!1}},x=async(_=!1)=>{const S=_?"api/v1/user/mentor-tutors?inhouse=true&role="+be:"api/v1/user/mentor-tutors?role="+"External Mentor";try{const r=await j.get(S);r&&(_?ee.value=Object.values(r):Z.value=r)}catch(r){console.error(r)}},J=async()=>{try{const _=await j.get("api/v1/package/component/list?category="+be);_&&(M.value=_)}catch(_){console.error(_)}},h=async(_,u,S,r)=>{try{const t=await j.get("api/v1/component/fee/ext-mentor/"+_+"/"+u+"/"+S+"/"+r);t&&(n.value.individual_fee=t.fee_individual,n.value.individual_fee?A():C.value=null)}catch(t){n.value.individual_fee=null,C.value=null,X("error","We're sorry, but we couldn't find a tutor fee for the selected curriculum and subject. This may be outside the scope of our current agreement. Please reach out to our HR team for assistance or to explore availableÂ options","bottom-end"),console.error(t)}te()},te=()=>{const _=n.value.package_id,u=M.value.findIndex(r=>r.id===_);let S=M.value[u];S.detail?(F.value=!0,n.value.duration=S.detail):(F.value=!1,n.value.duration=null)},v=async()=>{try{const _=await j.get("api/v1/user/component/list");_&&(R.value=_)}catch(_){console.error(_)}},K=async()=>{try{const _=await j.get("api/v1/engagement-type/component/list");_&&(re.value=_)}catch(_){console.log(_)}},E=async()=>{var u,S,r;n.value.mentortutor_email=p.value.email;const{valid:_}=await N.value.validate();if(_){d.value=!0;try{const t=await j.post("api/v1/timesheet/create/skip-request",n.value);t&&(X("success",t.message,"bottom-end"),L("reload"),n.value={ref_details:[],mentortutor_email:null,subject_id:null,subject_name:null,inhouse_id:null,package_id:null,duration:"",notes:"",pic_id:[],tax:null,individual_fee:""},p.value=[],window.open("/admin/timesheet/specialist/"+((u=t.data)==null?void 0:u.timesheet_id),"_blank"))}catch(t){if((r=(S=t==null?void 0:t.response)==null?void 0:S.data)!=null&&r.errors){const f=t.response.data.errors;X("error",f,"bottom-end")}}finally{L("close"),d.value=!1}}},A=()=>{const _=n.value.individual_fee*(1-n.value.tax/100);C.value=Math.trunc(_)},ue=()=>{const _=C.value/(1-n.value.tax/100);n.value.individual_fee=Math.trunc(_)};return pe(()=>{s(),oe(),K(),x(),x(!0),J(),v()}),(_,u)=>(m(),P(ie,{"max-width":"650","prepend-icon":"ri-send-plane-line",title:"Assign to Subject Specialist"},{default:o(()=>[l(ne,null,{default:o(()=>{var S,r;return[((S=e(n).ref_details)==null?void 0:S.length)>0?(m(),V("div",Ie,[i("p",Fe,y(((r=e(n).ref_details)==null?void 0:r.length)>1?"Students":"Student")+":",1),(m(!0),V(G,null,le(e(n).ref_details,t=>(m(),V("p",{key:t,class:"text-sm bg-info px-2 rounded"},y(t.student_first_name+" "+t.student_last_name),1))),128))])):z("",!0),l(xe,{onSubmit:ye(E,["prevent"]),ref_key:"formData",ref:N,"validate-on":"input"},{default:o(()=>[l(de,null,{default:o(()=>[l(g,{cols:"12"},{default:o(()=>[l(I,{clearable:"",modelValue:e(n).engagement_type,"onUpdate:modelValue":[u[0]||(u[0]=t=>e(n).engagement_type=t),u[1]||(u[1]=()=>(e(n).ref_details=[],p.value=null,$.value=null,e(n).package_id=null))],items:e(re),"item-props":t=>({title:t.name}),"item-value":"id",label:"Engagement Type",rules:e(T).required,loading:e(d),disabled:e(d)},null,8,["modelValue","items","item-props","rules","loading","disabled"])]),_:1}),l(g,{md:"12",cols:"12"},{default:o(()=>[l(I,{clearable:"",modelValue:e(n).ref_details,"onUpdate:modelValue":u[2]||(u[2]=t=>e(n).ref_details=t),label:"Mentee Name",items:e(W),"item-props":t=>({title:t.first_name+" "+t.last_name,subtitle:t.sch_name,value:{clientprog_id:t.clientprog_id,invoice_id:t.invoice_id,student_uuid:t.id,student_first_name:t.first_name,student_last_name:t.last_name,student_school:t.sch_name,student_grade:t.grade,program_name:t.program_name,require:t.require,package:t.package,curriculum:t.curriculum,engagement_type:e(n).engagement_type}}),rules:e(T).required,loading:e(d),disabled:e(d),density:"compact",multiple:""},null,8,["modelValue","items","item-props","rules","loading","disabled"])]),_:1}),l(g,{md:"6",cols:e(p)?11:12},{default:o(()=>[l(I,{density:"compact",clearable:"",modelValue:e(p),"onUpdate:modelValue":u[3]||(u[3]=t=>B(p)?p.value=t:null),label:"Subject Specialist Name",items:e(Z),"item-props":t=>{var f;return{title:t.full_name,subtitle:((f=t.roles)==null?void 0:f.length)>0?t.roles.map(b=>b.name).join(", "):"-",disabled:t.is_active==0}},rules:e(T).required,loading:e(d),disabled:e(d)},null,8,["modelValue","items","item-props","rules","loading","disabled"])]),_:1},8,["cols"]),e(p)?(m(),P(g,{key:0,cols:"1"},{default:o(()=>[l(_e,{"max-width":"600"},{activator:o(({props:t})=>[l(Y,{activator:"parent",location:"end"},{default:o(()=>[k("Fee Detail")]),_:1}),l(q,ke({icon:"ri-folder-info-line",class:"cursor-pointer mt-3"},t),null,16)]),default:o(({isActive:t})=>[l(ie,null,{default:o(()=>[l(ne,{class:"py-5"},{default:o(()=>{var f;return[i("div",Ne,[De,l(ae,{size:"x-small",color:"secondary",icon:"ri-close-line",onClick:b=>t.value=!1},null,8,["onClick"])]),((f=e(p))==null?void 0:f.roles.findIndex(b=>b.name==="External Mentor"))>=0?(m(),P(fe,{key:0,density:"compact"},{default:o(()=>[Me,i("tbody",null,[(m(!0),V(G,null,le(e(p).roles,(b,w)=>(m(),V(G,{key:w},[b.name=="External Mentor"?(m(!0),V(G,{key:0},le(b.subjects,a=>(m(),V("tr",{key:a},[i("td",Ae,[k(y(a.engagement_type_name??"-")+" ",1),a.agreement?(m(),V("a",{key:0,href:a.agreement,target:"_blank",class:"ms-2 d-inline cursor-pointer"},[l(Y,{activator:"parent",location:"end"},{default:o(()=>[k(" Check Agreement ")]),_:1}),l(q,{icon:"ri-file-pdf-2-line"})],8,Re)):z("",!0)]),i("td",Ee,y(a.stream??"-"),1),i("td",He,y(a.package_name??"-"),1),i("td",Ge," Rp. "+y(new Intl.NumberFormat("id-ID").format(a.fee_individual)),1)]))),128)):z("",!0)],64))),128))])]),_:1})):(m(),P(ne,{key:1,class:"text-center"},{default:o(()=>[k(" There is no tutoring subject ")]),_:1}))]}),_:2},1024)]),_:2},1024)]),_:1})]),_:1})):z("",!0),l(g,{md:e(p)?5:6,cols:"12"},{default:o(()=>[l(I,{density:"compact",clearable:"",label:"Stream",modelValue:e($),"onUpdate:modelValue":u[4]||(u[4]=t=>B($)?$.value=t:null),items:e(O),"item-title":"stream_name","item-value":"stream_name",loading:e(d),disabled:e(d)},null,8,["modelValue","items","loading","disabled"])]),_:1},8,["md"]),l(g,{md:"8",cols:"8"},{default:o(()=>[l(I,{density:"compact",clearable:"",label:"Package",modelValue:e(n).package_id,"onUpdate:modelValue":[u[5]||(u[5]=t=>e(n).package_id=t),u[6]||(u[6]=t=>h(e(p).id,e($),e(n).engagement_type,e(n).package_id))],items:e(M),"item-props":t=>({title:t.package!=null?t.type_of+" - "+t.package:t.type_of,subtitle:t.detail?t.detail/60+" Hours":"Customizable"}),"item-value":"id",rules:e(T).required,loading:e(d),disabled:e(d)},null,8,["modelValue","items","item-props","rules","loading","disabled"])]),_:1}),l(g,{md:"4",cols:"4"},{default:o(()=>[l(Q,{density:"compact",type:"number",clearable:"",label:+e(n).duration/60?""+e(n).duration/60+" Hours":"Minutes",readonly:e(F),modelValue:e(n).duration,"onUpdate:modelValue":u[7]||(u[7]=t=>e(n).duration=t),rules:e(T).required},null,8,["label","readonly","modelValue","rules"])]),_:1}),l(g,{md:"4",cols:"7"},{default:o(()=>[l(Q,{type:"number",clearable:"",label:"Fee/hours (Nett)",modelValue:e(C),"onUpdate:modelValue":[u[8]||(u[8]=t=>B(C)?C.value=t:null),ue],density:"compact",rules:e(T).required,readonly:""},null,8,["modelValue","rules"])]),_:1}),l(g,{md:"4",cols:"5"},{default:o(()=>[l(Q,{type:"number",clearable:"",label:"Tax",modelValue:e(n).tax,"onUpdate:modelValue":[u[9]||(u[9]=t=>e(n).tax=t),ue],rules:e(T).required,density:"compact",readonly:""},null,8,["modelValue","rules"])]),_:1}),l(g,{md:"4",cols:"12"},{default:o(()=>[l(Y,{activator:"parent",location:"top"},{default:o(()=>[k(" Fee Gross is automatically calculated based on the entered Net Fee and Tax Rate. ")]),_:1}),l(Q,{type:"number",clearable:"",label:"Fee/hours (Gross)",modelValue:e(n).individual_fee,"onUpdate:modelValue":[u[10]||(u[10]=t=>e(n).individual_fee=t),A],density:"compact",readonly:"",rules:e(T).required},null,8,["modelValue","rules"])]),_:1}),l(g,{md:"6",cols:"12"},{default:o(()=>[l(I,{density:"compact",clearable:"",modelValue:e(n).inhouse_id,"onUpdate:modelValue":u[11]||(u[11]=t=>e(n).inhouse_id=t),label:"Inhouse Mentor",items:e(ee),"item-props":t=>({title:t.full_name}),"item-value":"uuid",loading:e(d),disabled:e(d),rules:e(T).required},null,8,["modelValue","items","item-props","loading","disabled","rules"])]),_:1}),l(g,{md:"6",cols:"12"},{default:o(()=>[l(I,{density:"compact",multiple:"",clearable:"",chips:"",label:"PIC",modelValue:e(n).pic_id,"onUpdate:modelValue":u[12]||(u[12]=t=>e(n).pic_id=t),items:e(R),"item-title":"full_name","item-value":"id",loading:e(d),disabled:e(d),rules:e(T).required},null,8,["modelValue","items","loading","disabled","rules"])]),_:1}),l(g,{md:"12"},{default:o(()=>[l(we,{label:"Notes",modelValue:e(n).notes,"onUpdate:modelValue":u[13]||(u[13]=t=>e(n).notes=t)},null,8,["modelValue"])]),_:1})]),_:1}),l(Ve,{class:"mt-5 px-0"},{default:o(()=>[l(ae,{variant:"tonal",color:"error",type:"button",onClick:u[14]||(u[14]=t=>L("close"))},{default:o(()=>[l(q,{icon:"ri-close-line",class:"me-3"}),k(" Close ")]),_:1}),l(he),l(ae,{variant:"tonal",color:"success",type:"submit"},{default:o(()=>[k(" Save "),l(q,{icon:"ri-save-line",class:"ms-3"})]),_:1})]),_:1})]),_:1},512)]}),_:1})]),_:1}))}},Be={key:0,class:"mb-4 d-flex gap-1"},Le={class:"text-sm"},We={class:"d-flex justify-between align-center mb-3"},Oe=i("h4",{class:"w-100"},"Detail of Active Agreement",-1),Je=i("thead",null,[i("tr",null,[i("th",{class:"text-left",nowrap:""}," Curriculum "),i("th",{nowrap:""},"Subject Tutoring"),i("th",{nowrap:""},"Grade"),i("th",{nowrap:""},"Fee Individual - Gross")])],-1),Ke={nowrap:""},Qe=["href"],Xe={nowrap:""},Ye={nowrap:""},Ze={nowrap:""},et={__name:"program_add_tutoring",emits:["close","reload"],setup(ce,{emit:D}){const L=D,d=c(!1),p=c(null),Z=c([]),W=c([]),O=c([]),$=c([]),M=c([]),R=c([]),ee=c([]),F=c(!1),C=c("tutor"),re=c(null),N=c(null),n=c([]),oe=c(),s=c({ref_id:null,mentortutor_email:null,subject_id:null,inhouse_id:null,package_id:null,tax:null,individual_fee:null,duration:"",notes:"",pic_id:[],curriculum_id:null}),x=async()=>{var t,f;const r="api/v1/program/list?require=tutor";try{d.value=!0;const b=await j.get(r);b&&(Z.value=b),d.value=!1}catch(b){X("error",(f=(t=b.response)==null?void 0:t.data)==null?void 0:f.message,"bottom-end"),console.error(b),d.value=!1}},J=async(r=!1)=>{const t=r?"api/v1/user/mentor-tutors?inhouse=true&role="+C.value:"api/v1/user/mentor-tutors?role="+C.value;try{const f=await j.get(t);f&&(r?ee.value=Object.values(f):W.value=f)}catch(f){console.error(f)}},h=async()=>{try{const r=await j.get("api/v1/package/component/list?category="+C.value);r&&(M.value=r)}catch(r){console.error(r)}},te=()=>{const r=s.value.package_id,t=M.value.findIndex(b=>b.id===r);let f=M.value[t];f.detail?(F.value=!0,s.value.duration=f.detail):(F.value=!1,s.value.duration=null)},v=async()=>{try{const r=await j.get("api/v1/user/component/list");r&&(R.value=r)}catch(r){console.error(r)}},K=async(r,t=null,f=0)=>{re.value=f,s.value.tax=(f==1,2.5),s.value.subject_id=null,s.value.subject_name=null,s.value.individual_fee=null,N.value=null;const b=s.value.curriculum_id?"/"+s.value.curriculum_id:"";try{const w=await j.get("api/v1/user/mentor-tutors/"+t+"/subjects"+b);if(w){const a=[],U=new Set;for(const H of w)U.has(H.tutor_subject)||(U.add(H.tutor_subject),a.push(H));$.value=a}}catch(w){console.error(w)}},E=async(r,t,f)=>{var w;const b=(w=n.value[0])==null?void 0:w.grade;if(t)try{const a=await j.get("api/v1/component/fee/tutor/"+r+"/"+t+"/"+f+"/"+b);a&&(s.value.individual_fee=n.value.length>1?a.fee_group:a.fee_individual,s.value.individual_fee?u():N.value=null)}catch(a){X("error","We're sorry, but we couldn't find a tutor fee for the selected curriculum and subject. This may be outside the scope of our current agreement. Please reach out to our HR team for assistance or to explore availableÂ options","bottom-end"),console.error(a)}else s.value.individual_fee=null,N.value=null},A=async()=>{try{const r=await j.get("api/v1/curriculum/component/list");r&&(O.value=r)}catch(r){console.error(r)}},ue=async()=>{var t,f,b;s.value.mentortutor_email=p.value.email;const{valid:r}=await oe.value.validate();if(r){d.value=!0;try{const w=await j.post("api/v1/timesheet/create",s.value);w&&(X("success",w.message,"bottom-end"),L("reload"),s.value={ref_id:[],mentortutor_email:null,subject_id:null,subject_name:null,inhouse_id:null,package_id:null,duration:"",notes:"",pic_id:[],tax:null,individual_fee:"",curriculum_id:null},p.value=null,window.open("/admin/timesheet/tutoring/"+((t=w.data)==null?void 0:t.timesheet_id),"_blank"))}catch(w){if(console.log(w),(b=(f=w==null?void 0:w.response)==null?void 0:f.data)!=null&&b.errors){const a=w.response.data.errors;X("error",a,"bottom-end")}}finally{L("close"),d.value=!1}}},_=()=>{var r,t,f;s.value={ref_id:n.value.map(b=>b.id),curriculum_id:((r=n.value[0])==null?void 0:r.curriculum)??null,package_id:((t=n.value[0])==null?void 0:t.package)??null,program_name:((f=n.value[0])==null?void 0:f.program_name)??null}},u=()=>{const r=s.value.individual_fee*(1-s.value.tax/100);N.value=Math.trunc(r)},S=()=>{const r=N.value/(1-s.value.tax/100);s.value.individual_fee=Math.trunc(r)};return pe(()=>{x(),J(),J(!0),h(),v(),A()}),(r,t)=>{var f;return m(),P(ie,{"max-width":"650","prepend-icon":"ri-send-plane-line",title:((f=e(n)[0])==null?void 0:f.program_name)??"Assign to Tutor"},{default:o(()=>[l(ne,null,{default:o(()=>{var b,w;return[((b=e(n))==null?void 0:b.length)>0?(m(),V("div",Be,[i("p",Le,y(((w=e(n))==null?void 0:w.length)>1?"Students":"Student")+":",1),(m(!0),V(G,null,le(e(n),a=>(m(),V("p",{key:a,class:"text-sm bg-info px-2 rounded"},y(a.mentee),1))),128))])):z("",!0),l(xe,{onSubmit:ye(ue,["prevent"]),ref_key:"formData",ref:oe,"validate-on":"input"},{default:o(()=>[l(de,null,{default:o(()=>[l(g,{md:"12",cols:"12"},{default:o(()=>[l(I,{clearable:"",modelValue:e(n),"onUpdate:modelValue":[t[0]||(t[0]=a=>B(n)?n.value=a:null),_],label:"Student Name",items:e(Z),"item-props":a=>({title:a.student_name,subtitle:a.program_name+(a.timesheet_id?" â":"")+(a.scnd_timesheet_id?" â":""),disabled:a.timesheet_id&&a.scnd_timesheet_id,value:{id:a.id,require:a.require,mentee:a.student_name,package:a.package,curriculum:a.curriculum,program_name:a.program_name,grade:a.student_grade}}),rules:e(T).required,loading:e(d),disabled:e(d),density:"compact",multiple:""},null,8,["modelValue","items","item-props","rules","loading","disabled"])]),_:1}),l(g,{cols:e(p)?11:12},{default:o(()=>[l(I,{clearable:"",modelValue:e(p),"onUpdate:modelValue":[t[1]||(t[1]=a=>B(p)?p.value=a:null),t[2]||(t[2]=a=>K(e(p).roles,e(p).uuid,e(p).has_npwp))],label:"Tutor Name",items:e(W),"item-props":a=>{var U;return{title:a.full_name,subtitle:((U=a.roles)==null?void 0:U.length)>0?a.roles.map(H=>H.name).join(", "):"-",disabled:a.is_active==0}},rules:e(T).required,loading:e(d),disabled:e(d),density:"compact"},null,8,["modelValue","items","item-props","rules","loading","disabled"])]),_:1},8,["cols"]),e(p)?(m(),P(g,{key:0,cols:"1"},{default:o(()=>[l(_e,{"max-width":"600"},{activator:o(({props:a})=>[l(Y,{activator:"parent",location:"end"},{default:o(()=>[k("Fee Detail")]),_:1}),l(q,ke({icon:"ri-folder-info-line",class:"cursor-pointer mt-3"},a),null,16)]),default:o(({isActive:a})=>[l(ie,null,{default:o(()=>[l(ne,{class:"py-5"},{default:o(()=>{var U;return[i("div",We,[Oe,l(ae,{size:"x-small",color:"secondary",icon:"ri-close-line",onClick:H=>a.value=!1},null,8,["onClick"])]),((U=e(p))==null?void 0:U.roles.findIndex(H=>H.name==="Tutor"))>=0?(m(),P(fe,{key:0,density:"compact"},{default:o(()=>[Je,i("tbody",null,[(m(!0),V(G,null,le(e(p).roles,(H,Ce)=>(m(),V(G,{key:Ce},[H.name=="Tutor"?(m(!0),V(G,{key:0},le(H.subjects,se=>(m(),V("tr",{key:se},[i("td",Ke,[k(y(se.curriculum_name??"-")+" ",1),se.agreement?(m(),V("a",{key:0,href:se.agreement,target:"_blank",class:"ms-2 d-inline cursor-pointer"},[l(Y,{activator:"parent",location:"end"},{default:o(()=>[k(" Check Agreement ")]),_:1}),l(q,{icon:"ri-file-pdf-2-line"})],8,Qe)):z("",!0)]),i("td",Xe,y(se.tutor_subject??"-"),1),i("td",Ye,y(se.grade??"-"),1),i("td",Ze,"Rp. "+y(new Intl.NumberFormat("id-ID").format(se.fee_individual)),1)]))),128)):z("",!0)],64))),128))])]),_:1})):(m(),P(ne,{key:1,class:"text-center"},{default:o(()=>[k(" There is no tutoring subject ")]),_:1}))]}),_:2},1024)]),_:2},1024)]),_:1})]),_:1})):z("",!0),l(g,{md:"6",cols:"6"},{default:o(()=>[l(I,{clearable:"",modelValue:e(s).curriculum_id,"onUpdate:modelValue":[t[3]||(t[3]=a=>e(s).curriculum_id=a),t[4]||(t[4]=a=>E(e(p).id,e(s).subject_name,e(s).curriculum_id))],label:"Curriculum",items:e(O),"item-props":a=>({title:a.name}),loading:e(d),readonly:"",density:"compact","item-value":"id"},null,8,["modelValue","items","item-props","loading"])]),_:1}),l(g,{md:"6",cols:"6"},{default:o(()=>[l(I,{clearable:"",modelValue:e(s).subject_name,"onUpdate:modelValue":[t[5]||(t[5]=a=>e(s).subject_name=a),t[6]||(t[6]=a=>E(e(p).id,e(s).subject_name,e(s).curriculum_id))],label:"Subject Tutoring",items:e($),"item-value":"tutor_subject","item-title":"tutor_subject",loading:e(d),disabled:e(d),rules:e(T).required,density:"compact"},null,8,["modelValue","items","loading","disabled","rules"])]),_:1}),l(g,{md:"8",cols:"8"},{default:o(()=>{var a;return[l(I,{clearable:"",label:"Package",modelValue:e(s).package_id,"onUpdate:modelValue":[t[7]||(t[7]=U=>e(s).package_id=U),te],items:e(M),density:"compact","item-props":U=>({title:U.package!=null?U.type_of+" - "+U.package:U.type_of,subtitle:U.detail?U.detail/60+" Hours":"Customizable"}),"item-value":"id",rules:e(T).required,loading:e(d),disabled:e(d)||((a=e(n)[0])==null?void 0:a.package)},null,8,["modelValue","items","item-props","rules","loading","disabled"])]}),_:1}),l(g,{md:"4",cols:"4"},{default:o(()=>[l(Q,{type:"number",clearable:"",label:+e(s).duration/60?"Minutes ("+e(s).duration/60+" Hours)":"Minutes",readonly:e(F),modelValue:e(s).duration,"onUpdate:modelValue":t[8]||(t[8]=a=>e(s).duration=a),density:"compact",rules:e(T).required},null,8,["label","readonly","modelValue","rules"])]),_:1}),l(g,{md:"4",cols:"7"},{default:o(()=>[l(Q,{type:"number",clearable:"",label:"Fee/hours (Nett)",modelValue:e(N),"onUpdate:modelValue":[t[9]||(t[9]=a=>B(N)?N.value=a:null),S],density:"compact",rules:e(T).required,readonly:""},null,8,["modelValue","rules"])]),_:1}),l(g,{md:"4",cols:"5"},{default:o(()=>[l(Q,{type:"number",clearable:"",label:"Tax",modelValue:e(s).tax,"onUpdate:modelValue":[t[10]||(t[10]=a=>e(s).tax=a),S],rules:e(T).required,density:"compact",readonly:""},null,8,["modelValue","rules"])]),_:1}),l(g,{md:"4",cols:"12"},{default:o(()=>[l(Y,{activator:"parent",location:"top"},{default:o(()=>[k(" Fee Gross is automatically calculated based on the entered Net Fee and Tax Rate. ")]),_:1}),l(Q,{type:"number",clearable:"",label:"Fee/hours (Gross)",modelValue:e(s).individual_fee,"onUpdate:modelValue":[t[11]||(t[11]=a=>e(s).individual_fee=a),u],density:"compact",readonly:"",rules:e(T).required},null,8,["modelValue","rules"])]),_:1}),l(g,{md:"6",cols:"6"},{default:o(()=>[l(I,{clearable:"",modelValue:e(s).inhouse_id,"onUpdate:modelValue":t[12]||(t[12]=a=>e(s).inhouse_id=a),label:"Inhouse Mentor/Tutor",items:e(ee),density:"compact","item-props":a=>({title:a.full_name}),"item-value":"uuid",loading:e(d),disabled:e(d),rules:e(T).required},null,8,["modelValue","items","item-props","loading","disabled","rules"])]),_:1}),l(g,{md:"6",cols:"6"},{default:o(()=>[l(I,{multiple:"",clearable:"",chips:"",label:"PIC",modelValue:e(s).pic_id,"onUpdate:modelValue":t[13]||(t[13]=a=>e(s).pic_id=a),items:e(R),"item-title":"full_name","item-value":"id",loading:e(d),density:"compact",disabled:e(d),rules:e(T).required},null,8,["modelValue","items","loading","disabled","rules"])]),_:1}),l(g,{md:"12"},{default:o(()=>[l(we,{label:"Notes",modelValue:e(s).notes,"onUpdate:modelValue":t[14]||(t[14]=a=>e(s).notes=a),density:"compact"},null,8,["modelValue"])]),_:1})]),_:1}),l(Ve,{class:"mt-5 px-0"},{default:o(()=>[l(ae,{variant:"tonal",color:"error",type:"button",onClick:t[15]||(t[15]=a=>L("close"))},{default:o(()=>[l(q,{icon:"ri-close-line",class:"me-3"}),k(" Close ")]),_:1}),l(he),l(ae,{variant:"tonal",color:"success",type:"submit"},{default:o(()=>[k(" Save "),l(q,{icon:"ri-save-line",class:"ms-3"})]),_:1})]),_:1})]),_:1},512)]}),_:1})]),_:1},8,["title"])}}},tt=i("div",{class:"d-flex justify-between align-center"},[i("div",{class:"w-100"},[i("h4",null,"Timesheet List")])],-1),lt={class:"d-flex gap-2"},at=i("th",{class:"text-uppercase",width:"1%"}," No ",-1),ot=i("th",{class:"text-uppercase text-center"},"School/Student Name",-1),st={class:"text-uppercase text-center"},nt=i("th",{class:"text-uppercase text-center"},"Package",-1),rt=i("th",{class:"text-uppercase text-center"},"Tutor/Mentor",-1),it=i("th",{class:"text-uppercase text-center"},"PIC",-1),ut=i("th",{class:"text-uppercase text-center"},"Total Hours",-1),dt=i("th",{class:"text-uppercase text-center"},"Used",-1),ct=i("th",{class:"text-uppercase text-center"},"#",-1),mt=["onClick"],pt={key:0},_t={key:1},ft={class:"text-start"},gt={class:"text-left"},vt={class:"text-left"},bt={class:"text-left"},yt={class:"text-left"},kt={key:0},ht=i("tr",null,[i("td",{colspan:"9",class:"text-center"}," Sorry, no data found. ")],-1),Vt=[ht],xt={class:"d-flex justify-center mt-5"},Wt={__name:"timesheet",props:{name:String},setup(ce){const D=ce,L=$e();c([]);const d=c(!1),p=c(1),Z=c(),W=c(),O=c([]),$=c(!1),M=c([]),R=c(),ee=c([]),F=c(),C=async()=>{var K,E;const s="?page="+p.value,x=W.value?"&keyword="+W.value:"",J=R.value?"&program_name="+encodeURIComponent(R.value):"",h=F.value?"&package_id="+F.value:"",te="&paginate=true",v=D.name!="tutoring"?"&is_subject_specialist=true":"";try{$.value=!0;const A=await j.get("api/v1/timesheet/list"+s+x+J+h+te+v);A&&(p.value=A.current_page,Z.value=A.last_page,O.value=A),$.value=!1}catch(A){X("error",(E=(K=A.response)==null?void 0:K.data)==null?void 0:E.message,"bottom-end"),console.error(A),$.value=!1}},re=async()=>{try{const s=await j.get("api/v1/program/component/list");s&&(M.value=s)}catch(s){console.error(s)}},N=async()=>{try{const s=await j.get("api/v1/package/component/list");s&&(ee.value=s)}catch(s){console.error(s)}},n=je(async s=>{p.value=1,W.value=s.target.value,await C()},1e3),oe=s=>{const x=L.resolve("/admin/timesheet/"+D.name+"/"+s);window.open(x.href,"_blank")};return Te(()=>{C()}),pe(()=>{C(),re(),N()}),(s,x)=>{const J=Se("VText");return m(),V(G,null,[l(_e,{modelValue:e(d),"onUpdate:modelValue":x[2]||(x[2]=h=>B(d)?d.value=h:null),width:"auto",persistent:""},{default:o(()=>[D.name=="tutoring"?(m(),P(et,{key:0,onClose:x[0]||(x[0]=h=>d.value=!1),onReload:C})):(m(),P(ze,{key:1,onClose:x[1]||(x[1]=h=>d.value=!1),onReload:C}))]),_:1},8,["modelValue"]),l(ie,null,{default:o(()=>[l(qe,null,{default:o(()=>[tt]),_:1}),l(ne,null,{default:o(()=>[l(de,{class:"my-1 justify-space-between"},{default:o(()=>[D.name=="tutoring"?(m(),P(g,{key:0,cols:"12",md:"6"},{default:o(()=>[l(de,null,{default:o(()=>[l(g,{cols:"12",md:"6"},{default:o(()=>[l(I,{density:"compact",clearable:"",modelValue:e(R),"onUpdate:modelValue":[x[3]||(x[3]=h=>B(R)?R.value=h:null),C],label:"Program Name",items:e(M),"item-title":"program_name",placeholder:"Select Program Name",loading:e($),disabled:e($)},null,8,["modelValue","items","loading","disabled"])]),_:1}),l(g,{cols:"12",md:"6"},{default:o(()=>[l(I,{density:"compact",clearable:"true",modelValue:e(F),"onUpdate:modelValue":[x[4]||(x[4]=h=>B(F)?F.value=h:null),C],label:"Package",items:e(ee),"item-props":h=>({title:h.package!=null?h.type_of+" - "+h.package:h.type_of}),"item-value":"id",placeholder:"Select Package",loading:e($),disabled:e($)},null,8,["modelValue","items","item-props","loading","disabled"])]),_:1})]),_:1})]),_:1})):z("",!0),l(g,{cols:"12",md:D.name=="tutoring"?3:12},{default:o(()=>[i("div",lt,[l(Q,{density:"compact",loading:e($),disabled:e($),"append-inner-icon":"ri-search-line",label:"Search","hide-details":"","single-line":"",onInput:e(n)},null,8,["loading","disabled","onInput"]),i("div",{class:me(["text-end",D.name=="tutoring"?"":"w-md-75"])},[l(Y,{activator:"parent",location:"start"},{default:o(()=>[k("Add New Timesheet")]),_:1}),l(ae,{icon:"ri-add-line",onClick:x[5]||(x[5]=h=>d.value=!0)})],2)])]),_:1},8,["md"])]),_:1}),e($)?(m(),P(Ue,{key:0,class:"mx-auto border",type:"table-thead, table-row@10"})):(m(),P(fe,{key:1,class:"text-no-wrap",hover:""},{default:o(()=>{var h,te;return[i("thead",null,[i("tr",null,[at,ot,i("th",st,y(D.name=="tutoring"?"Program Name":"Engagement Type"),1),nt,rt,it,ut,dt,ct])]),i("tbody",null,[(m(!0),V(G,null,le(e(O).data,(v,K)=>(m(),V("tr",{key:K,class:me([v.void=="true"?"bg-secondary":"","cursor-pointer"]),onClick:E=>oe(v.id)},[i("td",null,y(parseInt(K)+1),1),i("td",{class:me(v.group?"cursor-pointer text-left":"text-left")},[v.group?(m(),P(J,{key:0},{default:o(()=>[l(q,{icon:"ri-group-line",class:"me-3"}),k(" "+y(v.clients[0])+" ",1),l(ve,{color:"error",content:v.clients.length-1+"+",inline:""},null,8,["content"]),l(Y,{activator:"parent",location:"top",transition:"scroll-y-transition",class:"bg-white"},{default:o(()=>[(m(!0),V(G,null,le(v.clients,E=>(m(),V("div",null,y(E),1))),256))]),_:2},1024)]),_:2},1024)):(m(),P(J,{key:1},{default:o(()=>[l(q,{icon:"ri-user-line",class:"me-3"}),k(" "+y(v.clients),1)]),_:2},1024)),v.spent==v.duration?(m(),P(ve,{key:2,color:"success",content:"Done",inline:"",class:"ms-2"})):z("",!0)],2),D.name=="tutoring"?(m(),V("td",pt,[l(q,{icon:"ri-bookmark-3-line",class:"me-3"}),k(" "+y(v.detail_package=="Trial"?"[TRIAL]":"")+" "+y(v.program_name),1)])):(m(),V("td",_t,[l(q,{icon:"ri-bookmark-3-line",class:"me-3"}),k(" "+y(v.engagement_type),1)])),i("td",ft,[l(q,{icon:"ri-bookmark-line",class:"me-3"}),k(" "+y(v.detail_package?v.package_type+" - "+v.detail_package:v.package_type),1)]),i("td",gt,[l(q,{icon:"ri-user-line",class:"me-3"}),k(" "+y(v.tutor_mentor),1)]),i("td",vt,[l(q,{icon:"ri-user-line",class:"cursor-pointer me-3"}),k(" "+y(v.admin),1)]),i("td",bt,[l(q,{icon:"ri-calendar-schedule-line",class:"cursor-pointer me-3"}),k(" "+y(v.duration/60)+" Hours ",1)]),i("td",yt,[l(q,{icon:"ri-timer-2-line",class:"cursor-pointer me-3"}),k(" "+y((v.spent/60).toFixed(2))+" Hours ",1)]),i("td",null,[l(ae,{color:v.void=="true"?"light":"secondary",onClick:E=>oe(v.id)},{default:o(()=>[l(q,{icon:"ri-timeline-view",class:"cursor-pointer"}),l(Y,{activator:"parent",location:"top",transition:"scroll-y-transition"},{default:o(()=>[k(" View Detail ")]),_:1})]),_:2},1032,["color","onClick"])])],10,mt))),128))]),((te=(h=e(O))==null?void 0:h.data)==null?void 0:te.length)==0?(m(),V("tfoot",kt,Vt)):z("",!0)]}),_:1})),i("div",xt,[l(Pe,{modelValue:e(p),"onUpdate:modelValue":[x[6]||(x[6]=h=>B(p)?p.value=h:null),C],length:e(Z),"total-visible":4,color:"primary","show-first-last-page":!1},null,8,["modelValue","length"])])]),_:1})]),_:1})],64)}}};export{Wt as default};
