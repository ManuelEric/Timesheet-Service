import{aw as q,K as J,r as p,e as R,c as W,b as t,w as l,ax as K,k as h,A as k,J as T,U as P,s as m,l as Z,o as f,a as b,u as e,j as v,f as g,W as w,Y as x,Z as U,h as A}from"./main-DZIQZe1y.js";import{r as V}from"./rules-CkvmYWH-.js";import{l as z}from"./eduall-jXBsxaj5.js";import{a as G,b as H}from"./auth-v1-mask-light--N6hHkxK.js";import{V as O,d as Q,b as X,a as S}from"./VCard-DmPYlA-K.js";import{V as N,a as _}from"./VRow-D8cZUnpE.js";import{V as E}from"./VForm-B8VmS2h5.js";import"./VAvatar-K3fpA4_3.js";import"./VImg-Ca9KsZtr.js";const ee={class:"auth-wrapper d-flex align-center justify-center pa-4"},ae={class:"d-flex justify-center mb-5"},se=["src"],te=b("h5",{class:"text-h5 font-weight-semibold mb-1"},"Welcome to Timesheet App! 👋🏻",-1),oe=b("p",{class:"mb-0"},"Please sign-in to your account and start the adventure",-1),le={class:"d-flex align-center justify-end flex-wrap my-2"},ve={__name:"login",props:{token:String,email:String,uuid:String},setup(Y){const j=q();J(()=>j.global.name.value==="light"?G:H);const u=Y,y=p(),s=p({token:"",email:"",password:"",password_confirmation:""}),r=p(!1),c=p(!1),d=p(!0),i=p(!1),B=[o=>o!==s.value.password?"Passwords do not match":!0],D=async()=>{const{valid:o}=await y.value.validate();if(o){r.value=!0;try{const a=await k.post("api/v1/auth/email/checking",{email:s.value.email});a&&(c.value=!0,a.has_password?d.value=!0:d.value=!1),r.value=!1}catch(a){m("error","You`re email is not found!","bottom-end"),console.error(a),r.value=!1}}},C=async()=>{const{valid:o}=await y.value.validate();if(o){r.value=!0;try{if(d.value){const a=await k.post("api/v1/identity/generate-token",{email:s.value.email,password:s.value.password});a&&(T.saveToken(a.granted_token),P.saveUser(a),m("success","You`ve successfully login.","bottom-end"),setTimeout(()=>{h.go("/user/dashboard")},1500))}else await I();r.value=!1}catch(a){s.value.password="",m("error","You`re password is wrong.","bottom-end"),console.error(a),r.value=!1}}},I=async()=>{try{const o=u.token?"api/v1/auth/reset-password":"api/v1/auth/create-password";await k.post(o,s.value)&&(d.value=!0,await C())}catch(o){console.error(o)}},L=()=>{s.value.email=u.email,s.value.token=u.token,c.value=!0,d.value=!1},M=()=>{K().isAuthenticated.value&&h.push("/user/dashboard")},F=async()=>{try{const o=await k.get("api/v1/auth/u/"+u.uuid);o&&(T.saveToken(o.granted_token),P.saveUser(o),setTimeout(()=>{h.push("/user/request").then(()=>{m("success","You`ve successfully login.","bottom-end"),h.go()})},1500))}catch(o){s.value.password="",m("error","You`re password is wrong.","bottom-end"),console.error(o)}finally{r.value=!1}};return R(()=>{M(),u.token&&L(),u.uuid&&F()}),(o,a)=>{const $=Z("router-link");return f(),W("div",ee,[t(O,{class:"auth-card pa-4 pt-7","max-width":"448"},{default:l(()=>[t(Q,{class:"justify-center"},{default:l(()=>[b("div",ae,[b("img",{src:e(z),alt:"Timesheet - EduALL",class:"w-50 text-center"},null,8,se)]),t(X,{class:"font-weight-semibold text-2xl text-uppercase"},{default:l(()=>[v(" Timesheet App ")]),_:1})]),_:1}),t(S,{class:"pt-2 text-center"},{default:l(()=>[te,oe]),_:1}),t(S,null,{default:l(()=>[e(c)?(f(),g(E,{key:1,ref_key:"formData",ref:y,onSubmit:U(C,["prevent"]),"validate-on":"input","fast-fail":""},{default:l(()=>[t(N,null,{default:l(()=>[t(_,{cols:"12"},{default:l(()=>[t(w,{modelValue:e(s).email,"onUpdate:modelValue":a[1]||(a[1]=n=>e(s).email=n),label:"Email",type:"email",disabled:e(c),rules:e(V).email},null,8,["modelValue","disabled","rules"])]),_:1}),e(d)?(f(),g(_,{key:0,cols:"12"},{default:l(()=>[t(w,{modelValue:e(s).password,"onUpdate:modelValue":a[2]||(a[2]=n=>e(s).password=n),label:"Password",placeholder:"············",type:e(i)?"text":"password","append-inner-icon":e(i)?"ri-eye-off-line":"ri-eye-line","onClick:appendInner":a[3]||(a[3]=n=>i.value=!e(i)),rules:e(V).required},null,8,["modelValue","type","append-inner-icon","rules"]),b("div",le,[t($,{to:"/user/forgot",class:"ms-2 mb-1"},{default:l(()=>[v(" Forgot Password? ")]),_:1})]),t(x,{block:"",type:"submit",loading:e(r),disabled:e(r)},{default:l(()=>[v(" Login ")]),_:1},8,["loading","disabled"])]),_:1})):A("",!0),e(c)&&!e(d)?(f(),g(_,{key:1,cols:"12"},{default:l(()=>[t(w,{modelValue:e(s).password,"onUpdate:modelValue":a[4]||(a[4]=n=>e(s).password=n),label:"New Password",placeholder:"············",type:e(i)?"text":"password","append-inner-icon":e(i)?"ri-eye-off-line":"ri-eye-line","onClick:appendInner":a[5]||(a[5]=n=>i.value=!e(i)),rules:e(V).password,class:"mb-6"},null,8,["modelValue","type","append-inner-icon","rules"]),t(w,{modelValue:e(s).password_confirmation,"onUpdate:modelValue":a[6]||(a[6]=n=>e(s).password_confirmation=n),label:"Confirmation Password",placeholder:"············",type:e(i)?"text":"password","append-inner-icon":e(i)?"ri-eye-off-line":"ri-eye-line","onClick:appendInner":a[7]||(a[7]=n=>i.value=!e(i)),class:"mb-6",rules:B},null,8,["modelValue","type","append-inner-icon"]),t(x,{block:"",type:"submit",loading:e(r),disabled:e(r)},{default:l(()=>[v(" Create New Password ")]),_:1},8,["loading","disabled"])]),_:1})):A("",!0)]),_:1})]),_:1},512)):(f(),g(E,{key:0,ref_key:"formData",ref:y,onSubmit:U(D,["prevent"])},{default:l(()=>[t(N,null,{default:l(()=>[t(_,{cols:"12"},{default:l(()=>[t(w,{modelValue:e(s).email,"onUpdate:modelValue":a[0]||(a[0]=n=>e(s).email=n),label:"Email",type:"email",disabled:e(c),rules:e(V).email},null,8,["modelValue","disabled","rules"]),t(x,{block:"",type:"submit",class:"mt-4",loading:e(r),disabled:e(r)},{default:l(()=>[v(" Check Email ")]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},512))]),_:1})]),_:1})])}}};export{ve as default};
