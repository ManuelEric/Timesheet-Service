import{r as c,o as pe,e as m,p as q,w as a,b as l,h as e,a as x,f as i,t as y,F as H,a0 as ee,q as G,j as ye,H as z,i as h,l as U,W as ke,k as te,V as K,z as Ve,s as Q,A as j,a1 as Te,a3 as $e,y as Se,n as me}from"./main-BtbNASML.js";import{r as T}from"./rules-CkvmYWH-.js";import{A as ge}from"./ApiServiceCRM-DO_QGdht.js";import{c as oe,V as ie,d as he,b as Ue}from"./VCard-DIbp9ZQ2.js";import{V as xe}from"./VForm-DbBEBB26.js";import{V as de,a as g}from"./VRow-DkCl9HSU.js";import{V as P}from"./VAutocomplete-BX8Sid8j.js";import{V as _e}from"./VDialog-CD0clByc.js";import{V as le}from"./VTooltip-D-vi6p91.js";import{a as fe,V as je}from"./VTable-BTH5Z4Xa.js";import{V as we}from"./VTextarea-F2AKCrS5.js";import{d as qe}from"./debounce-BOGN8dfb.js";import{V as Pe}from"./VPagination-eCRuc9EJ.js";import{V as ve}from"./VBadge-DEIbsKA_.js";import"./VAvatar-qAgvoM7o.js";import"./VImg-CS7GOvHv.js";import"./VList-D5TT8fqR.js";import"./ssrBoot-Ci-ZBwfZ.js";import"./VDivider-DZPLDaJZ.js";import"./VCheckboxBtn-Daff1PoX.js";import"./VSelectionControl-R3rniju9.js";import"./VSlideGroup-CnmrAbkO.js";const Ie={key:0,class:"mb-4 d-flex gap-1"},Fe={class:"text-sm"},Ne={class:"d-flex justify-between align-center mb-3"},De=i("h4",{class:"w-100"},"Detail of Active Agreement",-1),Me=i("thead",null,[i("tr",null,[i("th",{class:"text-left",nowrap:""}," Engagement Type "),i("th",{nowrap:""},"Stream"),i("th",{nowrap:""},"Package"),i("th",{nowrap:""},"Fee Individual - Gross")])],-1),Ae={nowrap:""},Re=["href"],Ee={nowrap:""},He={nowrap:""},Ge={nowrap:""},be="mentor",ze={__name:"program_add_specialist_timesheet",emits:["close","reload"],setup(ce,{emit:D}){const B=D,d=c(!1),_=c(null),X=c([]),L=c([]),W=c([]),$=c(null),M=c([]),R=c([]),Y=c([]),I=c(!1),C=c(null),se=c([]),F=c(),n=c({ref_details:[],mentortutor_email:null,subject_id:null,inhouse_id:null,package_id:null,duration:"",tax:2.5,individual_fee:null,notes:"",pic_id:[]}),ae=async()=>{const p="get/active/mentees/global";try{const u=await ge.get(p);u&&(L.value=u)}catch(u){console.error(u)}},s=async()=>{var u,S;const p="external-mentor/streams";try{d.value=!0;const r=await ge.get(p);r&&(W.value=r),d.value=!1}catch(r){Q("error",(S=(u=r.response)==null?void 0:u.data)==null?void 0:S.message,"bottom-end"),console.error(r),d.value=!1}},V=async(p=!1)=>{const S=p?"api/v1/user/mentor-tutors?inhouse=true&role="+be:"api/v1/user/mentor-tutors?role="+"External Mentor";try{const r=await j.get(S);r&&(p?Y.value=Object.values(r):X.value=r)}catch(r){console.error(r)}},O=async()=>{try{const p=await j.get("api/v1/package/component/list?category="+be);p&&(M.value=p)}catch(p){console.error(p)}},k=async(p,u,S,r)=>{try{const t=await j.get("api/v1/component/fee/ext-mentor/"+p+"/"+u+"/"+S+"/"+r);t&&(n.value.individual_fee=n.value.ref_details.length>1?t.fee_group:t.fee_individual,n.value.individual_fee?A():C.value=null)}catch(t){n.value.individual_fee=null,C.value=null,Q("error","We're sorry, but we couldn't find a tutor fee for the selected curriculum and subject. This may be outside the scope of our current agreement. Please reach out to our HR team for assistance or to explore available options","bottom-end"),console.error(t)}Z()},Z=()=>{const p=n.value.package_id,u=M.value.findIndex(r=>r.id===p);let S=M.value[u];S.detail?(I.value=!0,n.value.duration=S.detail):(I.value=!1,n.value.duration=null)},v=async()=>{try{const p=await j.get("api/v1/user/component/list");p&&(R.value=p)}catch(p){console.error(p)}},J=async()=>{try{const p=await j.get("api/v1/engagement-type/component/list");p&&(se.value=p)}catch(p){console.log(p)}},E=async()=>{var u,S,r;n.value.mentortutor_email=_.value.email;const{valid:p}=await F.value.validate();if(p){d.value=!0;try{const t=await j.post("api/v1/timesheet/create/skip-request",n.value);t&&(Q("success",t.message,"bottom-end"),B("reload"),n.value={ref_details:[],mentortutor_email:null,subject_id:null,subject_name:null,inhouse_id:null,package_id:null,duration:"",notes:"",pic_id:[],tax:null,individual_fee:""},_.value=[],window.open("/admin/timesheet/specialist/"+((u=t.data)==null?void 0:u.timesheet_id),"_blank"))}catch(t){if((r=(S=t==null?void 0:t.response)==null?void 0:S.data)!=null&&r.errors){const f=t.response.data.errors;Q("error",f,"bottom-end")}}finally{B("close"),d.value=!1}}},A=()=>{const p=n.value.individual_fee*(1-n.value.tax/100);C.value=Math.trunc(p)},ue=()=>{const p=C.value/(1-n.value.tax/100);n.value.individual_fee=Math.trunc(p)};return pe(()=>{s(),ae(),J(),V(),V(!0),O(),v()}),(p,u)=>(m(),q(ie,{"max-width":"650","prepend-icon":"ri-send-plane-line",title:"Assign to Subject Specialist"},{default:a(()=>[l(oe,null,{default:a(()=>{var S,r;return[((S=e(n).ref_details)==null?void 0:S.length)>0?(m(),x("div",Ie,[i("p",Fe,y(((r=e(n).ref_details)==null?void 0:r.length)>1?"Students":"Student")+":",1),(m(!0),x(H,null,ee(e(n).ref_details,t=>(m(),x("p",{key:t,class:"text-sm bg-info px-2 rounded"},y(t.student_first_name+" "+t.student_last_name),1))),128))])):G("",!0),l(xe,{onSubmit:ye(E,["prevent"]),ref_key:"formData",ref:F,"validate-on":"input"},{default:a(()=>[l(de,null,{default:a(()=>[l(g,{cols:"12"},{default:a(()=>[l(P,{clearable:"",modelValue:e(n).engagement_type,"onUpdate:modelValue":u[0]||(u[0]=t=>e(n).engagement_type=t),items:e(se),"item-props":t=>({title:t.name}),"item-value":"id",label:"Engagement Type",rules:e(T).required,loading:e(d),disabled:e(d)},null,8,["modelValue","items","item-props","rules","loading","disabled"])]),_:1}),l(g,{md:"12",cols:"12"},{default:a(()=>[l(P,{clearable:"",modelValue:e(n).ref_details,"onUpdate:modelValue":u[1]||(u[1]=t=>e(n).ref_details=t),label:"Mentee Name",items:e(L),"item-props":t=>({title:t.first_name+" "+t.last_name,subtitle:t.sch_name,value:{clientprog_id:t.clientprog_id,invoice_id:t.invoice_id,student_uuid:t.id,student_first_name:t.first_name,student_last_name:t.last_name,student_school:t.sch_name,student_grade:t.grade,program_name:t.program_name,require:t.require,package:t.package,curriculum:t.curriculum,engagement_type:e(n).engagement_type}}),rules:e(T).required,loading:e(d),disabled:e(d),density:"compact",multiple:""},null,8,["modelValue","items","item-props","rules","loading","disabled"])]),_:1}),l(g,{md:"6",cols:e(_)?11:12},{default:a(()=>[l(P,{density:"compact",clearable:"",modelValue:e(_),"onUpdate:modelValue":u[2]||(u[2]=t=>z(_)?_.value=t:null),label:"Subject Specialist Name",items:e(X),"item-props":t=>({title:t.full_name,subtitle:t.roles.map(f=>f.name).join(", ")}),rules:e(T).required,loading:e(d),disabled:e(d)},null,8,["modelValue","items","item-props","rules","loading","disabled"])]),_:1},8,["cols"]),e(_)?(m(),q(g,{key:0,cols:"1"},{default:a(()=>[l(_e,{"max-width":"600"},{activator:a(({props:t})=>[l(le,{activator:"parent",location:"end"},{default:a(()=>[h("Fee Detail")]),_:1}),l(U,ke({icon:"ri-folder-info-line",class:"cursor-pointer mt-3"},t),null,16)]),default:a(({isActive:t})=>[l(ie,null,{default:a(()=>[l(oe,{class:"py-5"},{default:a(()=>{var f;return[i("div",Ne,[De,l(te,{size:"x-small",color:"secondary",icon:"ri-close-line",onClick:b=>t.value=!1},null,8,["onClick"])]),((f=e(_))==null?void 0:f.roles.findIndex(b=>b.name==="External Mentor"))>=0?(m(),q(fe,{key:0,density:"compact"},{default:a(()=>[Me,i("tbody",null,[(m(!0),x(H,null,ee(e(_).roles,(b,w)=>(m(),x(H,{key:w},[b.name=="External Mentor"?(m(!0),x(H,{key:0},ee(b.subjects,o=>(m(),x("tr",{key:o},[i("td",Ae,[h(y(o.engagement_type_name??"-")+" ",1),o.agreement?(m(),x("a",{key:0,href:o.agreement,target:"_blank",class:"ms-2 d-inline cursor-pointer"},[l(le,{activator:"parent",location:"end"},{default:a(()=>[h(" Check Agreement ")]),_:1}),l(U,{icon:"ri-file-pdf-2-line"})],8,Re)):G("",!0)]),i("td",Ee,y(o.stream??"-"),1),i("td",He,y(o.package_name??"-"),1),i("td",Ge," Rp. "+y(new Intl.NumberFormat("id-ID").format(o.fee_individual)),1)]))),128)):G("",!0)],64))),128))])]),_:1})):(m(),q(oe,{key:1,class:"text-center"},{default:a(()=>[h(" There is no tutoring subject ")]),_:1}))]}),_:2},1024)]),_:2},1024)]),_:1})]),_:1})):G("",!0),l(g,{md:e(_)?5:6,cols:"12"},{default:a(()=>[l(P,{density:"compact",clearable:"",label:"Stream",modelValue:e($),"onUpdate:modelValue":u[3]||(u[3]=t=>z($)?$.value=t:null),items:e(W),"item-title":"stream_name","item-value":"stream_name",loading:e(d),disabled:e(d)},null,8,["modelValue","items","loading","disabled"])]),_:1},8,["md"]),l(g,{md:"8",cols:"8"},{default:a(()=>[l(P,{density:"compact",clearable:"",label:"Package",modelValue:e(n).package_id,"onUpdate:modelValue":[u[4]||(u[4]=t=>e(n).package_id=t),u[5]||(u[5]=t=>k(e(_).id,e($),e(n).engagement_type,e(n).package_id))],items:e(M),"item-props":t=>({title:t.package!=null?t.type_of+" - "+t.package:t.type_of,subtitle:t.detail?t.detail/60+" Hours":"Customizable"}),"item-value":"id",rules:e(T).required,loading:e(d),disabled:e(d)},null,8,["modelValue","items","item-props","rules","loading","disabled"])]),_:1}),l(g,{md:"4",cols:"4"},{default:a(()=>[l(K,{density:"compact",type:"number",clearable:"",label:+e(n).duration/60?""+e(n).duration/60+" Hours":"Minutes",readonly:e(I),modelValue:e(n).duration,"onUpdate:modelValue":u[6]||(u[6]=t=>e(n).duration=t),rules:e(T).required},null,8,["label","readonly","modelValue","rules"])]),_:1}),l(g,{md:"4",cols:"7"},{default:a(()=>[l(K,{type:"number",clearable:"",label:"Fee/hours (Nett)",modelValue:e(C),"onUpdate:modelValue":[u[7]||(u[7]=t=>z(C)?C.value=t:null),ue],density:"compact",rules:e(T).required,readonly:""},null,8,["modelValue","rules"])]),_:1}),l(g,{md:"4",cols:"5"},{default:a(()=>[l(K,{type:"number",clearable:"",label:"Tax",modelValue:e(n).tax,"onUpdate:modelValue":[u[8]||(u[8]=t=>e(n).tax=t),ue],rules:e(T).required,density:"compact",readonly:""},null,8,["modelValue","rules"])]),_:1}),l(g,{md:"4",cols:"12"},{default:a(()=>[l(le,{activator:"parent",location:"top"},{default:a(()=>[h(" Fee Gross is automatically calculated based on the entered Net Fee and Tax Rate. ")]),_:1}),l(K,{type:"number",clearable:"",label:"Fee/hours (Gross)",modelValue:e(n).individual_fee,"onUpdate:modelValue":[u[9]||(u[9]=t=>e(n).individual_fee=t),A],density:"compact",readonly:"",rules:e(T).required},null,8,["modelValue","rules"])]),_:1}),l(g,{md:"6",cols:"12"},{default:a(()=>[l(P,{density:"compact",clearable:"",modelValue:e(n).inhouse_id,"onUpdate:modelValue":u[10]||(u[10]=t=>e(n).inhouse_id=t),label:"Inhouse Mentor",items:e(Y),"item-props":t=>({title:t.full_name}),"item-value":"uuid",loading:e(d),disabled:e(d),rules:e(T).required},null,8,["modelValue","items","item-props","loading","disabled","rules"])]),_:1}),l(g,{md:"6",cols:"12"},{default:a(()=>[l(P,{density:"compact",multiple:"",clearable:"",chips:"",label:"PIC",modelValue:e(n).pic_id,"onUpdate:modelValue":u[11]||(u[11]=t=>e(n).pic_id=t),items:e(R),"item-title":"full_name","item-value":"id",loading:e(d),disabled:e(d),rules:e(T).required},null,8,["modelValue","items","loading","disabled","rules"])]),_:1}),l(g,{md:"12"},{default:a(()=>[l(we,{label:"Notes",modelValue:e(n).notes,"onUpdate:modelValue":u[12]||(u[12]=t=>e(n).notes=t)},null,8,["modelValue"])]),_:1})]),_:1}),l(he,{class:"mt-5 px-0"},{default:a(()=>[l(te,{variant:"tonal",color:"error",type:"button",onClick:u[13]||(u[13]=t=>B("close"))},{default:a(()=>[l(U,{icon:"ri-close-line",class:"me-3"}),h(" Close ")]),_:1}),l(Ve),l(te,{variant:"tonal",color:"success",type:"submit"},{default:a(()=>[h(" Save "),l(U,{icon:"ri-save-line",class:"ms-3"})]),_:1})]),_:1})]),_:1},512)]}),_:1})]),_:1}))}},Be={key:0,class:"mb-4 d-flex gap-1"},Le={class:"text-sm"},We={class:"d-flex justify-between align-center mb-3"},Oe=i("h4",{class:"w-100"},"Detail of Active Agreement",-1),Je=i("thead",null,[i("tr",null,[i("th",{class:"text-left",nowrap:""}," Curriculum "),i("th",{nowrap:""},"Subject Tutoring"),i("th",{nowrap:""},"Grade"),i("th",{nowrap:""},"Fee Individual - Gross")])],-1),Ke={nowrap:""},Qe={nowrap:""},Xe={nowrap:""},Ye={nowrap:""},Ze={__name:"program_add_tutoring",emits:["close","reload"],setup(ce,{emit:D}){const B=D,d=c(!1),_=c(null),X=c([]),L=c([]),W=c([]),$=c([]),M=c([]),R=c([]),Y=c([]),I=c(!1),C=c("tutor"),se=c(null),F=c(null),n=c([]),ae=c(),s=c({ref_id:null,mentortutor_email:null,subject_id:null,inhouse_id:null,package_id:null,tax:null,individual_fee:null,duration:"",notes:"",pic_id:[],curriculum_id:null}),V=async()=>{var t,f;const r="api/v1/program/list?require=tutor";try{d.value=!0;const b=await j.get(r);b&&(X.value=b),d.value=!1}catch(b){Q("error",(f=(t=b.response)==null?void 0:t.data)==null?void 0:f.message,"bottom-end"),console.error(b),d.value=!1}},O=async(r=!1)=>{const t=r?"api/v1/user/mentor-tutors?inhouse=true&role="+C.value:"api/v1/user/mentor-tutors?role="+C.value;try{const f=await j.get(t);f&&(r?Y.value=Object.values(f):L.value=f)}catch(f){console.error(f)}},k=async()=>{try{const r=await j.get("api/v1/package/component/list?category="+C.value);r&&(M.value=r)}catch(r){console.error(r)}},Z=()=>{const r=s.value.package_id,t=M.value.findIndex(b=>b.id===r);let f=M.value[t];f.detail?(I.value=!0,s.value.duration=f.detail):(I.value=!1,s.value.duration=null)},v=async()=>{try{const r=await j.get("api/v1/user/component/list");r&&(R.value=r)}catch(r){console.error(r)}},J=async(r,t=null,f=0)=>{se.value=f,s.value.tax=(f==1,2.5),s.value.subject_id=null,s.value.subject_name=null,s.value.individual_fee=null,F.value=null;const b=s.value.curriculum_id?"/"+s.value.curriculum_id:"";try{const w=await j.get("api/v1/user/mentor-tutors/"+t+"/subjects"+b);w&&($.value=w)}catch(w){console.error(w)}},E=async(r,t,f)=>{var w;const b=(w=n.value[0])==null?void 0:w.grade;if(t)try{const o=await j.get("api/v1/component/fee/tutor/"+r+"/"+t+"/"+f+"/"+b);o&&(s.value.individual_fee=n.value.length>1?o.fee_group:o.fee_individual,s.value.individual_fee?u():F.value=null)}catch(o){Q("error","We're sorry, but we couldn't find a tutor fee for the selected curriculum and subject. This may be outside the scope of our current agreement. Please reach out to our HR team for assistance or to explore available options","bottom-end"),console.error(o)}else s.value.individual_fee=null,F.value=null},A=async()=>{try{const r=await j.get("api/v1/curriculum/component/list");r&&(W.value=r)}catch(r){console.error(r)}},ue=async()=>{var t,f,b;s.value.mentortutor_email=_.value.email;const{valid:r}=await ae.value.validate();if(r){d.value=!0;try{const w=await j.post("api/v1/timesheet/create",s.value);w&&(Q("success",w.message,"bottom-end"),B("reload"),s.value={ref_id:[],mentortutor_email:null,subject_id:null,subject_name:null,inhouse_id:null,package_id:null,duration:"",notes:"",pic_id:[],tax:null,individual_fee:"",curriculum_id:null},_.value=null,window.open("/admin/timesheet/tutoring/"+((t=w.data)==null?void 0:t.timesheet_id),"_blank"))}catch(w){if(console.log(w),(b=(f=w==null?void 0:w.response)==null?void 0:f.data)!=null&&b.errors){const o=w.response.data.errors;Q("error",o,"bottom-end")}}finally{B("close"),d.value=!1}}},p=()=>{var r,t,f;s.value={ref_id:n.value.map(b=>b.id),curriculum_id:((r=n.value[0])==null?void 0:r.curriculum)??null,package_id:((t=n.value[0])==null?void 0:t.package)??null,program_name:((f=n.value[0])==null?void 0:f.program_name)??null}},u=()=>{const r=s.value.individual_fee*(1-s.value.tax/100);F.value=Math.trunc(r)},S=()=>{const r=F.value/(1-s.value.tax/100);s.value.individual_fee=Math.trunc(r)};return pe(()=>{V(),O(),O(!0),k(),v(),A()}),(r,t)=>{var f;return m(),q(ie,{"max-width":"650","prepend-icon":"ri-send-plane-line",title:((f=e(n)[0])==null?void 0:f.program_name)??"Assign to Tutor"},{default:a(()=>[l(oe,null,{default:a(()=>{var b,w;return[((b=e(n))==null?void 0:b.length)>0?(m(),x("div",Be,[i("p",Le,y(((w=e(n))==null?void 0:w.length)>1?"Students":"Student")+":",1),(m(!0),x(H,null,ee(e(n),o=>(m(),x("p",{key:o,class:"text-sm bg-info px-2 rounded"},y(o.mentee),1))),128))])):G("",!0),l(xe,{onSubmit:ye(ue,["prevent"]),ref_key:"formData",ref:ae,"validate-on":"input"},{default:a(()=>[l(de,null,{default:a(()=>[l(g,{md:"12",cols:"12"},{default:a(()=>[l(P,{clearable:"",modelValue:e(n),"onUpdate:modelValue":[t[0]||(t[0]=o=>z(n)?n.value=o:null),p],label:"Student Name",items:e(X),"item-props":o=>({title:o.student_name,subtitle:o.program_name+(o.timesheet_id?" ✅":"")+(o.scnd_timesheet_id?" ✅":""),disabled:o.timesheet_id&&o.scnd_timesheet_id,value:{id:o.id,require:o.require,mentee:o.student_name,package:o.package,curriculum:o.curriculum,program_name:o.program_name,grade:o.student_grade}}),rules:e(T).required,loading:e(d),disabled:e(d),density:"compact",multiple:""},null,8,["modelValue","items","item-props","rules","loading","disabled"])]),_:1}),l(g,{cols:e(_)?11:12},{default:a(()=>[l(P,{clearable:"",modelValue:e(_),"onUpdate:modelValue":[t[1]||(t[1]=o=>z(_)?_.value=o:null),t[2]||(t[2]=o=>J(e(_).roles,e(_).uuid,e(_).has_npwp))],label:"Tutor Name",items:e(L),"item-props":o=>({title:o.full_name,subtitle:o.roles.map(N=>N.name).join(", ")}),rules:e(T).required,loading:e(d),disabled:e(d),density:"compact"},null,8,["modelValue","items","item-props","rules","loading","disabled"])]),_:1},8,["cols"]),e(_)?(m(),q(g,{key:0,cols:"1"},{default:a(()=>[l(_e,{"max-width":"600"},{activator:a(({props:o})=>[l(le,{activator:"parent",location:"end"},{default:a(()=>[h("Fee Detail")]),_:1}),l(U,ke({icon:"ri-folder-info-line",class:"cursor-pointer mt-3"},o),null,16)]),default:a(({isActive:o})=>[l(ie,null,{default:a(()=>[l(oe,{class:"py-5"},{default:a(()=>{var N;return[i("div",We,[Oe,l(te,{size:"x-small",color:"secondary",icon:"ri-close-line",onClick:ne=>o.value=!1},null,8,["onClick"])]),((N=e(_))==null?void 0:N.roles.findIndex(ne=>ne.name==="Tutor"))>=0?(m(),q(fe,{key:0,density:"compact"},{default:a(()=>[Je,i("tbody",null,[(m(!0),x(H,null,ee(e(_).roles,(ne,Ce)=>(m(),x(H,{key:Ce},[ne.name=="Tutor"?(m(!0),x(H,{key:0},ee(ne.subjects,re=>(m(),x("tr",{key:re},[i("td",Ke,y(re.curriculum_name??"-"),1),i("td",Qe,y(re.tutor_subject??"-"),1),i("td",Xe,y(re.grade??"-"),1),i("td",Ye,"Rp. "+y(new Intl.NumberFormat("id-ID").format(re.fee_individual)),1)]))),128)):G("",!0)],64))),128))])]),_:1})):(m(),q(oe,{key:1,class:"text-center"},{default:a(()=>[h(" There is no tutoring subject ")]),_:1}))]}),_:2},1024)]),_:2},1024)]),_:1})]),_:1})):G("",!0),l(g,{md:"6",cols:"6"},{default:a(()=>[l(P,{clearable:"",modelValue:e(s).curriculum_id,"onUpdate:modelValue":[t[3]||(t[3]=o=>e(s).curriculum_id=o),t[4]||(t[4]=o=>E(e(_).id,e(s).subject_name,e(s).curriculum_id))],label:"Curriculum",items:e(W),"item-props":o=>({title:o.name}),loading:e(d),readonly:"",density:"compact","item-value":"id"},null,8,["modelValue","items","item-props","loading"])]),_:1}),l(g,{md:"6",cols:"6"},{default:a(()=>[l(P,{clearable:"",modelValue:e(s).subject_name,"onUpdate:modelValue":[t[5]||(t[5]=o=>e(s).subject_name=o),t[6]||(t[6]=o=>E(e(_).id,e(s).subject_name,e(s).curriculum_id))],label:"Subject Tutoring",items:e($),"item-value":"tutor_subject","item-title":"tutor_subject",loading:e(d),disabled:e(d),rules:e(T).required,density:"compact"},null,8,["modelValue","items","loading","disabled","rules"])]),_:1}),l(g,{md:"8",cols:"8"},{default:a(()=>{var o;return[l(P,{clearable:"",label:"Package",modelValue:e(s).package_id,"onUpdate:modelValue":[t[7]||(t[7]=N=>e(s).package_id=N),Z],items:e(M),density:"compact","item-props":N=>({title:N.package!=null?N.type_of+" - "+N.package:N.type_of,subtitle:N.detail?N.detail/60+" Hours":"Customizable"}),"item-value":"id",rules:e(T).required,loading:e(d),disabled:e(d)||((o=e(n)[0])==null?void 0:o.package)},null,8,["modelValue","items","item-props","rules","loading","disabled"])]}),_:1}),l(g,{md:"4",cols:"4"},{default:a(()=>[l(K,{type:"number",clearable:"",label:+e(s).duration/60?"Minutes ("+e(s).duration/60+" Hours)":"Minutes",readonly:e(I),modelValue:e(s).duration,"onUpdate:modelValue":t[8]||(t[8]=o=>e(s).duration=o),density:"compact",rules:e(T).required},null,8,["label","readonly","modelValue","rules"])]),_:1}),l(g,{md:"4",cols:"7"},{default:a(()=>[l(K,{type:"number",clearable:"",label:"Fee/hours (Nett)",modelValue:e(F),"onUpdate:modelValue":[t[9]||(t[9]=o=>z(F)?F.value=o:null),S],density:"compact",rules:e(T).required,readonly:""},null,8,["modelValue","rules"])]),_:1}),l(g,{md:"4",cols:"5"},{default:a(()=>[l(K,{type:"number",clearable:"",label:"Tax",modelValue:e(s).tax,"onUpdate:modelValue":[t[10]||(t[10]=o=>e(s).tax=o),S],rules:e(T).required,density:"compact",readonly:""},null,8,["modelValue","rules"])]),_:1}),l(g,{md:"4",cols:"12"},{default:a(()=>[l(le,{activator:"parent",location:"top"},{default:a(()=>[h(" Fee Gross is automatically calculated based on the entered Net Fee and Tax Rate. ")]),_:1}),l(K,{type:"number",clearable:"",label:"Fee/hours (Gross)",modelValue:e(s).individual_fee,"onUpdate:modelValue":[t[11]||(t[11]=o=>e(s).individual_fee=o),u],density:"compact",readonly:"",rules:e(T).required},null,8,["modelValue","rules"])]),_:1}),l(g,{md:"6",cols:"6"},{default:a(()=>[l(P,{clearable:"",modelValue:e(s).inhouse_id,"onUpdate:modelValue":t[12]||(t[12]=o=>e(s).inhouse_id=o),label:"Inhouse Mentor/Tutor",items:e(Y),density:"compact","item-props":o=>({title:o.full_name}),"item-value":"uuid",loading:e(d),disabled:e(d),rules:e(T).required},null,8,["modelValue","items","item-props","loading","disabled","rules"])]),_:1}),l(g,{md:"6",cols:"6"},{default:a(()=>[l(P,{multiple:"",clearable:"",chips:"",label:"PIC",modelValue:e(s).pic_id,"onUpdate:modelValue":t[13]||(t[13]=o=>e(s).pic_id=o),items:e(R),"item-title":"full_name","item-value":"id",loading:e(d),density:"compact",disabled:e(d),rules:e(T).required},null,8,["modelValue","items","loading","disabled","rules"])]),_:1}),l(g,{md:"12"},{default:a(()=>[l(we,{label:"Notes",modelValue:e(s).notes,"onUpdate:modelValue":t[14]||(t[14]=o=>e(s).notes=o),density:"compact"},null,8,["modelValue"])]),_:1})]),_:1}),l(he,{class:"mt-5 px-0"},{default:a(()=>[l(te,{variant:"tonal",color:"error",type:"button",onClick:t[15]||(t[15]=o=>B("close"))},{default:a(()=>[l(U,{icon:"ri-close-line",class:"me-3"}),h(" Close ")]),_:1}),l(Ve),l(te,{variant:"tonal",color:"success",type:"submit"},{default:a(()=>[h(" Save "),l(U,{icon:"ri-save-line",class:"ms-3"})]),_:1})]),_:1})]),_:1},512)]}),_:1})]),_:1},8,["title"])}}},et=i("div",{class:"d-flex justify-between align-center"},[i("div",{class:"w-100"},[i("h4",null,"Timesheet List")])],-1),tt={class:"d-flex gap-2"},lt=i("th",{class:"text-uppercase",width:"1%"}," No ",-1),at=i("th",{class:"text-uppercase text-center"},"School/Student Name",-1),ot={class:"text-uppercase text-center"},st=i("th",{class:"text-uppercase text-center"},"Package",-1),nt=i("th",{class:"text-uppercase text-center"},"Tutor/Mentor",-1),rt=i("th",{class:"text-uppercase text-center"},"PIC",-1),it=i("th",{class:"text-uppercase text-center"},"Total Hours",-1),ut=i("th",{class:"text-uppercase text-center"},"Used",-1),dt=i("th",{class:"text-uppercase text-center"},"#",-1),ct=["onClick"],mt={key:0},pt={key:1},_t={class:"text-start"},ft={class:"text-left"},gt={class:"text-left"},vt={class:"text-left"},bt={class:"text-left"},yt={key:0},kt=i("tr",null,[i("td",{colspan:"9",class:"text-center"}," Sorry, no data found. ")],-1),Vt=[kt],ht={class:"d-flex justify-center mt-5"},Lt={__name:"timesheet",props:{name:String},setup(ce){const D=ce,B=$e();c([]);const d=c(!1),_=c(1),X=c(),L=c(),W=c([]),$=c(!1),M=c([]),R=c(),Y=c([]),I=c(),C=async()=>{var J,E;const s="?page="+_.value,V=L.value?"&keyword="+L.value:"",O=R.value?"&program_name="+encodeURIComponent(R.value):"",k=I.value?"&package_id="+I.value:"",Z="&paginate=true",v=D.name!="tutoring"?"&is_subject_specialist=true":"";try{$.value=!0;const A=await j.get("api/v1/timesheet/list"+s+V+O+k+Z+v);A&&(_.value=A.current_page,X.value=A.last_page,W.value=A),$.value=!1}catch(A){Q("error",(E=(J=A.response)==null?void 0:J.data)==null?void 0:E.message,"bottom-end"),console.error(A),$.value=!1}},se=async()=>{try{const s=await j.get("api/v1/program/component/list");s&&(M.value=s)}catch(s){console.error(s)}},F=async()=>{try{const s=await j.get("api/v1/package/component/list");s&&(Y.value=s)}catch(s){console.error(s)}},n=qe(async s=>{_.value=1,L.value=s.target.value,await C()},1e3),ae=s=>{const V=B.resolve("/admin/timesheet/"+D.name+"/"+s);window.open(V.href,"_blank")};return Te(()=>{C()}),pe(()=>{C(),se(),F()}),(s,V)=>{const O=Se("VText");return m(),x(H,null,[l(_e,{modelValue:e(d),"onUpdate:modelValue":V[2]||(V[2]=k=>z(d)?d.value=k:null),width:"auto",persistent:""},{default:a(()=>[D.name=="tutoring"?(m(),q(Ze,{key:0,onClose:V[0]||(V[0]=k=>d.value=!1),onReload:C})):(m(),q(ze,{key:1,onClose:V[1]||(V[1]=k=>d.value=!1),onReload:C}))]),_:1},8,["modelValue"]),l(ie,null,{default:a(()=>[l(Ue,null,{default:a(()=>[et]),_:1}),l(oe,null,{default:a(()=>[l(de,{class:"my-1 justify-space-between"},{default:a(()=>[D.name=="tutoring"?(m(),q(g,{key:0,cols:"12",md:"6"},{default:a(()=>[l(de,null,{default:a(()=>[l(g,{cols:"12",md:"6"},{default:a(()=>[l(P,{density:"compact",clearable:"",modelValue:e(R),"onUpdate:modelValue":[V[3]||(V[3]=k=>z(R)?R.value=k:null),C],label:"Program Name",items:e(M),"item-title":"program_name",placeholder:"Select Program Name",loading:e($),disabled:e($)},null,8,["modelValue","items","loading","disabled"])]),_:1}),l(g,{cols:"12",md:"6"},{default:a(()=>[l(P,{density:"compact",clearable:"true",modelValue:e(I),"onUpdate:modelValue":[V[4]||(V[4]=k=>z(I)?I.value=k:null),C],label:"Package",items:e(Y),"item-props":k=>({title:k.package!=null?k.type_of+" - "+k.package:k.type_of}),"item-value":"id",placeholder:"Select Package",loading:e($),disabled:e($)},null,8,["modelValue","items","item-props","loading","disabled"])]),_:1})]),_:1})]),_:1})):G("",!0),l(g,{cols:"12",md:D.name=="tutoring"?3:12},{default:a(()=>[i("div",tt,[l(K,{density:"compact",loading:e($),disabled:e($),"append-inner-icon":"ri-search-line",label:"Search","hide-details":"","single-line":"",onInput:e(n)},null,8,["loading","disabled","onInput"]),i("div",{class:me(["text-end",D.name=="tutoring"?"":"w-md-75"])},[l(le,{activator:"parent",location:"start"},{default:a(()=>[h("Add New Timesheet")]),_:1}),l(te,{icon:"ri-add-line",onClick:V[5]||(V[5]=k=>d.value=!0)})],2)])]),_:1},8,["md"])]),_:1}),e($)?(m(),q(je,{key:0,class:"mx-auto border",type:"table-thead, table-row@10"})):(m(),q(fe,{key:1,class:"text-no-wrap",hover:""},{default:a(()=>{var k,Z;return[i("thead",null,[i("tr",null,[lt,at,i("th",ot,y(D.name=="tutoring"?"Program Name":"Engagement Type"),1),st,nt,rt,it,ut,dt])]),i("tbody",null,[(m(!0),x(H,null,ee(e(W).data,(v,J)=>(m(),x("tr",{key:J,class:me([v.void=="true"?"bg-secondary":"","cursor-pointer"]),onClick:E=>ae(v.id)},[i("td",null,y(parseInt(J)+1),1),i("td",{class:me(v.group?"cursor-pointer text-left":"text-left")},[v.group?(m(),q(O,{key:0},{default:a(()=>[l(U,{icon:"ri-group-line",class:"me-3"}),h(" "+y(v.clients[0])+" ",1),l(ve,{color:"error",content:v.clients.length-1+"+",inline:""},null,8,["content"]),l(le,{activator:"parent",location:"top",transition:"scroll-y-transition",class:"bg-white"},{default:a(()=>[(m(!0),x(H,null,ee(v.clients,E=>(m(),x("div",null,y(E),1))),256))]),_:2},1024)]),_:2},1024)):(m(),q(O,{key:1},{default:a(()=>[l(U,{icon:"ri-user-line",class:"me-3"}),h(" "+y(v.clients),1)]),_:2},1024)),v.spent==v.duration?(m(),q(ve,{key:2,color:"success",content:"Done",inline:"",class:"ms-2"})):G("",!0)],2),D.name=="tutoring"?(m(),x("td",mt,[l(U,{icon:"ri-bookmark-3-line",class:"me-3"}),h(" "+y(v.detail_package=="Trial"?"[TRIAL]":"")+" "+y(v.program_name),1)])):(m(),x("td",pt,[l(U,{icon:"ri-bookmark-3-line",class:"me-3"}),h(" "+y(v.engagement_type),1)])),i("td",_t,[l(U,{icon:"ri-bookmark-line",class:"me-3"}),h(" "+y(v.detail_package?v.package_type+" - "+v.detail_package:v.package_type),1)]),i("td",ft,[l(U,{icon:"ri-user-line",class:"me-3"}),h(" "+y(v.tutor_mentor),1)]),i("td",gt,[l(U,{icon:"ri-user-line",class:"cursor-pointer me-3"}),h(" "+y(v.admin),1)]),i("td",vt,[l(U,{icon:"ri-calendar-schedule-line",class:"cursor-pointer me-3"}),h(" "+y(v.duration/60)+" Hours ",1)]),i("td",bt,[l(U,{icon:"ri-timer-2-line",class:"cursor-pointer me-3"}),h(" "+y((v.spent/60).toFixed(2))+" Hours ",1)]),i("td",null,[l(te,{color:v.void=="true"?"light":"secondary",onClick:E=>ae(v.id)},{default:a(()=>[l(U,{icon:"ri-timeline-view",class:"cursor-pointer"}),l(le,{activator:"parent",location:"top",transition:"scroll-y-transition"},{default:a(()=>[h(" View Detail ")]),_:1})]),_:2},1032,["color","onClick"])])],10,ct))),128))]),((Z=(k=e(W))==null?void 0:k.data)==null?void 0:Z.length)==0?(m(),x("tfoot",yt,Vt)):G("",!0)]}),_:1})),i("div",ht,[l(Pe,{modelValue:e(_),"onUpdate:modelValue":[V[6]||(V[6]=k=>z(_)?_.value=k:null),C],length:e(X),"total-visible":4,color:"primary","show-first-last-page":!1},null,8,["modelValue","length"])])]),_:1})]),_:1})],64)}}};export{Lt as default};
