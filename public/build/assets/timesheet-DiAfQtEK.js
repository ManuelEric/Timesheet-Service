import{r as c,e as le,o as f,f as I,w as s,b as l,Z as re,u as e,z as L,V as k,a as i,t as b,h as E,W,Y as O,j as V,m as ne,A as x,s as G,$ as ie,c as j,F as Y,a0 as ue,l as Q,X as ee,n as te}from"./main-DLK4PCY5.js";import{r as w}from"./rules-B5G8qOzK.js";import{a as ae,c as de,V as oe,b as ce}from"./VCard-Cu6R_28A.js";import{V as me}from"./VForm-BBnkG8-R.js";import{V as J,a as v}from"./VRow-Dh-de3HZ.js";import{V as P}from"./VAutocomplete-0hME6nLp.js";import{V as pe}from"./VAlert-DIwQrSJK.js";import{V as _e}from"./VTextarea-CiJHFblk.js";import{d as ge}from"./debounce-BqMIt1SU.js";import{V as fe}from"./VDialog-CfSAOFGP.js";import{V as Z}from"./VTooltip-Cgdfgbf4.js";import{a as ve,V as be}from"./VTable-C9xCbNdt.js";import{V as ye}from"./VPagination-DyFmTi0F.js";import{V as Ve}from"./VBadge-CI5gyrwL.js";import"./VAvatar-DYLNWjmh.js";import"./VImg-DPq2q_is.js";import"./VList-B_84BKwF.js";import"./ssrBoot-CKf2ZAfC.js";import"./VDivider-C06oIVOX.js";import"./VCheckboxBtn-CsMV8DSQ.js";import"./VSelectionControl-Dfezxlcg.js";import"./VSlideGroup-DNylPZZt.js";const ke={__name:"program_add_tutoring",emits:["close","reload"],setup(K,{emit:T}){const B=T,d=c(!1),g=c([]),F=c([]),q=c([]),A=c([]),y=c([]),N=c([]),U=c([]),R=c([]),C=c(!1),h=c("tutor"),D=c(null),z=c(),r=c({ref_id:null,mentortutor_email:null,subject_id:null,inhouse_id:null,package_id:null,tax:null,individual_fee:null,duration:"",notes:"",pic_id:[],curriculum_id:null}),X=async()=>{var a,t;const o="api/v1/program/list";try{d.value=!0;const n=await x.get(o);n&&(F.value=n,console.log(n)),d.value=!1}catch(n){G("error",(t=(a=n.response)==null?void 0:a.data)==null?void 0:t.message,"bottom-end"),console.error(n),d.value=!1}},p=async(o=!1)=>{const a=o?"api/v1/user/mentor-tutors?inhouse=true&role="+h.value:"api/v1/user/mentor-tutors?role="+h.value;try{const t=await x.get(a);t&&(o?R.value=Object.values(t):q.value=t)}catch(t){console.error(t)}},_=async()=>{try{const o=await x.get("api/v1/package/component/list?category="+h.value);o&&(N.value=o)}catch(o){console.error(o)}},$=()=>{const o=r.value.package_id,a=N.value.findIndex(n=>n.id===o);let t=N.value[a];t.detail?(C.value=!0,r.value.duration=t.detail):(C.value=!1,r.value.duration=null)},H=async()=>{try{const o=await x.get("api/v1/user/component/list");o&&(U.value=o)}catch(o){console.error(o)}},m=async(o,a=null,t=0)=>{if(D.value=t,r.value.tax=t==1?2.5:3,r.value.subject_id=null,h.value=="mentor")r.value.subject_id=o[0].subjects[0].id;else try{const n=await x.get("api/v1/user/mentor-tutors/"+a+"/subjects");n&&(y.value=n)}catch(n){console.error(n)}},M=async(o,a,t)=>{try{const n=await x.get("api/v1/component/fee/"+o+"/"+a+"/"+t);n&&(r.value.individual_fee=n.fee_individual)}catch(n){console.error(n)}},u=async()=>{try{const o=await x.get("api/v1/curriculum/component/list");o&&(A.value=o)}catch(o){console.error(o)}},S=async()=>{var a,t;r.value.mentortutor_email=g.value.email;const{valid:o}=await z.value.validate();if(o){d.value=!0;try{const n=await x.post("api/v1/timesheet/create",r.value);n&&(G("success",n.message,"bottom-end"),B("reload"),selected.value=[],r.value={ref_id:[],mentortutor_email:null,subject_id:null,subject_name:null,inhouse_id:null,package_id:null,duration:"",notes:"",pic_id:[],tax:null,individual_fee:""},g.value=[],console.log(n))}catch(n){if(console.log(n),(t=(a=n==null?void 0:n.response)==null?void 0:a.data)!=null&&t.errors){const se=n.response.data.errors;G("error",se,"bottom-end")}}finally{B("close"),d.value=!1}}};return le(()=>{X(),p(),p(!0),_(),H(),u()}),(o,a)=>(f(),I(oe,{"max-width":"650","prepend-icon":"ri-send-plane-line",title:"Assign to Tutor"},{default:s(()=>[l(ae,null,{default:s(()=>[l(me,{onSubmit:re(S,["prevent"]),ref_key:"formData",ref:z,"validate-on":"input"},{default:s(()=>[l(J,null,{default:s(()=>[l(v,{md:"12"},{default:s(()=>[l(P,{clearable:"",modelValue:e(r).ref_id,"onUpdate:modelValue":a[0]||(a[0]=t=>e(r).ref_id=t),label:"Mentee Name",items:e(F),"item-props":t=>({title:t.student_name,subtitle:t.program_name+(t.timesheet_id||t.scnd_timesheet_id?" âœ…":"")}),"item-value":"id",rules:e(w).required,loading:e(d),disabled:e(d),density:"compact",multiple:""},null,8,["modelValue","items","item-props","rules","loading","disabled"])]),_:1}),l(v,{md:"12"},{default:s(()=>[l(P,{clearable:"",modelValue:e(g),"onUpdate:modelValue":[a[1]||(a[1]=t=>L(g)?g.value=t:null),a[2]||(a[2]=t=>m(e(g).roles,e(g).uuid,e(g).has_npwp))],label:"Tutor Name",items:e(q),"item-props":t=>({title:t.full_name,subtitle:t.roles.map(n=>n.name).join(", ")}),rules:e(w).required,loading:e(d),disabled:e(d),density:"compact"},null,8,["modelValue","items","item-props","rules","loading","disabled"]),e(D)!=null?(f(),I(pe,{key:0,color:e(D)==1?"success":"error",class:"py-1 mt-2"},{default:s(()=>[l(k,{icon:"ri-error-warning-line",class:"mr-2"}),i("small",null," Tutor "+b(e(D)==1?"already":"don`t")+" have NPWP ",1)]),_:1},8,["color"])):E("",!0)]),_:1}),l(v,{md:"6",cols:"12"},{default:s(()=>[l(P,{clearable:"",modelValue:e(r).curriculum_id,"onUpdate:modelValue":a[3]||(a[3]=t=>e(r).curriculum_id=t),label:"Curriculum",items:e(A),"item-props":t=>({title:t.name}),rules:e(w).required,loading:e(d),disabled:e(d),density:"compact","item-value":"id"},null,8,["modelValue","items","item-props","rules","loading","disabled"])]),_:1}),l(v,{md:"6",cols:"12"},{default:s(()=>[l(P,{clearable:"",modelValue:e(r).subject_name,"onUpdate:modelValue":[a[4]||(a[4]=t=>e(r).subject_name=t),a[5]||(a[5]=t=>M(e(g).id,e(r).subject_name,e(r).curriculum_id))],label:"Subject Tutoring",items:e(y),loading:e(d),disabled:e(d),rules:e(w).required,density:"compact"},null,8,["modelValue","items","loading","disabled","rules"])]),_:1}),l(v,{md:"8",col:"12"},{default:s(()=>[l(P,{clearable:"",label:"Package",modelValue:e(r).package_id,"onUpdate:modelValue":[a[6]||(a[6]=t=>e(r).package_id=t),$],items:e(N),density:"compact","item-props":t=>({title:t.package!=null?t.type_of+" - "+t.package:t.type_of,subtitle:t.detail?t.detail/60+" Hours":"Customizable"}),"item-value":"id",rules:e(w).required,loading:e(d),disabled:e(d)},null,8,["modelValue","items","item-props","rules","loading","disabled"])]),_:1}),l(v,{md:"4",cols:"12"},{default:s(()=>[l(W,{type:"number",clearable:"",label:+e(r).duration/60?"Minutes ("+e(r).duration/60+" Hours)":"Minutes",readonly:e(C),modelValue:e(r).duration,"onUpdate:modelValue":a[7]||(a[7]=t=>e(r).duration=t),density:"compact",rules:e(w).required},null,8,["label","readonly","modelValue","rules"])]),_:1}),l(v,{md:"7",cols:"12"},{default:s(()=>[l(W,{type:"number",clearable:"",label:"Fee/hours (Gross)",modelValue:e(r).individual_fee,"onUpdate:modelValue":a[8]||(a[8]=t=>e(r).individual_fee=t),density:"compact",rules:e(w).required},null,8,["modelValue","rules"])]),_:1}),l(v,{md:"5",cols:"12"},{default:s(()=>[l(W,{type:"number",clearable:"",label:"Tax",modelValue:e(r).tax,"onUpdate:modelValue":a[9]||(a[9]=t=>e(r).tax=t),rules:e(w).required,density:"compact"},null,8,["modelValue","rules"])]),_:1}),l(v,{md:"6",col:"12"},{default:s(()=>[l(P,{clearable:"",modelValue:e(r).inhouse_id,"onUpdate:modelValue":a[10]||(a[10]=t=>e(r).inhouse_id=t),label:"Inhouse Mentor/Tutor",items:e(R),density:"compact","item-props":t=>({title:t.full_name}),"item-value":"uuid",loading:e(d),disabled:e(d),rules:e(w).required},null,8,["modelValue","items","item-props","loading","disabled","rules"])]),_:1}),l(v,{md:"6",cols:"12"},{default:s(()=>[l(P,{multiple:"",clearable:"",chips:"",label:"PIC",modelValue:e(r).pic_id,"onUpdate:modelValue":a[11]||(a[11]=t=>e(r).pic_id=t),items:e(U),"item-title":"full_name","item-value":"id",loading:e(d),density:"compact",disabled:e(d),rules:e(w).required},null,8,["modelValue","items","loading","disabled","rules"])]),_:1}),l(v,{md:"12"},{default:s(()=>[l(_e,{label:"Notes",modelValue:e(r).notes,"onUpdate:modelValue":a[12]||(a[12]=t=>e(r).notes=t),density:"compact"},null,8,["modelValue"])]),_:1})]),_:1}),l(de,{class:"mt-5 px-0"},{default:s(()=>[l(O,{variant:"tonal",color:"error",type:"button",onClick:a[13]||(a[13]=t=>B("close"))},{default:s(()=>[l(k,{icon:"ri-close-line",class:"me-3"}),V(" Close ")]),_:1}),l(ne),l(O,{variant:"tonal",color:"success",type:"submit"},{default:s(()=>[V(" Save "),l(k,{icon:"ri-save-line",class:"ms-3"})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1}))}},he=i("div",{class:"d-flex justify-between align-center"},[i("div",{class:"w-100"},[i("h4",null,"Timesheet List")])],-1),xe={class:"d-flex gap-2"},we={key:0},Te=i("th",{class:"text-uppercase",width:"1%"}," No ",-1),Ce=i("th",{class:"text-uppercase text-center"},"School/Student Name",-1),je={class:"text-uppercase text-center"},Pe=i("th",{class:"text-uppercase text-center"},"Package",-1),Ue=i("th",{class:"text-uppercase text-center"},"Tutor/Mentor",-1),Ne=i("th",{class:"text-uppercase text-center"},"PIC",-1),Se=i("th",{class:"text-uppercase text-center"},"Total Hours",-1),Ie=i("th",{class:"text-uppercase text-center"},"Used",-1),qe=i("th",{class:"text-uppercase text-center"},"#",-1),Ae=["onClick"],De={key:0},$e={key:1},Me={class:"text-start"},Be={class:"text-left"},Fe={class:"text-left"},Re={class:"text-left"},He={class:"text-left"},Le={key:0},ze=i("tr",null,[i("td",{colspan:"9",class:"text-center"}," Sorry, no data found. ")],-1),Ee=[ze],We={class:"d-flex justify-center mt-5"},_t={__name:"timesheet",props:{name:String},setup(K){const T=K,B=ue();c([]);const d=c(!1),g=c(1),F=c(),q=c(),A=c([]),y=c(!1),N=c([]),U=c(),R=c([]),C=c(),h=async()=>{var u,S;const p="?page="+g.value,_=q.value?"&keyword="+q.value:"",$=U.value?"&program_name="+encodeURIComponent(U.value):"",H=C.value?"&package_id="+C.value:"",m="&paginate=true",M=T.name!="tutoring"?"&is_subject_specialist=true":"";try{y.value=!0;const o=await x.get("api/v1/timesheet/list"+p+_+$+H+m+M);o&&(g.value=o.current_page,F.value=o.last_page,A.value=o),y.value=!1}catch(o){G("error",(S=(u=o.response)==null?void 0:u.data)==null?void 0:S.message,"bottom-end"),console.error(o),y.value=!1}},D=async()=>{try{const p=await x.get("api/v1/program/component/list");p&&(N.value=p)}catch(p){console.error(p)}},z=async()=>{try{const p=await x.get("api/v1/package/component/list");p&&(R.value=p)}catch(p){console.error(p)}},r=ge(async p=>{g.value=1,q.value=p.target.value,await h()},1e3),X=p=>{const _=B.resolve("/admin/timesheet/"+T.name+"/"+p);window.open(_.href,"_blank")};return ie(()=>{h()}),le(()=>{h(),D(),z()}),(p,_)=>{const $=Q("VText"),H=Q("router-link");return f(),j(Y,null,[l(fe,{modelValue:e(d),"onUpdate:modelValue":_[1]||(_[1]=m=>L(d)?d.value=m:null),width:"auto",persistent:""},{default:s(()=>[l(ke,{onClose:_[0]||(_[0]=m=>d.value=!1),onReload:h})]),_:1},8,["modelValue"]),l(oe,null,{default:s(()=>[l(ce,null,{default:s(()=>[he]),_:1}),l(ae,null,{default:s(()=>[l(J,{class:"my-1 justify-space-between"},{default:s(()=>[T.name=="tutoring"?(f(),I(v,{key:0,cols:"12",md:"6"},{default:s(()=>[l(J,null,{default:s(()=>[l(v,{cols:"12",md:"6"},{default:s(()=>[l(P,{density:"compact",clearable:"",modelValue:e(U),"onUpdate:modelValue":[_[2]||(_[2]=m=>L(U)?U.value=m:null),h],label:"Program Name",items:e(N),"item-title":"program_name",placeholder:"Select Program Name",loading:e(y),disabled:e(y)},null,8,["modelValue","items","loading","disabled"])]),_:1}),l(v,{cols:"12",md:"6"},{default:s(()=>[l(P,{density:"compact",clearable:"true",modelValue:e(C),"onUpdate:modelValue":[_[3]||(_[3]=m=>L(C)?C.value=m:null),h],label:"Package",items:e(R),"item-props":m=>({title:m.package!=null?m.type_of+" - "+m.package:m.type_of}),"item-value":"id",placeholder:"Select Package",loading:e(y),disabled:e(y)},null,8,["modelValue","items","item-props","loading","disabled"])]),_:1})]),_:1})]),_:1})):E("",!0),l(v,{cols:"12",md:"3"},{default:s(()=>[i("div",xe,[l(W,{density:"compact",loading:e(y),disabled:e(y),"append-inner-icon":"ri-search-line",label:"Search","hide-details":"","single-line":"",onInput:e(r)},null,8,["loading","disabled","onInput"]),T.name=="tutoring"?(f(),j("div",we,[l(Z,{activator:"parent",location:"start"},{default:s(()=>[V("Add New Timesheet")]),_:1}),l(O,{icon:"ri-add-line",onClick:_[4]||(_[4]=m=>d.value=!0)})])):E("",!0)])]),_:1})]),_:1}),e(y)?(f(),I(be,{key:0,class:"mx-auto border",type:"table-thead, table-row@10"})):(f(),I(ve,{key:1,class:"text-no-wrap",hover:""},{default:s(()=>{var m,M;return[i("thead",null,[i("tr",null,[Te,Ce,i("th",je,b(T.name=="tutoring"?"Program Name":"Engagement Type"),1),Pe,Ue,Ne,Se,Ie,qe])]),i("tbody",null,[(f(!0),j(Y,null,ee(e(A).data,(u,S)=>(f(),j("tr",{key:S,class:te([u.void=="true"?"bg-secondary":"","cursor-pointer"]),onClick:o=>X(u.id)},[i("td",null,b(parseInt(S)+1),1),i("td",{class:te(u.group?"cursor-pointer text-left":"text-left")},[u.group?(f(),I($,{key:0},{default:s(()=>[l(k,{icon:"ri-group-line",class:"me-3"}),V(" "+b(u.clients[0])+" ",1),l(Ve,{color:"error",content:u.clients.length-1+"+",inline:""},null,8,["content"]),l(Z,{activator:"parent",location:"top",transition:"scroll-y-transition",class:"bg-white"},{default:s(()=>[(f(!0),j(Y,null,ee(u.clients,o=>(f(),j("div",null,b(o),1))),256))]),_:2},1024)]),_:2},1024)):(f(),I($,{key:1},{default:s(()=>[l(k,{icon:"ri-user-line",class:"me-3"}),V(" "+b(u.clients),1)]),_:2},1024))],2),T.name=="tutoring"?(f(),j("td",De,[l(k,{icon:"ri-bookmark-3-line",class:"me-3"}),V(" "+b(u.detail_package=="Trial"?"[TRIAL]":"")+" "+b(u.program_name),1)])):(f(),j("td",$e,[l(k,{icon:"ri-bookmark-3-line",class:"me-3"}),V(" "+b(u.engagement_type),1)])),i("td",Me,[l(k,{icon:"ri-bookmark-line",class:"me-3"}),V(" "+b(u.detail_package?u.package_type+" - "+u.detail_package:u.package_type),1)]),i("td",Be,[l(k,{icon:"ri-user-line",class:"me-3"}),V(" "+b(u.tutor_mentor),1)]),i("td",Fe,[l(k,{icon:"ri-user-line",class:"cursor-pointer me-3"}),V(" "+b(u.admin),1)]),i("td",Re,[l(k,{icon:"ri-calendar-schedule-line",class:"cursor-pointer me-3"}),V(" "+b(u.duration/60)+" Hours ",1)]),i("td",He,[l(k,{icon:"ri-timer-2-line",class:"cursor-pointer me-3"}),V(" "+b(u.spent/60)+" Hours ",1)]),i("td",null,[l(H,{to:"/admin/timesheet/"+T.name+"/"+u.id},{default:s(()=>[l(O,{color:u.void=="true"?"light":"secondary"},{default:s(()=>[l(k,{icon:"ri-timeline-view",class:"cursor-pointer"}),l(Z,{activator:"parent",location:"top",transition:"scroll-y-transition"},{default:s(()=>[V(" View Detail ")]),_:1})]),_:2},1032,["color"])]),_:2},1032,["to"])])],10,Ae))),128))]),((M=(m=e(A))==null?void 0:m.data)==null?void 0:M.length)==0?(f(),j("tfoot",Le,Ee)):E("",!0)]}),_:1})),i("div",We,[l(ye,{modelValue:e(g),"onUpdate:modelValue":[_[5]||(_[5]=m=>L(g)?g.value=m:null),h],length:e(F),"total-visible":4,color:"primary","show-first-last-page":!1},null,8,["modelValue","length"])])]),_:1})]),_:1})],64)}}};export{_t as default};
