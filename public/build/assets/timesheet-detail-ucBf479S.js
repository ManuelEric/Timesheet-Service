import{_ as xe}from"./DeleteHandler.vue_vue_type_script_setup_true_lang-BfExuf9b.js";import{r as h,y as ie,e as y,p as S,w as a,b as t,j as pe,V as E,h as e,D as O,k as L,l as C,i as M,z as fe,A as P,s as j,a5 as _e,o as ve,f as l,E as de,a as I,F as De,a0 as $e,t as g,q as Z,H as Ce,a6 as Te,d as ue,a1 as Me,W as Se,x as Ue,a7 as Ye,a8 as je,a9 as we}from"./main-By8SK6S3.js";import{r as A}from"./rules-CkvmYWH-.js";import{c as F,d as ge,V as H,b as le,a as me,e as Ne}from"./VCard-CCPni4mg.js";import{V as ye}from"./VForm-CLSRby1d.js";import{V as oe,a as w}from"./VRow-AJrP6gfp.js";import{V as he}from"./VTextarea-CUhnzTEG.js";import{V as se}from"./VDialog-4vEXrBWu.js";import{a as be,V as te}from"./VTable-CkKHn9Ec.js";import{T as re}from"./index-BL-Zadv3.js";import{V as Pe}from"./VCheckbox-2y3GC5zF.js";import{V as ae}from"./VAutocomplete-DqyH-JNf.js";import{V as Le}from"./VTooltip-CdGkDs_C.js";import{V as qe}from"./VDivider-LaNp6F6H.js";import{V as Ae,a as ce,b as Re}from"./VList-De_uO2Z0.js";import"./VAvatar-DnxIimKR.js";import"./VImg-BCY-WzON.js";import"./VCheckboxBtn-DWlRhZER.js";import"./VSelectionControl-BLsrjHCL.js";import"./VSlideGroup-uX-YxM6E.js";import"./ssrBoot-CNhTBMKE.js";const Fe={__name:"activity-add",props:{id:String},emits:["close","reload"],setup(q,{emit:U}){const c=q,D=U,o=h(!1),x=h(),i=h({activity:null,description:null,date:null,start_time:null,end_time:null,start_date:null,end_date:null,meeting_link:null}),_=()=>{i.value={activity:null,description:null,date:null,start_time:null,end_time:null,start_date:null,end_date:null,meeting_link:null}},$=async()=>{const{valid:k}=await x.value.validate();if(k){o.value=!0;try{const d=await P.post("api/v1/timesheet/"+c.id+"/activity",i.value);d&&j("success",d.message,"bottom-end")}catch(d){j("error",d.response.data.errors,"bottom-end")}finally{_(),o.value=!1,D("reload"),D("close")}}};return(k,d)=>{const V=ie("DialogCloseBtn"),p=ie("VDateInput");return y(),S(H,{title:"New Activity"},{default:a(()=>[t(V,{variant:"text",size:"default",onClick:d[0]||(d[0]=n=>D("close"))}),t(F,null,{default:a(()=>[t(ye,{onSubmit:pe($,["prevent"]),ref_key:"formData",ref:x,"validate-on":"input"},{default:a(()=>[t(oe,null,{default:a(()=>[t(w,{cols:"12",class:"d-none"},{default:a(()=>[t(E,{density:"compact",modelValue:e(i).activity,"onUpdate:modelValue":d[1]||(d[1]=n=>e(i).activity=n),label:"Activity Name",placeholder:"Activity",loading:e(o),disabled:e(o)},null,8,["modelValue","loading","disabled"])]),_:1}),t(w,{cols:"12"},{default:a(()=>[t(he,{density:"compact",modelValue:e(i).description,"onUpdate:modelValue":d[2]||(d[2]=n=>e(i).description=n),label:"Meeting Discussion",placeholder:"Meeting Discussion",loading:e(o),disabled:e(o),rules:e(A).required},null,8,["modelValue","loading","disabled","rules"])]),_:1}),t(w,{md:"6",cols:"12"},{default:a(()=>[t(p,{density:"compact",modelValue:e(i).date,"onUpdate:modelValue":d[3]||(d[3]=n=>e(i).date=n),label:"Date",placeholder:"Select Date",variant:"outlined","prepend-icon":"",loading:e(o),disabled:e(o),rules:e(A).required},null,8,["modelValue","loading","disabled","rules"])]),_:1}),t(w,{md:"3",cols:"6"},{default:a(()=>[t(E,{density:"compact",type:"time",modelValue:e(i).start_time,"onUpdate:modelValue":d[4]||(d[4]=n=>e(i).start_time=n),label:"Start Time",placeholder:"Start Time",rules:e(A).required,class:"mb-3",loading:e(o),disabled:!e(i).date||e(o),onChange:d[5]||(d[5]=n=>e(i).start_date=e(O)(e(i).date).format("YYYY-MM-DD")+" "+e(i).start_time+":00")},null,8,["modelValue","rules","loading","disabled"])]),_:1}),t(w,{md:"3",cols:"6"},{default:a(()=>[t(E,{density:"compact",type:"time",modelValue:e(i).end_time,"onUpdate:modelValue":d[6]||(d[6]=n=>e(i).end_time=n),label:"End Time",placeholder:"End Time",loading:e(o),disabled:!e(i).date||e(o),onChange:d[7]||(d[7]=n=>e(i).end_date=e(O)(e(i).date).format("YYYY-MM-DD")+" "+e(i).end_time+":00")},null,8,["modelValue","loading","disabled"])]),_:1}),t(w,{md:"12",cols:"12"},{default:a(()=>[t(E,{density:"compact",type:"text",modelValue:e(i).meeting_link,"onUpdate:modelValue":d[8]||(d[8]=n=>e(i).meeting_link=n),label:"Meeting Link",placeholder:"Meeting Link",loading:e(o),disabled:e(o)},null,8,["modelValue","loading","disabled"])]),_:1})]),_:1}),t(ge,{class:"mt-5"},{default:a(()=>[t(L,{variant:"tonal",type:"button",color:"error",loading:e(o),disabled:e(o),onClick:d[9]||(d[9]=n=>D("close"))},{default:a(()=>[t(C,{icon:"ri-close-line",class:"me-3"}),M(" Close ")]),_:1},8,["loading","disabled"]),t(fe),t(L,{variant:"tonal",type:"submit",color:"success",loading:e(o),disabled:e(o)},{default:a(()=>[M(" Save "),t(C,{icon:"ri-save-line",class:"ms-3"})]),_:1},8,["loading","disabled"])]),_:1})]),_:1},512)]),_:1})]),_:1})}}},Ie={__name:"activity-edit",props:{timesheet_id:Number,activity:String},emits:["close","reload"],setup(q,{emit:U}){const c=h(!1),D=h(),o=q,x=U,i=_e("updateReload"),_=h({activity:o==null?void 0:o.activity.activity,description:o==null?void 0:o.activity.description,date:new Date(o==null?void 0:o.activity.start_date),start_time:o==null?void 0:o.activity.start_time,end_time:o==null?void 0:o.activity.end_time,start_date:O(o==null?void 0:o.activity.start_date).format("YYYY-MM-DD")+" "+(o==null?void 0:o.activity.start_time)+":00",end_date:(o==null?void 0:o.activity.end_time)!=0?O(o==null?void 0:o.activity.start_date).format("YYYY-MM-DD")+" "+(o==null?void 0:o.activity.end_time)+":00":null,meeting_link:o==null?void 0:o.activity.meeting_link}),$=async()=>{var d,V;const{valid:k}=await D.value.validate();if(k){c.value=!0;try{_.value.start_date=O(_.value.date).format("YYYY-MM-DD")+" "+_.value.start_time+":00",_.value.end_date=O(_.value.date).format("YYYY-MM-DD")+" "+_.value.end_time+":00";const p=await P.put("api/v1/timesheet/"+o.timesheet_id+"/activity/"+o.activity.id,_.value);p&&(j("success",p.message,"bottom-end"),x("reload"))}catch(p){if((V=(d=p==null?void 0:p.response)==null?void 0:d.data)!=null&&V.errors){const n=p.response.data.errors;let s="Validation errors:";if(typeof n!="string"){for(const u in n)n.hasOwnProperty(u)&&(s+=`
${u}: ${n[u].join(", ")}`);j("error",s,"bottom-end")}else j("error",p.response.data.errors,"bottom-end")}}finally{c.value=!1,x("close"),setTimeout(()=>{i(!0)},3e3)}}};return(k,d)=>{const V=ie("DialogCloseBtn"),p=ie("VDateInput");return y(),S(H,{title:"Edit Activity"},{default:a(()=>[t(V,{variant:"text",size:"default",onClick:d[0]||(d[0]=n=>x("close"))}),t(F,null,{default:a(()=>[t(ye,{onSubmit:pe($,["prevent"]),ref_key:"formData",ref:D,"validate-on":"input"},{default:a(()=>[t(oe,null,{default:a(()=>[t(w,{cols:"12",class:"d-none"},{default:a(()=>[t(E,{density:"compact",modelValue:e(_).activity,"onUpdate:modelValue":d[1]||(d[1]=n=>e(_).activity=n),label:"Activity Name",placeholder:"Activity",disabled:e(c),loading:e(c)},null,8,["modelValue","disabled","loading"])]),_:1}),t(w,{cols:"12"},{default:a(()=>[t(he,{density:"compact",modelValue:e(_).description,"onUpdate:modelValue":d[2]||(d[2]=n=>e(_).description=n),label:"Meeting Discussion",rules:e(A).required,placeholder:"Meeting Discussion",disabled:e(c),loading:e(c)},null,8,["modelValue","rules","disabled","loading"])]),_:1}),t(w,{md:"6",cols:"12"},{default:a(()=>[t(p,{density:"compact",modelValue:e(_).date,"onUpdate:modelValue":d[3]||(d[3]=n=>e(_).date=n),label:"Date",placeholder:"Select Date","prepend-icon":"",disabled:e(c),loading:e(c),rules:e(A).required},null,8,["modelValue","disabled","loading","rules"])]),_:1}),t(w,{md:"3",cols:"6"},{default:a(()=>[t(E,{density:"compact",type:"time",modelValue:e(_).start_time,"onUpdate:modelValue":d[4]||(d[4]=n=>e(_).start_time=n),label:"Start Time",rules:e(A).required,placeholder:"Start Time",disabled:e(c),loading:e(c),onChange:d[5]||(d[5]=n=>e(_).start_date=e(O)(o==null?void 0:o.activity.date).format("YYYY-MM-DD")+" "+e(_).start_time+":00")},null,8,["modelValue","rules","disabled","loading"])]),_:1}),t(w,{md:"3",cols:"6"},{default:a(()=>[t(E,{density:"compact",type:"time",modelValue:e(_).end_time,"onUpdate:modelValue":d[6]||(d[6]=n=>e(_).end_time=n),label:"End Time",placeholder:"End Time",disabled:e(c),loading:e(c),onChange:d[7]||(d[7]=n=>e(_).end_date=e(O)(o==null?void 0:o.activity.date).format("YYYY-MM-DD")+" "+e(_).end_time+":00")},null,8,["modelValue","disabled","loading"])]),_:1}),t(w,{md:"12",cols:"12"},{default:a(()=>[t(E,{density:"compact",type:"text",modelValue:e(_).meeting_link,"onUpdate:modelValue":d[8]||(d[8]=n=>e(_).meeting_link=n),label:"Meeting Link",placeholder:"Meeting Link",disabled:e(c),loading:e(c)},null,8,["modelValue","disabled","loading"])]),_:1})]),_:1}),t(ge,{class:"mt-5"},{default:a(()=>[t(L,{variant:"tonal",color:"error",disabled:e(c),loading:e(c),onClick:d[9]||(d[9]=n=>x("close"))},{default:a(()=>[t(C,{icon:"ri-close-line",class:"me-3"}),M(" Close ")]),_:1},8,["disabled","loading"]),t(fe),t(L,{variant:"tonal",color:"success",type:"submit",disabled:e(c),loading:e(c)},{default:a(()=>[M(" Save "),t(C,{icon:"ri-save-line",class:"ms-3"})]),_:1},8,["disabled","loading"])]),_:1})]),_:1},512)]),_:1})]),_:1})}}},Ee={class:"d-flex justify-between align-center"},Be=l("div",{class:"w-100"},[l("h4",null,"Activity")],-1),ze=l("thead",null,[l("tr",null,[l("th",{class:"text-uppercase",width:"1%"}," No "),l("th",{class:"text-uppercase text-start"},"Meeting Discussion"),l("th",{class:"text-uppercase text-center"},"Date"),l("th",{class:"text-uppercase text-center"},"Start Time"),l("th",{class:"text-uppercase text-center"},"End Time"),l("th",{class:"text-uppercase text-center"},"Time Spent"),l("th",{class:"text-uppercase text-left"},"Fee Hours"),l("th",{class:"text-uppercase text-center"},"Status"),l("th",{class:"text-uppercase text-end"},"#")])],-1),Oe={key:0},He=l("tr",null,[l("th",{colspan:"8",class:"text-center"}," No Activity Found ")],-1),Ge=[He],Je={key:1},We={width:"1%"},Ke={class:"d-none"},Qe={class:"text-start"},Xe=["innerHTML"],Ze={class:"text-center"},et={class:"text-center"},tt={class:"text-center"},lt={class:"text-left"},at={class:"text-end"},st=["href","disabled"],it={__name:"timesheet-detail",props:{id:String},setup(q){const U=q,c=_e("updateReload"),D=h([]),o=h(!1),x=h([{add:!1,edit:!1,delete:!1}]),i=h([]),_=async()=>{o.value=!0;try{const p=await P.get("api/v1/timesheet/"+U.id+"/activities");p&&(D.value=p)}catch(p){console.error(p)}finally{o.value=!1}},$=p=>{x.value[p]?x.value[p]=!1:x.value[p]=!0},k=(p,n)=>{i.value=n,$(p)},d=async()=>{var p,n,s;o.value=!0;try{const u=await P.delete("api/v1/timesheet/"+U.id+"/activity/"+i.value.id);u&&(j("success",u.message,"bottom-end"),$("delete"))}catch(u){((p=u.response)==null?void 0:p.status)==400&&j("error",(s=(n=u.response)==null?void 0:n.data)==null?void 0:s.errors,"bottom-end")}finally{o.value=!1,_(),c(!0)}},V=async p=>{var n,s,u,r;try{const m=await P.patch("api/v1/timesheet/"+U.id+"/activity/"+p.id,p);m&&j("success",m.message,"bottom-end")}catch(m){if((s=(n=m==null?void 0:m.response)==null?void 0:n.data)!=null&&s.message&&j("error",m.response.data.message,"bottom-end"),(r=(u=m==null?void 0:m.response)==null?void 0:u.data)!=null&&r.errors){const f=m.response.data.errors;let R="Validation errors:";if(typeof f!="string"){for(const B in f)f.hasOwnProperty(B)&&(R+=`
${B}: ${f[B].join(", ")}`);j("error",R,"bottom-end")}else j("error",m.response.data.errors,"bottom-end")}}finally{_(),c(!0)}};return ve(()=>{_()}),(p,n)=>(y(),S(H,null,{default:a(()=>[t(le,null,{default:a(()=>[l("div",Ee,[Be,de((y(),S(L,{onClick:n[0]||(n[0]=s=>$("add"))},{default:a(()=>[t(C,{icon:"ri-add-line"})]),_:1})),[[re,"New Activity","start"]]),t(se,{modelValue:e(x).add,"onUpdate:modelValue":n[2]||(n[2]=s=>e(x).add=s),"max-width":"600",persistent:""},{default:a(()=>[t(Fe,{id:U.id,onClose:n[1]||(n[1]=s=>$("add")),onReload:_},null,8,["id"])]),_:1},8,["modelValue"])])]),_:1}),t(F,null,{default:a(()=>[e(o)?(y(),S(te,{key:1,type:"table"})):(y(),S(be,{key:0,class:"text-no-wrap","max-height":"400","fixed-header":""},{default:a(()=>{var s;return[ze,((s=e(D))==null?void 0:s.length)==0?(y(),I("tbody",Oe,Ge)):(y(),I("tbody",Je,[(y(!0),I(De,null,$e(e(D),(u,r)=>(y(),I("tr",{key:r},[l("td",We,g(r+1),1),l("td",Ke,g(u.activity),1),l("td",Qe,[l("div",{class:"py-2",style:{width:"250px","text-wrap":"wrap"},innerHTML:u.description},null,8,Xe)]),l("td",null,g(p.$moment(u.start_date).format("dddd"))+", "+g(p.$moment(u.start_date).format("MMM Do YYYY")),1),l("td",Ze,g(u.start_time),1),l("td",et,g(u.end_time),1),l("td",tt,[t(C,{icon:"ri-timer-2-line",class:"cursor-pointer me-3"}),M(" "+g(u.estimate)+" Minutes ",1)]),l("td",lt,"Rp. "+g(new Intl.NumberFormat("id-ID").format(u.fee_hours)),1),l("td",null,[de(t(Pe,{color:"success",modelValue:u.status,"onUpdate:modelValue":[m=>u.status=m,m=>V(u)],value:!0,"false-value":!1},null,8,["modelValue","onUpdate:modelValue"]),[[re,u.status?"Completed":"Not Yet","start"]])]),l("td",at,[u.meeting_link?(y(),S(L,{key:0,color:"primary",density:"compact",class:"me-1"},{default:a(()=>[l("a",{href:u.meeting_link,target:"_blank",class:"bg-primary",disabled:u.cutoff_status=="completed"},[t(C,{icon:"ri ri-link"}),M(" Join ")],8,st)]),_:2},1024)):Z("",!0),de((y(),S(L,{color:"warning",density:"compact",class:"me-1",disabled:u.cutoff_status=="completed",onClick:m=>k("edit",u)},{default:a(()=>[t(C,{icon:"ri-edit-line",class:"cursor-pointer"})]),_:2},1032,["disabled","onClick"])),[[re,"Edit Activity","start"]]),de((y(),S(L,{color:"error",density:"compact",disabled:u.cutoff_status=="completed",onClick:m=>k("delete",u)},{default:a(()=>[t(C,{icon:"ri-delete-bin-line",class:"cursor-pointer"})]),_:2},1032,["disabled","onClick"])),[[re,"Delete Activity","start"]])])]))),128))]))]}),_:1}))]),_:1}),t(se,{modelValue:e(x).edit,"onUpdate:modelValue":n[4]||(n[4]=s=>e(x).edit=s),"max-width":"600",persistent:""},{default:a(()=>[t(Ie,{timesheet_id:U==null?void 0:U.id,activity:e(i),onClose:n[3]||(n[3]=s=>$("edit")),onReload:_},null,8,["timesheet_id","activity"])]),_:1},8,["modelValue"]),t(se,{modelValue:e(x).delete,"onUpdate:modelValue":n[6]||(n[6]=s=>e(x).delete=s),"max-width":"400",persistent:""},{default:a(()=>[t(xe,{title:"activity",loading:e(o),onClose:n[5]||(n[5]=s=>$("delete")),onDelete:d},null,8,["loading"])]),_:1},8,["modelValue"])]),_:1}))}},ot={__name:"timesheet-transfer",props:{timesheet_id:Number,require:String},emits:["close","reload"],setup(q,{emit:U}){const c=h(),D=q,o=U,x=h([]),i=h([]),_=h([]),$=D.require.toLowerCase(),k=h(!1),d=h({mentortutor_email:null,subject_id:null}),V=async()=>{const s="api/v1/user/mentor-tutors?role="+$;k.value=!0;try{const u=await P.get(s);u&&(x.value=u)}catch(u){console.error(u)}finally{k.value=!1}},p=async(s,u=null)=>{if(d.value.subject_id=null,$=="mentor")d.value.subject_id=s[0].subjects[0].id;else{k.value=!0;try{const r=await P.get("api/v1/user/mentor-tutors/"+u+"/subjects");r&&(_.value=r)}catch(r){console.error(r)}finally{k.value=!1}}},n=async()=>{var r,m;o("close"),d.value.mentortutor_email=i.value.email;const{valid:s}=await c.value.validate(),u=await Te("Are you sure you want to change the owner?");if(s&&u){k.value=!0;try{const f=await P.patch("api/v1/timesheet/"+D.timesheet_id+"/void/",d.value);f&&(j("success",f.message,"bottom-end"),ue.push({path:"/admin/timesheet/"+f.data.timesheet_id}),d.value={mentortutor_email:null,subject_id:null},i.value=[],setTimeout(()=>{ue.go(0)},1e3))}catch(f){if(console.log(f),(m=(r=f==null?void 0:f.response)==null?void 0:r.data)!=null&&m.errors){const R=f.response.data.errors;j("error",R,"bottom-end")}}finally{o("close"),k.value=!1}}};return ve(()=>{V()}),(s,u)=>(y(),S(H,{class:"mx-auto my-8",elevation:"16",width:"450"},{default:a(()=>[t(ye,{ref_key:"formData",ref:c,"validate-on":"input",onSubmit:pe(n,["prevent"])},{default:a(()=>[t(me,null,{default:a(()=>[t(le,null,{default:a(()=>[M(" Timesheet Ownership Transfer ")]),_:1}),t(Ne,null,{default:a(()=>[M(" Change Timesheet Handler ")]),_:1})]),_:1}),t(F,null,{default:a(()=>[t(oe,null,{default:a(()=>{var r;return[t(w,{md:"12"},{default:a(()=>[t(ae,{clearable:"",modelValue:e(i),"onUpdate:modelValue":[u[0]||(u[0]=m=>Ce(i)?i.value=m:null),u[1]||(u[1]=m=>p(e(i).roles,e(i).uuid))],label:"Mentor/Tutor",items:e(x),"item-props":m=>({title:m.full_name,subtitle:m.roles.map(f=>f.name).join(", ")}),rules:e(A).required,loading:e(k),disabled:e(k)},null,8,["modelValue","items","item-props","rules","loading","disabled"])]),_:1}),((r=D.require)==null?void 0:r.toLowerCase())=="tutor"?(y(),S(w,{key:0,md:"12"},{default:a(()=>[t(ae,{clearable:"",modelValue:e(d).subject_id,"onUpdate:modelValue":u[2]||(u[2]=m=>e(d).subject_id=m),label:"Subject Tutoring",items:e(_),"item-title":"subject","item-value":"id",loading:e(k),disabled:e(k),rules:e(A).required},null,8,["modelValue","items","loading","disabled","rules"])]),_:1})):Z("",!0)]}),_:1})]),_:1}),t(ge,{class:"mx-3 mb-3"},{default:a(()=>[t(L,{color:"error",onClick:u[3]||(u[3]=r=>o("close"))},{default:a(()=>[t(C,{icon:"ri-close-line",class:"me-3"}),M(" Close ")]),_:1}),t(fe),t(L,{color:"success",type:"submit"},{default:a(()=>[M(" Save Changes "),t(C,{icon:"ri-save-line",class:"ms-3"})]),_:1})]),_:1})]),_:1},512)]),_:1}))}},nt={__name:"user-edit",props:["id","item","package_id","timesheetType"],emits:["close","reload"],setup(q,{emit:U}){var J,W,K,Q,X,Ve,ke;const c=q,D=U,o=h([]),x=h([]),i=h([]),_=h([]),$=h([]),k=h(!1),d=h(!0),V=h(!0),p=h(null),n=h(),s=h({ref_id:(J=c.item)==null?void 0:J.ref_id,mentortutor_email:(W=c.item)==null?void 0:W.tutormentor_email,subject_id:(K=c.item)==null?void 0:K.subject_id,inhouse_id:(Q=c.item)==null?void 0:Q.inhouse_id,package_id:c.package_id,duration:(X=c.item)==null?void 0:X.duration,notes:(Ve=c.item)==null?void 0:Ve.notes,pic_id:(ke=c.item)==null?void 0:ke.pic_id,tax:null,individual_fee:null}),u=async()=>{var b,N;const T="api/v1/program/list?require=tutor";try{d.value=!0;const Y=await P.get(T);Y&&(o.value=Y),d.value=!1}catch(Y){j("error",(N=(b=Y.response)==null?void 0:b.data)==null?void 0:N.message,"bottom-end"),console.error(Y),d.value=!1}},r=async(T=!1)=>{V.value=!0;const b=T?"api/v1/user/mentor-tutors?inhouse=true":"api/v1/user/mentor-tutors";try{const N=await P.get(b);N&&(T?$.value=Object.values(N):x.value=N)}catch(N){console.error(N)}finally{V.value=!1}},m=async()=>{V.value=!0;try{const T=await P.get("api/v1/package/component/list");T&&(i.value=T)}catch(T){console.error(T)}finally{V.value=!1}},f=()=>{const T=s.value.package_id,b=i.value.findIndex(Y=>Y.id===T);let N=i.value[b];N.detail?(k.value=!0,s.value.duration=N.detail):(k.value=!1,s.value.duration=null)},R=async()=>{V.value=!0;try{const T=await P.get("api/v1/user/component/list");T&&(_.value=T)}catch(T){console.error(T)}finally{V.value=!1}},B=async()=>{var b,N;const{valid:T}=await n.value.validate();if(T)try{const Y=await P.put("api/v1/timesheet/"+c.id+"/update",s.value);Y&&(s.value={ref_id:null,mentortutor_email:null,subject_id:null,inhouse_id:null,package_id:null,duration:"",notes:"",pic_id:[]},j("success",Y.message,"bottom-end"),D("reload"))}catch(Y){if((N=(b=Y==null?void 0:Y.response)==null?void 0:b.data)!=null&&N.errors){const ee=Y.response.data.errors;let ne="Validation errors:";for(const v in ee)ee.hasOwnProperty(v)&&(ne+=`
${v}: ${ee[v].join(", ")}`);j("error",ne,"bottom-end")}}finally{D("close")}},z=()=>{if(s.value.individual_fee){const T=s.value.individual_fee*(1-s.value.tax/100);p.value=Math.trunc(T)}else p.value=null},G=()=>{const T=p.value/(1-s.value.tax/100);s.value.individual_fee=Math.trunc(T)};return ve(()=>{u(),r(!0),m(),R(),z(),setTimeout(()=>{d.value=!1},2e3)}),(T,b)=>{const N=ie("DialogCloseBtn");return y(),S(H,{title:"Edit Detail"},{default:a(()=>[t(N,{variant:"text",size:"default",onClick:b[0]||(b[0]=Y=>D("close"))}),t(F,null,{default:a(()=>[t(ye,{onSubmit:pe(B,["prevent"]),ref_key:"formData",ref:n,"validate-on":"input"},{default:a(()=>[t(oe,null,{default:a(()=>{var Y,ee,ne;return[c.timesheetType!="specialist"?(y(),S(w,{key:0,md:"12",cols:"12"},{default:a(()=>[t(ae,{clearable:"",modelValue:e(s).ref_id,"onUpdate:modelValue":[b[1]||(b[1]=v=>e(s).ref_id=v),T.checkProgram],label:"Student Name",items:e(o),"item-props":v=>({title:v.student_name,subtitle:v.program_name+(v.timesheet_id?" ✅":"")+(v.scnd_timesheet_id?" ✅":""),disabled:v.timesheet_id&&v.scnd_timesheet_id}),"item-value":"id",rules:e(A).required,loading:e(d),disabled:e(d),density:"compact",multiple:""},null,8,["modelValue","items","item-props","rules","loading","disabled","onUpdate:modelValue"])]),_:1})):Z("",!0),t(w,{md:"8",cols:"8"},{default:a(()=>[t(ae,{density:"compact",clearable:"",label:"Package",modelValue:e(s).package_id,"onUpdate:modelValue":[b[2]||(b[2]=v=>e(s).package_id=v),f],items:e(i),"item-props":v=>({title:v.package!=null?v.type_of+" - "+v.package:v.type_of}),"item-value":"id",rules:e(A).required,loading:e(V),disabled:e(V)},null,8,["modelValue","items","item-props","rules","loading","disabled"])]),_:1}),t(w,{md:"4",cols:"4"},{default:a(()=>[t(E,{type:"number",clearable:"",label:+e(s).duration/60?"Minutes ("+e(s).duration/60+" Hours)":"Minutes",readonly:e(k),modelValue:e(s).duration,"onUpdate:modelValue":b[3]||(b[3]=v=>e(s).duration=v),rules:e(A).required},null,8,["label","readonly","modelValue","rules"])]),_:1}),t(w,{md:"12",cols:"12"},{default:a(()=>[t(ae,{density:"compact",clearable:"",modelValue:e(s).inhouse_id,"onUpdate:modelValue":b[4]||(b[4]=v=>e(s).inhouse_id=v),label:"Inhouse Mentor/Tutor",items:e($),"item-props":v=>({title:v.full_name}),"item-value":"uuid",rules:e(A).required,loading:e(V),disabled:e(V)},null,8,["modelValue","items","item-props","rules","loading","disabled"])]),_:1}),(Y=c.item)!=null&&Y.individual_fee?(y(),S(w,{key:1,md:"4",cols:"7",class:"d-none"},{default:a(()=>[t(E,{type:"number",clearable:"",label:"Fee/hours (Nett)",modelValue:e(p),"onUpdate:modelValue":[b[5]||(b[5]=v=>Ce(p)?p.value=v:null),G],density:"compact",readonly:""},null,8,["modelValue"])]),_:1})):Z("",!0),(ee=c.item)!=null&&ee.individual_fee?(y(),S(w,{key:2,md:"4",cols:"5",class:"d-none"},{default:a(()=>[t(E,{type:"number",clearable:"",label:"Tax",modelValue:e(s).tax,"onUpdate:modelValue":[b[6]||(b[6]=v=>e(s).tax=v),G],density:"compact",readonly:""},null,8,["modelValue"])]),_:1})):Z("",!0),(ne=c.item)!=null&&ne.individual_fee?(y(),S(w,{key:3,md:"4",cols:"12",class:"d-none"},{default:a(()=>[t(Le,{activator:"parent",location:"top"},{default:a(()=>[M(" Fee Gross is automatically calculated based on the entered Net Fee and Tax Rate. ")]),_:1}),t(E,{type:"number",clearable:"",label:"Fee/hours (Gross)",modelValue:e(s).individual_fee,"onUpdate:modelValue":[b[7]||(b[7]=v=>e(s).individual_fee=v),z],density:"compact",readonly:""},null,8,["modelValue"])]),_:1})):Z("",!0),t(w,{md:"12",cols:"12"},{default:a(()=>[t(ae,{density:"compact",multiple:"",clearable:"",chips:"",label:"PIC",modelValue:e(s).pic_id,"onUpdate:modelValue":b[8]||(b[8]=v=>e(s).pic_id=v),items:e(_),"item-title":"full_name","item-value":"id",rules:e(A).required,loading:e(V),disabled:e(V)},null,8,["modelValue","items","rules","loading","disabled"])]),_:1}),t(w,{md:"12",cols:"12"},{default:a(()=>[t(he,{density:"compact",label:"Notes",modelValue:e(s).notes,"onUpdate:modelValue":b[9]||(b[9]=v=>e(s).notes=v)},null,8,["modelValue"])]),_:1})]}),_:1}),t(qe,{class:"my-3 px-0"}),t(ge,null,{default:a(()=>[t(L,{variant:"tonal",color:"error",type:"button",onClick:b[10]||(b[10]=Y=>D("close"))},{default:a(()=>[t(C,{icon:"ri-close-line",class:"me-3"}),M(" Close ")]),_:1}),t(fe),t(L,{variant:"tonal",color:"success",type:"submit"},{default:a(()=>[M(" Save "),t(C,{icon:"ri-save-line",class:"ms-3"})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})}}},dt={class:"w-100"},rt={class:"mt-3 font-weight-light"},ut=l("hr",{class:"my-2"},null,-1),ct={key:0},mt=l("tr",{class:"bg-secondary"},[l("td",null,"Name"),l("td",null,"School"),l("td",null,"Grade")],-1),_t={key:1},pt=l("td",{width:"20%"},"Name",-1),ft=l("td",{width:"1%"},":",-1),vt=l("td",null,"School Name",-1),gt=l("td",{width:"1%"},":",-1),yt=l("td",null,"Grade",-1),bt=l("td",{width:"1%"},":",-1),ht=l("td",null,"Email",-1),Vt=l("td",{width:"1%"},":",-1),kt={class:"mt-5 font-weight-light"},wt=l("hr",{class:"my-2"},null,-1),xt={width:"30%"},Dt=l("td",{width:"1%"},":",-1),$t={key:0},Ct={key:1},Tt=l("td",null,"Package",-1),Mt=l("td",{width:"1%"},":",-1),St=l("td",null,"Person in Charge",-1),Ut=l("td",{width:"1%"},":",-1),Yt=l("td",{width:"1%"},":",-1),jt=l("td",{width:"1%"},":",-1),Nt=l("td",null,"Curriculum",-1),Pt=l("td",{width:"1%"},":",-1),Lt=l("td",null,"Notes",-1),qt=l("td",{width:"1%"},":",-1),At=l("td",null,"Update On",-1),Rt=l("td",{width:"1%"},":",-1),Ft={class:"d-flex align-end w-100"},It={class:"m-0 mb-1 text-white"},Et=l("h4",{class:"m-0 ms-2 text-white"},"Minutes",-1),Bt={class:"text-end w-100"},zt={class:"d-flex align-end w-100"},Ot={class:"m-0 mb-1 text-white"},Ht=l("h4",{class:"m-0 ms-2 text-white"},"Minutes",-1),Gt={class:"text-end w-100"},Jt={class:"d-flex align-end w-100"},Wt={class:"m-0 mb-1 text-white"},Kt=l("h4",{class:"m-0 ms-2 text-white"},"Minutes",-1),Qt={class:"text-end w-100"},Xt={__name:"user-detail",props:{id:String,name:String},emits:["void"],setup(q,{emit:U}){const c=q,D=U,o=_e("reloadData"),x=_e("updateReload"),i=h([]),_=h([{edit:!1,void:!1,delete:!1}]),$=h(!1),k=async n=>{var s,u,r;$.value=!0;try{const m=await P.get("api/v1/timesheet/"+n+"/detail");m&&(i.value=m,D("void",m.packageDetails.void))}catch(m){((s=m.response)==null?void 0:s.status)==400&&(j("error",(r=(u=m.response)==null?void 0:u.data)==null?void 0:r.errors,"bottom-end"),ue.push("/admin/timesheet")),console.log(m)}finally{$.value=!1}},d=async()=>{var n,s,u;$.value=!0;try{const r=await P.delete("api/v1/timesheet/"+c.id+"/delete");r&&(i.value=r,j("success",r.message,"bottom-end"),_.value.delete=!1,ue.push("/admin/timesheet/tutoring"))}catch(r){((n=r.response)==null?void 0:n.status)==400&&j("error",(u=(s=r.response)==null?void 0:s.data)==null?void 0:u.errors,"bottom-end")}finally{$.value=!1}},V=n=>{_.value[n]?_.value[n]=!1:_.value[n]=!0},p=async(n,s)=>{var u;Ye();try{const r=await P.get("api/v1/timesheet/"+n+"/export",{responseType:"blob"});if(r){const m=window.URL.createObjectURL(new Blob([r],{type:'"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"'})),f=document.createElement("a");f.href=m,f.setAttribute("download",`Timesheet_${s}.xlsx`),document.body.appendChild(f),f.click(),document.body.removeChild(f),window.URL.revokeObjectURL(m),je.close()}}catch(r){j("error",(u=r.response)==null?void 0:u.statusText,"bottom-end"),console.log(r)}};return ve(()=>{k(c.id)}),Me(()=>{o.value&&(k(c.id),x(!1))}),(n,s)=>{const u=ie("router-link");return y(),S(H,{class:"mb-3"},{default:a(()=>[e($)?(y(),S(te,{key:0,type:"heading"})):(y(),S(le,{key:1,class:"d-flex justify-between align-center"},{default:a(()=>{var r,m,f,R,B;return[l("div",dt,[t(u,{to:"/admin/timesheet/"+c.name},{default:a(()=>[t(C,{icon:"ri-arrow-left-line",color:"secondary",class:"me-2",size:"25"})]),_:1},8,["to"]),M(" "+g((r=e(i).packageDetails)==null?void 0:r.tutormentor_name)+" | "+g(((f=(m=e(i))==null?void 0:m.packageDetails)==null?void 0:f.package_type)+" - "+((B=(R=e(i))==null?void 0:R.packageDetails)==null?void 0:B.package_name)),1)]),l("div",null,[t(Ue,{"close-on-content-click":!1,location:"bottom"},{activator:a(({props:z})=>[de((y(),S(L,Se({color:"secondary"},z),{default:a(()=>[t(C,{icon:"ri-settings-3-line"})]),_:2},1040)),[[re,"Settings","start"]])]),default:a(()=>[t(Ae,null,{default:a(()=>[t(ce,null,{default:a(()=>[l("div",{class:"cursor-pointer",onClick:s[0]||(s[0]=z=>V("edit"))},[t(C,{icon:"ri-pencil-line",class:"me-2"}),M(" Edit TimeSheet ")])]),_:1}),t(ce,null,{default:a(()=>[l("div",{class:"cursor-pointer",onClick:s[1]||(s[1]=z=>V("void"))},[t(C,{icon:"ri-exchange-2-line",class:"me-2"}),M(" Timesheet Ownership Transfer ")])]),_:1}),t(ce,null,{default:a(()=>[t(Re,null,{default:a(()=>[l("div",{class:"cursor-pointer",onClick:s[2]||(s[2]=z=>{var G,J,W,K,Q,X;return p(c.id,((J=(G=e(i))==null?void 0:G.packageDetails)==null?void 0:J.package_type)+"-"+((K=(W=e(i))==null?void 0:W.packageDetails)==null?void 0:K.package_name)+"_"+((X=(Q=e(i))==null?void 0:Q.packageDetails)==null?void 0:X.tutormentor_name))})},[t(C,{icon:"ri-download-line",class:"me-2"}),M(" Download TimeSheet ")])]),_:1})]),_:1}),t(ce,null,{default:a(()=>[l("div",{class:"cursor-pointer",onClick:s[3]||(s[3]=z=>V("delete"))},[t(C,{icon:"ri-delete-bin-line",class:"me-2"}),M(" Delete TimeSheet ")])]),_:1})]),_:1})]),_:1})])]}),_:1})),t(F,null,{default:a(()=>[e($)?(y(),S(oe,{key:1},{default:a(()=>[t(w,{md:"7"},{default:a(()=>[t(te,{type:"heading, paragraph, heading, paragraph",class:"mb-3"})]),_:1}),t(w,{md:"5"},{default:a(()=>[t(te,{type:"text@3",color:"#16B1FF",class:"mb-3"}),t(te,{type:"text@3",color:"#91c45e",class:"mb-3"}),t(te,{type:"text@3",color:"#e05e5e",class:"mb-3"})]),_:1})]),_:1})):(y(),S(oe,{key:0,align:"center"},{default:a(()=>[t(w,{md:"7"},{default:a(()=>[l("h4",rt,[t(C,{icon:"ri-user-line",size:"17",class:"me-2"}),M(" Basic Profile ")]),ut,t(be,{density:"compact"},{default:a(()=>{var r,m;return[((r=e(i).clientProfile)==null?void 0:r.length)>1?(y(),I("tbody",ct,[mt,(y(!0),I(De,null,$e(e(i).clientProfile,f=>(y(),I("tr",null,[l("td",null,g(f.client_name),1),l("td",null,g(f.client_school),1),l("td",null,g(f.client_grade<=12?f.client_grade:"Not High School"),1)]))),256))])):((m=e(i).clientProfile)==null?void 0:m.length)==1?(y(),I("tbody",_t,[l("tr",null,[pt,ft,l("td",null,g(e(i).clientProfile[0].client_name),1)]),l("tr",null,[vt,gt,l("td",null,g(e(i).clientProfile[0].client_school),1)]),l("tr",null,[yt,bt,l("td",null,g(e(i).clientProfile[0].client_grade<=12?e(i).clientProfile[0].client_grade:"Not High School"),1)]),l("tr",null,[ht,Vt,l("td",null,g(e(i).clientProfile[0].client_mail),1)])])):Z("",!0)]}),_:1}),l("h4",kt,[t(C,{icon:"ri-bookmark-line",class:"me-2",size:"17"}),M(" Package Details ")]),wt,t(be,{density:"compact"},{default:a(()=>{var r,m,f,R,B,z,G,J,W,K,Q,X;return[l("tbody",null,[l("tr",null,[l("td",xt,g(c.name=="tutoring"?"Program Name":"Engagement Type"),1),Dt,c.name=="tutoring"?(y(),I("td",$t,g((r=e(i).packageDetails)!=null&&r.free_trial?"[TRIAL]":"")+" "+g((m=e(i).packageDetails)==null?void 0:m.program_name),1)):(y(),I("td",Ct,g((f=e(i).packageDetails)==null?void 0:f.engagement_type),1))]),l("tr",null,[Tt,Mt,l("td",null,g((R=e(i).packageDetails)==null?void 0:R.package_type)+" "+g((B=e(i).packageDetails)!=null&&B.package_name?" - "+((z=e(i).packageDetails)==null?void 0:z.package_name):""),1)]),l("tr",null,[St,Ut,l("td",null,g((G=e(i).packageDetails)==null?void 0:G.pic_name),1)]),l("tr",null,[l("td",null,g(c.name=="tutoring"?"Tutor":"Mentor")+" Name",1),Yt,l("td",null,g((J=e(i).packageDetails)==null?void 0:J.tutormentor_name)+" ( Rp. "+g(new Intl.NumberFormat("id-ID").format((W=e(i).packageDetails)==null?void 0:W.tutormentor_fee_hours))+" ) ",1)]),l("tr",null,[l("td",null,"Inhouse "+g(c.name=="tutoring"?"Tutor":"Mentor"),1),jt,l("td",null,g((K=e(i).packageDetails)==null?void 0:K.inhouse_name),1)]),l("tr",null,[Nt,Pt,l("td",null,g(((Q=e(i).editableColumns)==null?void 0:Q.curriculum_name)??"-"),1)]),l("tr",null,[Lt,qt,l("td",null,g((X=e(i).editableColumns)==null?void 0:X.notes),1)]),l("tr",null,[At,Rt,l("td",null,g(e(O)().format("LLL")),1)])])]}),_:1})]),_:1}),t(w,{md:"5"},{default:a(()=>[t(H,{color:"#16B1FF",class:"mb-2 d-flex align-center"},{default:a(()=>[l("div",null,[t(me,null,{default:a(()=>[t(le,{class:"text-white"},{default:a(()=>[M(" Total Minutes of Package ")]),_:1})]),_:1}),t(F,{class:"d-flex justify-between"},{default:a(()=>{var r;return[l("div",Ft,[l("h1",It,g((r=e(i).packageDetails)==null?void 0:r.duration_in_minutes),1),Et])]}),_:1})]),t(F,null,{default:a(()=>[l("div",Bt,[t(C,{icon:"ri-calendar-schedule-line",size:"60"})])]),_:1})]),_:1}),t(H,{color:"#91c45e",class:"mb-2 d-flex align-center"},{default:a(()=>[l("div",null,[t(me,null,{default:a(()=>[t(le,{class:"text-white"},{default:a(()=>[M(" Total Minutes Spent ")]),_:1})]),_:1}),t(F,{class:"d-flex justify-between"},{default:a(()=>{var r;return[l("div",zt,[l("h1",Ot,g((r=e(i).packageDetails)==null?void 0:r.time_spent_in_minutes),1),Ht])]}),_:1})]),t(F,null,{default:a(()=>[l("div",Gt,[t(C,{icon:"ri-timer-flash-line",size:"60",color:"white"})])]),_:1})]),_:1}),t(H,{color:"#e05e5e",class:"mb-2 d-flex align-center"},{default:a(()=>[l("div",null,[t(me,null,{default:a(()=>[t(le,{class:"text-white"},{default:a(()=>[M(" Total Minutes Left ")]),_:1})]),_:1}),t(F,{class:"d-flex justify-between"},{default:a(()=>{var r,m;return[l("div",Jt,[l("h1",Wt,g(((r=e(i).packageDetails)==null?void 0:r.duration_in_minutes)-((m=e(i).packageDetails)==null?void 0:m.time_spent_in_minutes)),1),Kt])]}),_:1})]),t(F,null,{default:a(()=>[l("div",Qt,[t(C,{icon:"ri-timer-2-line",size:"60"})])]),_:1})]),_:1})]),_:1})]),_:1}))]),_:1}),t(se,{modelValue:e(_).edit,"onUpdate:modelValue":s[6]||(s[6]=r=>e(_).edit=r),"max-width":"600",persistent:""},{default:a(()=>{var r;return[t(nt,{item:e(i).editableColumns,package_id:(r=e(i).packageDetails)==null?void 0:r.package_id,id:c.id,"timesheet-type":c.name,onClose:s[4]||(s[4]=m=>V("edit")),onReload:s[5]||(s[5]=m=>k(c.id))},null,8,["item","package_id","id","timesheet-type"])]}),_:1},8,["modelValue"]),t(se,{modelValue:e(_).delete,"onUpdate:modelValue":s[8]||(s[8]=r=>e(_).delete=r),"max-width":"400",persistent:""},{default:a(()=>[t(xe,{title:"timesheet",loading:e($),onDelete:d,onClose:s[7]||(s[7]=r=>V("delete"))},null,8,["loading"])]),_:1},8,["modelValue"]),t(se,{modelValue:e(_).void,"onUpdate:modelValue":s[10]||(s[10]=r=>e(_).void=r),"max-width":"400",persistent:""},{default:a(()=>[t(ot,{timesheet_id:c.id,require:e(i).editableColumns.tutormentor_role,onClose:s[9]||(s[9]=r=>V("void"))},null,8,["timesheet_id","require"])]),_:1},8,["modelValue"])]),_:1})}}},Zt={class:"h-auto position-relative"},el={key:0,class:"overlay"},tl=l("div",{class:"bg-secondary",style:{height:"100%",position:"absolute",left:"0",top:"0","z-index":"9998",width:"100%",opacity:"0.6"}},null,-1),ll={class:"d-flex align-center justify-center",style:{height:"100%",position:"absolute",left:"0",top:"0","z-index":"9999",width:"100%",opacity:"1"}},al={class:"text-center"},sl=l("h2",{class:"text-white mt-3"},"This Timesheet Has Changed Owner",-1),$l={__name:"timesheet-detail",props:{id:Number,name:String},setup(q){const U=q,c=U.id,D=h(!1),o=h(!1);we("reloadData",D),we("updateReload",i=>{D.value=i});const x=i=>{o.value=i};return(i,_)=>(y(),I("div",Zt,[e(o)=="true"?(y(),I("div",el,[tl,l("div",ll,[l("div",al,[t(C,{color:"white",icon:"ri-lock-line",size:"50"}),sl,t(L,{color:"light",class:"mt-4",onClick:_[0]||(_[0]=$=>e(ue).push({path:"/admin/timesheet"+U.name}))},{default:a(()=>[M(" Back to List ")]),_:1})])])])):Z("",!0),t(Xt,{id:e(c),name:U.name,onVoid:x},null,8,["id","name"]),t(it,{id:e(c)},null,8,["id"])]))}};export{$l as default};
