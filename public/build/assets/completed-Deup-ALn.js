import{e as _,a as O,f as a,m as Z,b as l,l as w,w as s,h as o,n as ue,aa as ce,i as x,r as d,a1 as de,o as pe,H as g,F as ee,D,A as C,y as me,V as fe,j as te,k as T,z as ve,E as j,p as I,q as le,a0 as _e,t as f,a6 as he,s as P,a7 as ye,a8 as Ve}from"./main-BtbNASML.js";import{r as ge}from"./rules-CkvmYWH-.js";import{c as L,V as E,b as be}from"./VCard-DIbp9ZQ2.js";import{d as we}from"./debounce-BOGN8dfb.js";import{V as xe}from"./VDialog-CD0clByc.js";import{V as A,a as b}from"./VRow-DkCl9HSU.js";import{V as B,a as ke}from"./VAutocomplete-BX8Sid8j.js";import{V as De}from"./VForm-DbBEBB26.js";import{V as ae}from"./VCheckbox-BnvPZkM1.js";import{V as Ce}from"./VDivider-DZPLDaJZ.js";import{a as Te,V as Ye}from"./VTable-BTH5Z4Xa.js";import{V as Se}from"./VPagination-eCRuc9EJ.js";import{T as z}from"./index-BWC3BmrH.js";import"./VAvatar-qAgvoM7o.js";import"./VImg-CS7GOvHv.js";import"./VList-D5TT8fqR.js";import"./ssrBoot-Ci-ZBwfZ.js";import"./VCheckboxBtn-Daff1PoX.js";import"./VSelectionControl-R3rniju9.js";import"./VSlideGroup-CnmrAbkO.js";import"./VTooltip-D-vi6p91.js";const Me={class:"position-relative overflow-hidden"},$e={class:"d-flex justify-space-between"},Fe={class:"text-secondary"},Ue={__name:"FilterSidebar",props:{active:Boolean,width:Number},emits:["close"],setup(H,{emit:n}){const V=H,R=n;return(v,u)=>(_(),O("section",Me,[a("div",{class:ue(["position-fixed filter-content",V.active?"active":""]),style:ce({width:V.width+"px"})},[a("div",$e,[a("h3",Fe,[Z(v.$slots,"header",{},()=>[x("Title")])]),a("div",{onClick:u[0]||(u[0]=Y=>R("close"))},[l(w,{icon:"ri-close-line",color:"#e08282",class:"cursor-pointer"})])]),l(o(E),{class:"mt-3"},{default:s(()=>[l(o(L),null,{default:s(()=>[Z(v.$slots,"content",{},()=>[x("Content")])]),_:3})]),_:3})],6)]))}},Ne={class:"d-flex mt-5 px-0"},Ie=a("div",{class:"d-flex justify-between align-center"},[a("div",{class:"w-100"},[a("h4",null,"Completed Cut-Off")])],-1),Oe=a("thead",null,[a("tr",null,[a("th",{class:"text-uppercase"},"#"),a("th",{class:"text-uppercase text-center"},"Timesheet"),a("th",{class:"text-uppercase text-center"},"Activity"),a("th",{class:"text-uppercase text-center"},"Students Name"),a("th",{class:"text-uppercase text-center"},"Activity Date"),a("th",{class:"text-uppercase text-center"},"Mentor/Tutor"),a("th",{class:"text-uppercase text-center"},"Time Spent"),a("th",{class:"text-uppercase text-center"},"Fee/Hours"),a("th",{class:"text-uppercase text-center"},"Total"),a("th",{class:"text-uppercase text-center"},"Cut-Off Date"),a("th",{class:"text-uppercase text-center"},"Cut-Off Status")])],-1),Re={class:"text-center"},Pe={class:"text-center text-capitalize"},je=a("th",{colspan:"9"},"Total Fee",-1),Ae={colspan:"2",class:"text-end"},Be={key:0},ze=a("tr",null,[a("td",{colspan:"10",class:"text-center"}," Sorry, no data found. ")],-1),Le=[ze],Ee={class:"d-flex justify-center mt-5"},pt={__name:"completed",setup(H){const n=d(!1),V=d([]),R=d(),v=d(!1),u=d({cut_off_date:[],specific:!1,timesheet_id:null}),Y=d(!1),S=d(1),q=d(),k=d([]),M=d(null),$=d(null),G=d([]),F=d(null),J=d([]),K=d([]),h=d(null),y=async()=>{n.value=!0;const r="?page="+S.value,t=M.value?"&keyword="+M.value:"",c=$.value?"&package_id="+$.value:"",e=h.value?"&cutoff_start="+D(h.value[0]).format("YYYY-MM-DD"):"",p=h.value?"&cutoff_end="+D(h.value[h.value.length-1]).format("YYYY-MM-DD"):"",i=F.value?"&mentor_id="+F.value:"",U="api/v1/payment/paid"+r+t+c+e+p+i;try{const m=await C.get(U);m&&(S.value=m.current_page,q.value=m.last_page,V.value=m)}catch(m){console.error(m)}finally{n.value=!1}},Q=we(async()=>{await y()},1e3),oe=async()=>{n.value=!0;try{const r=await C.get("api/v1/package/component/list");r&&(G.value=r,n.value=!1)}catch(r){n.value=!1,console.error(r)}},se=async()=>{n.value=!0;try{const r=await C.get("api/v1/user/mentor-tutors");r&&(J.value=r,n.value=!1)}catch(r){n.value=!1,console.error(r)}},ne=async()=>{const r=await he("Are you sure you want to cancel this activity?"),t={activity_id:Object.keys(k.value).map(c=>k.value[c])};if(r){n.value=!0;try{const c=await C.patch("api/v1/payment/cut-off/unassign",t);c&&(P("success",c.message,"bottom-end"),y())}catch(c){P("error",c.response.statusText,"bottom-end")}finally{n.value=!1}}},re=async()=>{let r=u.value.cut_off_date,t=D(r[0]).format("YYYY-MM-DD"),c=D(r[r.length-1]).format("YYYY-MM-DD");const e="api/v1/timesheet/component/list?cutoff_start="+t+"&cutoff_end="+c;n.value=!0;try{const p=await C.get(e);p&&(K.value=p,n.value=!1)}catch(p){n.value=!1,console.error(p)}},ie=()=>{u.value.cut_off_date=[],u.value.specific=!1,u.value.timesheet_id=null},W=async r=>{let t=u.value.cut_off_date,c=D(t[0]).format("YYYY-MM-DD"),e=D(t[t.length-1]).format("YYYY-MM-DD"),p=u.value.specific?"/"+u.value.timesheet_id:"",i=r=="timesheet"?"api/v1/payment/cut-off/export"+p+"/"+c+"/"+e:"";const{valid:U}=await R.value.validate();if(U){v.value=!1,ye();try{const m=await C.get(i,{responseType:"blob"});if(m){const X=window.URL.createObjectURL(new Blob([m],{type:'"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"'})),N=document.createElement("a");N.href=X,N.setAttribute("download",`Payroll_${c}_${e}.xlsx`),document.body.appendChild(N),N.click(),document.body.removeChild(N),window.URL.revokeObjectURL(X),Ve.close(),P("success","Successfully downloaded","bottom-end")}}catch(m){v.value=!0,P("error","Cut-Off date is not found!","bottom-end"),console.log(m)}finally{ie()}}};return de(()=>{y()}),pe(()=>{y(),oe(),se()}),(r,t)=>{const c=me("VDateInput");return _(),O(ee,null,[l(Ue,{active:o(Y),width:450,onClose:t[4]||(t[4]=e=>Y.value=!1)},{header:s(()=>[x(" Filter ")]),content:s(()=>[l(A,{class:"my-1"},{default:s(()=>[l(b,{cols:"12"},{default:s(()=>[l(fe,{clearable:!0,modelValue:o(M),"onUpdate:modelValue":t[0]||(t[0]=e=>g(M)?M.value=e:null),placeholder:"Search","prepend-inner-icon":"ri-search-line","onClick:clear":o(Q),onInput:o(Q)},null,8,["modelValue","onClick:clear","onInput"])]),_:1}),l(b,{cols:"12"},{default:s(()=>[l(B,{clearable:!0,loading:o(n),disabled:o(n),label:"Package Name",items:o(G),"item-title":e=>e.package?e.type_of+" - "+e.package:e.type_of,"item-value":"id",modelValue:o($),"onUpdate:modelValue":[t[1]||(t[1]=e=>g($)?$.value=e:null),y],placeholder:"Select Timesheet Package"},null,8,["loading","disabled","items","item-title","modelValue"])]),_:1}),l(b,{cols:"12"},{default:s(()=>[l(B,{loading:o(n),disabled:o(n),clearable:"true",label:"Tutor/Mentor Name",items:o(J),"item-props":e=>({title:e.full_name,subtitle:e.roles.map(p=>p.name).join(", ")}),"item-value":"id",modelValue:o(F),"onUpdate:modelValue":[t[2]||(t[2]=e=>g(F)?F.value=e:null),y],placeholder:"Select Tutor/Mentor Name"},null,8,["loading","disabled","items","item-props","modelValue"])]),_:1}),l(b,{cols:"12"},{default:s(()=>[l(c,{modelValue:o(h),"onUpdate:modelValue":[t[3]||(t[3]=e=>g(h)?h.value=e:null),y],label:"Cut-Off Date","prepend-icon":"",multiple:"range",color:"primary",clearable:!0},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["active"]),l(xe,{modelValue:o(v),"onUpdate:modelValue":t[11]||(t[11]=e=>g(v)?v.value=e:null),width:"auto"},{default:s(()=>[l(E,{width:"500","prepend-icon":"ri-download-line",title:"Download Timesheet"},{default:s(()=>[l(L,null,{default:s(()=>[l(De,{onSubmit:t[10]||(t[10]=te(e=>W("timesheet"),["prevent"])),ref_key:"formData",ref:R},{default:s(()=>[l(A,null,{default:s(()=>[l(b,{cols:"12"},{default:s(()=>[l(c,{label:"Start - End Date","prepend-icon":"",multiple:"range",modelValue:o(u).cut_off_date,"onUpdate:modelValue":[t[5]||(t[5]=e=>o(u).cut_off_date=e),re],rules:o(ge).required,class:"mb-3"},null,8,["modelValue","rules"]),l(ae,{label:"Specific Timesheet",modelValue:o(u).specific,"onUpdate:modelValue":t[6]||(t[6]=e=>o(u).specific=e)},null,8,["modelValue"]),l(B,{loading:o(n),label:"Timesheet - Package",items:o(K),"item-props":e=>({title:e.package_type+" - "+e.package_name,subtitle:e.clients}),"item-value":"id",class:"mt-3",modelValue:o(u).timesheet_id,"onUpdate:modelValue":t[7]||(t[7]=e=>o(u).timesheet_id=e),disabled:!o(u).specific},null,8,["loading","items","item-props","modelValue","disabled"])]),_:1})]),_:1}),l(Ce,{class:"mt-5"}),a("div",Ne,[l(T,{size:"small",variant:"tonal",color:"error",onClick:t[8]||(t[8]=e=>v.value=!1)},{default:s(()=>[l(w,{icon:"ri-close-line",class:"me-3"}),x(" Close ")]),_:1}),l(ve),l(T,{size:"small",variant:"tonal",type:"button",color:"info",class:"me-2",onClick:t[9]||(t[9]=te(e=>W("recap"),["prevent"]))},{default:s(()=>[x(" Recap "),l(w,{icon:"ri-download-line",class:"ms-3"})]),_:1}),l(T,{size:"small",variant:"tonal",color:"success",type:"submit"},{default:s(()=>[x(" Timesheet "),l(w,{icon:"ri-download-line",class:"ms-3"})]),_:1})])]),_:1},512)]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(E,null,{default:s(()=>[l(be,null,{default:s(()=>[Ie]),_:1}),l(L,null,{default:s(()=>[l(A,{class:"my-1"},{default:s(()=>[l(b,{cols:"6"},{default:s(()=>[j((_(),I(T,{color:"info",onClick:t[12]||(t[12]=e=>Y.value=!o(Y))},{default:s(()=>[l(w,{icon:"ri-search-line"})]),_:1})),[[z,"Filter","end"]])]),_:1}),l(b,{cols:"6",class:"text-end"},{default:s(()=>[o(k).length>0?j((_(),I(T,{key:0,color:"error",class:"me-1",onClick:ne},{default:s(()=>[l(w,{icon:"ri-close-line"})]),_:1})),[[z,"Cancel","start"]]):le("",!0),j((_(),I(T,{color:"secondary",onClick:t[13]||(t[13]=e=>v.value=!0)},{default:s(()=>[l(w,{icon:"ri-download-line"})]),_:1})),[[z,"Download Timesheet","start"]])]),_:1})]),_:1}),o(n)?(_(),I(Ye,{key:0,class:"mx-auto border",type:"table-thead, table-row@10"})):(_(),I(Te,{key:1,class:"text-no-wrap"},{default:s(()=>{var e,p;return[Oe,a("tbody",null,[(_(!0),O(ee,null,_e(o(V).data,i=>(_(),O("tr",{key:i},[a("td",null,[l(ae,{modelValue:o(k),"onUpdate:modelValue":t[14]||(t[14]=U=>g(k)?k.value=U:null),value:i.id},null,8,["modelValue","value"])]),a("td",null,f(i.package.type+" - "+i.package.name),1),a("td",null,f(i.activity),1),a("td",null,f(i.students),1),a("td",null,f(i.date),1),a("td",null,f(i.mentor_tutor),1),a("td",null,f(i.time_spent>0?(i.time_spent/60).toFixed(2)+" Hours":"-"),1),a("td",null,"Rp. "+f(new Intl.NumberFormat("id-ID").format(i.fee_hours)),1),a("td",null,"Rp. "+f(new Intl.NumberFormat("id-ID").format(i.time_spent/60*i.fee_hours)),1),a("td",Re,f(i.cutoff_date),1),a("td",Pe,[l(ke,{color:"success"},{default:s(()=>[x(f(i.cutoff_status),1)]),_:2},1024)])]))),128))]),a("thead",null,[a("tr",null,[je,a("th",Ae," Rp. "+f(new Intl.NumberFormat("id-ID").format(o(V).total_fee)),1)])]),((p=(e=o(V))==null?void 0:e.data)==null?void 0:p.length)==0?(_(),O("tfoot",Be,Le)):le("",!0)]}),_:1})),a("div",Ee,[l(Se,{modelValue:o(S),"onUpdate:modelValue":[t[15]||(t[15]=e=>g(S)?S.value=e:null),y],length:o(q),"total-visible":4,color:"primary",density:"compact","show-first-last-page":!1},null,8,["modelValue","length"])])]),_:1})]),_:1})],64)}}};export{pt as default};
