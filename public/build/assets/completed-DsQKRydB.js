import{e as _,a as O,f as a,m as Z,b as l,l as w,w as s,h as o,n as ie,aa as ue,i as x,r as d,a1 as de,o as ce,H as g,F as ee,D,A as C,y as me,V as pe,j as te,k as T,z as fe,E as B,p as I,q as le,a0 as ve,t as f,a6 as _e,s as A,a7 as he,a8 as ye}from"./main-BpSD5wCm.js";import{r as Ve}from"./rules-CkvmYWH-.js";import{c as L,V as E,b as ge}from"./VCard-C_anV8ex.js";import{d as be}from"./debounce-DgfsZ_An.js";import{V as we}from"./VDialog-Ci-MEP6s.js";import{V as P,a as b}from"./VRow-CzLypqcN.js";import{V as j,a as xe}from"./VAutocomplete-Egfx8a-h.js";import{V as ke}from"./VForm-D3ytqXHp.js";import{V as ae}from"./VCheckbox-DH4C5dMs.js";import{V as De}from"./VDivider-B9uOmllp.js";import{a as Ce,V as Te}from"./VTable-Dd55-96J.js";import{V as Ye}from"./VPagination-nEtnHsBH.js";import{T as z}from"./index-BIHrAzu0.js";import"./VAvatar-BXSouuj_.js";import"./VImg-BVeUgilH.js";import"./VList-4XP3lAgn.js";import"./ssrBoot-C5JfTuR6.js";import"./VCheckboxBtn-C6FHBBI6.js";import"./VSelectionControl-2zhniYVX.js";import"./VSlideGroup-Cvsx-8F9.js";import"./VTooltip-ChTkYdf4.js";const Se={class:"position-relative overflow-hidden"},Me={class:"d-flex justify-space-between"},$e={class:"text-secondary"},Fe={__name:"FilterSidebar",props:{active:Boolean,width:Number},emits:["close"],setup(H,{emit:n}){const V=H,R=n;return(v,c)=>(_(),O("section",Se,[a("div",{class:ie(["position-fixed filter-content",V.active?"active":""]),style:ue({width:V.width+"px"})},[a("div",Me,[a("h3",$e,[Z(v.$slots,"header",{},()=>[x("Title")])]),a("div",{onClick:c[0]||(c[0]=Y=>R("close"))},[l(w,{icon:"ri-close-line",color:"#e08282",class:"cursor-pointer"})])]),l(o(E),{class:"mt-3"},{default:s(()=>[l(o(L),null,{default:s(()=>[Z(v.$slots,"content",{},()=>[x("Content")])]),_:3})]),_:3})],6)]))}},Ne={class:"d-flex mt-5 px-0"},Ue=a("div",{class:"d-flex justify-between align-center"},[a("div",{class:"w-100"},[a("h4",null,"Completed Cut-Off")])],-1),Ie=a("thead",null,[a("tr",null,[a("th",{class:"text-uppercase"},"#"),a("th",{class:"text-uppercase text-center"},"Timesheet"),a("th",{class:"text-uppercase text-center"},"Activity"),a("th",{class:"text-uppercase text-center"},"Students Name"),a("th",{class:"text-uppercase text-center"},"Activity Date"),a("th",{class:"text-uppercase text-center"},"Mentor/Tutor"),a("th",{class:"text-uppercase text-center"},"Time Spent"),a("th",{class:"text-uppercase text-center"},"Fee/Hours"),a("th",{class:"text-uppercase text-center"},"Total"),a("th",{class:"text-uppercase text-center"},"Cut-Off Date"),a("th",{class:"text-uppercase text-center"},"Cut-Off Status")])],-1),Oe={class:"text-center"},Re={class:"text-center text-capitalize"},Ae=a("th",{colspan:"9"},"Total Fee",-1),Be={colspan:"2",class:"text-end"},Pe={key:0},je=a("tr",null,[a("td",{colspan:"10",class:"text-center"}," Sorry, no data found. ")],-1),ze=[je],Le={class:"d-flex justify-center mt-5"},ct={__name:"completed",setup(H){const n=d(!1),V=d([]),R=d(),v=d(!1),c=d({cut_off_date:[],specific:!1,timesheet_id:null}),Y=d(!1),S=d(1),q=d(),k=d([]),M=d(null),$=d(null),G=d([]),F=d(null),J=d([]),K=d([]),h=d(null),y=async()=>{n.value=!0;const r="?page="+S.value,t=M.value?"&keyword="+M.value:"",u=$.value?"&package_id="+$.value:"",e=h.value?"&cutoff_start="+D(h.value[0]).format("YYYY-MM-DD"):"",m=h.value?"&cutoff_end="+D(h.value[h.value.length-1]).format("YYYY-MM-DD"):"",i=F.value?"&mentor_id="+F.value:"",N="api/v1/payment/paid"+r+t+u+e+m+i;try{const p=await C.get(N);p&&(S.value=p.current_page,q.value=p.last_page,V.value=p)}catch(p){console.error(p)}finally{n.value=!1}},Q=be(async()=>{await y()},1e3),oe=async()=>{n.value=!0;try{const r=await C.get("api/v1/package/component/list");r&&(G.value=r,n.value=!1)}catch(r){n.value=!1,console.error(r)}},se=async()=>{n.value=!0;try{const r=await C.get("api/v1/user/mentor-tutors");r&&(J.value=r,n.value=!1)}catch(r){n.value=!1,console.error(r)}},ne=async()=>{const r=await _e("Are you sure you want to cancel this activity?"),t={activity_id:Object.keys(k.value).map(u=>k.value[u])};if(r){n.value=!0;try{const u=await C.patch("api/v1/payment/cut-off/unassign",t);u&&(A("success",u.message,"bottom-end"),y())}catch(u){A("error",u.response.statusText,"bottom-end")}finally{n.value=!1}}},re=async()=>{let r=c.value.cut_off_date,t=D(r[0]).format("YYYY-MM-DD"),u=D(r[r.length-1]).format("YYYY-MM-DD");const e="api/v1/timesheet/component/list?cutoff_start="+t+"&cutoff_end="+u;n.value=!0;try{const m=await C.get(e);m&&(K.value=m,n.value=!1)}catch(m){n.value=!1,console.error(m)}},W=async r=>{let t=c.value.cut_off_date,u=D(t[0]).format("YYYY-MM-DD"),e=D(t[t.length-1]).format("YYYY-MM-DD"),m=c.value.specific?"/"+c.value.timesheet_id:"",i=r=="timesheet"?"api/v1/payment/cut-off/export"+m+"/"+u+"/"+e:"api/v1/payment/cut-off/summarize/"+u+"/"+e;const{valid:N}=await R.value.validate();if(N){v.value=!1,he();try{const p=await C.get(i,{responseType:"blob"});if(p){const X=window.URL.createObjectURL(new Blob([p],{type:'"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"'})),U=document.createElement("a");U.href=X,U.setAttribute("download",r=="timesheet"?`Timesheet_${u}_${e}.xlsx`:`Payroll_${u}_${e}.xlsx`),document.body.appendChild(U),U.click(),document.body.removeChild(U),window.URL.revokeObjectURL(X),ye.close(),A("success","Successfully downloaded","bottom-end")}}catch(p){A("error","Cut-Off date is not found!","bottom-end"),console.log(p)}finally{v.value=!0}}};return de(()=>{y()}),ce(()=>{y(),oe(),se()}),(r,t)=>{const u=me("VDateInput");return _(),O(ee,null,[l(Fe,{active:o(Y),width:450,onClose:t[4]||(t[4]=e=>Y.value=!1)},{header:s(()=>[x(" Filter ")]),content:s(()=>[l(P,{class:"my-1"},{default:s(()=>[l(b,{cols:"12"},{default:s(()=>[l(pe,{clearable:!0,modelValue:o(M),"onUpdate:modelValue":t[0]||(t[0]=e=>g(M)?M.value=e:null),placeholder:"Search","prepend-inner-icon":"ri-search-line","onClick:clear":o(Q),onInput:o(Q)},null,8,["modelValue","onClick:clear","onInput"])]),_:1}),l(b,{cols:"12"},{default:s(()=>[l(j,{clearable:!0,loading:o(n),disabled:o(n),label:"Package Name",items:o(G),"item-title":e=>e.package?e.type_of+" - "+e.package:e.type_of,"item-value":"id",modelValue:o($),"onUpdate:modelValue":[t[1]||(t[1]=e=>g($)?$.value=e:null),y],placeholder:"Select Timesheet Package"},null,8,["loading","disabled","items","item-title","modelValue"])]),_:1}),l(b,{cols:"12"},{default:s(()=>[l(j,{loading:o(n),disabled:o(n),clearable:"true",label:"Tutor/Mentor Name",items:o(J),"item-props":e=>({title:e.full_name,subtitle:e.roles.map(m=>m.name).join(", ")}),"item-value":"id",modelValue:o(F),"onUpdate:modelValue":[t[2]||(t[2]=e=>g(F)?F.value=e:null),y],placeholder:"Select Tutor/Mentor Name"},null,8,["loading","disabled","items","item-props","modelValue"])]),_:1}),l(b,{cols:"12"},{default:s(()=>[l(u,{modelValue:o(h),"onUpdate:modelValue":[t[3]||(t[3]=e=>g(h)?h.value=e:null),y],label:"Cut-Off Date","prepend-icon":"",multiple:"range",color:"primary",clearable:!0},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["active"]),l(we,{modelValue:o(v),"onUpdate:modelValue":t[11]||(t[11]=e=>g(v)?v.value=e:null),width:"auto"},{default:s(()=>[l(E,{width:"500","prepend-icon":"ri-download-line",title:"Download Timesheet"},{default:s(()=>[l(L,null,{default:s(()=>[l(ke,{onSubmit:t[10]||(t[10]=te(e=>W("timesheet"),["prevent"])),ref_key:"formData",ref:R},{default:s(()=>[l(P,null,{default:s(()=>[l(b,{cols:"12"},{default:s(()=>[l(u,{label:"Start - End Date","prepend-icon":"",multiple:"range",modelValue:o(c).cut_off_date,"onUpdate:modelValue":[t[5]||(t[5]=e=>o(c).cut_off_date=e),re],rules:o(Ve).required,class:"mb-3"},null,8,["modelValue","rules"]),l(ae,{label:"Specific Timesheet",modelValue:o(c).specific,"onUpdate:modelValue":t[6]||(t[6]=e=>o(c).specific=e)},null,8,["modelValue"]),l(j,{loading:o(n),label:"Timesheet - Package",items:o(K),"item-props":e=>({title:e.package_type+" - "+e.package_name,subtitle:e.clients}),"item-value":"id",class:"mt-3",modelValue:o(c).timesheet_id,"onUpdate:modelValue":t[7]||(t[7]=e=>o(c).timesheet_id=e),disabled:!o(c).specific},null,8,["loading","items","item-props","modelValue","disabled"])]),_:1})]),_:1}),l(De,{class:"mt-5"}),a("div",Ne,[l(T,{size:"small",variant:"tonal",color:"error",onClick:t[8]||(t[8]=e=>v.value=!1)},{default:s(()=>[l(w,{icon:"ri-close-line",class:"me-3"}),x(" Close ")]),_:1}),l(fe),l(T,{size:"small",variant:"tonal",type:"button",color:"info",class:"me-2",loading:o(n),disabled:o(n),onClick:t[9]||(t[9]=te(e=>W("recap"),["prevent"]))},{default:s(()=>[x(" Recap "),l(w,{icon:"ri-download-line",class:"ms-3"})]),_:1},8,["loading","disabled"]),l(T,{size:"small",variant:"tonal",color:"success",type:"submit",loading:o(n),disabled:o(n)},{default:s(()=>[x(" Timesheet "),l(w,{icon:"ri-download-line",class:"ms-3"})]),_:1},8,["loading","disabled"])])]),_:1},512)]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(E,null,{default:s(()=>[l(ge,null,{default:s(()=>[Ue]),_:1}),l(L,null,{default:s(()=>[l(P,{class:"my-1"},{default:s(()=>[l(b,{cols:"6"},{default:s(()=>[B((_(),I(T,{color:"info",onClick:t[12]||(t[12]=e=>Y.value=!o(Y))},{default:s(()=>[l(w,{icon:"ri-search-line"})]),_:1})),[[z,"Filter","end"]])]),_:1}),l(b,{cols:"6",class:"text-end"},{default:s(()=>[o(k).length>0?B((_(),I(T,{key:0,color:"error",class:"me-1",onClick:ne},{default:s(()=>[l(w,{icon:"ri-close-line"})]),_:1})),[[z,"Cancel","start"]]):le("",!0),B((_(),I(T,{color:"secondary",onClick:t[13]||(t[13]=e=>v.value=!0)},{default:s(()=>[l(w,{icon:"ri-download-line"})]),_:1})),[[z,"Download Timesheet","start"]])]),_:1})]),_:1}),o(n)?(_(),I(Te,{key:0,class:"mx-auto border",type:"table-thead, table-row@10"})):(_(),I(Ce,{key:1,class:"text-no-wrap"},{default:s(()=>{var e,m;return[Ie,a("tbody",null,[(_(!0),O(ee,null,ve(o(V).data,i=>(_(),O("tr",{key:i},[a("td",null,[l(ae,{modelValue:o(k),"onUpdate:modelValue":t[14]||(t[14]=N=>g(k)?k.value=N:null),value:i.id},null,8,["modelValue","value"])]),a("td",null,f(i.package.type+" - "+i.package.name),1),a("td",null,f(i.activity),1),a("td",null,f(i.students),1),a("td",null,f(i.date),1),a("td",null,f(i.mentor_tutor),1),a("td",null,f(i.time_spent>0?(i.time_spent/60).toFixed(2)+" Hours":"-"),1),a("td",null,"Rp. "+f(new Intl.NumberFormat("id-ID").format(i.fee_hours)),1),a("td",null," Rp. "+f(['Bonus Fee"',"Additional Fee"].includes(i.activity)?new Intl.NumberFormat("id-ID").format(i.time_spent/60*i.fee_hours):new Intl.NumberFormat("id-ID").format(i.fee_hours)),1),a("td",Oe,f(i.cutoff_date),1),a("td",Re,[l(xe,{color:"success"},{default:s(()=>[x(f(i.cutoff_status),1)]),_:2},1024)])]))),128))]),a("thead",null,[a("tr",null,[Ae,a("th",Be," Rp. "+f(new Intl.NumberFormat("id-ID").format(o(V).total_fee)),1)])]),((m=(e=o(V))==null?void 0:e.data)==null?void 0:m.length)==0?(_(),O("tfoot",Pe,ze)):le("",!0)]}),_:1})),a("div",Le,[l(Ye,{modelValue:o(S),"onUpdate:modelValue":[t[15]||(t[15]=e=>g(S)?S.value=e:null),y],length:o(q),"total-visible":4,color:"primary",density:"compact","show-first-last-page":!1},null,8,["modelValue","length"])])]),_:1})]),_:1})],64)}}};export{ct as default};
