import{r as i,e as se,o as f,f as M,w as s,b as l,Z as ue,u as e,z as L,V as k,a as n,t as b,h as X,W,j as y,Y as J,m as de,A as w,s as Y,$ as ce,c as P,F as K,a1 as me,l as pe,X as ae,n as oe}from"./main-BIQnUG0_.js";import{r as x}from"./rules-CkvmYWH-.js";import{a as re,c as _e,V as ne,b as ge}from"./VCard-bB0gcZ_p.js";import{V as fe}from"./VForm-C80-6yBX.js";import{V as Q,a as v}from"./VRow-C_4OSeIv.js";import{V as N}from"./VAutocomplete-pUjQXdCh.js";import{V as ve}from"./VAlert-Dhtvoesw.js";import{V as Z}from"./VTooltip-Dkq1qh7g.js";import{V as be}from"./VTextarea-D6_Z88ln.js";import{d as ye}from"./debounce-BZiOUCC_.js";import{V as Ve}from"./VDialog-BkwIqJft.js";import{a as ke,V as he}from"./VTable-B5WVKUly.js";import{V as xe}from"./VPagination-HyS9jRe0.js";import{V as we}from"./VBadge-FFK5ltw2.js";import"./VAvatar-D4LMqwao.js";import"./VImg-xEhFyEAy.js";import"./VList-CGu6fi_t.js";import"./ssrBoot--6i7Pcvj.js";import"./VDivider-k53iwSKd.js";import"./VCheckboxBtn-21YCfxqa.js";import"./VSelectionControl-BKLWG9u1.js";import"./VSlideGroup-CgR0ygE0.js";const Te={__name:"program_add_tutoring",emits:["close","reload"],setup(ee,{emit:U}){const z=U,u=i(!1),g=i([]),E=i([]),A=i([]),D=i([]),V=i([]),$=i([]),S=i([]),G=i([]),T=i(!1),h=i("tutor"),R=i(null),q=i(null),O=i(),o=i({ref_id:null,mentortutor_email:null,subject_id:null,inhouse_id:null,package_id:null,tax:null,individual_fee:null,duration:"",notes:"",pic_id:[],curriculum_id:null}),_=async()=>{var a,t;const r="api/v1/program/list";try{u.value=!0;const c=await w.get(r);c&&(E.value=c),u.value=!1}catch(c){Y("error",(t=(a=c.response)==null?void 0:a.data)==null?void 0:t.message,"bottom-end"),console.error(c),u.value=!1}},p=async(r=!1)=>{const a=r?"api/v1/user/mentor-tutors?inhouse=true&role="+h.value:"api/v1/user/mentor-tutors?role="+h.value;try{const t=await w.get(a);t&&(r?G.value=Object.values(t):A.value=t)}catch(t){console.error(t)}},B=async()=>{try{const r=await w.get("api/v1/package/component/list?category="+h.value);r&&($.value=r)}catch(r){console.error(r)}},m=()=>{const r=o.value.package_id,a=$.value.findIndex(c=>c.id===r);let t=$.value[a];t.detail?(T.value=!0,o.value.duration=t.detail):(T.value=!1,o.value.duration=null)},H=async()=>{try{const r=await w.get("api/v1/user/component/list");r&&(S.value=r)}catch(r){console.error(r)}},d=async(r,a=null,t=0)=>{if(R.value=t,o.value.tax=(t==1,2.5),o.value.subject_id=null,h.value=="mentor")o.value.subject_id=r[0].subjects[0].id;else try{const c=await w.get("api/v1/user/mentor-tutors/"+a+"/subjects");c&&(V.value=c)}catch(c){console.error(c)}},I=async(r,a,t)=>{if(a)try{const c=await w.get("api/v1/component/fee/"+r+"/"+a+"/"+t);c&&(o.value.individual_fee=c.fee_individual,c.fee_individual?te():q.value=null)}catch(c){console.error(c)}},F=async()=>{try{const r=await w.get("api/v1/curriculum/component/list");r&&(D.value=r)}catch(r){console.error(r)}},C=async()=>{var a,t,c;o.value.mentortutor_email=g.value.email;const{valid:r}=await O.value.validate();if(r){u.value=!0;try{const j=await w.post("api/v1/timesheet/create",o.value);j&&(Y("success",j.message,"bottom-end"),z("reload"),o.value={ref_id:[],mentortutor_email:null,subject_id:null,subject_name:null,inhouse_id:null,package_id:null,duration:"",notes:"",pic_id:[],tax:null,individual_fee:""},g.value=[],window.open("/admin/timesheet/tutoring/"+((a=j.data)==null?void 0:a.timesheet_id),"_blank"))}catch(j){if(console.log(j),(c=(t=j==null?void 0:j.response)==null?void 0:t.data)!=null&&c.errors){const ie=j.response.data.errors;Y("error",ie,"bottom-end")}}finally{z("close"),u.value=!1}}},te=()=>{const r=o.value.individual_fee*(1-o.value.tax/100);q.value=Math.trunc(r)},le=()=>{const r=q.value/(1-o.value.tax/100);o.value.individual_fee=Math.trunc(r)};return se(()=>{_(),p(),p(!0),B(),H(),F()}),(r,a)=>(f(),M(ne,{"max-width":"650","prepend-icon":"ri-send-plane-line",title:"Assign to Tutor"},{default:s(()=>[l(re,null,{default:s(()=>[l(fe,{onSubmit:ue(C,["prevent"]),ref_key:"formData",ref:O,"validate-on":"input"},{default:s(()=>[l(Q,null,{default:s(()=>[l(v,{md:"12",cols:"12"},{default:s(()=>[l(N,{clearable:"",modelValue:e(o).ref_id,"onUpdate:modelValue":a[0]||(a[0]=t=>e(o).ref_id=t),label:"Mentee Name",items:e(E),"item-props":t=>({title:t.student_name,subtitle:t.program_name+(t.timesheet_id?" ✅":"")+(t.scnd_timesheet_id?" ✅":""),disabled:t.timesheet_id&&t.scnd_timesheet_id}),"item-value":"id",rules:e(x).required,loading:e(u),disabled:e(u),density:"compact",multiple:""},null,8,["modelValue","items","item-props","rules","loading","disabled"])]),_:1}),l(v,{md:"12",cols:"12"},{default:s(()=>[l(N,{clearable:"",modelValue:e(g),"onUpdate:modelValue":[a[1]||(a[1]=t=>L(g)?g.value=t:null),a[2]||(a[2]=t=>d(e(g).roles,e(g).uuid,e(g).has_npwp))],label:"Tutor Name",items:e(A),"item-props":t=>({title:t.full_name,subtitle:t.roles.map(c=>c.name).join(", ")}),rules:e(x).required,loading:e(u),disabled:e(u),density:"compact"},null,8,["modelValue","items","item-props","rules","loading","disabled"]),e(R)!=null?(f(),M(ve,{key:0,color:e(R)==1?"success":"error",class:"py-1 mt-2"},{default:s(()=>[l(k,{icon:"ri-error-warning-line",class:"mr-2"}),n("small",null," Tutor "+b(e(R)==1?"already":"don`t")+" have NPWP ",1)]),_:1},8,["color"])):X("",!0)]),_:1}),l(v,{md:"6",cols:"6"},{default:s(()=>[l(N,{clearable:"",modelValue:e(o).curriculum_id,"onUpdate:modelValue":[a[3]||(a[3]=t=>e(o).curriculum_id=t),a[4]||(a[4]=t=>I(e(g).id,e(o).subject_name,e(o).curriculum_id))],label:"Curriculum",items:e(D),"item-props":t=>({title:t.name}),rules:e(x).required,loading:e(u),disabled:e(u),density:"compact","item-value":"id"},null,8,["modelValue","items","item-props","rules","loading","disabled"])]),_:1}),l(v,{md:"6",cols:"6"},{default:s(()=>[l(N,{clearable:"",modelValue:e(o).subject_name,"onUpdate:modelValue":[a[5]||(a[5]=t=>e(o).subject_name=t),a[6]||(a[6]=t=>I(e(g).id,e(o).subject_name,e(o).curriculum_id))],label:"Subject Tutoring",items:e(V),loading:e(u),disabled:e(u),rules:e(x).required,density:"compact"},null,8,["modelValue","items","loading","disabled","rules"])]),_:1}),l(v,{md:"8",cols:"8"},{default:s(()=>[l(N,{clearable:"",label:"Package",modelValue:e(o).package_id,"onUpdate:modelValue":[a[7]||(a[7]=t=>e(o).package_id=t),m],items:e($),density:"compact","item-props":t=>({title:t.package!=null?t.type_of+" - "+t.package:t.type_of,subtitle:t.detail?t.detail/60+" Hours":"Customizable"}),"item-value":"id",rules:e(x).required,loading:e(u),disabled:e(u)},null,8,["modelValue","items","item-props","rules","loading","disabled"])]),_:1}),l(v,{md:"4",cols:"4"},{default:s(()=>[l(W,{type:"number",clearable:"",label:+e(o).duration/60?"Minutes ("+e(o).duration/60+" Hours)":"Minutes",readonly:e(T),modelValue:e(o).duration,"onUpdate:modelValue":a[8]||(a[8]=t=>e(o).duration=t),density:"compact",rules:e(x).required},null,8,["label","readonly","modelValue","rules"])]),_:1}),l(v,{md:"4",cols:"7"},{default:s(()=>[l(W,{type:"number",clearable:"",label:"Fee/hours (Nett)",modelValue:e(q),"onUpdate:modelValue":[a[9]||(a[9]=t=>L(q)?q.value=t:null),le],density:"compact",rules:e(x).required},null,8,["modelValue","rules"])]),_:1}),l(v,{md:"4",cols:"5"},{default:s(()=>[l(W,{type:"number",clearable:"",label:"Tax",modelValue:e(o).tax,"onUpdate:modelValue":[a[10]||(a[10]=t=>e(o).tax=t),le],rules:e(x).required,density:"compact"},null,8,["modelValue","rules"])]),_:1}),l(v,{md:"4",cols:"12"},{default:s(()=>[l(Z,{activator:"parent",location:"top"},{default:s(()=>[y(" Fee Gross is automatically calculated based on the entered Net Fee and Tax Rate. ")]),_:1}),l(W,{type:"number",clearable:"",label:"Fee/hours (Gross)",modelValue:e(o).individual_fee,"onUpdate:modelValue":[a[11]||(a[11]=t=>e(o).individual_fee=t),te],density:"compact",readonly:"",rules:e(x).required},null,8,["modelValue","rules"])]),_:1}),l(v,{md:"6",cols:"6"},{default:s(()=>[l(N,{clearable:"",modelValue:e(o).inhouse_id,"onUpdate:modelValue":a[12]||(a[12]=t=>e(o).inhouse_id=t),label:"Inhouse Mentor/Tutor",items:e(G),density:"compact","item-props":t=>({title:t.full_name}),"item-value":"uuid",loading:e(u),disabled:e(u),rules:e(x).required},null,8,["modelValue","items","item-props","loading","disabled","rules"])]),_:1}),l(v,{md:"6",cols:"6"},{default:s(()=>[l(N,{multiple:"",clearable:"",chips:"",label:"PIC",modelValue:e(o).pic_id,"onUpdate:modelValue":a[13]||(a[13]=t=>e(o).pic_id=t),items:e(S),"item-title":"full_name","item-value":"id",loading:e(u),density:"compact",disabled:e(u),rules:e(x).required},null,8,["modelValue","items","loading","disabled","rules"])]),_:1}),l(v,{md:"12"},{default:s(()=>[l(be,{label:"Notes",modelValue:e(o).notes,"onUpdate:modelValue":a[14]||(a[14]=t=>e(o).notes=t),density:"compact"},null,8,["modelValue"])]),_:1})]),_:1}),l(_e,{class:"mt-5 px-0"},{default:s(()=>[l(J,{variant:"tonal",color:"error",type:"button",onClick:a[15]||(a[15]=t=>z("close"))},{default:s(()=>[l(k,{icon:"ri-close-line",class:"me-3"}),y(" Close ")]),_:1}),l(de),l(J,{variant:"tonal",color:"success",type:"submit"},{default:s(()=>[y(" Save "),l(k,{icon:"ri-save-line",class:"ms-3"})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1}))}},Ce=n("div",{class:"d-flex justify-between align-center"},[n("div",{class:"w-100"},[n("h4",null,"Timesheet List")])],-1),je={class:"d-flex gap-2"},Pe={key:0},Ne=n("th",{class:"text-uppercase",width:"1%"}," No ",-1),Ue=n("th",{class:"text-uppercase text-center"},"School/Student Name",-1),Se={class:"text-uppercase text-center"},qe=n("th",{class:"text-uppercase text-center"},"Package",-1),Ie=n("th",{class:"text-uppercase text-center"},"Tutor/Mentor",-1),Fe=n("th",{class:"text-uppercase text-center"},"PIC",-1),$e=n("th",{class:"text-uppercase text-center"},"Total Hours",-1),Me=n("th",{class:"text-uppercase text-center"},"Used",-1),Ae=n("th",{class:"text-uppercase text-center"},"#",-1),De=["onClick"],Re={key:0},Be={key:1},He={class:"text-start"},Le={class:"text-left"},ze={class:"text-left"},Ee={class:"text-left"},Ge={class:"text-left"},We={key:0},Oe=n("tr",null,[n("td",{colspan:"9",class:"text-center"}," Sorry, no data found. ")],-1),Xe=[Oe],Ye={class:"d-flex justify-center mt-5"},bt={__name:"timesheet",props:{name:String},setup(ee){const U=ee,z=me();i([]);const u=i(!1),g=i(1),E=i(),A=i(),D=i([]),V=i(!1),$=i([]),S=i(),G=i([]),T=i(),h=async()=>{var I,F;const _="?page="+g.value,p=A.value?"&keyword="+A.value:"",B=S.value?"&program_name="+encodeURIComponent(S.value):"",m=T.value?"&package_id="+T.value:"",H="&paginate=true",d=U.name!="tutoring"?"&is_subject_specialist=true":"";try{V.value=!0;const C=await w.get("api/v1/timesheet/list"+_+p+B+m+H+d);C&&(g.value=C.current_page,E.value=C.last_page,D.value=C),V.value=!1}catch(C){Y("error",(F=(I=C.response)==null?void 0:I.data)==null?void 0:F.message,"bottom-end"),console.error(C),V.value=!1}},R=async()=>{try{const _=await w.get("api/v1/program/component/list");_&&($.value=_)}catch(_){console.error(_)}},q=async()=>{try{const _=await w.get("api/v1/package/component/list");_&&(G.value=_)}catch(_){console.error(_)}},O=ye(async _=>{g.value=1,A.value=_.target.value,await h()},1e3),o=_=>{const p=z.resolve("/admin/timesheet/"+U.name+"/"+_);window.open(p.href,"_blank")};return ce(()=>{h()}),se(()=>{h(),R(),q()}),(_,p)=>{const B=pe("VText");return f(),P(K,null,[l(Ve,{modelValue:e(u),"onUpdate:modelValue":p[1]||(p[1]=m=>L(u)?u.value=m:null),width:"auto",persistent:""},{default:s(()=>[l(Te,{onClose:p[0]||(p[0]=m=>u.value=!1),onReload:h})]),_:1},8,["modelValue"]),l(ne,null,{default:s(()=>[l(ge,null,{default:s(()=>[Ce]),_:1}),l(re,null,{default:s(()=>[l(Q,{class:"my-1 justify-space-between"},{default:s(()=>[U.name=="tutoring"?(f(),M(v,{key:0,cols:"12",md:"6"},{default:s(()=>[l(Q,null,{default:s(()=>[l(v,{cols:"12",md:"6"},{default:s(()=>[l(N,{density:"compact",clearable:"",modelValue:e(S),"onUpdate:modelValue":[p[2]||(p[2]=m=>L(S)?S.value=m:null),h],label:"Program Name",items:e($),"item-title":"program_name",placeholder:"Select Program Name",loading:e(V),disabled:e(V)},null,8,["modelValue","items","loading","disabled"])]),_:1}),l(v,{cols:"12",md:"6"},{default:s(()=>[l(N,{density:"compact",clearable:"true",modelValue:e(T),"onUpdate:modelValue":[p[3]||(p[3]=m=>L(T)?T.value=m:null),h],label:"Package",items:e(G),"item-props":m=>({title:m.package!=null?m.type_of+" - "+m.package:m.type_of}),"item-value":"id",placeholder:"Select Package",loading:e(V),disabled:e(V)},null,8,["modelValue","items","item-props","loading","disabled"])]),_:1})]),_:1})]),_:1})):X("",!0),l(v,{cols:"12",md:"3"},{default:s(()=>[n("div",je,[l(W,{density:"compact",loading:e(V),disabled:e(V),"append-inner-icon":"ri-search-line",label:"Search","hide-details":"","single-line":"",onInput:e(O)},null,8,["loading","disabled","onInput"]),U.name=="tutoring"?(f(),P("div",Pe,[l(Z,{activator:"parent",location:"start"},{default:s(()=>[y("Add New Timesheet")]),_:1}),l(J,{icon:"ri-add-line",onClick:p[4]||(p[4]=m=>u.value=!0)})])):X("",!0)])]),_:1})]),_:1}),e(V)?(f(),M(he,{key:0,class:"mx-auto border",type:"table-thead, table-row@10"})):(f(),M(ke,{key:1,class:"text-no-wrap",hover:""},{default:s(()=>{var m,H;return[n("thead",null,[n("tr",null,[Ne,Ue,n("th",Se,b(U.name=="tutoring"?"Program Name":"Engagement Type"),1),qe,Ie,Fe,$e,Me,Ae])]),n("tbody",null,[(f(!0),P(K,null,ae(e(D).data,(d,I)=>(f(),P("tr",{key:I,class:oe([d.void=="true"?"bg-secondary":"","cursor-pointer"]),onClick:F=>o(d.id)},[n("td",null,b(parseInt(I)+1),1),n("td",{class:oe(d.group?"cursor-pointer text-left":"text-left")},[d.group?(f(),M(B,{key:0},{default:s(()=>[l(k,{icon:"ri-group-line",class:"me-3"}),y(" "+b(d.clients[0])+" ",1),l(we,{color:"error",content:d.clients.length-1+"+",inline:""},null,8,["content"]),l(Z,{activator:"parent",location:"top",transition:"scroll-y-transition",class:"bg-white"},{default:s(()=>[(f(!0),P(K,null,ae(d.clients,F=>(f(),P("div",null,b(F),1))),256))]),_:2},1024)]),_:2},1024)):(f(),M(B,{key:1},{default:s(()=>[l(k,{icon:"ri-user-line",class:"me-3"}),y(" "+b(d.clients),1)]),_:2},1024))],2),U.name=="tutoring"?(f(),P("td",Re,[l(k,{icon:"ri-bookmark-3-line",class:"me-3"}),y(" "+b(d.detail_package=="Trial"?"[TRIAL]":"")+" "+b(d.program_name),1)])):(f(),P("td",Be,[l(k,{icon:"ri-bookmark-3-line",class:"me-3"}),y(" "+b(d.engagement_type),1)])),n("td",He,[l(k,{icon:"ri-bookmark-line",class:"me-3"}),y(" "+b(d.detail_package?d.package_type+" - "+d.detail_package:d.package_type),1)]),n("td",Le,[l(k,{icon:"ri-user-line",class:"me-3"}),y(" "+b(d.tutor_mentor),1)]),n("td",ze,[l(k,{icon:"ri-user-line",class:"cursor-pointer me-3"}),y(" "+b(d.admin),1)]),n("td",Ee,[l(k,{icon:"ri-calendar-schedule-line",class:"cursor-pointer me-3"}),y(" "+b(d.duration/60)+" Hours ",1)]),n("td",Ge,[l(k,{icon:"ri-timer-2-line",class:"cursor-pointer me-3"}),y(" "+b(d.spent/60)+" Hours ",1)]),n("td",null,[l(J,{color:d.void=="true"?"light":"secondary",onClick:F=>o(d.id)},{default:s(()=>[l(k,{icon:"ri-timeline-view",class:"cursor-pointer"}),l(Z,{activator:"parent",location:"top",transition:"scroll-y-transition"},{default:s(()=>[y(" View Detail ")]),_:1})]),_:2},1032,["color","onClick"])])],10,De))),128))]),((H=(m=e(D))==null?void 0:m.data)==null?void 0:H.length)==0?(f(),P("tfoot",We,Xe)):X("",!0)]}),_:1})),n("div",Ye,[l(xe,{modelValue:e(g),"onUpdate:modelValue":[p[5]||(p[5]=m=>L(g)?g.value=m:null),h],length:e(E),"total-visible":4,color:"primary","show-first-last-page":!1},null,8,["modelValue","length"])])]),_:1})]),_:1})],64)}}};export{bt as default};
