import{r as i,e as W,o as v,f as x,w as s,b as l,Z as oe,u as e,z as D,h as X,W as R,Y as z,V as q,j as P,m as se,A as C,s as E,l as re,x as ne,t as $,a as d,c as L,X as ie,F as ue,n as de}from"./main-qXfsbDxV.js";import{r as U}from"./rules-B5G8qOzK.js";import{a as Z,c as ce,V as J,b as me}from"./VCard-0nDPb5C9.js";import{V as pe}from"./VForm-uuZu4Soy.js";import{V as K,a as g}from"./VRow-CZMaU6Db.js";import{V as I}from"./VAutocomplete-C_ZpV7I8.js";import{V as fe}from"./VTextarea-CfddeDRU.js";import{d as ve}from"./debounce-IAC0XKs4.js";import{V as ge}from"./VDialog-BkesBgLA.js";import{V as _e,a as be}from"./VTable-YUNXAyGR.js";import{V as Ve}from"./VPagination-DeN2sUQK.js";import{T as ye}from"./index-Bc8q61ID.js";import{V as ke}from"./VCheckbox-B19lrrk6.js";import{V as Y}from"./VTooltip-DgmRvJS_.js";import"./VAvatar-8XWfWrYa.js";import"./VImg-DfdL-2nd.js";import"./VList-BmLD_4xu.js";import"./ssrBoot-C03wSs_W.js";import"./VDivider-BlZqtOM7.js";import"./VCheckboxBtn-sQZtdDVL.js";import"./VSelectionControl-DsOh91CE.js";import"./VSlideGroup-COF0qh2d.js";const he={__name:"program_add",props:{selected:Object},emits:["close","reload"],setup(G,{emit:_}){var H,O;const w=G,k=_,c=i(!1),m=i([]),S=i([]),b=i([]),A=i([]),j=i([]),h=i([]),F=i([]),M=i([]),V=i(!1),u=(O=(H=w.selected[0])==null?void 0:H.require)==null?void 0:O.toLowerCase(),N=i(),t=i({ref_id:w.selected.map(r=>r.id),mentortutor_email:null,subject_id:null,inhouse_id:null,package_id:null,duration:"",notes:"",pic_id:[]}),T=async(r=!1)=>{const a=r?"api/v1/user/mentor-tutors?inhouse=true&role="+u:"api/v1/user/mentor-tutors?role="+u;try{const n=await C.get(a);n&&(r?M.value=Object.values(n):b.value=n)}catch(n){console.error(n)}},p=async()=>{try{const r=await C.get("api/v1/package/component/list?category="+u);r&&(h.value=r)}catch(r){console.error(r)}},y=()=>{const r=t.value.package_id,a=h.value.findIndex(f=>f.id===r);let n=h.value[a];n.detail?(V.value=!0,t.value.duration=n.detail):(V.value=!1,t.value.duration=null)},B=async()=>{try{const r=await C.get("api/v1/user/component/list");r&&(F.value=r)}catch(r){console.error(r)}},Q=async(r,a=null)=>{if(t.value.subject_id=null,u=="mentor")t.value.subject_id=r[0].subjects[0].id;else try{const n=await C.get("api/v1/user/mentor-tutors/"+a+"/subjects");n&&(j.value=n)}catch(n){console.error(n)}},ee=async(r,a)=>{try{const n=await C.get("api/v1/component/fee/"+r+"/"+a);n&&(t.value.individual_fee=n.fee_individual)}catch(n){console.error(n)}},le=async()=>{try{const r=await C.get("api/v1/curriculum/component/list");r&&(A.value=r)}catch(r){console.error(r)}},te=async()=>{var a,n;c.value=!0,t.value.mentortutor_email=m.value.email;const{valid:r}=await N.value.validate();if(r)try{const f=await C.post("api/v1/timesheet/create",t.value);f&&(E("success",f.message,"bottom-end"),k("reload"),selected.value=[],t.value={ref_id:[],mentortutor_email:null,subject_id:null,subject_name:null,inhouse_id:null,package_id:null,duration:"",notes:"",pic_id:[],individual_fee:""},m.value=[])}catch(f){if(console.log(f),(n=(a=f==null?void 0:f.response)==null?void 0:a.data)!=null&&n.errors){const o=f.response.data.errors;E("error",o,"bottom-end")}}finally{k("close"),c.value=!1}};return W(()=>{T(),T(!0),p(),B(),le()}),(r,a)=>(v(),x(J,{width:"650","prepend-icon":"ri-send-plane-line",title:"Assign to Mentor/Tutor"},{default:s(()=>[l(Z,null,{default:s(()=>[l(pe,{onSubmit:oe(te,["prevent"]),ref_key:"formData",ref:N,"validate-on":"input"},{default:s(()=>[l(K,null,{default:s(()=>{var n,f;return[l(g,{md:"12"},{default:s(()=>[l(I,{variant:"solo",clearable:"",modelValue:e(m),"onUpdate:modelValue":[a[0]||(a[0]=o=>D(m)?m.value=o:null),a[1]||(a[1]=o=>Q(e(m).roles,e(m).uuid))],label:"Mentor/Tutor",items:e(b),"item-props":o=>({title:o.full_name,subtitle:o.roles.map(ae=>ae.name).join(", ")}),rules:e(U).required,loading:e(c),disabled:e(c)},null,8,["modelValue","items","item-props","rules","loading","disabled"])]),_:1}),l(g,{md:"6",col:"12"},{default:s(()=>[l(I,{variant:"solo",clearable:"",modelValue:e(S),"onUpdate:modelValue":a[2]||(a[2]=o=>D(S)?S.value=o:null),label:"Curriculum",items:e(A),"item-props":o=>({title:o.name}),rules:e(U).required,loading:e(c),disabled:e(c)},null,8,["modelValue","items","item-props","rules","loading","disabled"])]),_:1}),((f=(n=w.selected[0])==null?void 0:n.require)==null?void 0:f.toLowerCase())=="tutor"?(v(),x(g,{key:0,md:"6",col:"12"},{default:s(()=>[l(I,{variant:"solo",clearable:"",modelValue:e(t).subject_name,"onUpdate:modelValue":[a[3]||(a[3]=o=>e(t).subject_name=o),a[4]||(a[4]=o=>ee(e(m).id,e(t).subject_name))],label:"Subject Tutoring",items:e(j),loading:e(c),disabled:e(c),rules:e(U).required},null,8,["modelValue","items","loading","disabled","rules"])]),_:1})):X("",!0),l(g,{md:"5",col:"12"},{default:s(()=>[l(I,{variant:"solo",clearable:"",label:"Package",modelValue:e(t).package_id,"onUpdate:modelValue":[a[5]||(a[5]=o=>e(t).package_id=o),y],items:e(h),"item-props":o=>({title:o.package!=null?o.type_of+" - "+o.package:o.type_of,subtitle:o.detail?o.detail/60+" Hours":"Customizable"}),"item-value":"id",rules:e(U).required,loading:e(c),disabled:e(c)},null,8,["modelValue","items","item-props","rules","loading","disabled"])]),_:1}),l(g,{md:"3",col:"7"},{default:s(()=>[l(R,{type:"number",variant:"solo",clearable:"",label:+e(t).duration/60?""+e(t).duration/60+" Hours":"Minutes",readonly:e(V),modelValue:e(t).duration,"onUpdate:modelValue":a[6]||(a[6]=o=>e(t).duration=o),rules:e(U).required},null,8,["label","readonly","modelValue","rules"])]),_:1}),l(g,{md:"4",col:"5"},{default:s(()=>[l(R,{type:"number",variant:"solo",clearable:"",label:"Fee/hours",modelValue:e(t).individual_fee,"onUpdate:modelValue":a[7]||(a[7]=o=>e(t).individual_fee=o),rules:e(U).required},null,8,["modelValue","rules"])]),_:1}),l(g,{md:"6",col:"12"},{default:s(()=>[l(I,{variant:"solo",clearable:"",modelValue:e(t).inhouse_id,"onUpdate:modelValue":a[8]||(a[8]=o=>e(t).inhouse_id=o),label:"Inhouse Mentor/Tutor",items:e(M),"item-props":o=>({title:o.full_name}),"item-value":"uuid",loading:e(c),disabled:e(c),rules:e(U).required},null,8,["modelValue","items","item-props","loading","disabled","rules"])]),_:1}),l(g,{md:"6",col:"12"},{default:s(()=>[l(I,{variant:"solo",multiple:"",clearable:"",chips:"",label:"PIC",modelValue:e(t).pic_id,"onUpdate:modelValue":a[9]||(a[9]=o=>e(t).pic_id=o),items:e(F),"item-title":"full_name","item-value":"id",loading:e(c),disabled:e(c),rules:e(U).required},null,8,["modelValue","items","loading","disabled","rules"])]),_:1}),l(g,{md:"12"},{default:s(()=>[l(fe,{label:"Notes",modelValue:e(t).notes,"onUpdate:modelValue":a[10]||(a[10]=o=>e(t).notes=o),variant:"solo"},null,8,["modelValue"])]),_:1})]}),_:1}),l(ce,{class:"mt-5"},{default:s(()=>[l(z,{color:"error",type:"button",onClick:a[11]||(a[11]=n=>k("close"))},{default:s(()=>[l(q,{icon:"ri-close-line",class:"me-3"}),P(" Close ")]),_:1}),l(se),l(z,{color:"success",type:"submit"},{default:s(()=>[P(" Save "),l(q,{icon:"ri-save-line",class:"ms-3"})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1}))}},xe=d("div",{class:"d-flex justify-between align-center"},[d("div",{class:"w-100"},[d("h4",null,"Program Name")])],-1),we=d("thead",null,[d("tr",null,[d("th",{class:"text-uppercase",width:"1%"}," # "),d("th",{class:"text-uppercase text-center"},"Invoice ID"),d("th",{class:"text-uppercase text-center"},"Student/School Name"),d("th",{class:"text-uppercase text-center"},"Program Name"),d("th",{class:"text-uppercase text-center"},"Timesheet")])],-1),Ce={nowrap:""},je={class:"text-left",nowrap:""},Te={class:"text-left",nowrap:""},Ue={class:"text-center"},qe={key:0},Pe=d("tr",null,[d("td",{colspan:"6",class:"text-center"}," Sorry, no data found. ")],-1),Se=[Pe],Ne={class:"d-flex justify-center mt-5"},ll={__name:"program",setup(G){const _=i([]),w=i(!1),k=i(1),c=i(),m=i(),S=i([]),b=i(!1),A=i([]),j=i();i(),i({ref_id:[],mentortutor_email:null,subject_id:null,inhouse_id:null,package_id:null,duration:"",notes:"",pic_id:[]});const h=async()=>{var T,p;_.value=[];const V="?page="+k.value,u=m.value?"&keyword="+m.value:"",N=j.value?"&program_name="+encodeURIComponent(j.value):"",t="&paginate=true";try{b.value=!0;const y=await C.get("api/v1/program/list"+V+u+N+t);y&&(k.value=y.current_page,c.value=y.last_page,S.value=y),b.value=!1}catch(y){E("error",(p=(T=y.response)==null?void 0:T.data)==null?void 0:p.message,"bottom-end"),console.error(y),b.value=!1}},F=async()=>{try{const V=await C.get("api/v1/program/component/list");V&&(A.value=V)}catch(V){console.error(V)}},M=ve(async()=>{k.value=1,await h()},1e3);return W(()=>{h(),F()}),(V,u)=>{const N=re("VText");return v(),x(J,null,{default:s(()=>[l(me,null,{default:s(()=>[xe]),_:1}),l(Z,null,{default:s(()=>[l(K,{class:"my-1"},{default:s(()=>[l(g,{cols:"12",md:"3"},{default:s(()=>[l(I,{clearable:"",modelValue:e(j),"onUpdate:modelValue":[u[0]||(u[0]=t=>D(j)?j.value=t:null),h],label:"Program Name",items:e(A),"item-title":"program_name",placeholder:"Select Program Name",density:"compact",variant:"solo","hide-details":"","single-line":"",loading:e(b),disabled:e(b)},null,8,["modelValue","items","loading","disabled"])]),_:1}),l(g,{cols:"12",md:"3"},{default:s(()=>[l(R,{loading:e(b),disabled:e(b),"append-inner-icon":"ri-search-line",density:"compact",label:"Search",variant:"solo","hide-details":"","single-line":"",modelValue:e(m),"onUpdate:modelValue":u[1]||(u[1]=t=>D(m)?m.value=t:null),onInput:e(M)},null,8,["loading","disabled","modelValue","onInput"])]),_:1}),l(g,{cols:"12",md:"6",class:"text-end"},{default:s(()=>[ne((v(),x(z,{density:"compact",color:e(_).length>0?"warning":"primary",class:"mb-2",disabled:!(e(_).length>0),onClick:u[2]||(u[2]=t=>w.value=!0)},{default:s(()=>[P(" Assign "+$(e(_).length>1?"to Group":""),1)]),_:1},8,["color","disabled"])),[[ye,"Generate Timesheet","start"]])]),_:1})]),_:1}),l(ge,{modelValue:e(w),"onUpdate:modelValue":u[4]||(u[4]=t=>D(w)?w.value=t:null),width:"auto",persistent:""},{default:s(()=>[l(he,{selected:e(_),onClose:u[3]||(u[3]=t=>w.value=!1),onReload:h},null,8,["selected"])]),_:1},8,["modelValue"]),e(b)?(v(),x(_e,{key:0,class:"mx-auto border",type:"table-thead, table-row@10"})):(v(),x(be,{key:1,class:"table-responsive"},{default:s(()=>{var t,T;return[we,d("tbody",null,[(v(!0),L(ue,null,ie(e(S).data,(p,y)=>(v(),L("tr",{key:y,class:de({"bg-secondary":e(_).includes(p.id)})},[d("td",null,[p.timesheet_id?(v(),x(q,{key:1,icon:"ri-check-line",color:"success"})):(v(),x(ke,{key:0,modelValue:e(_),"onUpdate:modelValue":u[5]||(u[5]=B=>D(_)?_.value=B:null),value:{id:p.id,require:p.require}},null,8,["modelValue","value"]))]),d("td",Ce,[l(q,{icon:"ri-receipt-line",class:"me-3"}),P(" "+$(p.invoice_id),1)]),d("td",je,[l(q,{icon:"ri-user-line",class:"me-3"}),P(" "+$(p.student_name+" - "+p.student_school),1)]),d("td",Te,[l(q,{icon:"ri-bookmark-line",class:"me-3"}),P(" "+$(p.program_name),1)]),d("td",Ue,[p.timesheet_id?(v(),x(N,{key:0},{default:s(()=>[l(q,{icon:"ri-file-check-line",class:"mx-1",color:"success"}),l(Y,{activator:"parent",location:"top"},{default:s(()=>[P("Already")]),_:1})]),_:1})):(v(),x(N,{key:1},{default:s(()=>[l(q,{icon:"ri-file-close-line",class:"mx-1",color:"error"}),l(Y,{activator:"parent",location:"top"},{default:s(()=>[P("Not Yet")]),_:1})]),_:1}))])],2))),128))]),((T=(t=e(S))==null?void 0:t.data)==null?void 0:T.length)==0?(v(),L("tfoot",qe,Se)):X("",!0)]}),_:1})),d("div",Ne,[l(Ve,{modelValue:e(k),"onUpdate:modelValue":[u[6]||(u[6]=t=>D(k)?k.value=t:null),h],length:e(c),"total-visible":4,color:"primary",density:"compact","show-first-last-page":!1},null,8,["modelValue","length"])])]),_:1})]),_:1})}}};export{ll as default};
