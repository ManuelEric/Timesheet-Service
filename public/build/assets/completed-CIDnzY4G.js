import{r as i,a1 as J,o as K,a as Y,b as n,w as u,F as L,D as M,A as k,s as C,y as Q,e as _,h as l,H as D,E as W,p as T,l as F,k as I,q as N,i as O,j as $,f as e,a0 as X,t as f,a6 as Z,a7 as ee,a8 as te}from"./main-DxVVPUnD.js";import{d as ae}from"./debounce-COh9eUHn.js";import{V as z,a as S}from"./VRow-DRTL0gGp.js";import{V as le,b as oe,c as se}from"./VCard-CXHrprbC.js";import{V as E,a as ne}from"./VAutocomplete-C5L1KHcg.js";import{a as re,V as ce}from"./VTable-Ce2MceZc.js";import{V as ue}from"./VPagination-De8m-_M4.js";import{T as ie}from"./index-S7o_C3ZT.js";import{V as de}from"./VCheckbox-BhOGAef-.js";import"./VAvatar-BApRg9cY.js";import"./VImg-C-lOWxDp.js";import"./VList-DaM-snfX.js";import"./ssrBoot-_Tb6ce0s.js";import"./VDivider-CyqldJ4J.js";import"./VCheckboxBtn-vujEn6bG.js";import"./VSelectionControl-BgHS0iVL.js";import"./VSlideGroup-BqnIsj9N.js";import"./VTooltip-CnX6GLgX.js";const pe=e("div",{class:"d-flex justify-between align-center"},[e("div",{class:"w-100"},[e("h4",null,"Completed Cut-Off")])],-1),me=e("thead",null,[e("tr",null,[e("th",{class:"text-uppercase"},"#"),e("th",{class:"text-uppercase text-center"},"Timesheet"),e("th",{class:"text-uppercase text-center"},"Activity"),e("th",{class:"text-uppercase text-center"},"Students Name"),e("th",{class:"text-uppercase text-center"},"Activity Date"),e("th",{class:"text-uppercase text-center"},"Mentor/Tutor"),e("th",{class:"text-uppercase text-center"},"Time Spent"),e("th",{class:"text-uppercase text-center"},"Fee/Hours"),e("th",{class:"text-uppercase text-center"},"Total"),e("th",{class:"text-uppercase text-center"},"Cut-Off Date"),e("th",{class:"text-uppercase text-center"},"Cut-Off Status")])],-1),fe={class:"text-center"},ve={class:"text-center text-capitalize"},_e=e("th",{colspan:"9"},"Total Fee",-1),ye={colspan:"2",class:"text-end"},he={key:0},ge=e("tr",null,[e("td",{colspan:"10",class:"text-center"}," Sorry, no data found. ")],-1),be=[ge],xe={class:"d-flex justify-center mt-5"},Le={__name:"completed",setup(Ve){const s=i(!1),h=i([]),R=i({cut_off_date:[],specific:!1,timesheet_id:null}),V=i(1),P=i(),g=i([]),U=i(null),b=i(null),A=i([]),x=i(null),B=i([]);i([]);const v=i(null),y=async()=>{if(v.value){s.value=!0;const r="?page="+V.value,o=U.value?"&keyword="+U.value:"",c=b.value?"&package_id="+b.value:"",t=v.value?"&cutoff_start="+M(v.value[0]).format("YYYY-MM-DD"):"",d=v.value?"&cutoff_end="+M(v.value[v.value.length-1]).format("YYYY-MM-DD"):"",a=x.value?"&mentor_id="+x.value:"",p="api/v1/payment/paid"+r+o+c+t+d+a;try{const m=await k.get(p);m&&(V.value=m.current_page,P.value=m.last_page,h.value=m)}catch(m){console.error(m)}finally{s.value=!1}}else C("info","Please fill in cutoff date first!","bottom-end"),b.value=null,x.value=null};ae(async()=>{await y()},1e3);const H=async()=>{s.value=!0;try{const r=await k.get("api/v1/package/component/list");r&&(A.value=r,s.value=!1)}catch(r){s.value=!1,console.error(r)}},q=async()=>{s.value=!0;try{const r=await k.get("api/v1/user/mentor-tutors");r&&(B.value=r,s.value=!1)}catch(r){s.value=!1,console.error(r)}},G=async()=>{const r=await Z("Are you sure you want to cancel this activity?"),o={activity_id:Object.keys(g.value).map(c=>g.value[c])};if(r){s.value=!0;try{const c=await k.patch("api/v1/payment/cut-off/unassign",o);c&&(C("success",c.message,"bottom-end"),y())}catch(c){C("error",c.response.statusText,"bottom-end")}finally{s.value=!1}}},j=async r=>{let o=v.value,c=M(o[0]).format("YYYY-MM-DD"),t=M(o[o.length-1]).format("YYYY-MM-DD"),d=R.value.specific?"/"+R.value.timesheet_id:"",a=r=="timesheet"?"api/v1/payment/cut-off/export"+d+"/"+c+"/"+t:"api/v1/payment/cut-off/summarize/"+c+"/"+t;ee();try{const p=await k.get(a,{responseType:"blob"});if(p){const m=window.URL.createObjectURL(new Blob([p],{type:'"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"'})),w=document.createElement("a");w.href=m,w.setAttribute("download",r=="timesheet"?`Timesheet_${c}_${t}.xlsx`:`Payroll_${c}_${t}.xlsx`),document.body.appendChild(w),w.click(),document.body.removeChild(w),window.URL.revokeObjectURL(m),te.close(),C("success","Successfully downloaded","bottom-end")}}catch(p){C("error","Cut-Off date is not found!","bottom-end"),console.log(p)}};return J(()=>{}),K(()=>{y(),H(),q()}),(r,o)=>{const c=Q("VDateInput");return _(),Y(L,null,[n(z,null,{default:u(()=>[n(S,{md:"4",cols:"12"},{default:u(()=>[n(c,{modelValue:l(v),"onUpdate:modelValue":[o[0]||(o[0]=t=>D(v)?v.value=t:null),y],label:"Cut-Off Date","prepend-icon":"",multiple:"range",color:"primary",clearable:!0,variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1}),n(S,{md:"4",cols:"12"},{default:u(()=>[n(E,{clearable:!0,loading:l(s),disabled:l(s),label:"Package Name",items:l(A),"item-title":t=>t.package?t.type_of+" - "+t.package:t.type_of,"item-value":"id",modelValue:l(b),"onUpdate:modelValue":[o[1]||(o[1]=t=>D(b)?b.value=t:null),y],placeholder:"Select Timesheet Package",density:"compact"},null,8,["loading","disabled","items","item-title","modelValue"])]),_:1}),n(S,{md:"4",cols:"12"},{default:u(()=>[n(E,{loading:l(s),disabled:l(s),clearable:"true",label:"Tutor/Mentor Name",items:l(B),"item-props":t=>({title:t.full_name,subtitle:t.roles.map(d=>d.name).join(", ")}),"item-value":"id",modelValue:l(x),"onUpdate:modelValue":[o[2]||(o[2]=t=>D(x)?x.value=t:null),y],placeholder:"Select Tutor/Mentor Name",density:"compact"},null,8,["loading","disabled","items","item-props","modelValue"])]),_:1})]),_:1}),n(le,null,{default:u(()=>[n(oe,null,{default:u(()=>[pe]),_:1}),n(se,null,{default:u(()=>[n(z,{class:"my-1"},{default:u(()=>[n(S,{cols:"12"},{default:u(()=>{var t,d,a,p;return[l(g).length>0?W((_(),T(I,{key:0,color:"error",class:"me-3",onClick:G},{default:u(()=>[n(F,{icon:"ri-close-line"})]),_:1})),[[ie,"Cancel","start"]]):N("",!0),((d=(t=l(h))==null?void 0:t.data)==null?void 0:d.length)>0?(_(),T(I,{key:1,size:"small",variant:"tonal",type:"button",color:"info",class:"me-2",loading:l(s),disabled:l(s),onClick:o[3]||(o[3]=$(m=>j("recap"),["prevent"]))},{default:u(()=>[O(" Recap "),n(F,{icon:"ri-download-line",class:"ms-3"})]),_:1},8,["loading","disabled"])):N("",!0),((p=(a=l(h))==null?void 0:a.data)==null?void 0:p.length)>0?(_(),T(I,{key:2,size:"small",variant:"tonal",color:"success",type:"submit",loading:l(s),disabled:l(s),onClick:o[4]||(o[4]=$(m=>j("timesheet"),["prevent"]))},{default:u(()=>[O(" Timesheet "),n(F,{icon:"ri-download-line",class:"ms-3"})]),_:1},8,["loading","disabled"])):N("",!0)]}),_:1})]),_:1}),l(s)?(_(),T(ce,{key:0,class:"mx-auto border",type:"table-thead, table-row@10"})):(_(),T(re,{key:1,class:"text-no-wrap"},{default:u(()=>{var t,d;return[me,e("tbody",null,[(_(!0),Y(L,null,X(l(h).data,a=>(_(),Y("tr",{key:a},[e("td",null,[n(de,{modelValue:l(g),"onUpdate:modelValue":o[5]||(o[5]=p=>D(g)?g.value=p:null),value:a.id},null,8,["modelValue","value"])]),e("td",null,f(a.package.type+" - "+a.package.name),1),e("td",null,f(a.activity),1),e("td",null,f(a.students),1),e("td",null,f(a.date),1),e("td",null,f(a.mentor_tutor),1),e("td",null,f(a.time_spent>0?(a.time_spent/60).toFixed(2)+" Hours":"-"),1),e("td",null,"Rp. "+f(new Intl.NumberFormat("id-ID").format(a.fee_hours)),1),e("td",null," Rp. "+f(['Bonus Fee"',"Additional Fee"].includes(a.activity)?new Intl.NumberFormat("id-ID").format(a.time_spent/60*a.fee_hours):new Intl.NumberFormat("id-ID").format(a.fee_hours)),1),e("td",fe,f(a.cutoff_date),1),e("td",ve,[n(ne,{color:"success"},{default:u(()=>[O(f(a.cutoff_status),1)]),_:2},1024)])]))),128))]),e("thead",null,[e("tr",null,[_e,e("th",ye," Rp. "+f(new Intl.NumberFormat("id-ID").format(l(h).total_fee)),1)])]),((d=(t=l(h))==null?void 0:t.data)==null?void 0:d.length)==0?(_(),Y("tfoot",he,be)):N("",!0)]}),_:1})),e("div",xe,[n(ue,{modelValue:l(V),"onUpdate:modelValue":[o[6]||(o[6]=t=>D(V)?V.value=t:null),y],length:l(P),"total-visible":4,color:"primary",density:"compact","show-first-last-page":!1},null,8,["modelValue","length"])])]),_:1})]),_:1})],64)}}};export{Le as default};
