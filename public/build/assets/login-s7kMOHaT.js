import{av as J,K as R,r as m,e as W,c as q,b as t,w as l,aw as K,k as _,A as h,J as T,U as P,s as p,l as z,o as f,a as b,u as e,j as v,f as k,W as w,Y as x,am as U,h as A}from"./main-ExEM9zZY.js";import{r as g}from"./rules-B5G8qOzK.js";import{l as G}from"./eduall-jXBsxaj5.js";import{a as H,b as O}from"./auth-v1-mask-light--N6hHkxK.js";import{V as Q,d as X,b as Z,a as S}from"./VCard-4ZeQtL5W.js";import{V as N,a as V}from"./VRow-BX84uW53.js";import{V as E}from"./VForm-Df2Fzc9a.js";import"./VAvatar-DCovBj_a.js";import"./VImg-Dpd29ZCU.js";const ee={class:"auth-wrapper d-flex align-center justify-center pa-4"},ae={class:"d-flex justify-center mb-5"},se=["src"],te=b("h5",{class:"text-h5 font-weight-semibold mb-1"},"Welcome to Timesheet App! 👋🏻",-1),oe=b("p",{class:"mb-0"},"Please sign-in to your account and start the adventure",-1),le={class:"d-flex align-center justify-end flex-wrap my-2"},ve={__name:"login",props:{token:String,email:String,uuid:String},setup(Y){const j=J();R(()=>j.global.name.value==="light"?H:O);const u=Y,y=m(),s=m({token:"",email:"",password:"",password_confirmation:""}),r=m(!1),c=m(!1),d=m(!0),i=m(!1),B=[o=>o!==s.value.password?"Passwords do not match":!0],D=async()=>{const{valid:o}=await y.value.validate();if(o){r.value=!0;try{const a=await h.post("api/v1/auth/email/checking",{email:s.value.email});a&&(c.value=!0,a.has_password?d.value=!0:d.value=!1),r.value=!1}catch(a){p("error","You`re email is not found!","bottom-end"),console.error(a),r.value=!1}}},C=async()=>{const{valid:o}=await y.value.validate();if(o){r.value=!0;try{if(d.value){const a=await h.post("api/v1/identity/generate-token",{email:s.value.email,password:s.value.password});a&&(T.saveToken(a.granted_token),P.saveUser(a),p("success","You`ve successfully login.","bottom-end"),setTimeout(()=>{_.go("/user/dashboard")},1500))}else await I();r.value=!1}catch(a){s.value.password="",p("error","You`re password is wrong.","bottom-end"),console.error(a),r.value=!1}}},I=async()=>{try{const o=u.token?"api/v1/auth/reset-password":"api/v1/auth/create-password";await h.post(o,s.value)&&(d.value=!0,await C())}catch(o){console.error(o)}},L=()=>{s.value.email=u.email,s.value.token=u.token,c.value=!0,d.value=!1},M=()=>{K().isAuthenticated.value&&_.push("/user/dashboard")},F=async()=>{try{const o=await h.get("api/v1/auth/u/"+u.uuid);o&&(T.saveToken(o.granted_token),P.saveUser(o),p("success","You`ve successfully login.","bottom-end"),setTimeout(()=>{_.go("/user/dashboard")},1500))}catch(o){s.value.password="",p("error","You`re password is wrong.","bottom-end"),console.error(o)}finally{r.value=!1}};return W(()=>{M(),u.token&&L(),u.uuid&&F()}),(o,a)=>{const $=z("router-link");return f(),q("div",ee,[t(Q,{class:"auth-card pa-4 pt-7","max-width":"448"},{default:l(()=>[t(X,{class:"justify-center"},{default:l(()=>[b("div",ae,[b("img",{src:e(G),alt:"Timesheet - EduALL",class:"w-50 text-center"},null,8,se)]),t(Z,{class:"font-weight-semibold text-2xl text-uppercase"},{default:l(()=>[v(" Timesheet App ")]),_:1})]),_:1}),t(S,{class:"pt-2 text-center"},{default:l(()=>[te,oe]),_:1}),t(S,null,{default:l(()=>[e(c)?(f(),k(E,{key:1,ref_key:"formData",ref:y,onSubmit:U(C,["prevent"]),"validate-on":"input","fast-fail":""},{default:l(()=>[t(N,null,{default:l(()=>[t(V,{cols:"12"},{default:l(()=>[t(w,{modelValue:e(s).email,"onUpdate:modelValue":a[1]||(a[1]=n=>e(s).email=n),label:"Email",type:"email",disabled:e(c),rules:e(g).email},null,8,["modelValue","disabled","rules"])]),_:1}),e(d)?(f(),k(V,{key:0,cols:"12"},{default:l(()=>[t(w,{modelValue:e(s).password,"onUpdate:modelValue":a[2]||(a[2]=n=>e(s).password=n),label:"Password",placeholder:"············",type:e(i)?"text":"password","append-inner-icon":e(i)?"ri-eye-off-line":"ri-eye-line","onClick:appendInner":a[3]||(a[3]=n=>i.value=!e(i)),rules:e(g).required},null,8,["modelValue","type","append-inner-icon","rules"]),b("div",le,[t($,{to:"/user/forgot",class:"ms-2 mb-1"},{default:l(()=>[v(" Forgot Password? ")]),_:1})]),t(x,{block:"",type:"submit",loading:e(r),disabled:e(r)},{default:l(()=>[v(" Login ")]),_:1},8,["loading","disabled"])]),_:1})):A("",!0),e(c)&&!e(d)?(f(),k(V,{key:1,cols:"12"},{default:l(()=>[t(w,{modelValue:e(s).password,"onUpdate:modelValue":a[4]||(a[4]=n=>e(s).password=n),label:"New Password",placeholder:"············",type:e(i)?"text":"password","append-inner-icon":e(i)?"ri-eye-off-line":"ri-eye-line","onClick:appendInner":a[5]||(a[5]=n=>i.value=!e(i)),rules:e(g).password,class:"mb-6"},null,8,["modelValue","type","append-inner-icon","rules"]),t(w,{modelValue:e(s).password_confirmation,"onUpdate:modelValue":a[6]||(a[6]=n=>e(s).password_confirmation=n),label:"Confirmation Password",placeholder:"············",type:e(i)?"text":"password","append-inner-icon":e(i)?"ri-eye-off-line":"ri-eye-line","onClick:appendInner":a[7]||(a[7]=n=>i.value=!e(i)),class:"mb-6",rules:B},null,8,["modelValue","type","append-inner-icon"]),t(x,{block:"",type:"submit",loading:e(r),disabled:e(r)},{default:l(()=>[v(" Create New Password ")]),_:1},8,["loading","disabled"])]),_:1})):A("",!0)]),_:1})]),_:1},512)):(f(),k(E,{key:0,ref_key:"formData",ref:y,onSubmit:U(D,["prevent"])},{default:l(()=>[t(N,null,{default:l(()=>[t(V,{cols:"12"},{default:l(()=>[t(w,{modelValue:e(s).email,"onUpdate:modelValue":a[0]||(a[0]=n=>e(s).email=n),label:"Email",type:"email",disabled:e(c),rules:e(g).email},null,8,["modelValue","disabled","rules"]),t(x,{block:"",type:"submit",class:"mt-4",loading:e(r),disabled:e(r)},{default:l(()=>[v(" Check Email ")]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},512))]),_:1})]),_:1})])}}};export{ve as default};
