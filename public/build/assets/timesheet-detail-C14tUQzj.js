import{_ as xe}from"./DeleteHandler.vue_vue_type_script_setup_true_lang-DOoaKGD-.js";import{r as b,y as ie,e as y,p as S,w as a,b as t,j as pe,V as B,h as e,D as H,k as I,l as D,i as T,z as fe,A as P,s as N,a5 as _e,o as ve,f as l,E as de,a as R,F as De,a0 as $e,t as f,q as Z,H as Ce,a6 as Te,d as ue,a1 as Me,W as Se,x as Ue,a7 as Ye,a8 as Ne,a9 as we}from"./main-DxVVPUnD.js";import{r as F}from"./rules-CkvmYWH-.js";import{c as A,d as ge,V as O,b as le,a as me,e as je}from"./VCard-CXHrprbC.js";import{V as ye}from"./VForm-CLtZk-0_.js";import{V as oe,a as w}from"./VRow-DRTL0gGp.js";import{V as be}from"./VTextarea-6NPQtOZ8.js";import{V as se}from"./VDialog-V1TeQFp0.js";import{a as he,V as te}from"./VTable-Ce2MceZc.js";import{T as re}from"./index-S7o_C3ZT.js";import{V as Pe}from"./VCheckbox-BhOGAef-.js";import{V as ae}from"./VAutocomplete-C5L1KHcg.js";import{V as Ie}from"./VTooltip-CnX6GLgX.js";import{V as Le}from"./VDivider-CyqldJ4J.js";import{V as Fe,a as ce,b as qe}from"./VList-DaM-snfX.js";import"./VAvatar-BApRg9cY.js";import"./VImg-C-lOWxDp.js";import"./VCheckboxBtn-vujEn6bG.js";import"./VSelectionControl-BgHS0iVL.js";import"./VSlideGroup-BqnIsj9N.js";import"./ssrBoot-_Tb6ce0s.js";const Ae={__name:"activity-add",props:{id:String},emits:["close","reload"],setup(L,{emit:U}){const c=L,$=U,o=b(!1),x=b(),i=b({activity:null,description:null,date:null,start_time:null,end_time:null,start_date:null,end_date:null,meeting_link:null}),_=()=>{i.value={activity:null,description:null,date:null,start_time:null,end_time:null,start_date:null,end_date:null,meeting_link:null}},C=async()=>{const{valid:k}=await x.value.validate();if(k){o.value=!0;try{const d=await P.post("api/v1/timesheet/"+c.id+"/activity",i.value);d&&N("success",d.message,"bottom-end")}catch(d){N("error",d.response.data.errors,"bottom-end")}finally{_(),o.value=!1,$("reload"),$("close")}}};return(k,d)=>{const V=ie("DialogCloseBtn"),p=ie("VDateInput");return y(),S(O,{title:"New Activity"},{default:a(()=>[t(V,{variant:"text",size:"default",onClick:d[0]||(d[0]=n=>$("close"))}),t(A,null,{default:a(()=>[t(ye,{onSubmit:pe(C,["prevent"]),ref_key:"formData",ref:x,"validate-on":"input"},{default:a(()=>[t(oe,null,{default:a(()=>[t(w,{cols:"12",class:"d-none"},{default:a(()=>[t(B,{density:"compact",modelValue:e(i).activity,"onUpdate:modelValue":d[1]||(d[1]=n=>e(i).activity=n),label:"Activity Name",placeholder:"Activity",loading:e(o),disabled:e(o)},null,8,["modelValue","loading","disabled"])]),_:1}),t(w,{cols:"12"},{default:a(()=>[t(be,{density:"compact",modelValue:e(i).description,"onUpdate:modelValue":d[2]||(d[2]=n=>e(i).description=n),label:"Meeting Discussion",placeholder:"Meeting Discussion",loading:e(o),disabled:e(o),rules:e(F).required},null,8,["modelValue","loading","disabled","rules"])]),_:1}),t(w,{md:"6",cols:"12"},{default:a(()=>[t(p,{density:"compact",modelValue:e(i).date,"onUpdate:modelValue":d[3]||(d[3]=n=>e(i).date=n),label:"Date",placeholder:"Select Date",variant:"outlined","prepend-icon":"",loading:e(o),disabled:e(o),rules:e(F).required},null,8,["modelValue","loading","disabled","rules"])]),_:1}),t(w,{md:"3",cols:"6"},{default:a(()=>[t(B,{density:"compact",type:"time",modelValue:e(i).start_time,"onUpdate:modelValue":d[4]||(d[4]=n=>e(i).start_time=n),label:"Start Time",placeholder:"Start Time",rules:e(F).required,class:"mb-3",loading:e(o),disabled:!e(i).date||e(o),onChange:d[5]||(d[5]=n=>e(i).start_date=e(H)(e(i).date).format("YYYY-MM-DD")+" "+e(i).start_time+":00")},null,8,["modelValue","rules","loading","disabled"])]),_:1}),t(w,{md:"3",cols:"6"},{default:a(()=>[t(B,{density:"compact",type:"time",modelValue:e(i).end_time,"onUpdate:modelValue":d[6]||(d[6]=n=>e(i).end_time=n),label:"End Time",placeholder:"End Time",loading:e(o),disabled:!e(i).date||e(o),onChange:d[7]||(d[7]=n=>e(i).end_date=e(H)(e(i).date).format("YYYY-MM-DD")+" "+e(i).end_time+":00")},null,8,["modelValue","loading","disabled"])]),_:1}),t(w,{md:"12",cols:"12"},{default:a(()=>[t(B,{density:"compact",type:"text",modelValue:e(i).meeting_link,"onUpdate:modelValue":d[8]||(d[8]=n=>e(i).meeting_link=n),label:"Meeting Link",placeholder:"Meeting Link",loading:e(o),disabled:e(o)},null,8,["modelValue","loading","disabled"])]),_:1})]),_:1}),t(ge,{class:"mt-5"},{default:a(()=>[t(I,{variant:"tonal",type:"button",color:"error",loading:e(o),disabled:e(o),onClick:d[9]||(d[9]=n=>$("close"))},{default:a(()=>[t(D,{icon:"ri-close-line",class:"me-3"}),T(" Close ")]),_:1},8,["loading","disabled"]),t(fe),t(I,{variant:"tonal",type:"submit",color:"success",loading:e(o),disabled:e(o)},{default:a(()=>[T(" Save "),t(D,{icon:"ri-save-line",class:"ms-3"})]),_:1},8,["loading","disabled"])]),_:1})]),_:1},512)]),_:1})]),_:1})}}},Re={__name:"activity-edit",props:{timesheet_id:Number,activity:String},emits:["close","reload"],setup(L,{emit:U}){const c=b(!1),$=b(),o=L,x=U,i=_e("updateReload"),_=b({activity:o==null?void 0:o.activity.activity,description:o==null?void 0:o.activity.description,date:new Date(o==null?void 0:o.activity.start_date),start_time:o==null?void 0:o.activity.start_time,end_time:o==null?void 0:o.activity.end_time,start_date:H(o==null?void 0:o.activity.start_date).format("YYYY-MM-DD")+" "+(o==null?void 0:o.activity.start_time)+":00",end_date:(o==null?void 0:o.activity.end_time)!=0?H(o==null?void 0:o.activity.start_date).format("YYYY-MM-DD")+" "+(o==null?void 0:o.activity.end_time)+":00":null,meeting_link:o==null?void 0:o.activity.meeting_link}),C=async()=>{var d,V;const{valid:k}=await $.value.validate();if(k){c.value=!0;try{_.value.start_date=H(_.value.date).format("YYYY-MM-DD")+" "+_.value.start_time+":00",_.value.end_date=H(_.value.date).format("YYYY-MM-DD")+" "+_.value.end_time+":00";const p=await P.put("api/v1/timesheet/"+o.timesheet_id+"/activity/"+o.activity.id,_.value);p&&(N("success",p.message,"bottom-end"),x("reload"))}catch(p){if((V=(d=p==null?void 0:p.response)==null?void 0:d.data)!=null&&V.errors){const n=p.response.data.errors;let s="Validation errors:";if(typeof n!="string"){for(const r in n)n.hasOwnProperty(r)&&(s+=`
${r}: ${n[r].join(", ")}`);N("error",s,"bottom-end")}else N("error",p.response.data.errors,"bottom-end")}}finally{c.value=!1,x("close"),setTimeout(()=>{i(!0)},3e3)}}};return(k,d)=>{const V=ie("DialogCloseBtn"),p=ie("VDateInput");return y(),S(O,{title:"Edit Activity"},{default:a(()=>[t(V,{variant:"text",size:"default",onClick:d[0]||(d[0]=n=>x("close"))}),t(A,null,{default:a(()=>[t(ye,{onSubmit:pe(C,["prevent"]),ref_key:"formData",ref:$,"validate-on":"input"},{default:a(()=>[t(oe,null,{default:a(()=>[t(w,{cols:"12",class:"d-none"},{default:a(()=>[t(B,{density:"compact",modelValue:e(_).activity,"onUpdate:modelValue":d[1]||(d[1]=n=>e(_).activity=n),label:"Activity Name",placeholder:"Activity",disabled:e(c),loading:e(c)},null,8,["modelValue","disabled","loading"])]),_:1}),t(w,{cols:"12"},{default:a(()=>[t(be,{density:"compact",modelValue:e(_).description,"onUpdate:modelValue":d[2]||(d[2]=n=>e(_).description=n),label:"Meeting Discussion",rules:e(F).required,placeholder:"Meeting Discussion",disabled:e(c),loading:e(c)},null,8,["modelValue","rules","disabled","loading"])]),_:1}),t(w,{md:"6",cols:"12"},{default:a(()=>[t(p,{density:"compact",modelValue:e(_).date,"onUpdate:modelValue":d[3]||(d[3]=n=>e(_).date=n),label:"Date",placeholder:"Select Date","prepend-icon":"",variant:"outlined",disabled:e(c),loading:e(c),rules:e(F).required},null,8,["modelValue","disabled","loading","rules"])]),_:1}),t(w,{md:"3",cols:"6"},{default:a(()=>[t(B,{density:"compact",type:"time",modelValue:e(_).start_time,"onUpdate:modelValue":d[4]||(d[4]=n=>e(_).start_time=n),label:"Start Time",rules:e(F).required,placeholder:"Start Time",disabled:e(c),loading:e(c),onChange:d[5]||(d[5]=n=>e(_).start_date=e(H)(o==null?void 0:o.activity.date).format("YYYY-MM-DD")+" "+e(_).start_time+":00")},null,8,["modelValue","rules","disabled","loading"])]),_:1}),t(w,{md:"3",cols:"6"},{default:a(()=>[t(B,{density:"compact",type:"time",modelValue:e(_).end_time,"onUpdate:modelValue":d[6]||(d[6]=n=>e(_).end_time=n),label:"End Time",placeholder:"End Time",disabled:e(c),loading:e(c),onChange:d[7]||(d[7]=n=>e(_).end_date=e(H)(o==null?void 0:o.activity.date).format("YYYY-MM-DD")+" "+e(_).end_time+":00")},null,8,["modelValue","disabled","loading"])]),_:1}),t(w,{md:"12",cols:"12"},{default:a(()=>[t(B,{density:"compact",type:"text",modelValue:e(_).meeting_link,"onUpdate:modelValue":d[8]||(d[8]=n=>e(_).meeting_link=n),label:"Meeting Link",placeholder:"Meeting Link",disabled:e(c),loading:e(c)},null,8,["modelValue","disabled","loading"])]),_:1})]),_:1}),t(ge,{class:"mt-5"},{default:a(()=>[t(I,{variant:"tonal",color:"error",disabled:e(c),loading:e(c),onClick:d[9]||(d[9]=n=>x("close"))},{default:a(()=>[t(D,{icon:"ri-close-line",class:"me-3"}),T(" Close ")]),_:1},8,["disabled","loading"]),t(fe),t(I,{variant:"tonal",color:"success",type:"submit",disabled:e(c),loading:e(c)},{default:a(()=>[T(" Save "),t(D,{icon:"ri-save-line",class:"ms-3"})]),_:1},8,["disabled","loading"])]),_:1})]),_:1},512)]),_:1})]),_:1})}}},Be={class:"d-flex justify-between align-center"},Ee=l("div",{class:"w-100"},[l("h4",null,"Activity")],-1),ze=l("thead",null,[l("tr",null,[l("th",{class:"text-uppercase",width:"1%"}," No "),l("th",{class:"text-uppercase text-start"},"Meeting Discussion"),l("th",{class:"text-uppercase text-center"},"Date"),l("th",{class:"text-uppercase text-center"},"Start Time"),l("th",{class:"text-uppercase text-center"},"End Time"),l("th",{class:"text-uppercase text-center"},"Time Spent"),l("th",{class:"text-uppercase text-left"},"Fee Hours"),l("th",{class:"text-uppercase text-center"},"Status"),l("th",{class:"text-uppercase text-end"},"#")])],-1),He={key:0},Oe=l("tr",null,[l("th",{colspan:"8",class:"text-center"}," No Activity Found ")],-1),Ge=[Oe],Je={key:1},We={width:"1%"},Ke={class:"d-none"},Qe={class:"text-start"},Xe=["innerHTML"],Ze={class:"text-center"},et={class:"text-center"},tt={class:"text-center"},lt={class:"text-left"},at={class:"text-end"},st=["href","disabled"],it={__name:"timesheet-detail",props:{id:String},setup(L){const U=L,c=_e("updateReload"),$=b([]),o=b(!1),x=b([{add:!1,edit:!1,delete:!1}]),i=b([]),_=async()=>{o.value=!0;try{const p=await P.get("api/v1/timesheet/"+U.id+"/activities");p&&($.value=p)}catch(p){console.error(p)}finally{o.value=!1}},C=p=>{x.value[p]?x.value[p]=!1:x.value[p]=!0},k=(p,n)=>{i.value=n,C(p)},d=async()=>{var p,n,s;o.value=!0;try{const r=await P.delete("api/v1/timesheet/"+U.id+"/activity/"+i.value.id);r&&(N("success",r.message,"bottom-end"),C("delete"))}catch(r){((p=r.response)==null?void 0:p.status)==400&&N("error",(s=(n=r.response)==null?void 0:n.data)==null?void 0:s.errors,"bottom-end")}finally{o.value=!1,_(),c(!0)}},V=async p=>{var n,s,r,u;try{const m=await P.patch("api/v1/timesheet/"+U.id+"/activity/"+p.id,p);m&&N("success",m.message,"bottom-end")}catch(m){if((s=(n=m==null?void 0:m.response)==null?void 0:n.data)!=null&&s.message&&N("error",m.response.data.message,"bottom-end"),(u=(r=m==null?void 0:m.response)==null?void 0:r.data)!=null&&u.errors){const v=m.response.data.errors;let q="Validation errors:";if(typeof v!="string"){for(const E in v)v.hasOwnProperty(E)&&(q+=`
${E}: ${v[E].join(", ")}`);N("error",q,"bottom-end")}else N("error",m.response.data.errors,"bottom-end")}}finally{_(),c(!0)}};return ve(()=>{_()}),(p,n)=>(y(),S(O,null,{default:a(()=>[t(le,null,{default:a(()=>[l("div",Be,[Ee,de((y(),S(I,{onClick:n[0]||(n[0]=s=>C("add"))},{default:a(()=>[t(D,{icon:"ri-add-line"})]),_:1})),[[re,"New Activity","start"]]),t(se,{modelValue:e(x).add,"onUpdate:modelValue":n[2]||(n[2]=s=>e(x).add=s),"max-width":"600",persistent:""},{default:a(()=>[t(Ae,{id:U.id,onClose:n[1]||(n[1]=s=>C("add")),onReload:_},null,8,["id"])]),_:1},8,["modelValue"])])]),_:1}),t(A,null,{default:a(()=>[e(o)?(y(),S(te,{key:1,type:"table"})):(y(),S(he,{key:0,class:"text-no-wrap","max-height":"400","fixed-header":""},{default:a(()=>{var s;return[ze,((s=e($))==null?void 0:s.length)==0?(y(),R("tbody",He,Ge)):(y(),R("tbody",Je,[(y(!0),R(De,null,$e(e($),(r,u)=>(y(),R("tr",{key:u},[l("td",We,f(u+1),1),l("td",Ke,f(r.activity),1),l("td",Qe,[l("div",{class:"py-2",style:{width:"250px","text-wrap":"wrap"},innerHTML:r.description},null,8,Xe)]),l("td",null,f(p.$moment(r.start_date).format("dddd"))+", "+f(p.$moment(r.start_date).format("MMM Do YYYY")),1),l("td",Ze,f(r.start_time),1),l("td",et,f(r.end_time),1),l("td",tt,[t(D,{icon:"ri-timer-2-line",class:"cursor-pointer me-3"}),T(" "+f(r.estimate)+" Minutes ",1)]),l("td",lt," Rp. "+f(r.activity==="Bonus Fee"?new Intl.NumberFormat("id-ID").format(r.bonus_fee):r.activity==="Additional Fee"?new Intl.NumberFormat("id-ID").format(r.additional_fee):new Intl.NumberFormat("id-ID").format(r.fee_hours)),1),l("td",null,[de(t(Pe,{color:"success",modelValue:r.status,"onUpdate:modelValue":[m=>r.status=m,m=>V(r)],value:!0,"false-value":!1},null,8,["modelValue","onUpdate:modelValue"]),[[re,r.status?"Completed":"Not Yet","start"]])]),l("td",at,[r.meeting_link?(y(),S(I,{key:0,color:"primary",density:"compact",class:"me-1"},{default:a(()=>[l("a",{href:r.meeting_link,target:"_blank",class:"bg-primary",disabled:r.cutoff_status=="completed"},[t(D,{icon:"ri ri-link"}),T(" Join ")],8,st)]),_:2},1024)):Z("",!0),de((y(),S(I,{color:"warning",density:"compact",class:"me-1",disabled:r.cutoff_status=="completed",onClick:m=>k("edit",r)},{default:a(()=>[t(D,{icon:"ri-edit-line",class:"cursor-pointer"})]),_:2},1032,["disabled","onClick"])),[[re,"Edit Activity","start"]]),de((y(),S(I,{color:"error",density:"compact",disabled:r.cutoff_status=="completed",onClick:m=>k("delete",r)},{default:a(()=>[t(D,{icon:"ri-delete-bin-line",class:"cursor-pointer"})]),_:2},1032,["disabled","onClick"])),[[re,"Delete Activity","start"]])])]))),128))]))]}),_:1}))]),_:1}),t(se,{modelValue:e(x).edit,"onUpdate:modelValue":n[4]||(n[4]=s=>e(x).edit=s),"max-width":"600",persistent:""},{default:a(()=>[t(Re,{timesheet_id:U==null?void 0:U.id,activity:e(i),onClose:n[3]||(n[3]=s=>C("edit")),onReload:_},null,8,["timesheet_id","activity"])]),_:1},8,["modelValue"]),t(se,{modelValue:e(x).delete,"onUpdate:modelValue":n[6]||(n[6]=s=>e(x).delete=s),"max-width":"400",persistent:""},{default:a(()=>[t(xe,{title:"activity",loading:e(o),onClose:n[5]||(n[5]=s=>C("delete")),onDelete:d},null,8,["loading"])]),_:1},8,["modelValue"])]),_:1}))}},ot={__name:"timesheet-transfer",props:{timesheet_id:Number,require:String},emits:["close","reload"],setup(L,{emit:U}){const c=b(),$=L,o=U,x=b([]),i=b([]),_=b([]),C=$.require.toLowerCase(),k=b(!1),d=b({mentortutor_email:null,subject_id:null}),V=async()=>{const s="api/v1/user/mentor-tutors?role="+C;k.value=!0;try{const r=await P.get(s);r&&(x.value=r)}catch(r){console.error(r)}finally{k.value=!1}},p=async(s,r=null)=>{if(d.value.subject_id=null,C=="mentor")d.value.subject_id=s[0].subjects[0].id;else{k.value=!0;try{const u=await P.get("api/v1/user/mentor-tutors/"+r+"/subjects");u&&(_.value=u)}catch(u){console.error(u)}finally{k.value=!1}}},n=async()=>{var u,m;o("close"),d.value.mentortutor_email=i.value.email;const{valid:s}=await c.value.validate(),r=await Te("Are you sure you want to change the owner?");if(s&&r){k.value=!0;try{const v=await P.patch("api/v1/timesheet/"+$.timesheet_id+"/void/",d.value);v&&(N("success",v.message,"bottom-end"),ue.push({path:"/admin/timesheet/"+v.data.timesheet_id}),d.value={mentortutor_email:null,subject_id:null},i.value=[],setTimeout(()=>{ue.go(0)},1e3))}catch(v){if(console.log(v),(m=(u=v==null?void 0:v.response)==null?void 0:u.data)!=null&&m.errors){const q=v.response.data.errors;N("error",q,"bottom-end")}}finally{o("close"),k.value=!1}}};return ve(()=>{V()}),(s,r)=>(y(),S(O,{class:"mx-auto my-8",elevation:"16",width:"450"},{default:a(()=>[t(ye,{ref_key:"formData",ref:c,"validate-on":"input",onSubmit:pe(n,["prevent"])},{default:a(()=>[t(me,null,{default:a(()=>[t(le,null,{default:a(()=>[T(" Timesheet Ownership Transfer ")]),_:1}),t(je,null,{default:a(()=>[T(" Change Timesheet Handler ")]),_:1})]),_:1}),t(A,null,{default:a(()=>[t(oe,null,{default:a(()=>{var u;return[t(w,{md:"12"},{default:a(()=>[t(ae,{clearable:"",modelValue:e(i),"onUpdate:modelValue":[r[0]||(r[0]=m=>Ce(i)?i.value=m:null),r[1]||(r[1]=m=>p(e(i).roles,e(i).uuid))],label:"Mentor/Tutor",items:e(x),"item-props":m=>({title:m.full_name,subtitle:m.roles.map(v=>v.name).join(", ")}),rules:e(F).required,loading:e(k),disabled:e(k)},null,8,["modelValue","items","item-props","rules","loading","disabled"])]),_:1}),((u=$.require)==null?void 0:u.toLowerCase())=="tutor"?(y(),S(w,{key:0,md:"12"},{default:a(()=>[t(ae,{clearable:"",modelValue:e(d).subject_id,"onUpdate:modelValue":r[2]||(r[2]=m=>e(d).subject_id=m),label:"Subject Tutoring",items:e(_),"item-title":"subject","item-value":"id",loading:e(k),disabled:e(k),rules:e(F).required},null,8,["modelValue","items","loading","disabled","rules"])]),_:1})):Z("",!0)]}),_:1})]),_:1}),t(ge,{class:"mx-3 mb-3"},{default:a(()=>[t(I,{color:"error",onClick:r[3]||(r[3]=u=>o("close"))},{default:a(()=>[t(D,{icon:"ri-close-line",class:"me-3"}),T(" Close ")]),_:1}),t(fe),t(I,{color:"success",type:"submit"},{default:a(()=>[T(" Save Changes "),t(D,{icon:"ri-save-line",class:"ms-3"})]),_:1})]),_:1})]),_:1},512)]),_:1}))}},nt={__name:"user-edit",props:["id","item","package_id","timesheetType"],emits:["close","reload"],setup(L,{emit:U}){var J,W,K,Q,X,Ve,ke;const c=L,$=U,o=b([]),x=b([]),i=b([]),_=b([]),C=b([]),k=b(!1),d=b(!0),V=b(!0),p=b(null),n=b(),s=b({ref_id:(J=c.item)==null?void 0:J.ref_id,mentortutor_email:(W=c.item)==null?void 0:W.tutormentor_email,subject_id:(K=c.item)==null?void 0:K.subject_id,inhouse_id:(Q=c.item)==null?void 0:Q.inhouse_id,package_id:c.package_id,duration:(X=c.item)==null?void 0:X.duration,notes:(Ve=c.item)==null?void 0:Ve.notes,pic_id:(ke=c.item)==null?void 0:ke.pic_id,tax:null,individual_fee:null}),r=async()=>{var h,j;const M="api/v1/program/list?require=tutor";try{d.value=!0;const Y=await P.get(M);Y&&(o.value=Y),d.value=!1}catch(Y){N("error",(j=(h=Y.response)==null?void 0:h.data)==null?void 0:j.message,"bottom-end"),console.error(Y),d.value=!1}},u=async(M=!1)=>{V.value=!0;const h=M?"api/v1/user/mentor-tutors?inhouse=true":"api/v1/user/mentor-tutors";try{const j=await P.get(h);j&&(M?C.value=Object.values(j):x.value=j)}catch(j){console.error(j)}finally{V.value=!1}},m=async()=>{V.value=!0;try{const M=await P.get("api/v1/package/component/list");M&&(i.value=M)}catch(M){console.error(M)}finally{V.value=!1}},v=()=>{const M=s.value.package_id,h=i.value.findIndex(Y=>Y.id===M);let j=i.value[h];j.detail?(k.value=!0,s.value.duration=j.detail):(k.value=!1,s.value.duration=null)},q=async()=>{V.value=!0;try{const M=await P.get("api/v1/user/component/list");M&&(_.value=M)}catch(M){console.error(M)}finally{V.value=!1}},E=async()=>{var h,j;const{valid:M}=await n.value.validate();if(M)try{const Y=await P.put("api/v1/timesheet/"+c.id+"/update",s.value);Y&&(s.value={ref_id:null,mentortutor_email:null,subject_id:null,inhouse_id:null,package_id:null,duration:"",notes:"",pic_id:[]},N("success",Y.message,"bottom-end"),$("reload"))}catch(Y){if((j=(h=Y==null?void 0:Y.response)==null?void 0:h.data)!=null&&j.errors){const ee=Y.response.data.errors;let ne="Validation errors:";for(const g in ee)ee.hasOwnProperty(g)&&(ne+=`
${g}: ${ee[g].join(", ")}`);N("error",ne,"bottom-end")}}finally{$("close")}},z=()=>{if(s.value.individual_fee){const M=s.value.individual_fee*(1-s.value.tax/100);p.value=Math.trunc(M)}else p.value=null},G=()=>{const M=p.value/(1-s.value.tax/100);s.value.individual_fee=Math.trunc(M)};return ve(()=>{r(),u(!0),m(),q(),z(),setTimeout(()=>{d.value=!1},2e3)}),(M,h)=>{const j=ie("DialogCloseBtn");return y(),S(O,{title:"Edit Detail"},{default:a(()=>[t(j,{variant:"text",size:"default",onClick:h[0]||(h[0]=Y=>$("close"))}),t(A,null,{default:a(()=>[t(ye,{onSubmit:pe(E,["prevent"]),ref_key:"formData",ref:n,"validate-on":"input"},{default:a(()=>[t(oe,null,{default:a(()=>{var Y,ee,ne;return[c.timesheetType!="specialist"?(y(),S(w,{key:0,md:"12",cols:"12"},{default:a(()=>[t(ae,{clearable:"",modelValue:e(s).ref_id,"onUpdate:modelValue":[h[1]||(h[1]=g=>e(s).ref_id=g),M.checkProgram],label:"Student Name",items:e(o),"item-props":g=>({title:g.student_name,subtitle:g.program_name+(g.timesheet_id?" ✅":"")+(g.scnd_timesheet_id?" ✅":""),disabled:g.timesheet_id&&g.scnd_timesheet_id}),"item-value":"id",rules:e(F).required,loading:e(d),disabled:e(d),density:"compact",multiple:""},null,8,["modelValue","items","item-props","rules","loading","disabled","onUpdate:modelValue"])]),_:1})):Z("",!0),t(w,{md:"8",cols:"8"},{default:a(()=>[t(ae,{density:"compact",clearable:"",label:"Package",modelValue:e(s).package_id,"onUpdate:modelValue":[h[2]||(h[2]=g=>e(s).package_id=g),v],items:e(i),"item-props":g=>({title:g.package!=null?g.type_of+" - "+g.package:g.type_of}),"item-value":"id",rules:e(F).required,loading:e(V),disabled:e(V)},null,8,["modelValue","items","item-props","rules","loading","disabled"])]),_:1}),t(w,{md:"4",cols:"4"},{default:a(()=>[t(B,{type:"number",clearable:"",label:+e(s).duration/60?"Minutes ("+e(s).duration/60+" Hours)":"Minutes",readonly:e(k),modelValue:e(s).duration,"onUpdate:modelValue":h[3]||(h[3]=g=>e(s).duration=g),rules:e(F).required},null,8,["label","readonly","modelValue","rules"])]),_:1}),t(w,{md:"12",cols:"12"},{default:a(()=>[t(ae,{density:"compact",clearable:"",modelValue:e(s).inhouse_id,"onUpdate:modelValue":h[4]||(h[4]=g=>e(s).inhouse_id=g),label:"Inhouse Mentor/Tutor",items:e(C),"item-props":g=>({title:g.full_name}),"item-value":"uuid",rules:e(F).required,loading:e(V),disabled:e(V)},null,8,["modelValue","items","item-props","rules","loading","disabled"])]),_:1}),(Y=c.item)!=null&&Y.individual_fee?(y(),S(w,{key:1,md:"4",cols:"7",class:"d-none"},{default:a(()=>[t(B,{type:"number",clearable:"",label:"Fee/hours (Nett)",modelValue:e(p),"onUpdate:modelValue":[h[5]||(h[5]=g=>Ce(p)?p.value=g:null),G],density:"compact",readonly:""},null,8,["modelValue"])]),_:1})):Z("",!0),(ee=c.item)!=null&&ee.individual_fee?(y(),S(w,{key:2,md:"4",cols:"5",class:"d-none"},{default:a(()=>[t(B,{type:"number",clearable:"",label:"Tax",modelValue:e(s).tax,"onUpdate:modelValue":[h[6]||(h[6]=g=>e(s).tax=g),G],density:"compact",readonly:""},null,8,["modelValue"])]),_:1})):Z("",!0),(ne=c.item)!=null&&ne.individual_fee?(y(),S(w,{key:3,md:"4",cols:"12",class:"d-none"},{default:a(()=>[t(Ie,{activator:"parent",location:"top"},{default:a(()=>[T(" Fee Gross is automatically calculated based on the entered Net Fee and Tax Rate. ")]),_:1}),t(B,{type:"number",clearable:"",label:"Fee/hours (Gross)",modelValue:e(s).individual_fee,"onUpdate:modelValue":[h[7]||(h[7]=g=>e(s).individual_fee=g),z],density:"compact",readonly:""},null,8,["modelValue"])]),_:1})):Z("",!0),t(w,{md:"12",cols:"12"},{default:a(()=>[t(ae,{density:"compact",multiple:"",clearable:"",chips:"",label:"PIC",modelValue:e(s).pic_id,"onUpdate:modelValue":h[8]||(h[8]=g=>e(s).pic_id=g),items:e(_),"item-title":"full_name","item-value":"id",rules:e(F).required,loading:e(V),disabled:e(V)},null,8,["modelValue","items","rules","loading","disabled"])]),_:1}),t(w,{md:"12",cols:"12"},{default:a(()=>[t(be,{density:"compact",label:"Notes",modelValue:e(s).notes,"onUpdate:modelValue":h[9]||(h[9]=g=>e(s).notes=g)},null,8,["modelValue"])]),_:1})]}),_:1}),t(Le,{class:"my-3 px-0"}),t(ge,null,{default:a(()=>[t(I,{variant:"tonal",color:"error",type:"button",onClick:h[10]||(h[10]=Y=>$("close"))},{default:a(()=>[t(D,{icon:"ri-close-line",class:"me-3"}),T(" Close ")]),_:1}),t(fe),t(I,{variant:"tonal",color:"success",type:"submit"},{default:a(()=>[T(" Save "),t(D,{icon:"ri-save-line",class:"ms-3"})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})}}},dt={class:"w-100"},rt={class:"mt-3 font-weight-light"},ut=l("hr",{class:"my-2"},null,-1),ct={key:0},mt=l("tr",{class:"bg-secondary"},[l("td",null,"Name"),l("td",null,"School"),l("td",null,"Grade")],-1),_t={key:1},pt=l("td",{width:"20%"},"Name",-1),ft=l("td",{width:"1%"},":",-1),vt=l("td",null,"School Name",-1),gt=l("td",{width:"1%"},":",-1),yt=l("td",null,"Grade",-1),ht=l("td",{width:"1%"},":",-1),bt=l("td",null,"Email",-1),Vt=l("td",{width:"1%"},":",-1),kt=l("td",null,"Sales PIC",-1),wt=l("td",{width:"1%"},":",-1),xt=["href"],Dt={class:"mt-5 font-weight-light"},$t=l("hr",{class:"my-2"},null,-1),Ct={width:"30%"},Tt=l("td",{width:"1%"},":",-1),Mt={key:0},St={key:1},Ut=l("td",null,"Package",-1),Yt=l("td",{width:"1%"},":",-1),Nt=l("td",null,"Person in Charge",-1),jt=l("td",{width:"1%"},":",-1),Pt=l("td",{width:"1%"},":",-1),It=l("td",{width:"1%"},":",-1),Lt=l("td",null,"Curriculum",-1),Ft=l("td",{width:"1%"},":",-1),qt=l("td",null,"Notes",-1),At=l("td",{width:"1%"},":",-1),Rt=l("td",null,"Update On",-1),Bt=l("td",{width:"1%"},":",-1),Et={class:"d-flex align-end w-100"},zt={class:"m-0 mb-1 text-white"},Ht=l("h4",{class:"m-0 ms-2 text-white"},"Minutes",-1),Ot={class:"text-end w-100"},Gt={class:"d-flex align-end w-100"},Jt={class:"m-0 mb-1 text-white"},Wt=l("h4",{class:"m-0 ms-2 text-white"},"Minutes",-1),Kt={class:"text-end w-100"},Qt={class:"d-flex align-end w-100"},Xt={class:"m-0 mb-1 text-white"},Zt=l("h4",{class:"m-0 ms-2 text-white"},"Minutes",-1),el={class:"text-end w-100"},tl={__name:"user-detail",props:{id:String,name:String},emits:["void"],setup(L,{emit:U}){const c=L,$=U,o=_e("reloadData"),x=_e("updateReload"),i=b([]),_=b([{edit:!1,void:!1,delete:!1}]),C=b(!1),k=async n=>{var s,r,u;C.value=!0;try{const m=await P.get("api/v1/timesheet/"+n+"/detail");m&&(i.value=m,$("void",m.packageDetails.void))}catch(m){((s=m.response)==null?void 0:s.status)==400&&(N("error",(u=(r=m.response)==null?void 0:r.data)==null?void 0:u.errors,"bottom-end"),ue.push("/admin/timesheet")),console.log(m)}finally{C.value=!1}},d=async()=>{var n,s,r;C.value=!0;try{const u=await P.delete("api/v1/timesheet/"+c.id+"/delete");u&&(i.value=u,N("success",u.message,"bottom-end"),_.value.delete=!1,ue.push("/admin/timesheet/tutoring"))}catch(u){((n=u.response)==null?void 0:n.status)==400&&N("error",(r=(s=u.response)==null?void 0:s.data)==null?void 0:r.errors,"bottom-end")}finally{C.value=!1}},V=n=>{_.value[n]?_.value[n]=!1:_.value[n]=!0},p=async(n,s)=>{var r;Ye();try{const u=await P.get("api/v1/timesheet/"+n+"/export",{responseType:"blob"});if(u){const m=window.URL.createObjectURL(new Blob([u],{type:'"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"'})),v=document.createElement("a");v.href=m,v.setAttribute("download",`Timesheet_${s}.xlsx`),document.body.appendChild(v),v.click(),document.body.removeChild(v),window.URL.revokeObjectURL(m),Ne.close()}}catch(u){N("error",(r=u.response)==null?void 0:r.statusText,"bottom-end"),console.log(u)}};return ve(()=>{k(c.id)}),Me(()=>{o.value&&(k(c.id),x(!1))}),(n,s)=>{const r=ie("router-link");return y(),S(O,{class:"mb-3"},{default:a(()=>[e(C)?(y(),S(te,{key:0,type:"heading"})):(y(),S(le,{key:1,class:"d-flex justify-between align-center"},{default:a(()=>{var u,m,v,q,E;return[l("div",dt,[t(r,{to:"/admin/timesheet/"+c.name},{default:a(()=>[t(D,{icon:"ri-arrow-left-line",color:"secondary",class:"me-2",size:"25"})]),_:1},8,["to"]),T(" "+f((u=e(i).packageDetails)==null?void 0:u.tutormentor_name)+" | "+f(((v=(m=e(i))==null?void 0:m.packageDetails)==null?void 0:v.package_type)+" - "+((E=(q=e(i))==null?void 0:q.packageDetails)==null?void 0:E.package_name)),1)]),l("div",null,[t(Ue,{"close-on-content-click":!1,location:"bottom"},{activator:a(({props:z})=>[de((y(),S(I,Se({color:"secondary"},z),{default:a(()=>[t(D,{icon:"ri-settings-3-line"})]),_:2},1040)),[[re,"Settings","start"]])]),default:a(()=>[t(Fe,null,{default:a(()=>[t(ce,null,{default:a(()=>[l("div",{class:"cursor-pointer",onClick:s[0]||(s[0]=z=>V("edit"))},[t(D,{icon:"ri-pencil-line",class:"me-2"}),T(" Edit TimeSheet ")])]),_:1}),t(ce,null,{default:a(()=>[l("div",{class:"cursor-pointer",onClick:s[1]||(s[1]=z=>V("void"))},[t(D,{icon:"ri-exchange-2-line",class:"me-2"}),T(" Timesheet Ownership Transfer ")])]),_:1}),t(ce,null,{default:a(()=>[t(qe,null,{default:a(()=>[l("div",{class:"cursor-pointer",onClick:s[2]||(s[2]=z=>{var G,J,W,K,Q,X;return p(c.id,((J=(G=e(i))==null?void 0:G.packageDetails)==null?void 0:J.package_type)+"-"+((K=(W=e(i))==null?void 0:W.packageDetails)==null?void 0:K.package_name)+"_"+((X=(Q=e(i))==null?void 0:Q.packageDetails)==null?void 0:X.tutormentor_name))})},[t(D,{icon:"ri-download-line",class:"me-2"}),T(" Download TimeSheet ")])]),_:1})]),_:1}),t(ce,null,{default:a(()=>[l("div",{class:"cursor-pointer",onClick:s[3]||(s[3]=z=>V("delete"))},[t(D,{icon:"ri-delete-bin-line",class:"me-2"}),T(" Delete TimeSheet ")])]),_:1})]),_:1})]),_:1})])]}),_:1})),t(A,null,{default:a(()=>[e(C)?(y(),S(oe,{key:1},{default:a(()=>[t(w,{md:"7"},{default:a(()=>[t(te,{type:"heading, paragraph, heading, paragraph",class:"mb-3"})]),_:1}),t(w,{md:"5"},{default:a(()=>[t(te,{type:"text@3",color:"#16B1FF",class:"mb-3"}),t(te,{type:"text@3",color:"#91c45e",class:"mb-3"}),t(te,{type:"text@3",color:"#e05e5e",class:"mb-3"})]),_:1})]),_:1})):(y(),S(oe,{key:0,align:"center"},{default:a(()=>[t(w,{md:"7"},{default:a(()=>[l("h4",rt,[t(D,{icon:"ri-user-line",size:"17",class:"me-2"}),T(" Basic Profile ")]),ut,t(he,{density:"compact"},{default:a(()=>{var u,m;return[((u=e(i).clientProfile)==null?void 0:u.length)>1?(y(),R("tbody",ct,[mt,(y(!0),R(De,null,$e(e(i).clientProfile,v=>(y(),R("tr",null,[l("td",null,f(v.client_name),1),l("td",null,f(v.client_school),1),l("td",null,f(v.client_grade<=12?v.client_grade:"Not High School"),1)]))),256))])):((m=e(i).clientProfile)==null?void 0:m.length)==1?(y(),R("tbody",_t,[l("tr",null,[pt,ft,l("td",null,f(e(i).clientProfile[0].client_name),1)]),l("tr",null,[vt,gt,l("td",null,f(e(i).clientProfile[0].client_school),1)]),l("tr",null,[yt,ht,l("td",null,f(e(i).clientProfile[0].client_grade<=12?e(i).clientProfile[0].client_grade:"Not High School"),1)]),l("tr",null,[bt,Vt,l("td",null,f(e(i).clientProfile[0].client_mail),1)]),l("tr",null,[kt,wt,l("td",null,[T(f(e(i).clientProfile[0].sales_pic_name)+" ",1),l("a",{href:"https://api.whatsapp.com/send?phone="+e(i).clientProfile[0].sales_pic_phone+"&text=Halo%20"+e(i).clientProfile[0].sales_pic_name,target:"_blank"},[t(D,{icon:"ri-whatsapp-line",color:"success",class:"ms-3"})],8,xt)])])])):Z("",!0)]}),_:1}),l("h4",Dt,[t(D,{icon:"ri-bookmark-line",class:"me-2",size:"17"}),T(" Package Details ")]),$t,t(he,{density:"compact"},{default:a(()=>{var u,m,v,q,E,z,G,J,W,K,Q,X;return[l("tbody",null,[l("tr",null,[l("td",Ct,f(c.name=="tutoring"?"Program Name":"Engagement Type"),1),Tt,c.name=="tutoring"?(y(),R("td",Mt,f((u=e(i).packageDetails)!=null&&u.free_trial?"[TRIAL]":"")+" "+f((m=e(i).packageDetails)==null?void 0:m.program_name),1)):(y(),R("td",St,f((v=e(i).packageDetails)==null?void 0:v.engagement_type),1))]),l("tr",null,[Ut,Yt,l("td",null,f((q=e(i).packageDetails)==null?void 0:q.package_type)+" "+f((E=e(i).packageDetails)!=null&&E.package_name?" - "+((z=e(i).packageDetails)==null?void 0:z.package_name):""),1)]),l("tr",null,[Nt,jt,l("td",null,f((G=e(i).packageDetails)==null?void 0:G.pic_name),1)]),l("tr",null,[l("td",null,f(c.name=="tutoring"?"Tutor":"Mentor")+" Name",1),Pt,l("td",null,f((J=e(i).packageDetails)==null?void 0:J.tutormentor_name)+" ( Rp. "+f(new Intl.NumberFormat("id-ID").format((W=e(i).packageDetails)==null?void 0:W.tutormentor_fee_hours))+" ) ",1)]),l("tr",null,[l("td",null,"Inhouse "+f(c.name=="tutoring"?"Tutor":"Mentor"),1),It,l("td",null,f((K=e(i).packageDetails)==null?void 0:K.inhouse_name),1)]),l("tr",null,[Lt,Ft,l("td",null,f(((Q=e(i).editableColumns)==null?void 0:Q.curriculum_name)??"-"),1)]),l("tr",null,[qt,At,l("td",null,f((X=e(i).editableColumns)==null?void 0:X.notes),1)]),l("tr",null,[Rt,Bt,l("td",null,f(e(H)().format("LLL")),1)])])]}),_:1})]),_:1}),t(w,{md:"5"},{default:a(()=>[t(O,{color:"#16B1FF",class:"mb-2 d-flex align-center"},{default:a(()=>[l("div",null,[t(me,null,{default:a(()=>[t(le,{class:"text-white"},{default:a(()=>[T(" Total Minutes of Package ")]),_:1})]),_:1}),t(A,{class:"d-flex justify-between"},{default:a(()=>{var u;return[l("div",Et,[l("h1",zt,f((u=e(i).packageDetails)==null?void 0:u.duration_in_minutes),1),Ht])]}),_:1})]),t(A,null,{default:a(()=>[l("div",Ot,[t(D,{icon:"ri-calendar-schedule-line",size:"60"})])]),_:1})]),_:1}),t(O,{color:"#91c45e",class:"mb-2 d-flex align-center"},{default:a(()=>[l("div",null,[t(me,null,{default:a(()=>[t(le,{class:"text-white"},{default:a(()=>[T(" Total Minutes Spent ")]),_:1})]),_:1}),t(A,{class:"d-flex justify-between"},{default:a(()=>{var u;return[l("div",Gt,[l("h1",Jt,f((u=e(i).packageDetails)==null?void 0:u.time_spent_in_minutes),1),Wt])]}),_:1})]),t(A,null,{default:a(()=>[l("div",Kt,[t(D,{icon:"ri-timer-flash-line",size:"60",color:"white"})])]),_:1})]),_:1}),t(O,{color:"#e05e5e",class:"mb-2 d-flex align-center"},{default:a(()=>[l("div",null,[t(me,null,{default:a(()=>[t(le,{class:"text-white"},{default:a(()=>[T(" Total Minutes Left ")]),_:1})]),_:1}),t(A,{class:"d-flex justify-between"},{default:a(()=>{var u,m;return[l("div",Qt,[l("h1",Xt,f(((u=e(i).packageDetails)==null?void 0:u.duration_in_minutes)-((m=e(i).packageDetails)==null?void 0:m.time_spent_in_minutes)),1),Zt])]}),_:1})]),t(A,null,{default:a(()=>[l("div",el,[t(D,{icon:"ri-timer-2-line",size:"60"})])]),_:1})]),_:1})]),_:1})]),_:1}))]),_:1}),t(se,{modelValue:e(_).edit,"onUpdate:modelValue":s[6]||(s[6]=u=>e(_).edit=u),"max-width":"600",persistent:""},{default:a(()=>{var u;return[t(nt,{item:e(i).editableColumns,package_id:(u=e(i).packageDetails)==null?void 0:u.package_id,id:c.id,"timesheet-type":c.name,onClose:s[4]||(s[4]=m=>V("edit")),onReload:s[5]||(s[5]=m=>k(c.id))},null,8,["item","package_id","id","timesheet-type"])]}),_:1},8,["modelValue"]),t(se,{modelValue:e(_).delete,"onUpdate:modelValue":s[8]||(s[8]=u=>e(_).delete=u),"max-width":"400",persistent:""},{default:a(()=>[t(xe,{title:"timesheet",loading:e(C),onDelete:d,onClose:s[7]||(s[7]=u=>V("delete"))},null,8,["loading"])]),_:1},8,["modelValue"]),t(se,{modelValue:e(_).void,"onUpdate:modelValue":s[10]||(s[10]=u=>e(_).void=u),"max-width":"400",persistent:""},{default:a(()=>[t(ot,{timesheet_id:c.id,require:e(i).editableColumns.tutormentor_role,onClose:s[9]||(s[9]=u=>V("void"))},null,8,["timesheet_id","require"])]),_:1},8,["modelValue"])]),_:1})}}},ll={class:"h-auto position-relative"},al={key:0,class:"overlay"},sl=l("div",{class:"bg-secondary",style:{height:"100%",position:"absolute",left:"0",top:"0","z-index":"9998",width:"100%",opacity:"0.6"}},null,-1),il={class:"d-flex align-center justify-center",style:{height:"100%",position:"absolute",left:"0",top:"0","z-index":"9999",width:"100%",opacity:"1"}},ol={class:"text-center"},nl=l("h2",{class:"text-white mt-3"},"This Timesheet Has Changed Owner",-1),Ml={__name:"timesheet-detail",props:{id:Number,name:String},setup(L){const U=L,c=U.id,$=b(!1),o=b(!1);we("reloadData",$),we("updateReload",i=>{$.value=i});const x=i=>{o.value=i};return(i,_)=>(y(),R("div",ll,[e(o)=="true"?(y(),R("div",al,[sl,l("div",il,[l("div",ol,[t(D,{color:"white",icon:"ri-lock-line",size:"50"}),nl,t(I,{color:"light",class:"mt-4",onClick:_[0]||(_[0]=C=>e(ue).push({path:"/admin/timesheet"+U.name}))},{default:a(()=>[T(" Back to List ")]),_:1})])])])):Z("",!0),t(tl,{id:e(c),name:U.name,onVoid:x},null,8,["id","name"]),t(it,{id:e(c)},null,8,["id"])]))}};export{Ml as default};
