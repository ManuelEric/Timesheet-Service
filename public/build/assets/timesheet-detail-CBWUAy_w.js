import{_ as xe}from"./DeleteHandler.vue_vue_type_script_setup_true_lang-CTmrI7b8.js";import{r as h,y as ie,e as y,p as S,w as a,b as t,j as pe,V as B,h as e,D as O,k as L,l as C,i as M,z as fe,A as P,s as N,a5 as _e,o as ve,f as l,E as de,a as R,F as De,a0 as $e,t as g,q as Z,H as Ce,a6 as Te,d as ue,a1 as Me,W as Se,x as Ue,a7 as Ye,a8 as Ne,a9 as we}from"./main-CIyTb30b.js";import{r as I}from"./rules-CkvmYWH-.js";import{c as A,d as ge,V as H,b as le,a as me,e as je}from"./VCard-C29YU8gH.js";import{V as ye}from"./VForm-BpW83qwK.js";import{V as oe,a as w}from"./VRow-Qu8MLV5u.js";import{V as he}from"./VTextarea-D3aFUxft.js";import{V as se}from"./VDialog-MgaX4bNX.js";import{a as be,V as te}from"./VTable-DhFykMyG.js";import{T as re}from"./index-Q_ly0H3Z.js";import{V as Pe}from"./VCheckbox-4Wa-QGww.js";import{V as ae}from"./VAutocomplete-Cb3oZRW_.js";import{V as Le}from"./VTooltip-DNVkbYjw.js";import{V as Fe}from"./VDivider-CZWgXtvS.js";import{V as Ie,a as ce,b as qe}from"./VList-_Z-6DLT-.js";import"./VAvatar-BX5jpCoU.js";import"./VImg-W4GSKdm2.js";import"./VCheckboxBtn-Br7Sis1X.js";import"./VSelectionControl-BXKEtM3o.js";import"./VSlideGroup-CaDoTvXL.js";import"./ssrBoot-DemGpwGB.js";const Ae={__name:"activity-add",props:{id:String},emits:["close","reload"],setup(F,{emit:U}){const c=F,D=U,o=h(!1),x=h(),i=h({activity:null,description:null,date:null,start_time:null,end_time:null,start_date:null,end_date:null,meeting_link:null}),_=()=>{i.value={activity:null,description:null,date:null,start_time:null,end_time:null,start_date:null,end_date:null,meeting_link:null}},$=async()=>{const{valid:k}=await x.value.validate();if(k){o.value=!0;try{const d=await P.post("api/v1/timesheet/"+c.id+"/activity",i.value);d&&N("success",d.message,"bottom-end")}catch(d){N("error",d.response.data.errors,"bottom-end")}finally{_(),o.value=!1,D("reload"),D("close")}}};return(k,d)=>{const V=ie("DialogCloseBtn"),p=ie("VDateInput");return y(),S(H,{title:"New Activity"},{default:a(()=>[t(V,{variant:"text",size:"default",onClick:d[0]||(d[0]=n=>D("close"))}),t(A,null,{default:a(()=>[t(ye,{onSubmit:pe($,["prevent"]),ref_key:"formData",ref:x,"validate-on":"input"},{default:a(()=>[t(oe,null,{default:a(()=>[t(w,{cols:"12",class:"d-none"},{default:a(()=>[t(B,{density:"compact",modelValue:e(i).activity,"onUpdate:modelValue":d[1]||(d[1]=n=>e(i).activity=n),label:"Activity Name",placeholder:"Activity",loading:e(o),disabled:e(o)},null,8,["modelValue","loading","disabled"])]),_:1}),t(w,{cols:"12"},{default:a(()=>[t(he,{density:"compact",modelValue:e(i).description,"onUpdate:modelValue":d[2]||(d[2]=n=>e(i).description=n),label:"Meeting Discussion",placeholder:"Meeting Discussion",loading:e(o),disabled:e(o),rules:e(I).required},null,8,["modelValue","loading","disabled","rules"])]),_:1}),t(w,{md:"6",cols:"12"},{default:a(()=>[t(p,{density:"compact",modelValue:e(i).date,"onUpdate:modelValue":d[3]||(d[3]=n=>e(i).date=n),label:"Date",placeholder:"Select Date",variant:"outlined","prepend-icon":"",loading:e(o),disabled:e(o),rules:e(I).required},null,8,["modelValue","loading","disabled","rules"])]),_:1}),t(w,{md:"3",cols:"6"},{default:a(()=>[t(B,{density:"compact",type:"time",modelValue:e(i).start_time,"onUpdate:modelValue":d[4]||(d[4]=n=>e(i).start_time=n),label:"Start Time",placeholder:"Start Time",rules:e(I).required,class:"mb-3",loading:e(o),disabled:!e(i).date||e(o),onChange:d[5]||(d[5]=n=>e(i).start_date=e(O)(e(i).date).format("YYYY-MM-DD")+" "+e(i).start_time+":00")},null,8,["modelValue","rules","loading","disabled"])]),_:1}),t(w,{md:"3",cols:"6"},{default:a(()=>[t(B,{density:"compact",type:"time",modelValue:e(i).end_time,"onUpdate:modelValue":d[6]||(d[6]=n=>e(i).end_time=n),label:"End Time",placeholder:"End Time",loading:e(o),disabled:!e(i).date||e(o),onChange:d[7]||(d[7]=n=>e(i).end_date=e(O)(e(i).date).format("YYYY-MM-DD")+" "+e(i).end_time+":00")},null,8,["modelValue","loading","disabled"])]),_:1}),t(w,{md:"12",cols:"12"},{default:a(()=>[t(B,{density:"compact",type:"text",modelValue:e(i).meeting_link,"onUpdate:modelValue":d[8]||(d[8]=n=>e(i).meeting_link=n),label:"Meeting Link",placeholder:"Meeting Link",loading:e(o),disabled:e(o)},null,8,["modelValue","loading","disabled"])]),_:1})]),_:1}),t(ge,{class:"mt-5"},{default:a(()=>[t(L,{variant:"tonal",type:"button",color:"error",loading:e(o),disabled:e(o),onClick:d[9]||(d[9]=n=>D("close"))},{default:a(()=>[t(C,{icon:"ri-close-line",class:"me-3"}),M(" Close ")]),_:1},8,["loading","disabled"]),t(fe),t(L,{variant:"tonal",type:"submit",color:"success",loading:e(o),disabled:e(o)},{default:a(()=>[M(" Save "),t(C,{icon:"ri-save-line",class:"ms-3"})]),_:1},8,["loading","disabled"])]),_:1})]),_:1},512)]),_:1})]),_:1})}}},Re={__name:"activity-edit",props:{timesheet_id:Number,activity:String},emits:["close","reload"],setup(F,{emit:U}){const c=h(!1),D=h(),o=F,x=U,i=_e("updateReload"),_=h({activity:o==null?void 0:o.activity.activity,description:o==null?void 0:o.activity.description,date:new Date(o==null?void 0:o.activity.start_date),start_time:o==null?void 0:o.activity.start_time,end_time:o==null?void 0:o.activity.end_time,start_date:O(o==null?void 0:o.activity.start_date).format("YYYY-MM-DD")+" "+(o==null?void 0:o.activity.start_time)+":00",end_date:(o==null?void 0:o.activity.end_time)!=0?O(o==null?void 0:o.activity.start_date).format("YYYY-MM-DD")+" "+(o==null?void 0:o.activity.end_time)+":00":null,meeting_link:o==null?void 0:o.activity.meeting_link}),$=async()=>{var d,V;const{valid:k}=await D.value.validate();if(k){c.value=!0;try{_.value.start_date=O(_.value.date).format("YYYY-MM-DD")+" "+_.value.start_time+":00",_.value.end_date=O(_.value.date).format("YYYY-MM-DD")+" "+_.value.end_time+":00";const p=await P.put("api/v1/timesheet/"+o.timesheet_id+"/activity/"+o.activity.id,_.value);p&&(N("success",p.message,"bottom-end"),x("reload"))}catch(p){if((V=(d=p==null?void 0:p.response)==null?void 0:d.data)!=null&&V.errors){const n=p.response.data.errors;let s="Validation errors:";if(typeof n!="string"){for(const r in n)n.hasOwnProperty(r)&&(s+=`
${r}: ${n[r].join(", ")}`);N("error",s,"bottom-end")}else N("error",p.response.data.errors,"bottom-end")}}finally{c.value=!1,x("close"),setTimeout(()=>{i(!0)},3e3)}}};return(k,d)=>{const V=ie("DialogCloseBtn"),p=ie("VDateInput");return y(),S(H,{title:"Edit Activity"},{default:a(()=>[t(V,{variant:"text",size:"default",onClick:d[0]||(d[0]=n=>x("close"))}),t(A,null,{default:a(()=>[t(ye,{onSubmit:pe($,["prevent"]),ref_key:"formData",ref:D,"validate-on":"input"},{default:a(()=>[t(oe,null,{default:a(()=>[t(w,{cols:"12",class:"d-none"},{default:a(()=>[t(B,{density:"compact",modelValue:e(_).activity,"onUpdate:modelValue":d[1]||(d[1]=n=>e(_).activity=n),label:"Activity Name",placeholder:"Activity",disabled:e(c),loading:e(c)},null,8,["modelValue","disabled","loading"])]),_:1}),t(w,{cols:"12"},{default:a(()=>[t(he,{density:"compact",modelValue:e(_).description,"onUpdate:modelValue":d[2]||(d[2]=n=>e(_).description=n),label:"Meeting Discussion",rules:e(I).required,placeholder:"Meeting Discussion",disabled:e(c),loading:e(c)},null,8,["modelValue","rules","disabled","loading"])]),_:1}),t(w,{md:"6",cols:"12"},{default:a(()=>[t(p,{density:"compact",modelValue:e(_).date,"onUpdate:modelValue":d[3]||(d[3]=n=>e(_).date=n),label:"Date",placeholder:"Select Date","prepend-icon":"",disabled:e(c),loading:e(c),rules:e(I).required},null,8,["modelValue","disabled","loading","rules"])]),_:1}),t(w,{md:"3",cols:"6"},{default:a(()=>[t(B,{density:"compact",type:"time",modelValue:e(_).start_time,"onUpdate:modelValue":d[4]||(d[4]=n=>e(_).start_time=n),label:"Start Time",rules:e(I).required,placeholder:"Start Time",disabled:e(c),loading:e(c),onChange:d[5]||(d[5]=n=>e(_).start_date=e(O)(o==null?void 0:o.activity.date).format("YYYY-MM-DD")+" "+e(_).start_time+":00")},null,8,["modelValue","rules","disabled","loading"])]),_:1}),t(w,{md:"3",cols:"6"},{default:a(()=>[t(B,{density:"compact",type:"time",modelValue:e(_).end_time,"onUpdate:modelValue":d[6]||(d[6]=n=>e(_).end_time=n),label:"End Time",placeholder:"End Time",disabled:e(c),loading:e(c),onChange:d[7]||(d[7]=n=>e(_).end_date=e(O)(o==null?void 0:o.activity.date).format("YYYY-MM-DD")+" "+e(_).end_time+":00")},null,8,["modelValue","disabled","loading"])]),_:1}),t(w,{md:"12",cols:"12"},{default:a(()=>[t(B,{density:"compact",type:"text",modelValue:e(_).meeting_link,"onUpdate:modelValue":d[8]||(d[8]=n=>e(_).meeting_link=n),label:"Meeting Link",placeholder:"Meeting Link",disabled:e(c),loading:e(c)},null,8,["modelValue","disabled","loading"])]),_:1})]),_:1}),t(ge,{class:"mt-5"},{default:a(()=>[t(L,{variant:"tonal",color:"error",disabled:e(c),loading:e(c),onClick:d[9]||(d[9]=n=>x("close"))},{default:a(()=>[t(C,{icon:"ri-close-line",class:"me-3"}),M(" Close ")]),_:1},8,["disabled","loading"]),t(fe),t(L,{variant:"tonal",color:"success",type:"submit",disabled:e(c),loading:e(c)},{default:a(()=>[M(" Save "),t(C,{icon:"ri-save-line",class:"ms-3"})]),_:1},8,["disabled","loading"])]),_:1})]),_:1},512)]),_:1})]),_:1})}}},Be={class:"d-flex justify-between align-center"},Ee=l("div",{class:"w-100"},[l("h4",null,"Activity")],-1),ze=l("thead",null,[l("tr",null,[l("th",{class:"text-uppercase",width:"1%"}," No "),l("th",{class:"text-uppercase text-start"},"Meeting Discussion"),l("th",{class:"text-uppercase text-center"},"Date"),l("th",{class:"text-uppercase text-center"},"Start Time"),l("th",{class:"text-uppercase text-center"},"End Time"),l("th",{class:"text-uppercase text-center"},"Time Spent"),l("th",{class:"text-uppercase text-left"},"Fee Hours"),l("th",{class:"text-uppercase text-center"},"Status"),l("th",{class:"text-uppercase text-end"},"#")])],-1),Oe={key:0},He=l("tr",null,[l("th",{colspan:"8",class:"text-center"}," No Activity Found ")],-1),Ge=[He],Je={key:1},We={width:"1%"},Ke={class:"d-none"},Qe={class:"text-start"},Xe=["innerHTML"],Ze={class:"text-center"},et={class:"text-center"},tt={class:"text-center"},lt={class:"text-left"},at={class:"text-end"},st=["href","disabled"],it={__name:"timesheet-detail",props:{id:String},setup(F){const U=F,c=_e("updateReload"),D=h([]),o=h(!1),x=h([{add:!1,edit:!1,delete:!1}]),i=h([]),_=async()=>{o.value=!0;try{const p=await P.get("api/v1/timesheet/"+U.id+"/activities");p&&(D.value=p)}catch(p){console.error(p)}finally{o.value=!1}},$=p=>{x.value[p]?x.value[p]=!1:x.value[p]=!0},k=(p,n)=>{i.value=n,$(p)},d=async()=>{var p,n,s;o.value=!0;try{const r=await P.delete("api/v1/timesheet/"+U.id+"/activity/"+i.value.id);r&&(N("success",r.message,"bottom-end"),$("delete"))}catch(r){((p=r.response)==null?void 0:p.status)==400&&N("error",(s=(n=r.response)==null?void 0:n.data)==null?void 0:s.errors,"bottom-end")}finally{o.value=!1,_(),c(!0)}},V=async p=>{var n,s,r,u;try{const m=await P.patch("api/v1/timesheet/"+U.id+"/activity/"+p.id,p);m&&N("success",m.message,"bottom-end")}catch(m){if((s=(n=m==null?void 0:m.response)==null?void 0:n.data)!=null&&s.message&&N("error",m.response.data.message,"bottom-end"),(u=(r=m==null?void 0:m.response)==null?void 0:r.data)!=null&&u.errors){const f=m.response.data.errors;let q="Validation errors:";if(typeof f!="string"){for(const E in f)f.hasOwnProperty(E)&&(q+=`
${E}: ${f[E].join(", ")}`);N("error",q,"bottom-end")}else N("error",m.response.data.errors,"bottom-end")}}finally{_(),c(!0)}};return ve(()=>{_()}),(p,n)=>(y(),S(H,null,{default:a(()=>[t(le,null,{default:a(()=>[l("div",Be,[Ee,de((y(),S(L,{onClick:n[0]||(n[0]=s=>$("add"))},{default:a(()=>[t(C,{icon:"ri-add-line"})]),_:1})),[[re,"New Activity","start"]]),t(se,{modelValue:e(x).add,"onUpdate:modelValue":n[2]||(n[2]=s=>e(x).add=s),"max-width":"600",persistent:""},{default:a(()=>[t(Ae,{id:U.id,onClose:n[1]||(n[1]=s=>$("add")),onReload:_},null,8,["id"])]),_:1},8,["modelValue"])])]),_:1}),t(A,null,{default:a(()=>[e(o)?(y(),S(te,{key:1,type:"table"})):(y(),S(be,{key:0,class:"text-no-wrap","max-height":"400","fixed-header":""},{default:a(()=>{var s;return[ze,((s=e(D))==null?void 0:s.length)==0?(y(),R("tbody",Oe,Ge)):(y(),R("tbody",Je,[(y(!0),R(De,null,$e(e(D),(r,u)=>(y(),R("tr",{key:u},[l("td",We,g(u+1),1),l("td",Ke,g(r.activity),1),l("td",Qe,[l("div",{class:"py-2",style:{width:"250px","text-wrap":"wrap"},innerHTML:r.description},null,8,Xe)]),l("td",null,g(p.$moment(r.start_date).format("dddd"))+", "+g(p.$moment(r.start_date).format("MMM Do YYYY")),1),l("td",Ze,g(r.start_time),1),l("td",et,g(r.end_time),1),l("td",tt,[t(C,{icon:"ri-timer-2-line",class:"cursor-pointer me-3"}),M(" "+g(r.estimate)+" Minutes ",1)]),l("td",lt," Rp. "+g(r.activity==="Bonus Fee"?new Intl.NumberFormat("id-ID").format(r.bonus_fee):r.activity==="Additional Fee"?new Intl.NumberFormat("id-ID").format(r.additional_fee):new Intl.NumberFormat("id-ID").format(r.fee_hours)),1),l("td",null,[de(t(Pe,{color:"success",modelValue:r.status,"onUpdate:modelValue":[m=>r.status=m,m=>V(r)],value:!0,"false-value":!1},null,8,["modelValue","onUpdate:modelValue"]),[[re,r.status?"Completed":"Not Yet","start"]])]),l("td",at,[r.meeting_link?(y(),S(L,{key:0,color:"primary",density:"compact",class:"me-1"},{default:a(()=>[l("a",{href:r.meeting_link,target:"_blank",class:"bg-primary",disabled:r.cutoff_status=="completed"},[t(C,{icon:"ri ri-link"}),M(" Join ")],8,st)]),_:2},1024)):Z("",!0),de((y(),S(L,{color:"warning",density:"compact",class:"me-1",disabled:r.cutoff_status=="completed",onClick:m=>k("edit",r)},{default:a(()=>[t(C,{icon:"ri-edit-line",class:"cursor-pointer"})]),_:2},1032,["disabled","onClick"])),[[re,"Edit Activity","start"]]),de((y(),S(L,{color:"error",density:"compact",disabled:r.cutoff_status=="completed",onClick:m=>k("delete",r)},{default:a(()=>[t(C,{icon:"ri-delete-bin-line",class:"cursor-pointer"})]),_:2},1032,["disabled","onClick"])),[[re,"Delete Activity","start"]])])]))),128))]))]}),_:1}))]),_:1}),t(se,{modelValue:e(x).edit,"onUpdate:modelValue":n[4]||(n[4]=s=>e(x).edit=s),"max-width":"600",persistent:""},{default:a(()=>[t(Re,{timesheet_id:U==null?void 0:U.id,activity:e(i),onClose:n[3]||(n[3]=s=>$("edit")),onReload:_},null,8,["timesheet_id","activity"])]),_:1},8,["modelValue"]),t(se,{modelValue:e(x).delete,"onUpdate:modelValue":n[6]||(n[6]=s=>e(x).delete=s),"max-width":"400",persistent:""},{default:a(()=>[t(xe,{title:"activity",loading:e(o),onClose:n[5]||(n[5]=s=>$("delete")),onDelete:d},null,8,["loading"])]),_:1},8,["modelValue"])]),_:1}))}},ot={__name:"timesheet-transfer",props:{timesheet_id:Number,require:String},emits:["close","reload"],setup(F,{emit:U}){const c=h(),D=F,o=U,x=h([]),i=h([]),_=h([]),$=D.require.toLowerCase(),k=h(!1),d=h({mentortutor_email:null,subject_id:null}),V=async()=>{const s="api/v1/user/mentor-tutors?role="+$;k.value=!0;try{const r=await P.get(s);r&&(x.value=r)}catch(r){console.error(r)}finally{k.value=!1}},p=async(s,r=null)=>{if(d.value.subject_id=null,$=="mentor")d.value.subject_id=s[0].subjects[0].id;else{k.value=!0;try{const u=await P.get("api/v1/user/mentor-tutors/"+r+"/subjects");u&&(_.value=u)}catch(u){console.error(u)}finally{k.value=!1}}},n=async()=>{var u,m;o("close"),d.value.mentortutor_email=i.value.email;const{valid:s}=await c.value.validate(),r=await Te("Are you sure you want to change the owner?");if(s&&r){k.value=!0;try{const f=await P.patch("api/v1/timesheet/"+D.timesheet_id+"/void/",d.value);f&&(N("success",f.message,"bottom-end"),ue.push({path:"/admin/timesheet/"+f.data.timesheet_id}),d.value={mentortutor_email:null,subject_id:null},i.value=[],setTimeout(()=>{ue.go(0)},1e3))}catch(f){if(console.log(f),(m=(u=f==null?void 0:f.response)==null?void 0:u.data)!=null&&m.errors){const q=f.response.data.errors;N("error",q,"bottom-end")}}finally{o("close"),k.value=!1}}};return ve(()=>{V()}),(s,r)=>(y(),S(H,{class:"mx-auto my-8",elevation:"16",width:"450"},{default:a(()=>[t(ye,{ref_key:"formData",ref:c,"validate-on":"input",onSubmit:pe(n,["prevent"])},{default:a(()=>[t(me,null,{default:a(()=>[t(le,null,{default:a(()=>[M(" Timesheet Ownership Transfer ")]),_:1}),t(je,null,{default:a(()=>[M(" Change Timesheet Handler ")]),_:1})]),_:1}),t(A,null,{default:a(()=>[t(oe,null,{default:a(()=>{var u;return[t(w,{md:"12"},{default:a(()=>[t(ae,{clearable:"",modelValue:e(i),"onUpdate:modelValue":[r[0]||(r[0]=m=>Ce(i)?i.value=m:null),r[1]||(r[1]=m=>p(e(i).roles,e(i).uuid))],label:"Mentor/Tutor",items:e(x),"item-props":m=>({title:m.full_name,subtitle:m.roles.map(f=>f.name).join(", ")}),rules:e(I).required,loading:e(k),disabled:e(k)},null,8,["modelValue","items","item-props","rules","loading","disabled"])]),_:1}),((u=D.require)==null?void 0:u.toLowerCase())=="tutor"?(y(),S(w,{key:0,md:"12"},{default:a(()=>[t(ae,{clearable:"",modelValue:e(d).subject_id,"onUpdate:modelValue":r[2]||(r[2]=m=>e(d).subject_id=m),label:"Subject Tutoring",items:e(_),"item-title":"subject","item-value":"id",loading:e(k),disabled:e(k),rules:e(I).required},null,8,["modelValue","items","loading","disabled","rules"])]),_:1})):Z("",!0)]}),_:1})]),_:1}),t(ge,{class:"mx-3 mb-3"},{default:a(()=>[t(L,{color:"error",onClick:r[3]||(r[3]=u=>o("close"))},{default:a(()=>[t(C,{icon:"ri-close-line",class:"me-3"}),M(" Close ")]),_:1}),t(fe),t(L,{color:"success",type:"submit"},{default:a(()=>[M(" Save Changes "),t(C,{icon:"ri-save-line",class:"ms-3"})]),_:1})]),_:1})]),_:1},512)]),_:1}))}},nt={__name:"user-edit",props:["id","item","package_id","timesheetType"],emits:["close","reload"],setup(F,{emit:U}){var J,W,K,Q,X,Ve,ke;const c=F,D=U,o=h([]),x=h([]),i=h([]),_=h([]),$=h([]),k=h(!1),d=h(!0),V=h(!0),p=h(null),n=h(),s=h({ref_id:(J=c.item)==null?void 0:J.ref_id,mentortutor_email:(W=c.item)==null?void 0:W.tutormentor_email,subject_id:(K=c.item)==null?void 0:K.subject_id,inhouse_id:(Q=c.item)==null?void 0:Q.inhouse_id,package_id:c.package_id,duration:(X=c.item)==null?void 0:X.duration,notes:(Ve=c.item)==null?void 0:Ve.notes,pic_id:(ke=c.item)==null?void 0:ke.pic_id,tax:null,individual_fee:null}),r=async()=>{var b,j;const T="api/v1/program/list?require=tutor";try{d.value=!0;const Y=await P.get(T);Y&&(o.value=Y),d.value=!1}catch(Y){N("error",(j=(b=Y.response)==null?void 0:b.data)==null?void 0:j.message,"bottom-end"),console.error(Y),d.value=!1}},u=async(T=!1)=>{V.value=!0;const b=T?"api/v1/user/mentor-tutors?inhouse=true":"api/v1/user/mentor-tutors";try{const j=await P.get(b);j&&(T?$.value=Object.values(j):x.value=j)}catch(j){console.error(j)}finally{V.value=!1}},m=async()=>{V.value=!0;try{const T=await P.get("api/v1/package/component/list");T&&(i.value=T)}catch(T){console.error(T)}finally{V.value=!1}},f=()=>{const T=s.value.package_id,b=i.value.findIndex(Y=>Y.id===T);let j=i.value[b];j.detail?(k.value=!0,s.value.duration=j.detail):(k.value=!1,s.value.duration=null)},q=async()=>{V.value=!0;try{const T=await P.get("api/v1/user/component/list");T&&(_.value=T)}catch(T){console.error(T)}finally{V.value=!1}},E=async()=>{var b,j;const{valid:T}=await n.value.validate();if(T)try{const Y=await P.put("api/v1/timesheet/"+c.id+"/update",s.value);Y&&(s.value={ref_id:null,mentortutor_email:null,subject_id:null,inhouse_id:null,package_id:null,duration:"",notes:"",pic_id:[]},N("success",Y.message,"bottom-end"),D("reload"))}catch(Y){if((j=(b=Y==null?void 0:Y.response)==null?void 0:b.data)!=null&&j.errors){const ee=Y.response.data.errors;let ne="Validation errors:";for(const v in ee)ee.hasOwnProperty(v)&&(ne+=`
${v}: ${ee[v].join(", ")}`);N("error",ne,"bottom-end")}}finally{D("close")}},z=()=>{if(s.value.individual_fee){const T=s.value.individual_fee*(1-s.value.tax/100);p.value=Math.trunc(T)}else p.value=null},G=()=>{const T=p.value/(1-s.value.tax/100);s.value.individual_fee=Math.trunc(T)};return ve(()=>{r(),u(!0),m(),q(),z(),setTimeout(()=>{d.value=!1},2e3)}),(T,b)=>{const j=ie("DialogCloseBtn");return y(),S(H,{title:"Edit Detail"},{default:a(()=>[t(j,{variant:"text",size:"default",onClick:b[0]||(b[0]=Y=>D("close"))}),t(A,null,{default:a(()=>[t(ye,{onSubmit:pe(E,["prevent"]),ref_key:"formData",ref:n,"validate-on":"input"},{default:a(()=>[t(oe,null,{default:a(()=>{var Y,ee,ne;return[c.timesheetType!="specialist"?(y(),S(w,{key:0,md:"12",cols:"12"},{default:a(()=>[t(ae,{clearable:"",modelValue:e(s).ref_id,"onUpdate:modelValue":[b[1]||(b[1]=v=>e(s).ref_id=v),T.checkProgram],label:"Student Name",items:e(o),"item-props":v=>({title:v.student_name,subtitle:v.program_name+(v.timesheet_id?" ✅":"")+(v.scnd_timesheet_id?" ✅":""),disabled:v.timesheet_id&&v.scnd_timesheet_id}),"item-value":"id",rules:e(I).required,loading:e(d),disabled:e(d),density:"compact",multiple:""},null,8,["modelValue","items","item-props","rules","loading","disabled","onUpdate:modelValue"])]),_:1})):Z("",!0),t(w,{md:"8",cols:"8"},{default:a(()=>[t(ae,{density:"compact",clearable:"",label:"Package",modelValue:e(s).package_id,"onUpdate:modelValue":[b[2]||(b[2]=v=>e(s).package_id=v),f],items:e(i),"item-props":v=>({title:v.package!=null?v.type_of+" - "+v.package:v.type_of}),"item-value":"id",rules:e(I).required,loading:e(V),disabled:e(V)},null,8,["modelValue","items","item-props","rules","loading","disabled"])]),_:1}),t(w,{md:"4",cols:"4"},{default:a(()=>[t(B,{type:"number",clearable:"",label:+e(s).duration/60?"Minutes ("+e(s).duration/60+" Hours)":"Minutes",readonly:e(k),modelValue:e(s).duration,"onUpdate:modelValue":b[3]||(b[3]=v=>e(s).duration=v),rules:e(I).required},null,8,["label","readonly","modelValue","rules"])]),_:1}),t(w,{md:"12",cols:"12"},{default:a(()=>[t(ae,{density:"compact",clearable:"",modelValue:e(s).inhouse_id,"onUpdate:modelValue":b[4]||(b[4]=v=>e(s).inhouse_id=v),label:"Inhouse Mentor/Tutor",items:e($),"item-props":v=>({title:v.full_name}),"item-value":"uuid",rules:e(I).required,loading:e(V),disabled:e(V)},null,8,["modelValue","items","item-props","rules","loading","disabled"])]),_:1}),(Y=c.item)!=null&&Y.individual_fee?(y(),S(w,{key:1,md:"4",cols:"7",class:"d-none"},{default:a(()=>[t(B,{type:"number",clearable:"",label:"Fee/hours (Nett)",modelValue:e(p),"onUpdate:modelValue":[b[5]||(b[5]=v=>Ce(p)?p.value=v:null),G],density:"compact",readonly:""},null,8,["modelValue"])]),_:1})):Z("",!0),(ee=c.item)!=null&&ee.individual_fee?(y(),S(w,{key:2,md:"4",cols:"5",class:"d-none"},{default:a(()=>[t(B,{type:"number",clearable:"",label:"Tax",modelValue:e(s).tax,"onUpdate:modelValue":[b[6]||(b[6]=v=>e(s).tax=v),G],density:"compact",readonly:""},null,8,["modelValue"])]),_:1})):Z("",!0),(ne=c.item)!=null&&ne.individual_fee?(y(),S(w,{key:3,md:"4",cols:"12",class:"d-none"},{default:a(()=>[t(Le,{activator:"parent",location:"top"},{default:a(()=>[M(" Fee Gross is automatically calculated based on the entered Net Fee and Tax Rate. ")]),_:1}),t(B,{type:"number",clearable:"",label:"Fee/hours (Gross)",modelValue:e(s).individual_fee,"onUpdate:modelValue":[b[7]||(b[7]=v=>e(s).individual_fee=v),z],density:"compact",readonly:""},null,8,["modelValue"])]),_:1})):Z("",!0),t(w,{md:"12",cols:"12"},{default:a(()=>[t(ae,{density:"compact",multiple:"",clearable:"",chips:"",label:"PIC",modelValue:e(s).pic_id,"onUpdate:modelValue":b[8]||(b[8]=v=>e(s).pic_id=v),items:e(_),"item-title":"full_name","item-value":"id",rules:e(I).required,loading:e(V),disabled:e(V)},null,8,["modelValue","items","rules","loading","disabled"])]),_:1}),t(w,{md:"12",cols:"12"},{default:a(()=>[t(he,{density:"compact",label:"Notes",modelValue:e(s).notes,"onUpdate:modelValue":b[9]||(b[9]=v=>e(s).notes=v)},null,8,["modelValue"])]),_:1})]}),_:1}),t(Fe,{class:"my-3 px-0"}),t(ge,null,{default:a(()=>[t(L,{variant:"tonal",color:"error",type:"button",onClick:b[10]||(b[10]=Y=>D("close"))},{default:a(()=>[t(C,{icon:"ri-close-line",class:"me-3"}),M(" Close ")]),_:1}),t(fe),t(L,{variant:"tonal",color:"success",type:"submit"},{default:a(()=>[M(" Save "),t(C,{icon:"ri-save-line",class:"ms-3"})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})}}},dt={class:"w-100"},rt={class:"mt-3 font-weight-light"},ut=l("hr",{class:"my-2"},null,-1),ct={key:0},mt=l("tr",{class:"bg-secondary"},[l("td",null,"Name"),l("td",null,"School"),l("td",null,"Grade")],-1),_t={key:1},pt=l("td",{width:"20%"},"Name",-1),ft=l("td",{width:"1%"},":",-1),vt=l("td",null,"School Name",-1),gt=l("td",{width:"1%"},":",-1),yt=l("td",null,"Grade",-1),bt=l("td",{width:"1%"},":",-1),ht=l("td",null,"Email",-1),Vt=l("td",{width:"1%"},":",-1),kt={class:"mt-5 font-weight-light"},wt=l("hr",{class:"my-2"},null,-1),xt={width:"30%"},Dt=l("td",{width:"1%"},":",-1),$t={key:0},Ct={key:1},Tt=l("td",null,"Package",-1),Mt=l("td",{width:"1%"},":",-1),St=l("td",null,"Person in Charge",-1),Ut=l("td",{width:"1%"},":",-1),Yt=l("td",{width:"1%"},":",-1),Nt=l("td",{width:"1%"},":",-1),jt=l("td",null,"Curriculum",-1),Pt=l("td",{width:"1%"},":",-1),Lt=l("td",null,"Notes",-1),Ft=l("td",{width:"1%"},":",-1),It=l("td",null,"Update On",-1),qt=l("td",{width:"1%"},":",-1),At={class:"d-flex align-end w-100"},Rt={class:"m-0 mb-1 text-white"},Bt=l("h4",{class:"m-0 ms-2 text-white"},"Minutes",-1),Et={class:"text-end w-100"},zt={class:"d-flex align-end w-100"},Ot={class:"m-0 mb-1 text-white"},Ht=l("h4",{class:"m-0 ms-2 text-white"},"Minutes",-1),Gt={class:"text-end w-100"},Jt={class:"d-flex align-end w-100"},Wt={class:"m-0 mb-1 text-white"},Kt=l("h4",{class:"m-0 ms-2 text-white"},"Minutes",-1),Qt={class:"text-end w-100"},Xt={__name:"user-detail",props:{id:String,name:String},emits:["void"],setup(F,{emit:U}){const c=F,D=U,o=_e("reloadData"),x=_e("updateReload"),i=h([]),_=h([{edit:!1,void:!1,delete:!1}]),$=h(!1),k=async n=>{var s,r,u;$.value=!0;try{const m=await P.get("api/v1/timesheet/"+n+"/detail");m&&(i.value=m,D("void",m.packageDetails.void))}catch(m){((s=m.response)==null?void 0:s.status)==400&&(N("error",(u=(r=m.response)==null?void 0:r.data)==null?void 0:u.errors,"bottom-end"),ue.push("/admin/timesheet")),console.log(m)}finally{$.value=!1}},d=async()=>{var n,s,r;$.value=!0;try{const u=await P.delete("api/v1/timesheet/"+c.id+"/delete");u&&(i.value=u,N("success",u.message,"bottom-end"),_.value.delete=!1,ue.push("/admin/timesheet/tutoring"))}catch(u){((n=u.response)==null?void 0:n.status)==400&&N("error",(r=(s=u.response)==null?void 0:s.data)==null?void 0:r.errors,"bottom-end")}finally{$.value=!1}},V=n=>{_.value[n]?_.value[n]=!1:_.value[n]=!0},p=async(n,s)=>{var r;Ye();try{const u=await P.get("api/v1/timesheet/"+n+"/export",{responseType:"blob"});if(u){const m=window.URL.createObjectURL(new Blob([u],{type:'"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"'})),f=document.createElement("a");f.href=m,f.setAttribute("download",`Timesheet_${s}.xlsx`),document.body.appendChild(f),f.click(),document.body.removeChild(f),window.URL.revokeObjectURL(m),Ne.close()}}catch(u){N("error",(r=u.response)==null?void 0:r.statusText,"bottom-end"),console.log(u)}};return ve(()=>{k(c.id)}),Me(()=>{o.value&&(k(c.id),x(!1))}),(n,s)=>{const r=ie("router-link");return y(),S(H,{class:"mb-3"},{default:a(()=>[e($)?(y(),S(te,{key:0,type:"heading"})):(y(),S(le,{key:1,class:"d-flex justify-between align-center"},{default:a(()=>{var u,m,f,q,E;return[l("div",dt,[t(r,{to:"/admin/timesheet/"+c.name},{default:a(()=>[t(C,{icon:"ri-arrow-left-line",color:"secondary",class:"me-2",size:"25"})]),_:1},8,["to"]),M(" "+g((u=e(i).packageDetails)==null?void 0:u.tutormentor_name)+" | "+g(((f=(m=e(i))==null?void 0:m.packageDetails)==null?void 0:f.package_type)+" - "+((E=(q=e(i))==null?void 0:q.packageDetails)==null?void 0:E.package_name)),1)]),l("div",null,[t(Ue,{"close-on-content-click":!1,location:"bottom"},{activator:a(({props:z})=>[de((y(),S(L,Se({color:"secondary"},z),{default:a(()=>[t(C,{icon:"ri-settings-3-line"})]),_:2},1040)),[[re,"Settings","start"]])]),default:a(()=>[t(Ie,null,{default:a(()=>[t(ce,null,{default:a(()=>[l("div",{class:"cursor-pointer",onClick:s[0]||(s[0]=z=>V("edit"))},[t(C,{icon:"ri-pencil-line",class:"me-2"}),M(" Edit TimeSheet ")])]),_:1}),t(ce,null,{default:a(()=>[l("div",{class:"cursor-pointer",onClick:s[1]||(s[1]=z=>V("void"))},[t(C,{icon:"ri-exchange-2-line",class:"me-2"}),M(" Timesheet Ownership Transfer ")])]),_:1}),t(ce,null,{default:a(()=>[t(qe,null,{default:a(()=>[l("div",{class:"cursor-pointer",onClick:s[2]||(s[2]=z=>{var G,J,W,K,Q,X;return p(c.id,((J=(G=e(i))==null?void 0:G.packageDetails)==null?void 0:J.package_type)+"-"+((K=(W=e(i))==null?void 0:W.packageDetails)==null?void 0:K.package_name)+"_"+((X=(Q=e(i))==null?void 0:Q.packageDetails)==null?void 0:X.tutormentor_name))})},[t(C,{icon:"ri-download-line",class:"me-2"}),M(" Download TimeSheet ")])]),_:1})]),_:1}),t(ce,null,{default:a(()=>[l("div",{class:"cursor-pointer",onClick:s[3]||(s[3]=z=>V("delete"))},[t(C,{icon:"ri-delete-bin-line",class:"me-2"}),M(" Delete TimeSheet ")])]),_:1})]),_:1})]),_:1})])]}),_:1})),t(A,null,{default:a(()=>[e($)?(y(),S(oe,{key:1},{default:a(()=>[t(w,{md:"7"},{default:a(()=>[t(te,{type:"heading, paragraph, heading, paragraph",class:"mb-3"})]),_:1}),t(w,{md:"5"},{default:a(()=>[t(te,{type:"text@3",color:"#16B1FF",class:"mb-3"}),t(te,{type:"text@3",color:"#91c45e",class:"mb-3"}),t(te,{type:"text@3",color:"#e05e5e",class:"mb-3"})]),_:1})]),_:1})):(y(),S(oe,{key:0,align:"center"},{default:a(()=>[t(w,{md:"7"},{default:a(()=>[l("h4",rt,[t(C,{icon:"ri-user-line",size:"17",class:"me-2"}),M(" Basic Profile ")]),ut,t(be,{density:"compact"},{default:a(()=>{var u,m;return[((u=e(i).clientProfile)==null?void 0:u.length)>1?(y(),R("tbody",ct,[mt,(y(!0),R(De,null,$e(e(i).clientProfile,f=>(y(),R("tr",null,[l("td",null,g(f.client_name),1),l("td",null,g(f.client_school),1),l("td",null,g(f.client_grade<=12?f.client_grade:"Not High School"),1)]))),256))])):((m=e(i).clientProfile)==null?void 0:m.length)==1?(y(),R("tbody",_t,[l("tr",null,[pt,ft,l("td",null,g(e(i).clientProfile[0].client_name),1)]),l("tr",null,[vt,gt,l("td",null,g(e(i).clientProfile[0].client_school),1)]),l("tr",null,[yt,bt,l("td",null,g(e(i).clientProfile[0].client_grade<=12?e(i).clientProfile[0].client_grade:"Not High School"),1)]),l("tr",null,[ht,Vt,l("td",null,g(e(i).clientProfile[0].client_mail),1)])])):Z("",!0)]}),_:1}),l("h4",kt,[t(C,{icon:"ri-bookmark-line",class:"me-2",size:"17"}),M(" Package Details ")]),wt,t(be,{density:"compact"},{default:a(()=>{var u,m,f,q,E,z,G,J,W,K,Q,X;return[l("tbody",null,[l("tr",null,[l("td",xt,g(c.name=="tutoring"?"Program Name":"Engagement Type"),1),Dt,c.name=="tutoring"?(y(),R("td",$t,g((u=e(i).packageDetails)!=null&&u.free_trial?"[TRIAL]":"")+" "+g((m=e(i).packageDetails)==null?void 0:m.program_name),1)):(y(),R("td",Ct,g((f=e(i).packageDetails)==null?void 0:f.engagement_type),1))]),l("tr",null,[Tt,Mt,l("td",null,g((q=e(i).packageDetails)==null?void 0:q.package_type)+" "+g((E=e(i).packageDetails)!=null&&E.package_name?" - "+((z=e(i).packageDetails)==null?void 0:z.package_name):""),1)]),l("tr",null,[St,Ut,l("td",null,g((G=e(i).packageDetails)==null?void 0:G.pic_name),1)]),l("tr",null,[l("td",null,g(c.name=="tutoring"?"Tutor":"Mentor")+" Name",1),Yt,l("td",null,g((J=e(i).packageDetails)==null?void 0:J.tutormentor_name)+" ( Rp. "+g(new Intl.NumberFormat("id-ID").format((W=e(i).packageDetails)==null?void 0:W.tutormentor_fee_hours))+" ) ",1)]),l("tr",null,[l("td",null,"Inhouse "+g(c.name=="tutoring"?"Tutor":"Mentor"),1),Nt,l("td",null,g((K=e(i).packageDetails)==null?void 0:K.inhouse_name),1)]),l("tr",null,[jt,Pt,l("td",null,g(((Q=e(i).editableColumns)==null?void 0:Q.curriculum_name)??"-"),1)]),l("tr",null,[Lt,Ft,l("td",null,g((X=e(i).editableColumns)==null?void 0:X.notes),1)]),l("tr",null,[It,qt,l("td",null,g(e(O)().format("LLL")),1)])])]}),_:1})]),_:1}),t(w,{md:"5"},{default:a(()=>[t(H,{color:"#16B1FF",class:"mb-2 d-flex align-center"},{default:a(()=>[l("div",null,[t(me,null,{default:a(()=>[t(le,{class:"text-white"},{default:a(()=>[M(" Total Minutes of Package ")]),_:1})]),_:1}),t(A,{class:"d-flex justify-between"},{default:a(()=>{var u;return[l("div",At,[l("h1",Rt,g((u=e(i).packageDetails)==null?void 0:u.duration_in_minutes),1),Bt])]}),_:1})]),t(A,null,{default:a(()=>[l("div",Et,[t(C,{icon:"ri-calendar-schedule-line",size:"60"})])]),_:1})]),_:1}),t(H,{color:"#91c45e",class:"mb-2 d-flex align-center"},{default:a(()=>[l("div",null,[t(me,null,{default:a(()=>[t(le,{class:"text-white"},{default:a(()=>[M(" Total Minutes Spent ")]),_:1})]),_:1}),t(A,{class:"d-flex justify-between"},{default:a(()=>{var u;return[l("div",zt,[l("h1",Ot,g((u=e(i).packageDetails)==null?void 0:u.time_spent_in_minutes),1),Ht])]}),_:1})]),t(A,null,{default:a(()=>[l("div",Gt,[t(C,{icon:"ri-timer-flash-line",size:"60",color:"white"})])]),_:1})]),_:1}),t(H,{color:"#e05e5e",class:"mb-2 d-flex align-center"},{default:a(()=>[l("div",null,[t(me,null,{default:a(()=>[t(le,{class:"text-white"},{default:a(()=>[M(" Total Minutes Left ")]),_:1})]),_:1}),t(A,{class:"d-flex justify-between"},{default:a(()=>{var u,m;return[l("div",Jt,[l("h1",Wt,g(((u=e(i).packageDetails)==null?void 0:u.duration_in_minutes)-((m=e(i).packageDetails)==null?void 0:m.time_spent_in_minutes)),1),Kt])]}),_:1})]),t(A,null,{default:a(()=>[l("div",Qt,[t(C,{icon:"ri-timer-2-line",size:"60"})])]),_:1})]),_:1})]),_:1})]),_:1}))]),_:1}),t(se,{modelValue:e(_).edit,"onUpdate:modelValue":s[6]||(s[6]=u=>e(_).edit=u),"max-width":"600",persistent:""},{default:a(()=>{var u;return[t(nt,{item:e(i).editableColumns,package_id:(u=e(i).packageDetails)==null?void 0:u.package_id,id:c.id,"timesheet-type":c.name,onClose:s[4]||(s[4]=m=>V("edit")),onReload:s[5]||(s[5]=m=>k(c.id))},null,8,["item","package_id","id","timesheet-type"])]}),_:1},8,["modelValue"]),t(se,{modelValue:e(_).delete,"onUpdate:modelValue":s[8]||(s[8]=u=>e(_).delete=u),"max-width":"400",persistent:""},{default:a(()=>[t(xe,{title:"timesheet",loading:e($),onDelete:d,onClose:s[7]||(s[7]=u=>V("delete"))},null,8,["loading"])]),_:1},8,["modelValue"]),t(se,{modelValue:e(_).void,"onUpdate:modelValue":s[10]||(s[10]=u=>e(_).void=u),"max-width":"400",persistent:""},{default:a(()=>[t(ot,{timesheet_id:c.id,require:e(i).editableColumns.tutormentor_role,onClose:s[9]||(s[9]=u=>V("void"))},null,8,["timesheet_id","require"])]),_:1},8,["modelValue"])]),_:1})}}},Zt={class:"h-auto position-relative"},el={key:0,class:"overlay"},tl=l("div",{class:"bg-secondary",style:{height:"100%",position:"absolute",left:"0",top:"0","z-index":"9998",width:"100%",opacity:"0.6"}},null,-1),ll={class:"d-flex align-center justify-center",style:{height:"100%",position:"absolute",left:"0",top:"0","z-index":"9999",width:"100%",opacity:"1"}},al={class:"text-center"},sl=l("h2",{class:"text-white mt-3"},"This Timesheet Has Changed Owner",-1),$l={__name:"timesheet-detail",props:{id:Number,name:String},setup(F){const U=F,c=U.id,D=h(!1),o=h(!1);we("reloadData",D),we("updateReload",i=>{D.value=i});const x=i=>{o.value=i};return(i,_)=>(y(),R("div",Zt,[e(o)=="true"?(y(),R("div",el,[tl,l("div",ll,[l("div",al,[t(C,{color:"white",icon:"ri-lock-line",size:"50"}),sl,t(L,{color:"light",class:"mt-4",onClick:_[0]||(_[0]=$=>e(ue).push({path:"/admin/timesheet"+U.name}))},{default:a(()=>[M(" Back to List ")]),_:1})])])])):Z("",!0),t(Xt,{id:e(c),name:U.name,onVoid:x},null,8,["id","name"]),t(it,{id:e(c)},null,8,["id"])]))}};export{$l as default};
