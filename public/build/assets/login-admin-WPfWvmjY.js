import{u as S,c as U,r as m,o as j,J as h,a as M,b as t,w as s,v as B,d as g,A as b,U as V,s as f,e as N,f as p,h as a,i as _,j as D,V as k,k as E}from"./main-oIjuiKWz.js";import{r as w}from"./rules-CkvmYWH-.js";import{l as P}from"./eduall-jXBsxaj5.js";import{a as F,b as I}from"./auth-v1-mask-light--N6hHkxK.js";import{V as J,a as Y,b as q,c as y}from"./VCard-DmEyK9tU.js";import{V as R}from"./VForm-Cf0_ol5u.js";import{V as W,a as $}from"./VRow-CztQ6-gq.js";import"./VAvatar-DNQYbHRv.js";import"./VImg-BHtRBqo1.js";const z={class:"auth-wrapper d-flex align-center justify-center pa-4"},G={class:"d-flex justify-center mb-5"},H=["src"],K=p("h5",{class:"text-h5 font-weight-semibold mb-1"},"Welcome to Timesheet App! 👋🏻",-1),O=p("p",{class:"mb-0"},"Please sign-in to your account and start the adventure",-1),re={__name:"login-admin",props:{email:String,token:String},setup(x){const T=S();U(()=>T.global.name.value==="light"?F:I);const r=x,v=m(),i=m({email:"",password:""}),o=m(!1),u=m(!1),A=async()=>{var e,l;const{valid:n}=await v.value.validate();if(n)try{o.value=!0;const d=await b.post("api/v1/auth/token",i.value);d&&(h.saveToken(d.granted_token),V.saveUser(d),f("success","You`ve successfully login.","bottom-end"),setTimeout(()=>{g.go("/admin/dashboard")},1500)),o.value=!1}catch(d){const c=(l=(e=d.response)==null?void 0:e.data)==null?void 0:l.errors;typeof c=="object"?f("error",c.email||c.password,"bottom-end"):f("error",c,"bottom-end"),o.value=!1}},C=()=>{B().isAuthenticated.value&&g.push("/admin/dashboard")},L=async()=>{o.value=!0;const n="api/v1/auth/token/"+(r==null?void 0:r.email)+"?signature="+r.token;try{const e=await b.get(n);e&&(console.log(e),h.saveToken(e.granted_token),V.saveUser(e),f("success","You`ve successfully login.","bottom-end"),setTimeout(()=>{g.go("/admin/dashboard")},1500))}catch(e){console.log(e)}finally{o.value=!1}};return j(()=>{C(),(r.email||r.token)&&!h.getToken()&&L()}),(n,e)=>(N(),M("div",z,[t(J,{class:"auth-card pa-4 pt-7","max-width":"448"},{default:s(()=>[t(Y,{class:"justify-center"},{default:s(()=>[p("div",G,[p("img",{src:a(P),alt:"Timesheet - EduALL",class:"w-50 text-center"},null,8,H)]),t(q,{class:"font-weight-semibold text-2xl text-uppercase"},{default:s(()=>[_(" Timesheet App ")]),_:1})]),_:1}),t(y,{class:"pt-2 text-center"},{default:s(()=>[K,O]),_:1}),t(y,null,{default:s(()=>[t(R,{onSubmit:D(A,["prevent"]),ref_key:"formData",ref:v,"validate-on":"input","fast-fail":""},{default:s(()=>[t(W,null,{default:s(()=>[t($,{cols:"12"},{default:s(()=>[t(k,{modelValue:a(i).email,"onUpdate:modelValue":e[0]||(e[0]=l=>a(i).email=l),label:"Email",type:"email",class:"mb-3",rules:a(w).email},null,8,["modelValue","rules"]),t(k,{modelValue:a(i).password,"onUpdate:modelValue":e[1]||(e[1]=l=>a(i).password=l),label:"Password",placeholder:"············",type:a(u)?"text":"password","append-inner-icon":a(u)?"ri-eye-off-line":"ri-eye-line","onClick:appendInner":e[2]||(e[2]=l=>u.value=!a(u)),class:"mb-5",rules:a(w).required},null,8,["modelValue","type","append-inner-icon","rules"]),t(E,{block:"",type:"submit",loading:a(o),disabled:a(o)},{default:s(()=>[_(" Login ")]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]))}};export{re as default};
