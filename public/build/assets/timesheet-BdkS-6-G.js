import{r as n,e as se,o as f,f as H,w as s,b as l,Z as ce,u as e,z as D,W as O,j as b,Y,V as x,m as me,A as T,s as W,an as pe,c as U,F as J,ap as _e,l as ge,h as K,a as i,t as V,X as ae,n as oe}from"./main-DT3mfMhh.js";import{r as w}from"./rules-CkvmYWH-.js";import{a as re,c as ve,V as ne,b as fe}from"./VCard-B1WMrmIT.js";import{V as be}from"./VForm-DvMturz9.js";import{V as Q,a as v}from"./VRow-B2kT-fjx.js";import{V as N}from"./VAutocomplete-DMF1pjCM.js";import{V as X}from"./VTooltip-D3Hkf7RW.js";import{V as ye}from"./VTextarea-q7X9F2P8.js";import{d as Ve}from"./debounce-DBbemDoi.js";import{V as ke}from"./VDialog-DkS0_R4d.js";import{a as he,V as xe}from"./VTable-B3ZIPGha.js";import{V as we}from"./VPagination-BrUHuVHi.js";import{V as Te}from"./VBadge-BmXeQjxp.js";import"./VAvatar-s-BwFvum.js";import"./VImg-s-0HfYOy.js";import"./VList-AaW2TqoL.js";import"./ssrBoot-Dt0_NvWe.js";import"./VDivider-BtncAMmF.js";import"./VCheckboxBtn-COx4n_zN.js";import"./VSelectionControl-DVkMG7VE.js";import"./VSlideGroup-Dl8wDpyK.js";const Ce={__name:"program_add_tutoring",emits:["close","reload"],setup(ee,{emit:S}){const L=S,u=n(!1),g=n([]),z=n([]),A=n([]),R=n([]),y=n([]),F=n([]),q=n([]),E=n([]),C=n(!1),k=n("tutor"),Z=n(null),I=n(null),h=n([]),G=n(),a=n({ref_id:null,mentortutor_email:null,subject_id:null,inhouse_id:null,package_id:null,tax:null,individual_fee:null,duration:"",notes:"",pic_id:[],curriculum_id:null}),_=async()=>{var o,m;const r="api/v1/program/list";try{u.value=!0;const t=await T.get(r);t&&(z.value=t),u.value=!1}catch(t){W("error",(m=(o=t.response)==null?void 0:o.data)==null?void 0:m.message,"bottom-end"),console.error(t),u.value=!1}},M=async(r=!1)=>{const o=r?"api/v1/user/mentor-tutors?inhouse=true&role="+k.value:"api/v1/user/mentor-tutors?role="+k.value;try{const m=await T.get(o);m&&(r?E.value=Object.values(m):A.value=m)}catch(m){console.error(m)}},p=async()=>{try{const r=await T.get("api/v1/package/component/list?category="+k.value);r&&(F.value=r)}catch(r){console.error(r)}},B=()=>{const r=a.value.package_id,o=F.value.findIndex(t=>t.id===r);let m=F.value[o];m.detail?(C.value=!0,a.value.duration=m.detail):(C.value=!1,a.value.duration=null)},d=async()=>{try{const r=await T.get("api/v1/user/component/list");r&&(q.value=r)}catch(r){console.error(r)}},$=async(r,o=null,m=0)=>{if(Z.value=m,a.value.tax=(m==1,2.5),a.value.subject_id=null,k.value=="mentor")a.value.subject_id=r[0].subjects[0].id;else try{const t=await T.get("api/v1/user/mentor-tutors/"+o+"/subjects");t&&(y.value=t)}catch(t){console.error(t)}},j=async(r,o,m)=>{if(o)try{const t=await T.get("api/v1/component/fee/"+r+"/"+o+"/"+m);t&&(a.value.individual_fee=t.fee_individual,t.fee_individual?te():I.value=null)}catch(t){console.error(t)}},P=async()=>{try{const r=await T.get("api/v1/curriculum/component/list");r&&(R.value=r)}catch(r){console.error(r)}},ie=async()=>{var o,m,t;a.value.mentortutor_email=g.value.email;const{valid:r}=await G.value.validate();if(r){u.value=!0;try{const c=await T.post("api/v1/timesheet/create",a.value);c&&(W("success",c.message,"bottom-end"),L("reload"),a.value={ref_id:[],mentortutor_email:null,subject_id:null,subject_name:null,inhouse_id:null,package_id:null,duration:"",notes:"",pic_id:[],tax:null,individual_fee:"",curriculum_id:null},g.value=[],window.open("/admin/timesheet/tutoring/"+((o=c.data)==null?void 0:o.timesheet_id),"_blank"))}catch(c){if(console.log(c),(t=(m=c==null?void 0:c.response)==null?void 0:m.data)!=null&&t.errors){const de=c.response.data.errors;W("error",de,"bottom-end")}}finally{L("close"),u.value=!1}}},ue=()=>{a.value={ref_id:h.value.map(r=>r.id),curriculum_id:h.value[0].curriculum??null,package_id:h.value[0].package??null,program_name:h.value[0].program_name??null}},te=()=>{const r=a.value.individual_fee*(1-a.value.tax/100);I.value=Math.trunc(r)},le=()=>{const r=I.value/(1-a.value.tax/100);a.value.individual_fee=Math.trunc(r)};return se(()=>{_(),M(),M(!0),p(),d(),P()}),(r,o)=>{var m;return f(),H(ne,{"max-width":"650","prepend-icon":"ri-send-plane-line",title:((m=e(h)[0])==null?void 0:m.program_name)??"Assign to Tutor"},{default:s(()=>[l(re,null,{default:s(()=>[l(be,{onSubmit:ce(ie,["prevent"]),ref_key:"formData",ref:G,"validate-on":"input"},{default:s(()=>[l(Q,null,{default:s(()=>[l(v,{md:"12",cols:"12"},{default:s(()=>[l(N,{clearable:"",modelValue:e(h),"onUpdate:modelValue":[o[0]||(o[0]=t=>D(h)?h.value=t:null),ue],label:"Mentee Name",items:e(z),"item-props":t=>({title:t.student_name,subtitle:t.program_name+(t.timesheet_id?" ✅":"")+(t.scnd_timesheet_id?" ✅":""),disabled:t.timesheet_id&&t.scnd_timesheet_id,value:{id:t.id,require:t.require,mentee:t.student_name,package:t.package,curriculum:t.curriculum,program_name:t.program_name}}),rules:e(w).required,loading:e(u),disabled:e(u),density:"compact",multiple:""},null,8,["modelValue","items","item-props","rules","loading","disabled"])]),_:1}),l(v,{md:"12",cols:"12"},{default:s(()=>[l(N,{clearable:"",modelValue:e(g),"onUpdate:modelValue":[o[1]||(o[1]=t=>D(g)?g.value=t:null),o[2]||(o[2]=t=>$(e(g).roles,e(g).uuid,e(g).has_npwp))],label:"Tutor Name",items:e(A),"item-props":t=>({title:t.full_name,subtitle:t.roles.map(c=>c.name).join(", ")}),rules:e(w).required,loading:e(u),disabled:e(u),density:"compact"},null,8,["modelValue","items","item-props","rules","loading","disabled"])]),_:1}),l(v,{md:"6",cols:"6"},{default:s(()=>{var t;return[l(N,{clearable:"",modelValue:e(a).curriculum_id,"onUpdate:modelValue":[o[3]||(o[3]=c=>e(a).curriculum_id=c),o[4]||(o[4]=c=>j(e(g).id,e(a).subject_name,e(a).curriculum_id))],label:"Curriculum",items:e(R),"item-props":c=>({title:c.name}),rules:e(w).required,loading:e(u),disabled:e(u)||((t=e(h)[0])==null?void 0:t.curriculum),density:"compact","item-value":"id"},null,8,["modelValue","items","item-props","rules","loading","disabled"])]}),_:1}),l(v,{md:"6",cols:"6"},{default:s(()=>[l(N,{clearable:"",modelValue:e(a).subject_name,"onUpdate:modelValue":[o[5]||(o[5]=t=>e(a).subject_name=t),o[6]||(o[6]=t=>j(e(g).id,e(a).subject_name,e(a).curriculum_id))],label:"Subject Tutoring",items:e(y),loading:e(u),disabled:e(u),rules:e(w).required,density:"compact"},null,8,["modelValue","items","loading","disabled","rules"])]),_:1}),l(v,{md:"8",cols:"8"},{default:s(()=>{var t;return[l(N,{clearable:"",label:"Package",modelValue:e(a).package_id,"onUpdate:modelValue":[o[7]||(o[7]=c=>e(a).package_id=c),B],items:e(F),density:"compact","item-props":c=>({title:c.package!=null?c.type_of+" - "+c.package:c.type_of,subtitle:c.detail?c.detail/60+" Hours":"Customizable"}),"item-value":"id",rules:e(w).required,loading:e(u),disabled:e(u)||((t=e(h)[0])==null?void 0:t.package)},null,8,["modelValue","items","item-props","rules","loading","disabled"])]}),_:1}),l(v,{md:"4",cols:"4"},{default:s(()=>[l(O,{type:"number",clearable:"",label:+e(a).duration/60?"Minutes ("+e(a).duration/60+" Hours)":"Minutes",readonly:e(C),modelValue:e(a).duration,"onUpdate:modelValue":o[8]||(o[8]=t=>e(a).duration=t),density:"compact",rules:e(w).required},null,8,["label","readonly","modelValue","rules"])]),_:1}),l(v,{md:"4",cols:"7"},{default:s(()=>[l(O,{type:"number",clearable:"",label:"Fee/hours (Nett)",modelValue:e(I),"onUpdate:modelValue":[o[9]||(o[9]=t=>D(I)?I.value=t:null),le],density:"compact",rules:e(w).required},null,8,["modelValue","rules"])]),_:1}),l(v,{md:"4",cols:"5"},{default:s(()=>[l(O,{type:"number",clearable:"",label:"Tax",modelValue:e(a).tax,"onUpdate:modelValue":[o[10]||(o[10]=t=>e(a).tax=t),le],rules:e(w).required,density:"compact"},null,8,["modelValue","rules"])]),_:1}),l(v,{md:"4",cols:"12"},{default:s(()=>[l(X,{activator:"parent",location:"top"},{default:s(()=>[b(" Fee Gross is automatically calculated based on the entered Net Fee and Tax Rate. ")]),_:1}),l(O,{type:"number",clearable:"",label:"Fee/hours (Gross)",modelValue:e(a).individual_fee,"onUpdate:modelValue":[o[11]||(o[11]=t=>e(a).individual_fee=t),te],density:"compact",readonly:"",rules:e(w).required},null,8,["modelValue","rules"])]),_:1}),l(v,{md:"6",cols:"6"},{default:s(()=>[l(N,{clearable:"",modelValue:e(a).inhouse_id,"onUpdate:modelValue":o[12]||(o[12]=t=>e(a).inhouse_id=t),label:"Inhouse Mentor/Tutor",items:e(E),density:"compact","item-props":t=>({title:t.full_name}),"item-value":"uuid",loading:e(u),disabled:e(u),rules:e(w).required},null,8,["modelValue","items","item-props","loading","disabled","rules"])]),_:1}),l(v,{md:"6",cols:"6"},{default:s(()=>[l(N,{multiple:"",clearable:"",chips:"",label:"PIC",modelValue:e(a).pic_id,"onUpdate:modelValue":o[13]||(o[13]=t=>e(a).pic_id=t),items:e(q),"item-title":"full_name","item-value":"id",loading:e(u),density:"compact",disabled:e(u),rules:e(w).required},null,8,["modelValue","items","loading","disabled","rules"])]),_:1}),l(v,{md:"12"},{default:s(()=>[l(ye,{label:"Notes",modelValue:e(a).notes,"onUpdate:modelValue":o[14]||(o[14]=t=>e(a).notes=t),density:"compact"},null,8,["modelValue"])]),_:1})]),_:1}),l(ve,{class:"mt-5 px-0"},{default:s(()=>[l(Y,{variant:"tonal",color:"error",type:"button",onClick:o[15]||(o[15]=t=>L("close"))},{default:s(()=>[l(x,{icon:"ri-close-line",class:"me-3"}),b(" Close ")]),_:1}),l(me),l(Y,{variant:"tonal",color:"success",type:"submit"},{default:s(()=>[b(" Save "),l(x,{icon:"ri-save-line",class:"ms-3"})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1},8,["title"])}}},je=i("div",{class:"d-flex justify-between align-center"},[i("div",{class:"w-100"},[i("h4",null,"Timesheet List")])],-1),Pe={class:"d-flex gap-2"},Ue={key:0},Ne=i("th",{class:"text-uppercase",width:"1%"}," No ",-1),Se=i("th",{class:"text-uppercase text-center"},"School/Student Name",-1),qe={class:"text-uppercase text-center"},Ie=i("th",{class:"text-uppercase text-center"},"Package",-1),Fe=i("th",{class:"text-uppercase text-center"},"Tutor/Mentor",-1),Me=i("th",{class:"text-uppercase text-center"},"PIC",-1),$e=i("th",{class:"text-uppercase text-center"},"Total Hours",-1),De=i("th",{class:"text-uppercase text-center"},"Used",-1),Ae=i("th",{class:"text-uppercase text-center"},"#",-1),Re=["onClick"],Be={key:0},He={key:1},Le={class:"text-start"},ze={class:"text-left"},Ee={class:"text-left"},Ge={class:"text-left"},Oe={class:"text-left"},We={key:0},Xe=i("tr",null,[i("td",{colspan:"9",class:"text-center"}," Sorry, no data found. ")],-1),Ye=[Xe],Ze={class:"d-flex justify-center mt-5"},bt={__name:"timesheet",props:{name:String},setup(ee){const S=ee,L=_e();n([]);const u=n(!1),g=n(1),z=n(),A=n(),R=n([]),y=n(!1),F=n([]),q=n(),E=n([]),C=n(),k=async()=>{var $,j;const a="?page="+g.value,_=A.value?"&keyword="+A.value:"",M=q.value?"&program_name="+encodeURIComponent(q.value):"",p=C.value?"&package_id="+C.value:"",B="&paginate=true",d=S.name!="tutoring"?"&is_subject_specialist=true":"";try{y.value=!0;const P=await T.get("api/v1/timesheet/list"+a+_+M+p+B+d);P&&(g.value=P.current_page,z.value=P.last_page,R.value=P),y.value=!1}catch(P){W("error",(j=($=P.response)==null?void 0:$.data)==null?void 0:j.message,"bottom-end"),console.error(P),y.value=!1}},Z=async()=>{try{const a=await T.get("api/v1/program/component/list");a&&(F.value=a)}catch(a){console.error(a)}},I=async()=>{try{const a=await T.get("api/v1/package/component/list");a&&(E.value=a)}catch(a){console.error(a)}},h=Ve(async a=>{g.value=1,A.value=a.target.value,await k()},1e3),G=a=>{const _=L.resolve("/admin/timesheet/"+S.name+"/"+a);window.open(_.href,"_blank")};return pe(()=>{k()}),se(()=>{k(),Z(),I()}),(a,_)=>{const M=ge("VText");return f(),U(J,null,[l(ke,{modelValue:e(u),"onUpdate:modelValue":_[1]||(_[1]=p=>D(u)?u.value=p:null),width:"auto",persistent:""},{default:s(()=>[l(Ce,{onClose:_[0]||(_[0]=p=>u.value=!1),onReload:k})]),_:1},8,["modelValue"]),l(ne,null,{default:s(()=>[l(fe,null,{default:s(()=>[je]),_:1}),l(re,null,{default:s(()=>[l(Q,{class:"my-1 justify-space-between"},{default:s(()=>[S.name=="tutoring"?(f(),H(v,{key:0,cols:"12",md:"6"},{default:s(()=>[l(Q,null,{default:s(()=>[l(v,{cols:"12",md:"6"},{default:s(()=>[l(N,{density:"compact",clearable:"",modelValue:e(q),"onUpdate:modelValue":[_[2]||(_[2]=p=>D(q)?q.value=p:null),k],label:"Program Name",items:e(F),"item-title":"program_name",placeholder:"Select Program Name",loading:e(y),disabled:e(y)},null,8,["modelValue","items","loading","disabled"])]),_:1}),l(v,{cols:"12",md:"6"},{default:s(()=>[l(N,{density:"compact",clearable:"true",modelValue:e(C),"onUpdate:modelValue":[_[3]||(_[3]=p=>D(C)?C.value=p:null),k],label:"Package",items:e(E),"item-props":p=>({title:p.package!=null?p.type_of+" - "+p.package:p.type_of}),"item-value":"id",placeholder:"Select Package",loading:e(y),disabled:e(y)},null,8,["modelValue","items","item-props","loading","disabled"])]),_:1})]),_:1})]),_:1})):K("",!0),l(v,{cols:"12",md:"3"},{default:s(()=>[i("div",Pe,[l(O,{density:"compact",loading:e(y),disabled:e(y),"append-inner-icon":"ri-search-line",label:"Search","hide-details":"","single-line":"",onInput:e(h)},null,8,["loading","disabled","onInput"]),S.name=="tutoring"?(f(),U("div",Ue,[l(X,{activator:"parent",location:"start"},{default:s(()=>[b("Add New Timesheet")]),_:1}),l(Y,{icon:"ri-add-line",onClick:_[4]||(_[4]=p=>u.value=!0)})])):K("",!0)])]),_:1})]),_:1}),e(y)?(f(),H(xe,{key:0,class:"mx-auto border",type:"table-thead, table-row@10"})):(f(),H(he,{key:1,class:"text-no-wrap",hover:""},{default:s(()=>{var p,B;return[i("thead",null,[i("tr",null,[Ne,Se,i("th",qe,V(S.name=="tutoring"?"Program Name":"Engagement Type"),1),Ie,Fe,Me,$e,De,Ae])]),i("tbody",null,[(f(!0),U(J,null,ae(e(R).data,(d,$)=>(f(),U("tr",{key:$,class:oe([d.void=="true"?"bg-secondary":"","cursor-pointer"]),onClick:j=>G(d.id)},[i("td",null,V(parseInt($)+1),1),i("td",{class:oe(d.group?"cursor-pointer text-left":"text-left")},[d.group?(f(),H(M,{key:0},{default:s(()=>[l(x,{icon:"ri-group-line",class:"me-3"}),b(" "+V(d.clients[0])+" ",1),l(Te,{color:"error",content:d.clients.length-1+"+",inline:""},null,8,["content"]),l(X,{activator:"parent",location:"top",transition:"scroll-y-transition",class:"bg-white"},{default:s(()=>[(f(!0),U(J,null,ae(d.clients,j=>(f(),U("div",null,V(j),1))),256))]),_:2},1024)]),_:2},1024)):(f(),H(M,{key:1},{default:s(()=>[l(x,{icon:"ri-user-line",class:"me-3"}),b(" "+V(d.clients),1)]),_:2},1024))],2),S.name=="tutoring"?(f(),U("td",Be,[l(x,{icon:"ri-bookmark-3-line",class:"me-3"}),b(" "+V(d.detail_package=="Trial"?"[TRIAL]":"")+" "+V(d.program_name),1)])):(f(),U("td",He,[l(x,{icon:"ri-bookmark-3-line",class:"me-3"}),b(" "+V(d.engagement_type),1)])),i("td",Le,[l(x,{icon:"ri-bookmark-line",class:"me-3"}),b(" "+V(d.detail_package?d.package_type+" - "+d.detail_package:d.package_type),1)]),i("td",ze,[l(x,{icon:"ri-user-line",class:"me-3"}),b(" "+V(d.tutor_mentor),1)]),i("td",Ee,[l(x,{icon:"ri-user-line",class:"cursor-pointer me-3"}),b(" "+V(d.admin),1)]),i("td",Ge,[l(x,{icon:"ri-calendar-schedule-line",class:"cursor-pointer me-3"}),b(" "+V(d.duration/60)+" Hours ",1)]),i("td",Oe,[l(x,{icon:"ri-timer-2-line",class:"cursor-pointer me-3"}),b(" "+V(d.spent/60)+" Hours ",1)]),i("td",null,[l(Y,{color:d.void=="true"?"light":"secondary",onClick:j=>G(d.id)},{default:s(()=>[l(x,{icon:"ri-timeline-view",class:"cursor-pointer"}),l(X,{activator:"parent",location:"top",transition:"scroll-y-transition"},{default:s(()=>[b(" View Detail ")]),_:1})]),_:2},1032,["color","onClick"])])],10,Re))),128))]),((B=(p=e(R))==null?void 0:p.data)==null?void 0:B.length)==0?(f(),U("tfoot",We,Ye)):K("",!0)]}),_:1})),i("div",Ze,[l(we,{modelValue:e(g),"onUpdate:modelValue":[_[5]||(_[5]=p=>D(g)?g.value=p:null),k],length:e(z),"total-visible":4,color:"primary","show-first-last-page":!1},null,8,["modelValue","length"])])]),_:1})]),_:1})],64)}}};export{bt as default};
