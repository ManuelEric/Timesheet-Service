import{r as c,o as pe,e as m,p as P,w as a,b as l,h as e,a as h,f as i,t as y,F as H,a0 as te,q as G,j as ye,H as z,i as k,l as U,W as ke,k as le,V as K,z as Ve,s as Q,A as q,a1 as Te,a3 as $e,y as Se,n as me}from"./main-C4jd8X9w.js";import{r as T}from"./rules-CkvmYWH-.js";import{A as ge}from"./ApiServiceCRM-BJNba4R8.js";import{c as ne,V as ie,d as he,b as Ue}from"./VCard-DoQXPR2Y.js";import{V as xe}from"./VForm-DShyo-Xo.js";import{V as de,a as g}from"./VRow-D3prF08I.js";import{V as j}from"./VAutocomplete-DgFvRm4q.js";import{V as _e}from"./VDialog-CQAJBi7x.js";import{V as X}from"./VTooltip-c8ktYnZR.js";import{a as fe,V as qe}from"./VTable-CBHtl7Rw.js";import{V as we}from"./VTextarea-B51m0Mnu.js";import{d as Pe}from"./debounce-Bnwuv8Yx.js";import{V as je}from"./VPagination-rAnLl25g.js";import{V as ve}from"./VBadge-BAXw0BL1.js";import"./VAvatar-C6AtTOjc.js";import"./VImg-CbWWs8Rw.js";import"./VList-ZKARXVzO.js";import"./ssrBoot-CVbbZS7S.js";import"./VDivider-L7MNpkjT.js";import"./VCheckboxBtn-Dvh9gbK8.js";import"./VSelectionControl-DVJ2CNSF.js";import"./VSlideGroup-DgmZ8MOO.js";const Ie={key:0,class:"mb-4 d-flex gap-1"},Fe={class:"text-sm"},Ne={class:"d-flex justify-between align-center mb-3"},De=i("h4",{class:"w-100"},"Detail of Active Agreement",-1),Me=i("thead",null,[i("tr",null,[i("th",{class:"text-left",nowrap:""}," Engagement Type "),i("th",{nowrap:""},"Stream"),i("th",{nowrap:""},"Package"),i("th",{nowrap:""},"Fee Individual - Gross")])],-1),Ae={nowrap:""},Re=["href"],Ee={nowrap:""},He={nowrap:""},Ge={nowrap:""},be="mentor",ze={__name:"program_add_specialist_timesheet",emits:["close","reload"],setup(ce,{emit:D}){const B=D,d=c(!1),p=c(null),Y=c([]),L=c([]),W=c([]),$=c(null),M=c([]),R=c([]),Z=c([]),I=c(!1),C=c(null),se=c([]),F=c(),s=c({ref_details:[],mentortutor_email:null,subject_id:null,inhouse_id:null,package_id:null,duration:"",tax:2.5,individual_fee:null,notes:"",pic_id:[]}),ae=async()=>{const _="get/active/mentees/global";try{const u=await ge.get(_);u&&(L.value=u)}catch(u){console.error(u)}},n=async()=>{var u,S;const _="external-mentor/streams";try{d.value=!0;const r=await ge.get(_);r&&(W.value=r),d.value=!1}catch(r){Q("error",(S=(u=r.response)==null?void 0:u.data)==null?void 0:S.message,"bottom-end"),console.error(r),d.value=!1}},x=async(_=!1)=>{const S=_?"api/v1/user/mentor-tutors?inhouse=true&role="+be:"api/v1/user/mentor-tutors?role="+"External Mentor";try{const r=await q.get(S);r&&(_?Z.value=Object.values(r):Y.value=r)}catch(r){console.error(r)}},O=async()=>{try{const _=await q.get("api/v1/package/component/list?category="+be);_&&(M.value=_)}catch(_){console.error(_)}},V=async(_,u,S,r)=>{try{const t=await q.get("api/v1/component/fee/ext-mentor/"+_+"/"+u+"/"+S+"/"+r);t&&(s.value.individual_fee=t.fee_individual,s.value.individual_fee?A():C.value=null)}catch(t){s.value.individual_fee=null,C.value=null,Q("error","We're sorry, but we couldn't find a tutor fee for the selected curriculum and subject. This may be outside the scope of our current agreement. Please reach out to our HR team for assistance or to explore available options","bottom-end"),console.error(t)}ee()},ee=()=>{const _=s.value.package_id,u=M.value.findIndex(r=>r.id===_);let S=M.value[u];S.detail?(I.value=!0,s.value.duration=S.detail):(I.value=!1,s.value.duration=null)},v=async()=>{try{const _=await q.get("api/v1/user/component/list");_&&(R.value=_)}catch(_){console.error(_)}},J=async()=>{try{const _=await q.get("api/v1/engagement-type/component/list");_&&(se.value=_)}catch(_){console.log(_)}},E=async()=>{var u,S,r;s.value.mentortutor_email=p.value.email;const{valid:_}=await F.value.validate();if(_){d.value=!0;try{const t=await q.post("api/v1/timesheet/create/skip-request",s.value);t&&(Q("success",t.message,"bottom-end"),B("reload"),s.value={ref_details:[],mentortutor_email:null,subject_id:null,subject_name:null,inhouse_id:null,package_id:null,duration:"",notes:"",pic_id:[],tax:null,individual_fee:""},p.value=[],window.open("/admin/timesheet/specialist/"+((u=t.data)==null?void 0:u.timesheet_id),"_blank"))}catch(t){if((r=(S=t==null?void 0:t.response)==null?void 0:S.data)!=null&&r.errors){const f=t.response.data.errors;Q("error",f,"bottom-end")}}finally{B("close"),d.value=!1}}},A=()=>{const _=s.value.individual_fee*(1-s.value.tax/100);C.value=Math.trunc(_)},ue=()=>{const _=C.value/(1-s.value.tax/100);s.value.individual_fee=Math.trunc(_)};return pe(()=>{n(),ae(),J(),x(),x(!0),O(),v()}),(_,u)=>(m(),P(ie,{"max-width":"650","prepend-icon":"ri-send-plane-line",title:"Assign to Subject Specialist"},{default:a(()=>[l(ne,null,{default:a(()=>{var S,r;return[((S=e(s).ref_details)==null?void 0:S.length)>0?(m(),h("div",Ie,[i("p",Fe,y(((r=e(s).ref_details)==null?void 0:r.length)>1?"Students":"Student")+":",1),(m(!0),h(H,null,te(e(s).ref_details,t=>(m(),h("p",{key:t,class:"text-sm bg-info px-2 rounded"},y(t.student_first_name+" "+t.student_last_name),1))),128))])):G("",!0),l(xe,{onSubmit:ye(E,["prevent"]),ref_key:"formData",ref:F,"validate-on":"input"},{default:a(()=>[l(de,null,{default:a(()=>[l(g,{cols:"12"},{default:a(()=>[l(j,{clearable:"",modelValue:e(s).engagement_type,"onUpdate:modelValue":[u[0]||(u[0]=t=>e(s).engagement_type=t),u[1]||(u[1]=()=>(e(s).ref_details=[],p.value=null,$.value=null,e(s).package_id=null))],items:e(se),"item-props":t=>({title:t.name}),"item-value":"id",label:"Engagement Type",rules:e(T).required,loading:e(d),disabled:e(d)},null,8,["modelValue","items","item-props","rules","loading","disabled"])]),_:1}),l(g,{md:"12",cols:"12"},{default:a(()=>[l(j,{clearable:"",modelValue:e(s).ref_details,"onUpdate:modelValue":u[2]||(u[2]=t=>e(s).ref_details=t),label:"Mentee Name",items:e(L),"item-props":t=>({title:t.first_name+" "+t.last_name,subtitle:t.sch_name,value:{clientprog_id:t.clientprog_id,invoice_id:t.invoice_id,student_uuid:t.id,student_first_name:t.first_name,student_last_name:t.last_name,student_school:t.sch_name,student_grade:t.grade,program_name:t.program_name,require:t.require,package:t.package,curriculum:t.curriculum,engagement_type:e(s).engagement_type}}),rules:e(T).required,loading:e(d),disabled:e(d),density:"compact",multiple:""},null,8,["modelValue","items","item-props","rules","loading","disabled"])]),_:1}),l(g,{md:"6",cols:e(p)?11:12},{default:a(()=>[l(j,{density:"compact",clearable:"",modelValue:e(p),"onUpdate:modelValue":u[3]||(u[3]=t=>z(p)?p.value=t:null),label:"Subject Specialist Name",items:e(Y),"item-props":t=>({title:t.full_name,subtitle:t.roles.map(f=>f.name).join(", ")}),rules:e(T).required,loading:e(d),disabled:e(d)},null,8,["modelValue","items","item-props","rules","loading","disabled"])]),_:1},8,["cols"]),e(p)?(m(),P(g,{key:0,cols:"1"},{default:a(()=>[l(_e,{"max-width":"600"},{activator:a(({props:t})=>[l(X,{activator:"parent",location:"end"},{default:a(()=>[k("Fee Detail")]),_:1}),l(U,ke({icon:"ri-folder-info-line",class:"cursor-pointer mt-3"},t),null,16)]),default:a(({isActive:t})=>[l(ie,null,{default:a(()=>[l(ne,{class:"py-5"},{default:a(()=>{var f;return[i("div",Ne,[De,l(le,{size:"x-small",color:"secondary",icon:"ri-close-line",onClick:b=>t.value=!1},null,8,["onClick"])]),((f=e(p))==null?void 0:f.roles.findIndex(b=>b.name==="External Mentor"))>=0?(m(),P(fe,{key:0,density:"compact"},{default:a(()=>[Me,i("tbody",null,[(m(!0),h(H,null,te(e(p).roles,(b,w)=>(m(),h(H,{key:w},[b.name=="External Mentor"?(m(!0),h(H,{key:0},te(b.subjects,o=>(m(),h("tr",{key:o},[i("td",Ae,[k(y(o.engagement_type_name??"-")+" ",1),o.agreement?(m(),h("a",{key:0,href:o.agreement,target:"_blank",class:"ms-2 d-inline cursor-pointer"},[l(X,{activator:"parent",location:"end"},{default:a(()=>[k(" Check Agreement ")]),_:1}),l(U,{icon:"ri-file-pdf-2-line"})],8,Re)):G("",!0)]),i("td",Ee,y(o.stream??"-"),1),i("td",He,y(o.package_name??"-"),1),i("td",Ge," Rp. "+y(new Intl.NumberFormat("id-ID").format(o.fee_individual)),1)]))),128)):G("",!0)],64))),128))])]),_:1})):(m(),P(ne,{key:1,class:"text-center"},{default:a(()=>[k(" There is no tutoring subject ")]),_:1}))]}),_:2},1024)]),_:2},1024)]),_:1})]),_:1})):G("",!0),l(g,{md:e(p)?5:6,cols:"12"},{default:a(()=>[l(j,{density:"compact",clearable:"",label:"Stream",modelValue:e($),"onUpdate:modelValue":u[4]||(u[4]=t=>z($)?$.value=t:null),items:e(W),"item-title":"stream_name","item-value":"stream_name",loading:e(d),disabled:e(d)},null,8,["modelValue","items","loading","disabled"])]),_:1},8,["md"]),l(g,{md:"8",cols:"8"},{default:a(()=>[l(j,{density:"compact",clearable:"",label:"Package",modelValue:e(s).package_id,"onUpdate:modelValue":[u[5]||(u[5]=t=>e(s).package_id=t),u[6]||(u[6]=t=>V(e(p).id,e($),e(s).engagement_type,e(s).package_id))],items:e(M),"item-props":t=>({title:t.package!=null?t.type_of+" - "+t.package:t.type_of,subtitle:t.detail?t.detail/60+" Hours":"Customizable"}),"item-value":"id",rules:e(T).required,loading:e(d),disabled:e(d)},null,8,["modelValue","items","item-props","rules","loading","disabled"])]),_:1}),l(g,{md:"4",cols:"4"},{default:a(()=>[l(K,{density:"compact",type:"number",clearable:"",label:+e(s).duration/60?""+e(s).duration/60+" Hours":"Minutes",readonly:e(I),modelValue:e(s).duration,"onUpdate:modelValue":u[7]||(u[7]=t=>e(s).duration=t),rules:e(T).required},null,8,["label","readonly","modelValue","rules"])]),_:1}),l(g,{md:"4",cols:"7"},{default:a(()=>[l(K,{type:"number",clearable:"",label:"Fee/hours (Nett)",modelValue:e(C),"onUpdate:modelValue":[u[8]||(u[8]=t=>z(C)?C.value=t:null),ue],density:"compact",rules:e(T).required,readonly:""},null,8,["modelValue","rules"])]),_:1}),l(g,{md:"4",cols:"5"},{default:a(()=>[l(K,{type:"number",clearable:"",label:"Tax",modelValue:e(s).tax,"onUpdate:modelValue":[u[9]||(u[9]=t=>e(s).tax=t),ue],rules:e(T).required,density:"compact",readonly:""},null,8,["modelValue","rules"])]),_:1}),l(g,{md:"4",cols:"12"},{default:a(()=>[l(X,{activator:"parent",location:"top"},{default:a(()=>[k(" Fee Gross is automatically calculated based on the entered Net Fee and Tax Rate. ")]),_:1}),l(K,{type:"number",clearable:"",label:"Fee/hours (Gross)",modelValue:e(s).individual_fee,"onUpdate:modelValue":[u[10]||(u[10]=t=>e(s).individual_fee=t),A],density:"compact",readonly:"",rules:e(T).required},null,8,["modelValue","rules"])]),_:1}),l(g,{md:"6",cols:"12"},{default:a(()=>[l(j,{density:"compact",clearable:"",modelValue:e(s).inhouse_id,"onUpdate:modelValue":u[11]||(u[11]=t=>e(s).inhouse_id=t),label:"Inhouse Mentor",items:e(Z),"item-props":t=>({title:t.full_name}),"item-value":"uuid",loading:e(d),disabled:e(d),rules:e(T).required},null,8,["modelValue","items","item-props","loading","disabled","rules"])]),_:1}),l(g,{md:"6",cols:"12"},{default:a(()=>[l(j,{density:"compact",multiple:"",clearable:"",chips:"",label:"PIC",modelValue:e(s).pic_id,"onUpdate:modelValue":u[12]||(u[12]=t=>e(s).pic_id=t),items:e(R),"item-title":"full_name","item-value":"id",loading:e(d),disabled:e(d),rules:e(T).required},null,8,["modelValue","items","loading","disabled","rules"])]),_:1}),l(g,{md:"12"},{default:a(()=>[l(we,{label:"Notes",modelValue:e(s).notes,"onUpdate:modelValue":u[13]||(u[13]=t=>e(s).notes=t)},null,8,["modelValue"])]),_:1})]),_:1}),l(he,{class:"mt-5 px-0"},{default:a(()=>[l(le,{variant:"tonal",color:"error",type:"button",onClick:u[14]||(u[14]=t=>B("close"))},{default:a(()=>[l(U,{icon:"ri-close-line",class:"me-3"}),k(" Close ")]),_:1}),l(Ve),l(le,{variant:"tonal",color:"success",type:"submit"},{default:a(()=>[k(" Save "),l(U,{icon:"ri-save-line",class:"ms-3"})]),_:1})]),_:1})]),_:1},512)]}),_:1})]),_:1}))}},Be={key:0,class:"mb-4 d-flex gap-1"},Le={class:"text-sm"},We={class:"d-flex justify-between align-center mb-3"},Oe=i("h4",{class:"w-100"},"Detail of Active Agreement",-1),Je=i("thead",null,[i("tr",null,[i("th",{class:"text-left",nowrap:""}," Curriculum "),i("th",{nowrap:""},"Subject Tutoring"),i("th",{nowrap:""},"Grade"),i("th",{nowrap:""},"Fee Individual - Gross")])],-1),Ke={nowrap:""},Qe=["href"],Xe={nowrap:""},Ye={nowrap:""},Ze={nowrap:""},et={__name:"program_add_tutoring",emits:["close","reload"],setup(ce,{emit:D}){const B=D,d=c(!1),p=c(null),Y=c([]),L=c([]),W=c([]),$=c([]),M=c([]),R=c([]),Z=c([]),I=c(!1),C=c("tutor"),se=c(null),F=c(null),s=c([]),ae=c(),n=c({ref_id:null,mentortutor_email:null,subject_id:null,inhouse_id:null,package_id:null,tax:null,individual_fee:null,duration:"",notes:"",pic_id:[],curriculum_id:null}),x=async()=>{var t,f;const r="api/v1/program/list?require=tutor";try{d.value=!0;const b=await q.get(r);b&&(Y.value=b),d.value=!1}catch(b){Q("error",(f=(t=b.response)==null?void 0:t.data)==null?void 0:f.message,"bottom-end"),console.error(b),d.value=!1}},O=async(r=!1)=>{const t=r?"api/v1/user/mentor-tutors?inhouse=true&role="+C.value:"api/v1/user/mentor-tutors?role="+C.value;try{const f=await q.get(t);f&&(r?Z.value=Object.values(f):L.value=f)}catch(f){console.error(f)}},V=async()=>{try{const r=await q.get("api/v1/package/component/list?category="+C.value);r&&(M.value=r)}catch(r){console.error(r)}},ee=()=>{const r=n.value.package_id,t=M.value.findIndex(b=>b.id===r);let f=M.value[t];f.detail?(I.value=!0,n.value.duration=f.detail):(I.value=!1,n.value.duration=null)},v=async()=>{try{const r=await q.get("api/v1/user/component/list");r&&(R.value=r)}catch(r){console.error(r)}},J=async(r,t=null,f=0)=>{se.value=f,n.value.tax=(f==1,2.5),n.value.subject_id=null,n.value.subject_name=null,n.value.individual_fee=null,F.value=null;const b=n.value.curriculum_id?"/"+n.value.curriculum_id:"";try{const w=await q.get("api/v1/user/mentor-tutors/"+t+"/subjects"+b);w&&($.value=w)}catch(w){console.error(w)}},E=async(r,t,f)=>{var w;const b=(w=s.value[0])==null?void 0:w.grade;if(t)try{const o=await q.get("api/v1/component/fee/tutor/"+r+"/"+t+"/"+f+"/"+b);o&&(n.value.individual_fee=s.value.length>1?o.fee_group:o.fee_individual,n.value.individual_fee?u():F.value=null)}catch(o){Q("error","We're sorry, but we couldn't find a tutor fee for the selected curriculum and subject. This may be outside the scope of our current agreement. Please reach out to our HR team for assistance or to explore available options","bottom-end"),console.error(o)}else n.value.individual_fee=null,F.value=null},A=async()=>{try{const r=await q.get("api/v1/curriculum/component/list");r&&(W.value=r)}catch(r){console.error(r)}},ue=async()=>{var t,f,b;n.value.mentortutor_email=p.value.email;const{valid:r}=await ae.value.validate();if(r){d.value=!0;try{const w=await q.post("api/v1/timesheet/create",n.value);w&&(Q("success",w.message,"bottom-end"),B("reload"),n.value={ref_id:[],mentortutor_email:null,subject_id:null,subject_name:null,inhouse_id:null,package_id:null,duration:"",notes:"",pic_id:[],tax:null,individual_fee:"",curriculum_id:null},p.value=null,window.open("/admin/timesheet/tutoring/"+((t=w.data)==null?void 0:t.timesheet_id),"_blank"))}catch(w){if(console.log(w),(b=(f=w==null?void 0:w.response)==null?void 0:f.data)!=null&&b.errors){const o=w.response.data.errors;Q("error",o,"bottom-end")}}finally{B("close"),d.value=!1}}},_=()=>{var r,t,f;n.value={ref_id:s.value.map(b=>b.id),curriculum_id:((r=s.value[0])==null?void 0:r.curriculum)??null,package_id:((t=s.value[0])==null?void 0:t.package)??null,program_name:((f=s.value[0])==null?void 0:f.program_name)??null}},u=()=>{const r=n.value.individual_fee*(1-n.value.tax/100);F.value=Math.trunc(r)},S=()=>{const r=F.value/(1-n.value.tax/100);n.value.individual_fee=Math.trunc(r)};return pe(()=>{x(),O(),O(!0),V(),v(),A()}),(r,t)=>{var f;return m(),P(ie,{"max-width":"650","prepend-icon":"ri-send-plane-line",title:((f=e(s)[0])==null?void 0:f.program_name)??"Assign to Tutor"},{default:a(()=>[l(ne,null,{default:a(()=>{var b,w;return[((b=e(s))==null?void 0:b.length)>0?(m(),h("div",Be,[i("p",Le,y(((w=e(s))==null?void 0:w.length)>1?"Students":"Student")+":",1),(m(!0),h(H,null,te(e(s),o=>(m(),h("p",{key:o,class:"text-sm bg-info px-2 rounded"},y(o.mentee),1))),128))])):G("",!0),l(xe,{onSubmit:ye(ue,["prevent"]),ref_key:"formData",ref:ae,"validate-on":"input"},{default:a(()=>[l(de,null,{default:a(()=>[l(g,{md:"12",cols:"12"},{default:a(()=>[l(j,{clearable:"",modelValue:e(s),"onUpdate:modelValue":[t[0]||(t[0]=o=>z(s)?s.value=o:null),_],label:"Student Name",items:e(Y),"item-props":o=>({title:o.student_name,subtitle:o.program_name+(o.timesheet_id?" ✅":"")+(o.scnd_timesheet_id?" ✅":""),disabled:o.timesheet_id&&o.scnd_timesheet_id,value:{id:o.id,require:o.require,mentee:o.student_name,package:o.package,curriculum:o.curriculum,program_name:o.program_name,grade:o.student_grade}}),rules:e(T).required,loading:e(d),disabled:e(d),density:"compact",multiple:""},null,8,["modelValue","items","item-props","rules","loading","disabled"])]),_:1}),l(g,{cols:e(p)?11:12},{default:a(()=>[l(j,{clearable:"",modelValue:e(p),"onUpdate:modelValue":[t[1]||(t[1]=o=>z(p)?p.value=o:null),t[2]||(t[2]=o=>J(e(p).roles,e(p).uuid,e(p).has_npwp))],label:"Tutor Name",items:e(L),"item-props":o=>({title:o.full_name,subtitle:o.roles.map(N=>N.name).join(", ")}),rules:e(T).required,loading:e(d),disabled:e(d),density:"compact"},null,8,["modelValue","items","item-props","rules","loading","disabled"])]),_:1},8,["cols"]),e(p)?(m(),P(g,{key:0,cols:"1"},{default:a(()=>[l(_e,{"max-width":"600"},{activator:a(({props:o})=>[l(X,{activator:"parent",location:"end"},{default:a(()=>[k("Fee Detail")]),_:1}),l(U,ke({icon:"ri-folder-info-line",class:"cursor-pointer mt-3"},o),null,16)]),default:a(({isActive:o})=>[l(ie,null,{default:a(()=>[l(ne,{class:"py-5"},{default:a(()=>{var N;return[i("div",We,[Oe,l(le,{size:"x-small",color:"secondary",icon:"ri-close-line",onClick:re=>o.value=!1},null,8,["onClick"])]),((N=e(p))==null?void 0:N.roles.findIndex(re=>re.name==="Tutor"))>=0?(m(),P(fe,{key:0,density:"compact"},{default:a(()=>[Je,i("tbody",null,[(m(!0),h(H,null,te(e(p).roles,(re,Ce)=>(m(),h(H,{key:Ce},[re.name=="Tutor"?(m(!0),h(H,{key:0},te(re.subjects,oe=>(m(),h("tr",{key:oe},[i("td",Ke,[k(y(oe.curriculum_name??"-")+" ",1),oe.agreement?(m(),h("a",{key:0,href:oe.agreement,target:"_blank",class:"ms-2 d-inline cursor-pointer"},[l(X,{activator:"parent",location:"end"},{default:a(()=>[k(" Check Agreement ")]),_:1}),l(U,{icon:"ri-file-pdf-2-line"})],8,Qe)):G("",!0)]),i("td",Xe,y(oe.tutor_subject??"-"),1),i("td",Ye,y(oe.grade??"-"),1),i("td",Ze,"Rp. "+y(new Intl.NumberFormat("id-ID").format(oe.fee_individual)),1)]))),128)):G("",!0)],64))),128))])]),_:1})):(m(),P(ne,{key:1,class:"text-center"},{default:a(()=>[k(" There is no tutoring subject ")]),_:1}))]}),_:2},1024)]),_:2},1024)]),_:1})]),_:1})):G("",!0),l(g,{md:"6",cols:"6"},{default:a(()=>[l(j,{clearable:"",modelValue:e(n).curriculum_id,"onUpdate:modelValue":[t[3]||(t[3]=o=>e(n).curriculum_id=o),t[4]||(t[4]=o=>E(e(p).id,e(n).subject_name,e(n).curriculum_id))],label:"Curriculum",items:e(W),"item-props":o=>({title:o.name}),loading:e(d),readonly:"",density:"compact","item-value":"id"},null,8,["modelValue","items","item-props","loading"])]),_:1}),l(g,{md:"6",cols:"6"},{default:a(()=>[l(j,{clearable:"",modelValue:e(n).subject_name,"onUpdate:modelValue":[t[5]||(t[5]=o=>e(n).subject_name=o),t[6]||(t[6]=o=>E(e(p).id,e(n).subject_name,e(n).curriculum_id))],label:"Subject Tutoring",items:e($),"item-value":"tutor_subject","item-title":"tutor_subject",loading:e(d),disabled:e(d),rules:e(T).required,density:"compact"},null,8,["modelValue","items","loading","disabled","rules"])]),_:1}),l(g,{md:"8",cols:"8"},{default:a(()=>{var o;return[l(j,{clearable:"",label:"Package",modelValue:e(n).package_id,"onUpdate:modelValue":[t[7]||(t[7]=N=>e(n).package_id=N),ee],items:e(M),density:"compact","item-props":N=>({title:N.package!=null?N.type_of+" - "+N.package:N.type_of,subtitle:N.detail?N.detail/60+" Hours":"Customizable"}),"item-value":"id",rules:e(T).required,loading:e(d),disabled:e(d)||((o=e(s)[0])==null?void 0:o.package)},null,8,["modelValue","items","item-props","rules","loading","disabled"])]}),_:1}),l(g,{md:"4",cols:"4"},{default:a(()=>[l(K,{type:"number",clearable:"",label:+e(n).duration/60?"Minutes ("+e(n).duration/60+" Hours)":"Minutes",readonly:e(I),modelValue:e(n).duration,"onUpdate:modelValue":t[8]||(t[8]=o=>e(n).duration=o),density:"compact",rules:e(T).required},null,8,["label","readonly","modelValue","rules"])]),_:1}),l(g,{md:"4",cols:"7"},{default:a(()=>[l(K,{type:"number",clearable:"",label:"Fee/hours (Nett)",modelValue:e(F),"onUpdate:modelValue":[t[9]||(t[9]=o=>z(F)?F.value=o:null),S],density:"compact",rules:e(T).required,readonly:""},null,8,["modelValue","rules"])]),_:1}),l(g,{md:"4",cols:"5"},{default:a(()=>[l(K,{type:"number",clearable:"",label:"Tax",modelValue:e(n).tax,"onUpdate:modelValue":[t[10]||(t[10]=o=>e(n).tax=o),S],rules:e(T).required,density:"compact",readonly:""},null,8,["modelValue","rules"])]),_:1}),l(g,{md:"4",cols:"12"},{default:a(()=>[l(X,{activator:"parent",location:"top"},{default:a(()=>[k(" Fee Gross is automatically calculated based on the entered Net Fee and Tax Rate. ")]),_:1}),l(K,{type:"number",clearable:"",label:"Fee/hours (Gross)",modelValue:e(n).individual_fee,"onUpdate:modelValue":[t[11]||(t[11]=o=>e(n).individual_fee=o),u],density:"compact",readonly:"",rules:e(T).required},null,8,["modelValue","rules"])]),_:1}),l(g,{md:"6",cols:"6"},{default:a(()=>[l(j,{clearable:"",modelValue:e(n).inhouse_id,"onUpdate:modelValue":t[12]||(t[12]=o=>e(n).inhouse_id=o),label:"Inhouse Mentor/Tutor",items:e(Z),density:"compact","item-props":o=>({title:o.full_name}),"item-value":"uuid",loading:e(d),disabled:e(d),rules:e(T).required},null,8,["modelValue","items","item-props","loading","disabled","rules"])]),_:1}),l(g,{md:"6",cols:"6"},{default:a(()=>[l(j,{multiple:"",clearable:"",chips:"",label:"PIC",modelValue:e(n).pic_id,"onUpdate:modelValue":t[13]||(t[13]=o=>e(n).pic_id=o),items:e(R),"item-title":"full_name","item-value":"id",loading:e(d),density:"compact",disabled:e(d),rules:e(T).required},null,8,["modelValue","items","loading","disabled","rules"])]),_:1}),l(g,{md:"12"},{default:a(()=>[l(we,{label:"Notes",modelValue:e(n).notes,"onUpdate:modelValue":t[14]||(t[14]=o=>e(n).notes=o),density:"compact"},null,8,["modelValue"])]),_:1})]),_:1}),l(he,{class:"mt-5 px-0"},{default:a(()=>[l(le,{variant:"tonal",color:"error",type:"button",onClick:t[15]||(t[15]=o=>B("close"))},{default:a(()=>[l(U,{icon:"ri-close-line",class:"me-3"}),k(" Close ")]),_:1}),l(Ve),l(le,{variant:"tonal",color:"success",type:"submit"},{default:a(()=>[k(" Save "),l(U,{icon:"ri-save-line",class:"ms-3"})]),_:1})]),_:1})]),_:1},512)]}),_:1})]),_:1},8,["title"])}}},tt=i("div",{class:"d-flex justify-between align-center"},[i("div",{class:"w-100"},[i("h4",null,"Timesheet List")])],-1),lt={class:"d-flex gap-2"},at=i("th",{class:"text-uppercase",width:"1%"}," No ",-1),ot=i("th",{class:"text-uppercase text-center"},"School/Student Name",-1),nt={class:"text-uppercase text-center"},st=i("th",{class:"text-uppercase text-center"},"Package",-1),rt=i("th",{class:"text-uppercase text-center"},"Tutor/Mentor",-1),it=i("th",{class:"text-uppercase text-center"},"PIC",-1),ut=i("th",{class:"text-uppercase text-center"},"Total Hours",-1),dt=i("th",{class:"text-uppercase text-center"},"Used",-1),ct=i("th",{class:"text-uppercase text-center"},"#",-1),mt=["onClick"],pt={key:0},_t={key:1},ft={class:"text-start"},gt={class:"text-left"},vt={class:"text-left"},bt={class:"text-left"},yt={class:"text-left"},kt={key:0},Vt=i("tr",null,[i("td",{colspan:"9",class:"text-center"}," Sorry, no data found. ")],-1),ht=[Vt],xt={class:"d-flex justify-center mt-5"},Wt={__name:"timesheet",props:{name:String},setup(ce){const D=ce,B=$e();c([]);const d=c(!1),p=c(1),Y=c(),L=c(),W=c([]),$=c(!1),M=c([]),R=c(),Z=c([]),I=c(),C=async()=>{var J,E;const n="?page="+p.value,x=L.value?"&keyword="+L.value:"",O=R.value?"&program_name="+encodeURIComponent(R.value):"",V=I.value?"&package_id="+I.value:"",ee="&paginate=true",v=D.name!="tutoring"?"&is_subject_specialist=true":"";try{$.value=!0;const A=await q.get("api/v1/timesheet/list"+n+x+O+V+ee+v);A&&(p.value=A.current_page,Y.value=A.last_page,W.value=A),$.value=!1}catch(A){Q("error",(E=(J=A.response)==null?void 0:J.data)==null?void 0:E.message,"bottom-end"),console.error(A),$.value=!1}},se=async()=>{try{const n=await q.get("api/v1/program/component/list");n&&(M.value=n)}catch(n){console.error(n)}},F=async()=>{try{const n=await q.get("api/v1/package/component/list");n&&(Z.value=n)}catch(n){console.error(n)}},s=Pe(async n=>{p.value=1,L.value=n.target.value,await C()},1e3),ae=n=>{const x=B.resolve("/admin/timesheet/"+D.name+"/"+n);window.open(x.href,"_blank")};return Te(()=>{C()}),pe(()=>{C(),se(),F()}),(n,x)=>{const O=Se("VText");return m(),h(H,null,[l(_e,{modelValue:e(d),"onUpdate:modelValue":x[2]||(x[2]=V=>z(d)?d.value=V:null),width:"auto",persistent:""},{default:a(()=>[D.name=="tutoring"?(m(),P(et,{key:0,onClose:x[0]||(x[0]=V=>d.value=!1),onReload:C})):(m(),P(ze,{key:1,onClose:x[1]||(x[1]=V=>d.value=!1),onReload:C}))]),_:1},8,["modelValue"]),l(ie,null,{default:a(()=>[l(Ue,null,{default:a(()=>[tt]),_:1}),l(ne,null,{default:a(()=>[l(de,{class:"my-1 justify-space-between"},{default:a(()=>[D.name=="tutoring"?(m(),P(g,{key:0,cols:"12",md:"6"},{default:a(()=>[l(de,null,{default:a(()=>[l(g,{cols:"12",md:"6"},{default:a(()=>[l(j,{density:"compact",clearable:"",modelValue:e(R),"onUpdate:modelValue":[x[3]||(x[3]=V=>z(R)?R.value=V:null),C],label:"Program Name",items:e(M),"item-title":"program_name",placeholder:"Select Program Name",loading:e($),disabled:e($)},null,8,["modelValue","items","loading","disabled"])]),_:1}),l(g,{cols:"12",md:"6"},{default:a(()=>[l(j,{density:"compact",clearable:"true",modelValue:e(I),"onUpdate:modelValue":[x[4]||(x[4]=V=>z(I)?I.value=V:null),C],label:"Package",items:e(Z),"item-props":V=>({title:V.package!=null?V.type_of+" - "+V.package:V.type_of}),"item-value":"id",placeholder:"Select Package",loading:e($),disabled:e($)},null,8,["modelValue","items","item-props","loading","disabled"])]),_:1})]),_:1})]),_:1})):G("",!0),l(g,{cols:"12",md:D.name=="tutoring"?3:12},{default:a(()=>[i("div",lt,[l(K,{density:"compact",loading:e($),disabled:e($),"append-inner-icon":"ri-search-line",label:"Search","hide-details":"","single-line":"",onInput:e(s)},null,8,["loading","disabled","onInput"]),i("div",{class:me(["text-end",D.name=="tutoring"?"":"w-md-75"])},[l(X,{activator:"parent",location:"start"},{default:a(()=>[k("Add New Timesheet")]),_:1}),l(le,{icon:"ri-add-line",onClick:x[5]||(x[5]=V=>d.value=!0)})],2)])]),_:1},8,["md"])]),_:1}),e($)?(m(),P(qe,{key:0,class:"mx-auto border",type:"table-thead, table-row@10"})):(m(),P(fe,{key:1,class:"text-no-wrap",hover:""},{default:a(()=>{var V,ee;return[i("thead",null,[i("tr",null,[at,ot,i("th",nt,y(D.name=="tutoring"?"Program Name":"Engagement Type"),1),st,rt,it,ut,dt,ct])]),i("tbody",null,[(m(!0),h(H,null,te(e(W).data,(v,J)=>(m(),h("tr",{key:J,class:me([v.void=="true"?"bg-secondary":"","cursor-pointer"]),onClick:E=>ae(v.id)},[i("td",null,y(parseInt(J)+1),1),i("td",{class:me(v.group?"cursor-pointer text-left":"text-left")},[v.group?(m(),P(O,{key:0},{default:a(()=>[l(U,{icon:"ri-group-line",class:"me-3"}),k(" "+y(v.clients[0])+" ",1),l(ve,{color:"error",content:v.clients.length-1+"+",inline:""},null,8,["content"]),l(X,{activator:"parent",location:"top",transition:"scroll-y-transition",class:"bg-white"},{default:a(()=>[(m(!0),h(H,null,te(v.clients,E=>(m(),h("div",null,y(E),1))),256))]),_:2},1024)]),_:2},1024)):(m(),P(O,{key:1},{default:a(()=>[l(U,{icon:"ri-user-line",class:"me-3"}),k(" "+y(v.clients),1)]),_:2},1024)),v.spent==v.duration?(m(),P(ve,{key:2,color:"success",content:"Done",inline:"",class:"ms-2"})):G("",!0)],2),D.name=="tutoring"?(m(),h("td",pt,[l(U,{icon:"ri-bookmark-3-line",class:"me-3"}),k(" "+y(v.detail_package=="Trial"?"[TRIAL]":"")+" "+y(v.program_name),1)])):(m(),h("td",_t,[l(U,{icon:"ri-bookmark-3-line",class:"me-3"}),k(" "+y(v.engagement_type),1)])),i("td",ft,[l(U,{icon:"ri-bookmark-line",class:"me-3"}),k(" "+y(v.detail_package?v.package_type+" - "+v.detail_package:v.package_type),1)]),i("td",gt,[l(U,{icon:"ri-user-line",class:"me-3"}),k(" "+y(v.tutor_mentor),1)]),i("td",vt,[l(U,{icon:"ri-user-line",class:"cursor-pointer me-3"}),k(" "+y(v.admin),1)]),i("td",bt,[l(U,{icon:"ri-calendar-schedule-line",class:"cursor-pointer me-3"}),k(" "+y(v.duration/60)+" Hours ",1)]),i("td",yt,[l(U,{icon:"ri-timer-2-line",class:"cursor-pointer me-3"}),k(" "+y((v.spent/60).toFixed(2))+" Hours ",1)]),i("td",null,[l(le,{color:v.void=="true"?"light":"secondary",onClick:E=>ae(v.id)},{default:a(()=>[l(U,{icon:"ri-timeline-view",class:"cursor-pointer"}),l(X,{activator:"parent",location:"top",transition:"scroll-y-transition"},{default:a(()=>[k(" View Detail ")]),_:1})]),_:2},1032,["color","onClick"])])],10,mt))),128))]),((ee=(V=e(W))==null?void 0:V.data)==null?void 0:ee.length)==0?(m(),h("tfoot",kt,ht)):G("",!0)]}),_:1})),i("div",xt,[l(je,{modelValue:e(p),"onUpdate:modelValue":[x[6]||(x[6]=V=>z(p)?p.value=V:null),C],length:e(Y),"total-visible":4,color:"primary","show-first-last-page":!1},null,8,["modelValue","length"])])]),_:1})]),_:1})],64)}}};export{Wt as default};
