import{r as i,e as W,o as p,f as _,w as s,b as l,Z as oe,u as e,z as I,h as X,W as R,Y as z,V as j,j as A,m as se,A as T,s as E,l as re,x as ne,t as $,a as d,c as L,X as ie,F as ue,n as de}from"./main-C7YDAO-v.js";import{r as P}from"./rules-B5G8qOzK.js";import{a as Z,c as ce,V as J,b as me}from"./VCard-CvBGH6Er.js";import{V as pe}from"./VForm-DXKsZBlH.js";import{V as K,a as g}from"./VRow-C_0NEaca.js";import{V as N}from"./VAutocomplete-2_w2XG8q.js";import{V as fe}from"./VTextarea-CgHPT78S.js";import{d as ve}from"./debounce-DrptU6Nr.js";import{V as _e}from"./VDialog-BegWHZ3d.js";import{V as ge,a as be}from"./VTable-DIqq-92A.js";import{V as Ve}from"./VPagination-B9onMoEE.js";import{T as ye}from"./index-Bmz2iX1t.js";import{V as ke}from"./VCheckbox-Bbtt-_5X.js";import{V as Y}from"./VTooltip-_SegqQRd.js";import"./VAvatar-Dj3SEqcq.js";import"./VImg-BjoC2mFC.js";import"./VList-Cf505by_.js";import"./ssrBoot-Cpx9HoY3.js";import"./VDivider-DEzlGTdp.js";import"./VCheckboxBtn-CMowJJQ1.js";import"./VSelectionControl-auFl3Hul.js";import"./VSlideGroup-7VZfJgtJ.js";const xe={__name:"program_add",props:{selected:Object},emits:["close","reload"],setup(G,{emit:b}){var H,O;const w=G,x=b,c=i(!1),f=i([]),S=i([]),V=i([]),D=i([]),U=i([]),h=i([]),F=i([]),M=i([]),y=i(!1),u=(O=(H=w.selected[0])==null?void 0:H.require)==null?void 0:O.toLowerCase(),C=i(),t=i({ref_id:w.selected.map(r=>r.id),mentortutor_email:null,subject_id:null,inhouse_id:null,package_id:null,duration:"",notes:"",pic_id:[]}),q=async(r=!1)=>{const a=r?"api/v1/user/mentor-tutors?inhouse=true&role="+u:"api/v1/user/mentor-tutors?role="+u;try{const n=await T.get(a);n&&(r?M.value=Object.values(n):V.value=n)}catch(n){console.error(n)}},m=async()=>{try{const r=await T.get("api/v1/package/component/list?category="+u);r&&(h.value=r)}catch(r){console.error(r)}},k=()=>{const r=t.value.package_id,a=h.value.findIndex(v=>v.id===r);let n=h.value[a];n.detail?(y.value=!0,t.value.duration=n.detail):(y.value=!1,t.value.duration=null)},B=async()=>{try{const r=await T.get("api/v1/user/component/list");r&&(F.value=r)}catch(r){console.error(r)}},Q=async(r,a=null)=>{if(t.value.subject_id=null,u=="mentor")t.value.subject_id=r[0].subjects[0].id;else try{const n=await T.get("api/v1/user/mentor-tutors/"+a+"/subjects");n&&(U.value=n)}catch(n){console.error(n)}},ee=async(r,a)=>{try{const n=await T.get("api/v1/component/fee/"+r+"/"+a);n&&(t.value.individual_fee=n.fee_individual)}catch(n){console.error(n)}},le=async()=>{try{const r=await T.get("api/v1/curriculum/component/list");r&&(D.value=r)}catch(r){console.error(r)}},te=async()=>{var a,n;c.value=!0,t.value.mentortutor_email=f.value.email;const{valid:r}=await C.value.validate();if(r)try{const v=await T.post("api/v1/timesheet/create",t.value);v&&(E("success",v.message,"bottom-end"),x("reload"),selected.value=[],t.value={ref_id:[],mentortutor_email:null,subject_id:null,subject_name:null,inhouse_id:null,package_id:null,duration:"",notes:"",pic_id:[],individual_fee:""},f.value=[])}catch(v){if(console.log(v),(n=(a=v==null?void 0:v.response)==null?void 0:a.data)!=null&&n.errors){const o=v.response.data.errors;E("error",o,"bottom-end")}}finally{x("close"),c.value=!1}};return W(()=>{q(),q(!0),m(),B(),le()}),(r,a)=>(p(),_(J,{width:"650","prepend-icon":"ri-send-plane-line",title:"Assign to Mentor/Tutor"},{default:s(()=>[l(Z,null,{default:s(()=>[l(pe,{onSubmit:oe(te,["prevent"]),ref_key:"formData",ref:C,"validate-on":"input"},{default:s(()=>[l(K,null,{default:s(()=>{var n,v;return[l(g,{md:"12"},{default:s(()=>[l(N,{variant:"solo",clearable:"",modelValue:e(f),"onUpdate:modelValue":[a[0]||(a[0]=o=>I(f)?f.value=o:null),a[1]||(a[1]=o=>Q(e(f).roles,e(f).uuid))],label:"Mentor/Tutor",items:e(V),"item-props":o=>({title:o.full_name,subtitle:o.roles.map(ae=>ae.name).join(", ")}),rules:e(P).required,loading:e(c),disabled:e(c)},null,8,["modelValue","items","item-props","rules","loading","disabled"])]),_:1}),l(g,{md:"6",col:"12"},{default:s(()=>[l(N,{variant:"solo",clearable:"",modelValue:e(S),"onUpdate:modelValue":a[2]||(a[2]=o=>I(S)?S.value=o:null),label:"Curriculum",items:e(D),"item-props":o=>({title:o.name}),rules:e(P).required,loading:e(c),disabled:e(c)},null,8,["modelValue","items","item-props","rules","loading","disabled"])]),_:1}),((v=(n=w.selected[0])==null?void 0:n.require)==null?void 0:v.toLowerCase())=="tutor"?(p(),_(g,{key:0,md:"6",col:"12"},{default:s(()=>[l(N,{variant:"solo",clearable:"",modelValue:e(t).subject_name,"onUpdate:modelValue":[a[3]||(a[3]=o=>e(t).subject_name=o),a[4]||(a[4]=o=>ee(e(f).id,e(t).subject_name))],label:"Subject Tutoring",items:e(U),loading:e(c),disabled:e(c),rules:e(P).required},null,8,["modelValue","items","loading","disabled","rules"])]),_:1})):X("",!0),l(g,{md:"5",col:"12"},{default:s(()=>[l(N,{variant:"solo",clearable:"",label:"Package",modelValue:e(t).package_id,"onUpdate:modelValue":[a[5]||(a[5]=o=>e(t).package_id=o),k],items:e(h),"item-props":o=>({title:o.package!=null?o.type_of+" - "+o.package:o.type_of,subtitle:o.detail?o.detail/60+" Hours":"Customizable"}),"item-value":"id",rules:e(P).required,loading:e(c),disabled:e(c)},null,8,["modelValue","items","item-props","rules","loading","disabled"])]),_:1}),l(g,{md:"3",col:"7"},{default:s(()=>[l(R,{type:"number",variant:"solo",clearable:"",label:+e(t).duration/60?""+e(t).duration/60+" Hours":"Minutes",readonly:e(y),modelValue:e(t).duration,"onUpdate:modelValue":a[6]||(a[6]=o=>e(t).duration=o),rules:e(P).required},null,8,["label","readonly","modelValue","rules"])]),_:1}),l(g,{md:"4",col:"5"},{default:s(()=>[l(R,{type:"number",variant:"solo",clearable:"",label:"Fee/hours",modelValue:e(t).individual_fee,"onUpdate:modelValue":a[7]||(a[7]=o=>e(t).individual_fee=o),rules:e(P).required},null,8,["modelValue","rules"])]),_:1}),l(g,{md:"6",col:"12"},{default:s(()=>[l(N,{variant:"solo",clearable:"",modelValue:e(t).inhouse_id,"onUpdate:modelValue":a[8]||(a[8]=o=>e(t).inhouse_id=o),label:"Inhouse Mentor/Tutor",items:e(M),"item-props":o=>({title:o.full_name}),"item-value":"uuid",loading:e(c),disabled:e(c),rules:e(P).required},null,8,["modelValue","items","item-props","loading","disabled","rules"])]),_:1}),l(g,{md:"6",col:"12"},{default:s(()=>[l(N,{variant:"solo",multiple:"",clearable:"",chips:"",label:"PIC",modelValue:e(t).pic_id,"onUpdate:modelValue":a[9]||(a[9]=o=>e(t).pic_id=o),items:e(F),"item-title":"full_name","item-value":"id",loading:e(c),disabled:e(c),rules:e(P).required},null,8,["modelValue","items","loading","disabled","rules"])]),_:1}),l(g,{md:"12"},{default:s(()=>[l(fe,{label:"Notes",modelValue:e(t).notes,"onUpdate:modelValue":a[10]||(a[10]=o=>e(t).notes=o),variant:"solo"},null,8,["modelValue"])]),_:1})]}),_:1}),l(ce,{class:"mt-5"},{default:s(()=>[l(z,{color:"error",type:"button",onClick:a[11]||(a[11]=n=>x("close"))},{default:s(()=>[l(j,{icon:"ri-close-line",class:"me-3"}),A(" Close ")]),_:1}),l(se),l(z,{color:"success",type:"submit"},{default:s(()=>[A(" Save "),l(j,{icon:"ri-save-line",class:"ms-3"})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1}))}},he=d("div",{class:"d-flex justify-between align-center"},[d("div",{class:"w-100"},[d("h4",null,"Program Name")])],-1),we=d("thead",null,[d("tr",null,[d("th",{class:"text-uppercase",width:"1%"}," # "),d("th",{class:"text-uppercase text-center"},"Student/School Name"),d("th",{class:"text-uppercase text-center"},"Program Name"),d("th",{class:"text-uppercase text-center"},"Trial"),d("th",{class:"text-uppercase text-center"},"Timesheet")])],-1),Ce={class:"text-left",nowrap:""},je={class:"text-left",nowrap:""},Te={class:"text-center",nowrap:""},Ue={class:"text-center"},qe={key:0},Pe=d("tr",null,[d("td",{colspan:"6",class:"text-center"}," Sorry, no data found. ")],-1),Se=[Pe],Ne={class:"d-flex justify-center mt-5"},ll={__name:"program",setup(G){const b=i([]),w=i(!1),x=i(1),c=i(),f=i(),S=i([]),V=i(!1),D=i([]),U=i();i(),i({ref_id:[],mentortutor_email:null,subject_id:null,inhouse_id:null,package_id:null,duration:"",notes:"",pic_id:[]});const h=async()=>{var q,m;b.value=[];const y="?page="+x.value,u=f.value?"&keyword="+f.value:"",C=U.value?"&program_name="+encodeURIComponent(U.value):"",t="&paginate=true";try{V.value=!0;const k=await T.get("api/v1/program/list"+y+u+C+t);k&&(x.value=k.current_page,c.value=k.last_page,S.value=k),V.value=!1}catch(k){E("error",(m=(q=k.response)==null?void 0:q.data)==null?void 0:m.message,"bottom-end"),console.error(k),V.value=!1}},F=async()=>{try{const y=await T.get("api/v1/program/component/list");y&&(D.value=y)}catch(y){console.error(y)}},M=ve(async()=>{x.value=1,await h()},1e3);return W(()=>{h(),F()}),(y,u)=>{const C=re("VText");return p(),_(J,null,{default:s(()=>[l(me,null,{default:s(()=>[he]),_:1}),l(Z,null,{default:s(()=>[l(K,{class:"my-1"},{default:s(()=>[l(g,{cols:"12",md:"3"},{default:s(()=>[l(N,{clearable:"",modelValue:e(U),"onUpdate:modelValue":[u[0]||(u[0]=t=>I(U)?U.value=t:null),h],label:"Program Name",items:e(D),"item-title":"program_name",placeholder:"Select Program Name",density:"compact",variant:"solo","hide-details":"","single-line":"",loading:e(V),disabled:e(V)},null,8,["modelValue","items","loading","disabled"])]),_:1}),l(g,{cols:"12",md:"3"},{default:s(()=>[l(R,{loading:e(V),disabled:e(V),"append-inner-icon":"ri-search-line",density:"compact",label:"Search",variant:"solo","hide-details":"","single-line":"",modelValue:e(f),"onUpdate:modelValue":u[1]||(u[1]=t=>I(f)?f.value=t:null),onInput:e(M)},null,8,["loading","disabled","modelValue","onInput"])]),_:1}),l(g,{cols:"12",md:"6",class:"text-end"},{default:s(()=>[ne((p(),_(z,{density:"compact",color:e(b).length>0?"warning":"primary",class:"mb-2",disabled:!(e(b).length>0),onClick:u[2]||(u[2]=t=>w.value=!0)},{default:s(()=>[A(" Assign "+$(e(b).length>1?"to Group":""),1)]),_:1},8,["color","disabled"])),[[ye,"Generate Timesheet","start"]])]),_:1})]),_:1}),l(_e,{modelValue:e(w),"onUpdate:modelValue":u[4]||(u[4]=t=>I(w)?w.value=t:null),width:"auto",persistent:""},{default:s(()=>[l(xe,{selected:e(b),onClose:u[3]||(u[3]=t=>w.value=!1),onReload:h},null,8,["selected"])]),_:1},8,["modelValue"]),e(V)?(p(),_(ge,{key:0,class:"mx-auto border",type:"table-thead, table-row@10"})):(p(),_(be,{key:1,class:"table-responsive"},{default:s(()=>{var t,q;return[we,d("tbody",null,[(p(!0),L(ue,null,ie(e(S).data,(m,k)=>(p(),L("tr",{key:k,class:de({"bg-secondary":e(b).includes(m.id)})},[d("td",null,[m.timesheet_id?(p(),_(j,{key:1,icon:"ri-check-line",color:"success"})):(p(),_(ke,{key:0,modelValue:e(b),"onUpdate:modelValue":u[5]||(u[5]=B=>I(b)?b.value=B:null),value:{id:m.id,require:m.require}},null,8,["modelValue","value"]))]),d("td",Ce,[l(j,{icon:"ri-user-line",class:"me-3"}),A(" "+$(m.student_name+" - "+m.student_school),1)]),d("td",je,[l(j,{icon:"ri-bookmark-line",class:"me-3"}),A(" "+$(m.free_trial?"[TRIAL]":"")+" "+$(m.program_name),1)]),d("td",Te,[m.free_trial?(p(),_(C,{key:0},{default:s(()=>[l(j,{icon:"ri-check-line",class:"mx-1",color:"success"})]),_:1})):(p(),_(C,{key:1},{default:s(()=>[l(j,{icon:"ri-close-line",class:"mx-1",color:"error"})]),_:1}))]),d("td",Ue,[m.timesheet_id?(p(),_(C,{key:0},{default:s(()=>[l(j,{icon:"ri-file-check-line",class:"mx-1",color:"success"}),l(Y,{activator:"parent",location:"top"},{default:s(()=>[A("Already")]),_:1})]),_:1})):(p(),_(C,{key:1},{default:s(()=>[l(j,{icon:"ri-file-close-line",class:"mx-1",color:"error"}),l(Y,{activator:"parent",location:"top"},{default:s(()=>[A("Not Yet")]),_:1})]),_:1}))])],2))),128))]),((q=(t=e(S))==null?void 0:t.data)==null?void 0:q.length)==0?(p(),L("tfoot",qe,Se)):X("",!0)]}),_:1})),d("div",Ne,[l(Ve,{modelValue:e(x),"onUpdate:modelValue":[u[6]||(u[6]=t=>I(x)?x.value=t:null),h],length:e(c),"total-visible":4,color:"primary",density:"compact","show-first-last-page":!1},null,8,["modelValue","length"])])]),_:1})]),_:1})}}};export{ll as default};
