import{r as i,e as W,o as v,f as w,w as s,b as l,Z as oe,u as e,z as N,h as X,W as R,Y as z,V as I,j as A,m as se,A as C,s as E,l as re,x as ne,t as B,a as c,c as L,X as ie,F as ue,n as de}from"./main-hx09Hrpa.js";import{r as U}from"./rules-B5G8qOzK.js";import{a as Z,c as ce,V as J,b as me}from"./VCard-D7fXvrE8.js";import{V as pe}from"./VForm-TiMvonFV.js";import{V as K,a as g}from"./VRow-CVTsRxDz.js";import{V as S}from"./VAutocomplete-BJH8Lg-T.js";import{V as fe}from"./VTextarea-Cj8c-SUQ.js";import{d as ve}from"./debounce-D1wdy3__.js";import{V as ge}from"./VDialog-9PVBv1Rz.js";import{V as _e,a as be}from"./VTable-567X0Y2R.js";import{V as Ve}from"./VPagination-Q3SSnUME.js";import{T as ye}from"./index-D849mLXv.js";import{V as ke}from"./VCheckbox-DNgCosTe.js";import{V as Y}from"./VTooltip-D-rywHCX.js";import"./VAvatar-Da3c__KI.js";import"./VImg-CgRfhXmv.js";import"./VList-BbE8kIo3.js";import"./ssrBoot-Va78v84f.js";import"./VDivider-TgHQQllx.js";import"./VCheckboxBtn-BPJSNm-y.js";import"./VSelectionControl-JlkdGNsC.js";import"./VSlideGroup-sCkXUHt4.js";const he={__name:"program_add",props:{selected:Object},emits:["close","reload"],setup(G,{emit:_}){var H,O;const x=G,k=_,d=i(!1),m=i([]),q=i([]),b=i([]),D=i([]),j=i([]),h=i([]),F=i([]),M=i([]),V=i(!1),u=(O=(H=x.selected[0])==null?void 0:H.require)==null?void 0:O.toLowerCase(),P=i(),t=i({ref_id:x.selected.map(r=>r.id),mentortutor_email:null,subject_id:null,inhouse_id:null,package_id:null,duration:"",notes:"",pic_id:[]}),T=async(r=!1)=>{const a=r?"api/v1/user/mentor-tutors?inhouse=true&role="+u:"api/v1/user/mentor-tutors?role="+u;try{const n=await C.get(a);n&&(r?M.value=Object.values(n):b.value=n)}catch(n){console.error(n)}},p=async()=>{try{const r=await C.get("api/v1/package/component/list?category="+u);r&&(h.value=r)}catch(r){console.error(r)}},y=()=>{const r=t.value.package_id,a=h.value.findIndex(f=>f.id===r);let n=h.value[a];n.detail?(V.value=!0,t.value.duration=n.detail):(V.value=!1,t.value.duration=null)},$=async()=>{try{const r=await C.get("api/v1/user/component/list");r&&(F.value=r)}catch(r){console.error(r)}},Q=async(r,a=null)=>{if(t.value.subject_id=null,u=="mentor")t.value.subject_id=r[0].subjects[0].id;else try{const n=await C.get("api/v1/user/mentor-tutors/"+a+"/subjects");n&&(j.value=n)}catch(n){console.error(n)}},ee=async(r,a)=>{try{const n=await C.get("api/v1/component/fee/"+r+"/"+a);n&&(t.value.individual_fee=n.fee_individual)}catch(n){console.error(n)}},le=async()=>{try{const r=await C.get("api/v1/curriculum/component/list");r&&(D.value=r)}catch(r){console.error(r)}},te=async()=>{var a,n;d.value=!0,t.value.mentortutor_email=m.value.email;const{valid:r}=await P.value.validate();if(r)try{const f=await C.post("api/v1/timesheet/create",t.value);f&&(E("success",f.message,"bottom-end"),k("reload"),selected.value=[],t.value={ref_id:[],mentortutor_email:null,subject_id:null,subject_name:null,inhouse_id:null,package_id:null,duration:"",notes:"",pic_id:[],individual_fee:""},m.value=[])}catch(f){if(console.log(f),(n=(a=f==null?void 0:f.response)==null?void 0:a.data)!=null&&n.errors){const o=f.response.data.errors;E("error",o,"bottom-end")}}finally{k("close"),d.value=!1}};return W(()=>{T(),T(!0),p(),$(),le()}),(r,a)=>(v(),w(J,{width:"650","prepend-icon":"ri-send-plane-line",title:"Assign to Mentor/Tutor"},{default:s(()=>[l(Z,null,{default:s(()=>[l(pe,{onSubmit:oe(te,["prevent"]),ref_key:"formData",ref:P,"validate-on":"input"},{default:s(()=>[l(K,null,{default:s(()=>{var n,f;return[l(g,{md:"12"},{default:s(()=>[l(S,{variant:"solo",clearable:"",modelValue:e(m),"onUpdate:modelValue":[a[0]||(a[0]=o=>N(m)?m.value=o:null),a[1]||(a[1]=o=>Q(e(m).roles,e(m).uuid))],label:"Mentor/Tutor",items:e(b),"item-props":o=>({title:o.full_name,subtitle:o.roles.map(ae=>ae.name).join(", ")}),rules:e(U).required,loading:e(d),disabled:e(d)},null,8,["modelValue","items","item-props","rules","loading","disabled"])]),_:1}),l(g,{md:"6",col:"12"},{default:s(()=>[l(S,{variant:"solo",clearable:"",modelValue:e(q),"onUpdate:modelValue":a[2]||(a[2]=o=>N(q)?q.value=o:null),label:"Curriculum",items:e(D),"item-props":o=>({title:o.name}),rules:e(U).required,loading:e(d),disabled:e(d)},null,8,["modelValue","items","item-props","rules","loading","disabled"])]),_:1}),((f=(n=x.selected[0])==null?void 0:n.require)==null?void 0:f.toLowerCase())=="tutor"?(v(),w(g,{key:0,md:"6",col:"12"},{default:s(()=>[l(S,{variant:"solo",clearable:"",modelValue:e(t).subject_name,"onUpdate:modelValue":[a[3]||(a[3]=o=>e(t).subject_name=o),a[4]||(a[4]=o=>ee(e(m).id,e(t).subject_name))],label:"Subject Tutoring",items:e(j),loading:e(d),disabled:e(d),rules:e(U).required},null,8,["modelValue","items","loading","disabled","rules"])]),_:1})):X("",!0),l(g,{md:"5",col:"12"},{default:s(()=>[l(S,{variant:"solo",clearable:"",label:"Package",modelValue:e(t).package_id,"onUpdate:modelValue":[a[5]||(a[5]=o=>e(t).package_id=o),y],items:e(h),"item-props":o=>({title:o.package!=null?o.type_of+" - "+o.package:o.type_of,subtitle:o.detail?o.detail/60+" Hours":"Customizable"}),"item-value":"id",rules:e(U).required,loading:e(d),disabled:e(d)},null,8,["modelValue","items","item-props","rules","loading","disabled"])]),_:1}),l(g,{md:"3",col:"7"},{default:s(()=>[l(R,{type:"number",variant:"solo",clearable:"",label:+e(t).duration/60?""+e(t).duration/60+" Hours":"Minutes",readonly:e(V),modelValue:e(t).duration,"onUpdate:modelValue":a[6]||(a[6]=o=>e(t).duration=o),rules:e(U).required},null,8,["label","readonly","modelValue","rules"])]),_:1}),l(g,{md:"4",col:"5"},{default:s(()=>[l(R,{type:"number",variant:"solo",clearable:"",label:"Fee/hours",modelValue:e(t).individual_fee,"onUpdate:modelValue":a[7]||(a[7]=o=>e(t).individual_fee=o),rules:e(U).required},null,8,["modelValue","rules"])]),_:1}),l(g,{md:"6",col:"12"},{default:s(()=>[l(S,{variant:"solo",clearable:"",modelValue:e(t).inhouse_id,"onUpdate:modelValue":a[8]||(a[8]=o=>e(t).inhouse_id=o),label:"Inhouse Mentor/Tutor",items:e(M),"item-props":o=>({title:o.full_name}),"item-value":"uuid",loading:e(d),disabled:e(d),rules:e(U).required},null,8,["modelValue","items","item-props","loading","disabled","rules"])]),_:1}),l(g,{md:"6",col:"12"},{default:s(()=>[l(S,{variant:"solo",multiple:"",clearable:"",chips:"",label:"PIC",modelValue:e(t).pic_id,"onUpdate:modelValue":a[9]||(a[9]=o=>e(t).pic_id=o),items:e(F),"item-title":"full_name","item-value":"id",loading:e(d),disabled:e(d),rules:e(U).required},null,8,["modelValue","items","loading","disabled","rules"])]),_:1}),l(g,{md:"12"},{default:s(()=>[l(fe,{label:"Notes",modelValue:e(t).notes,"onUpdate:modelValue":a[10]||(a[10]=o=>e(t).notes=o),variant:"solo"},null,8,["modelValue"])]),_:1})]}),_:1}),l(ce,{class:"mt-5"},{default:s(()=>[l(z,{color:"error",type:"button",onClick:a[11]||(a[11]=n=>k("close"))},{default:s(()=>[l(I,{icon:"ri-close-line",class:"me-3"}),A(" Close ")]),_:1}),l(se),l(z,{color:"success",type:"submit"},{default:s(()=>[A(" Save "),l(I,{icon:"ri-save-line",class:"ms-3"})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1}))}},we=c("div",{class:"d-flex justify-between align-center"},[c("div",{class:"w-100"},[c("h4",null,"Program Name")])],-1),xe=c("thead",null,[c("tr",null,[c("th",{class:"text-uppercase",width:"1%"}," # "),c("th",{class:"text-uppercase text-center"},"Student/School Name"),c("th",{class:"text-uppercase text-center"},"Program Name"),c("th",{class:"text-uppercase text-center"},"Timesheet")])],-1),Ce={class:"text-left",nowrap:""},je={class:"text-left",nowrap:""},Te={class:"text-center"},Ue={key:0},qe=c("tr",null,[c("td",{colspan:"6",class:"text-center"}," Sorry, no data found. ")],-1),Pe=[qe],Se={class:"d-flex justify-center mt-5"},el={__name:"program",setup(G){const _=i([]),x=i(!1),k=i(1),d=i(),m=i(),q=i([]),b=i(!1),D=i([]),j=i();i(),i({ref_id:[],mentortutor_email:null,subject_id:null,inhouse_id:null,package_id:null,duration:"",notes:"",pic_id:[]});const h=async()=>{var T,p;_.value=[];const V="?page="+k.value,u=m.value?"&keyword="+m.value:"",P=j.value?"&program_name="+encodeURIComponent(j.value):"",t="&paginate=true";try{b.value=!0;const y=await C.get("api/v1/program/list"+V+u+P+t);y&&(k.value=y.current_page,d.value=y.last_page,q.value=y),b.value=!1}catch(y){E("error",(p=(T=y.response)==null?void 0:T.data)==null?void 0:p.message,"bottom-end"),console.error(y),b.value=!1}},F=async()=>{try{const V=await C.get("api/v1/program/component/list");V&&(D.value=V)}catch(V){console.error(V)}},M=ve(async()=>{k.value=1,await h()},1e3);return W(()=>{h(),F()}),(V,u)=>{const P=re("VText");return v(),w(J,null,{default:s(()=>[l(me,null,{default:s(()=>[we]),_:1}),l(Z,null,{default:s(()=>[l(K,{class:"my-1"},{default:s(()=>[l(g,{cols:"12",md:"3"},{default:s(()=>[l(S,{clearable:"",modelValue:e(j),"onUpdate:modelValue":[u[0]||(u[0]=t=>N(j)?j.value=t:null),h],label:"Program Name",items:e(D),"item-title":"program_name",placeholder:"Select Program Name",density:"compact",variant:"solo","hide-details":"","single-line":"",loading:e(b),disabled:e(b)},null,8,["modelValue","items","loading","disabled"])]),_:1}),l(g,{cols:"12",md:"3"},{default:s(()=>[l(R,{loading:e(b),disabled:e(b),"append-inner-icon":"ri-search-line",density:"compact",label:"Search",variant:"solo","hide-details":"","single-line":"",modelValue:e(m),"onUpdate:modelValue":u[1]||(u[1]=t=>N(m)?m.value=t:null),onInput:e(M)},null,8,["loading","disabled","modelValue","onInput"])]),_:1}),l(g,{cols:"12",md:"6",class:"text-end"},{default:s(()=>[ne((v(),w(z,{density:"compact",color:e(_).length>0?"warning":"primary",class:"mb-2",disabled:!(e(_).length>0),onClick:u[2]||(u[2]=t=>x.value=!0)},{default:s(()=>[A(" Assign "+B(e(_).length>1?"to Group":""),1)]),_:1},8,["color","disabled"])),[[ye,"Generate Timesheet","start"]])]),_:1})]),_:1}),l(ge,{modelValue:e(x),"onUpdate:modelValue":u[4]||(u[4]=t=>N(x)?x.value=t:null),width:"auto",persistent:""},{default:s(()=>[l(he,{selected:e(_),onClose:u[3]||(u[3]=t=>x.value=!1),onReload:h},null,8,["selected"])]),_:1},8,["modelValue"]),e(b)?(v(),w(_e,{key:0,class:"mx-auto border",type:"table-thead, table-row@10"})):(v(),w(be,{key:1,class:"table-responsive"},{default:s(()=>{var t,T;return[xe,c("tbody",null,[(v(!0),L(ue,null,ie(e(q).data,(p,y)=>(v(),L("tr",{key:y,class:de({"bg-secondary":e(_).includes(p.id)})},[c("td",null,[p.timesheet_id?(v(),w(I,{key:1,icon:"ri-check-line",color:"success"})):(v(),w(ke,{key:0,modelValue:e(_),"onUpdate:modelValue":u[5]||(u[5]=$=>N(_)?_.value=$:null),value:{id:p.id,require:p.require}},null,8,["modelValue","value"]))]),c("td",Ce,[l(I,{icon:"ri-user-line",class:"me-3"}),A(" "+B(p.student_name+" - "+p.student_school),1)]),c("td",je,[l(I,{icon:"ri-bookmark-line",class:"me-3"}),A(" "+B(p.program_name),1)]),c("td",Te,[p.timesheet_id?(v(),w(P,{key:0},{default:s(()=>[l(I,{icon:"ri-file-check-line",class:"mx-1",color:"success"}),l(Y,{activator:"parent",location:"top"},{default:s(()=>[A("Already")]),_:1})]),_:1})):(v(),w(P,{key:1},{default:s(()=>[l(I,{icon:"ri-file-close-line",class:"mx-1",color:"error"}),l(Y,{activator:"parent",location:"top"},{default:s(()=>[A("Not Yet")]),_:1})]),_:1}))])],2))),128))]),((T=(t=e(q))==null?void 0:t.data)==null?void 0:T.length)==0?(v(),L("tfoot",Ue,Pe)):X("",!0)]}),_:1})),c("div",Se,[l(Ve,{modelValue:e(k),"onUpdate:modelValue":[u[6]||(u[6]=t=>N(k)?k.value=t:null),h],length:e(d),"total-visible":4,color:"primary",density:"compact","show-first-last-page":!1},null,8,["modelValue","length"])])]),_:1})]),_:1})}}};export{el as default};
