import{u as j,c as M,r as c,o as B,J as p,a as N,b as t,w as s,v as D,d as h,A as _,U as k,s as m,e as E,f,h as a,i as y,j as P,V as w,k as F}from"./main-C7HeVIZ5.js";import{r as x}from"./rules-CkvmYWH-.js";import{l as I}from"./eduall-jXBsxaj5.js";import{a as J,b as Y}from"./auth-v1-mask-light--N6hHkxK.js";import{V as q,a as R,b as W,c as T}from"./VCard-Ba63PbrT.js";import{V as $}from"./VForm-pnfd7m6F.js";import{V as z,a as G}from"./VRow-9L048_KB.js";import"./VAvatar-C0Zf_2GF.js";import"./VImg-D2-scTzC.js";const H={class:"auth-wrapper d-flex align-center justify-center pa-4"},K={class:"d-flex justify-center mb-5"},O=["src"],Q=f("h5",{class:"text-h5 font-weight-semibold mb-1"},"Welcome to Timesheet App! ",-1),X=f("p",{class:"mb-0"},"Please sign-in to your account and start the adventure",-1),ie={__name:"login-admin",props:{email:String,token:String},setup(A){const C=j();M(()=>C.global.name.value==="light"?J:Y);const n=A,g=c(),i=c({email:"",password:""}),l=c(!1),u=c(!1),L=async()=>{var e,r,v,b,V;const{valid:d}=await g.value.validate();if(d)try{l.value=!0;const o=await _.post("api/v1/auth/token",i.value);o&&(p.saveToken(o.granted_token),k.saveUser(o),m("success","You`ve successfully login.","bottom-end"),setTimeout(()=>{h.go("/admin/dashboard")},1500)),l.value=!1}catch(o){typeof o.response.data.errors=="object"?m("error",(v=(r=(e=o.response)==null?void 0:e.data)==null?void 0:r.errors)==null?void 0:v.email,"bottom-end"):m("error",(V=(b=o.response)==null?void 0:b.data)==null?void 0:V.errors,"bottom-end"),l.value=!1,console.error(o)}},S=()=>{D().isAuthenticated.value&&h.push("/admin/dashboard")},U=async()=>{l.value=!0;const d="api/v1/auth/token/"+(n==null?void 0:n.email)+"?signature="+n.token;try{const e=await _.get(d);e&&(console.log(e),p.saveToken(e.granted_token),k.saveUser(e),m("success","You`ve successfully login.","bottom-end"),setTimeout(()=>{h.go("/admin/dashboard")},1500))}catch(e){console.log(e)}finally{l.value=!1}};return B(()=>{S(),(n.email||n.token)&&!p.getToken()&&U()}),(d,e)=>(E(),N("div",H,[t(q,{class:"auth-card pa-4 pt-7","max-width":"448"},{default:s(()=>[t(R,{class:"justify-center"},{default:s(()=>[f("div",K,[f("img",{src:a(I),alt:"Timesheet - EduALL",class:"w-50 text-center"},null,8,O)]),t(W,{class:"font-weight-semibold text-2xl text-uppercase"},{default:s(()=>[y(" Timesheet App ")]),_:1})]),_:1}),t(T,{class:"pt-2 text-center"},{default:s(()=>[Q,X]),_:1}),t(T,null,{default:s(()=>[t($,{onSubmit:P(L,["prevent"]),ref_key:"formData",ref:g,"validate-on":"input","fast-fail":""},{default:s(()=>[t(z,null,{default:s(()=>[t(G,{cols:"12"},{default:s(()=>[t(w,{modelValue:a(i).email,"onUpdate:modelValue":e[0]||(e[0]=r=>a(i).email=r),label:"Email",type:"email",class:"mb-3",rules:a(x).email},null,8,["modelValue","rules"]),t(w,{modelValue:a(i).password,"onUpdate:modelValue":e[1]||(e[1]=r=>a(i).password=r),label:"Password",placeholder:"路路路路路路路路路路路路",type:a(u)?"text":"password","append-inner-icon":a(u)?"ri-eye-off-line":"ri-eye-line","onClick:appendInner":e[2]||(e[2]=r=>u.value=!a(u)),class:"mb-5",rules:a(x).required},null,8,["modelValue","type","append-inner-icon","rules"]),t(F,{block:"",type:"submit",loading:a(l),disabled:a(l)},{default:s(()=>[y(" Login ")]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]))}};export{ie as default};
